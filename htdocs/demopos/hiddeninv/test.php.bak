<?php
//print_r($_POST);

//輸入暫結單
/*create.tempdb.php*/
/*
POST:
machinetype				='m1'
consecnumber				=''
memno				=$_POST['memno'][]
no				=$_POST['no'][]
number				=$_POST['number'][]
listtype				=$initsetting['init']['ordertype']
typeno				=$_POST['type'][]
type				=array()
name				=$_POST['name'][]
taste1				=$_POST['taste'][]
taste1name				=array()
taste1number				=array()
mname1				=$_POST['mname'][]
unitprice				=$_POST['money'][]
usercode				=system
username				=系統寫入
discount				=array(0)
discontent				=array()
listtotal				=$_POST['subtotal'][]
memberdis				=array(0)
listdis1				=array(0)
listdis2				=array(0)
autodis				=array(0)
should				=$_POST['subtotal'][]
charge				=array(0)
tablenumber				=array()
invsalemoney				=$_POST['subtotal'][]
*/
$initsetting=parse_ini_file('../../database/initsetting.ini',true);

$type=array();
$discount=array();
$discontent=array();

array_shift($_POST['no']);
array_shift($_POST['number']);
array_shift($_POST['type']);
array_shift($_POST['name']);
array_shift($_POST['taste']);
array_shift($_POST['tastename']);
array_shift($_POST['tastenumber']);
array_shift($_POST['mname']);
array_shift($_POST['money']);
for($i=0;$i<sizeof($_POST['type']);$i++){
	array_push($type,'');
	array_push($discount,'');
	array_push($discontent,'');
}
$PostData=array('machinetype'=>'m1','consecnumber'=>'','memno'=>$_POST['memno'][0],'no'=>json_encode($_POST['no']),'number'=>json_encode($_POST['number']),'listtype'=>$initsetting['init']['ordertype'],'typeno'=>json_encode($_POST['type']),'type'=>json_encode($type),'name'=>json_encode($_POST['name']),'taste1'=>json_encode($_POST['taste']),'taste1name'=>json_encode($_POST['tastename']),'taste1number'=>json_encode($_POST['tastenumber']),'mname1'=>json_encode($_POST['mname']),'unitprice'=>json_encode($_POST['money']),'usercode'=>'system','username'=>'系統寫入','discount'=>json_encode($discount),'discontent'=>json_encode($discontent),'listtotal'=>$_POST['subtotal'][0],'memberdis'=>'0','listdis1'=>'0','listdis2'=>'0','autodis'=>'0','should'=>$_POST['subtotal'][0],'charge'=>'0','tablenumber'=>'','invsalemoney'=>$_POST['subtotal'][0]));
print_r($PostData);

//print_r($_SERVER);
$temp=preg_split('/htdocs/',dirname(__FILE__));
//echo $_SERVER['HTTP_HOST'].$temp[1];
$ttemp=preg_split('/hidden/',$temp[1]);
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, 'http://'.$_SERVER['HTTP_HOST'].$ttemp[0].'lib/js/create.tempdb.php');
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
curl_setopt($ch, CURLOPT_POST, 1);
// Edit: prior variable $postFields should be $postfields;
curl_setopt($ch, CURLOPT_POSTFIELDS, $PostData);
curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0); // On dev server only!
$Result = curl_exec($ch);
if(curl_errno($ch) !== 0) {
	print_r('cURL error when connecting to ' . $_SERVER['HTTP_HOST'].$ttemp[0].'lib/js/create.tempdb.php' . ': ' . curl_error($_SERVER['HTTP_HOST'].$ttemp[0].'lib/js/create.tempdb.php'));
}
curl_close($ch);
$memlist = json_decode($Result,true);

//開立發票
/*open.inv.php*/

//轉入正式單
/*temptodb.ajax.php*/
?>

