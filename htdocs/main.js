function roundfun(number,precision){
	return Math.round(Number(number) * Math.pow(10, Number((precision || 0)))) / Math.pow(10, Number((precision || 0)));
}
function ceilfun(number,precision){
	return Math.ceil(Math.ceil(Number(number) * Math.pow(10, Number((precision || 0)) + 1)) / 10) / Math.pow(10, Number((precision || 0)));
}
function floorfun(number,precision){
	return Math.floor(Math.floor(Number(number) * Math.pow(10, Number((precision || 0)) + 1)) / 10) / Math.pow(10, Number((precision || 0)));
}
function openCity(cityClass,cityName) {
	//console.log('1');
	$('.'+cityClass+' .w3-bar-item.w3-button').removeClass('focus');
	$('.'+cityClass+' #'+cityName+'button').addClass('focus');
	$('.'+cityClass+' .'+cityClass+'Item').css({'display':'none'});
	$('.'+cityClass+' #'+cityName).css({'display':'block'});
	//console.log('2');
}
function ClearWindow(tablenumber,listtype){
	console.clear();
	/*banner*/
	//產品佔存之產品資訊
	$('.order#order .parameters #typeno').val('');
	$('.order#order .parameters #type').val('');
	$('.order#order .parameters #no').val('');
	$('.order#order .parameters #name').val('');
	$('.order#order .parameters #msize').val('');
	for(i=0;i<6;i++){
		$('.order#order .parameters input[id="mname1[]"]:eq('+i+')').val('');
		$('.order#order .parameters input[id="mname2[]"]:eq('+i+')').val('');
		$('.order#order .parameters input[id^="money"]:eq('+i+')').val('');
	}
	$('.order#order #menubox #itemfun #changetaste').prop('disabled',true);
	$('.order#order #menubox #itemfun .startchangetaste').val('0');
	$('.order#order .parameters #taste1').val('');
	$('.order#order .parameters #taste1name').val('');
	$('.order#order .parameters #taste2name').val('');
	$('.order#order .parameters #taste1money').val('');
	$('.order#order .parameters #background').val('');
	//帳單類別、連動桌號
	if($('.order#order #banner #type input[name="reservedatetime"]').length>0){
		$('.order#order #banner #type input[name="reservedatetime"]').val('');
	}
	else{
	}
	if($('.order#order .initsetting #orderlocation').val().length>0){
		$('.order#order #banner #type #button').prop('disabled',false);
		if(listtype==''){
			if($('.order#order .companydata #ispad').val()=='submachine'){
				if($('.order#order .initsetting #subordertype').val()=='1'){
					$('.order#order #banner #type .inside').prop('disabled',false);
					$('.order#order #banner #type .inside').trigger('click');
				}
				else if($('.order#order .initsetting #subordertype').val()=='2'){
					$('.order#order #banner #type .come').prop('disabled',false);
					$('.order#order #banner #type .come').trigger('click');
				}
				else if($('.order#order .initsetting #subordertype').val()=='3'){
					$('.order#order #banner #type .outside').prop('disabled',false);
					$('.order#order #banner #type .outside').trigger('click');
				}
				else if($('.order#order .initsetting #subordertype').val()=='4'){
					$('.order#order #banner #type .bysale').prop('disabled',false);
					$('.order#order #banner #type .bysale').trigger('click');
				}
				else{
				}
			}
			else{
				if($('.order#order .initsetting #ordertype').val()=='1'){
					$('.order#order #banner #type .inside').prop('disabled',false);
					$('.order#order #banner #type .inside').trigger('click');
				}
				else if($('.order#order .initsetting #ordertype').val()=='2'){
					$('.order#order #banner #type .come').prop('disabled',false);
					$('.order#order #banner #type .come').trigger('click');
				}
				else if($('.order#order .initsetting #ordertype').val()=='3'){
					$('.order#order #banner #type .outside').prop('disabled',false);
					$('.order#order #banner #type .outside').trigger('click');
				}
				else if($('.order#order .initsetting #ordertype').val()=='4'){
					$('.order#order #banner #type .bysale').prop('disabled',false);
					$('.order#order #banner #type .bysale').trigger('click');
				}
				else{
				}
			}
		}
		else{
			if(listtype=='1'){
				$('.order#order #banner #type .inside').prop('disabled',false);
				$('.order#order #banner #type .inside').trigger('click');
			}
			else if(listtype=='2'){
				$('.order#order #banner #type .come').prop('disabled',false);
				$('.order#order #banner #type .come').trigger('click');
			}
			else if(listtype=='3'){
				$('.order#order #banner #type .outside').prop('disabled',false);
				$('.order#order #banner #type .outside').trigger('click');
			}
			else if(listtype=='4'){
				$('.order#order #banner #type .bysale').prop('disabled',false);
				$('.order#order #banner #type .bysale').trigger('click');
			}
		}
	}
	else{
	}
	//帳單資訊(金額、總數、發票量)
	$('.order#order #detail #viewtotal').val('0');
	$('.order#order #detail #viewnumber').val('0');
	$.ajax({
		url:'./lib/js/getinvnumber.ajax.php',
		dataType:'html',
		success:function(d){
			if(d.length>20){
				$.ajax({
					url:'./lib/js/print.php',
					method:'post',
					data:{'html':'getinvnumber.ajax.php '+d},
					dataType:'html',
					success:function(d){/*console.log(d);*/},
					error:function(e){/*console.log(e);*/}
				});
			}
			else{
			}
			$('.order#order #detail #invnum').val(d);
		},
		error:function(e){
			//console.log(e);
		}
	});
	$.ajax({
		url:'./lib/js/getoinvnumber.ajax.php',
		dataType:'html',
		success:function(d){
			if(d.length>20){
				$.ajax({
					url:'./lib/js/print.php',
					method:'post',
					data:{'html':'getoinvnumber.ajax.php '+d},
					dataType:'html',
					success:function(d){/*console.log(d);*/},
					error:function(e){/*console.log(e);*/}
				});
			}
			else{
			}
			$('.order#order #detail #oinv').val(d);
		},
		error:function(e){
			//console.log(e);
		}
	});
	/*member tabs1*/
	//tempbox
	$('.order#order #tabs1 #tempbox input[name="target"]').val('0');
	$('.order#order #tabs1 #tempbox input[name="linenumber"]').val('0');
	$('.order#order #tabs1 #tempbox input[name="typeno"]').val('');
	$('.order#order #tabs1 #tempbox input[name="type"]').val('');
	$('.order#order #tabs1 #tempbox input[name="no"]').val('');
	$('.order#order #tabs1 #tempbox input[name="personcount"]').val('0');
	$('.order#order #tabs1 #tempbox input[name="needcharge"]').val('1');
	$('.order#order #tabs1 #tempbox input[name="dis1"]').val('');
	$('.order#order #tabs1 #tempbox input[name="dis2"]').val('');
	$('.order#order #tabs1 #tempbox input[name="dis3"]').val('');
	$('.order#order #tabs1 #tempbox input[name="dis4"]').val('');
	$('.order#order #tabs1 #tempbox input[name="name"]').val('');
	$('.order#order #tabs1 #tempbox input[name="name2"]').val('');
	$('.order#order #tabs1 #tempbox input[name="isgroup"]').val('');
	$('.order#order #tabs1 #tempbox input[name="childtype"]').val('');
	$('.order#order #tabs1 #tempbox input[name="mname1"]').val('');
	$('.order#order #tabs1 #tempbox input[name="mname2"]').val('');
	$('.order#order #tabs1 #tempbox input[name="insaleinv"]').val('');
	$('.order#order #tabs1 #tempbox input[name="unitprice"]').val('0');
	$('.order#order #tabs1 #tempbox input[name="money"]').val('0');
	$('.order#order #tabs1 #tempbox input[name="discount"]').val('0');
	$('.order#order #tabs1 #tempbox input[name="discontent"]').val('');
	$('.order#order #tabs1 #tempbox input[name="number"]').val('0');
	$('.order#order #tabs1 #tempbox input[name="subtotal"]').val('0');
	$('.order#order #tabs1 #tempbox input[name="taste1"]').val('');
	$('.order#order #tabs1 #tempbox input[name="taste1name"]').val('');
	$('.order#order #tabs1 #tempbox input[name="taste2name"]').val('');
	$('.order#order #tabs1 #tempbox input[name="taste2"]').val('');
	$('.order#order #tabs1 #tempbox input[name="taste1price"]').val('');
	$('.order#order #tabs1 #tempbox input[name="taste1number"]').val('');
	$('.order#order #tabs1 #tempbox input[name="taste1money"]').val('0');
	$('.order#order #tabs1 #tempbox input[name="background"]').val('');
	$('.order#order #tabs1 #editview').val('');
	//membutton
	if($('.order#order .initsetting #openmember').val()=='1'){
		$('.order#order #tabs1 #membutton div:eq(0)').html('會員');
		$('.order#order #tabs1 #membutton div:eq(1)').html('');
	}
	else{
	}
	//persons
	if($('.order#order .initsetting #openpersoncount').val()=='1'){
		$('.order#order #tabs1 #persons').val('0');
		for(var i=1;i<=$('.setperson #view #person').length;i++){
			$('.setperson #view input[name="persons'+i+'"]').val('0');
		}
	}
	else{
	}
	/*list*/
	//tabs4
	$('.order#order #tabs4 #listform input[name="memno"]').val('');
	$('.order#order #tabs4 #listform input[name="consecnumber"]').val('');
	$.ajax({
		url:'./lib/js/getnewbizdate.ajax.php',
		dataType:'html',
		success:function(d){
			if(d.length>20){
				$.ajax({
					url:'./lib/js/print.php',
					method:'post',
					data:{'html':'getnewbizdate.ajax.php '+d},
					dataType:'html',
					success:function(d){/*console.log(d);*/},
					error:function(e){/*console.log(e);*/}
				});
			}
			else{
			}
			$('.order#order #tabs4 #listform input[name="bizdate"]').val(d);
		},
		error:function(e){
			//console.log(e);
		}
	});
	if($('.order#order .initsetting #orderlocation').val().length>0){
		if(listtype==''){
			if($('.order#order .companydata #ispad').val()=='submachine'){
				if($('.order#order .initsetting #subordertype').val()=='1'){
					$('.order#order #tabs4 #listform input[name="listtype"]').val('1');
					$('.order#order #tabs4 #listform input[name="typename"]').val($('.order#order #banner #type .inside #name1').html());
				}
				else if($('.order#order .initsetting #subordertype').val()=='2'){
					$('.order#order #tabs4 #listform input[name="listtype"]').val('2');
					$('.order#order #tabs4 #listform input[name="typename"]').val($('.order#order #banner #type .come #name1').html());
				}
				else if($('.order#order .initsetting #subordertype').val()=='3'){
					$('.order#order #tabs4 #listform input[name="listtype"]').val('3');
					$('.order#order #tabs4 #listform input[name="typename"]').val($('.order#order #banner #type .outside #name1').html());
				}
				else if($('.order#order .initsetting #subordertype').val()=='4'){
					$('.order#order #tabs4 #listform input[name="listtype"]').val('4');
					$('.order#order #tabs4 #listform input[name="typename"]').val($('.order#order #banner #type .bysale #name1').html());
				}
				else{
				}
			}
			else{
				if($('.order#order .initsetting #ordertype').val()=='1'){
					$('.order#order #tabs4 #listform input[name="listtype"]').val('1');
					$('.order#order #tabs4 #listform input[name="typename"]').val($('.order#order #banner #type .inside #name1').html());
				}
				else if($('.order#order .initsetting #ordertype').val()=='2'){
					$('.order#order #tabs4 #listform input[name="listtype"]').val('2');
					$('.order#order #tabs4 #listform input[name="typename"]').val($('.order#order #banner #type .come #name1').html());
				}
				else if($('.order#order .initsetting #ordertype').val()=='3'){
					$('.order#order #tabs4 #listform input[name="listtype"]').val('3');
					$('.order#order #tabs4 #listform input[name="typename"]').val($('.order#order #banner #type .outside #name1').html());
				}
				else if($('.order#order .initsetting #ordertype').val()=='4'){
					$('.order#order #tabs4 #listform input[name="listtype"]').val('4');
					$('.order#order #tabs4 #listform input[name="typename"]').val($('.order#order #banner #type .bysale #name1').html());
				}
				else{
				}
			}
		}
		else{
			if(listtype=='1'){
				$('.order#order #tabs4 #listform input[name="listtype"]').val('1');
				$('.order#order #tabs4 #listform input[name="typename"]').val($('.order#order #banner #type .inside #name1').html());
			}
			else if(listtype=='2'){
				$('.order#order #tabs4 #listform input[name="listtype"]').val('2');
				$('.order#order #tabs4 #listform input[name="typename"]').val($('.order#order #banner #type .come #name1').html());
			}
			else if(listtype=='3'){
				$('.order#order #tabs4 #listform input[name="listtype"]').val('3');
				$('.order#order #tabs4 #listform input[name="typename"]').val($('.order#order #banner #type .outside #name1').html());
			}
			else if(listtype=='4'){
				$('.order#order #tabs4 #listform input[name="listtype"]').val('4');
				$('.order#order #tabs4 #listform input[name="typename"]').val($('.order#order #banner #type .bysale #name1').html());
			}
			else{
			}
		}
	}
	else{
	}
	$('.order#order #tabs4 #listform input[name="invsalemoney"]').val('0');
	$('.order#order #tabs4 #listform input[name="charge"]').val('');
	$('.order#order #tabs4 #listform input[name="tempban"]').val('');
	$.ajax({
		url:'./lib/js/gettempdata.ajax.php',
		dataType:'html',
		success:function(d){
			var temp=d.split(',');
			$('.order#order #tabs4 #listform input[name="tempbuytype"]').val(temp[0]);
			$('.order#order #tabs4 #listform input[name="printclientlist"]').val(temp[1]);
		},
		error:function(e){
			//console.log(e);
		}
	});
	$('.order#order #tabs4 #listform input[name="total"]').val('0');
	$('.order#order #tabs4 #listform input[name="totalnumber"]').val('0');
	$('.order#order #tabs4 #listform input[name="tablenumber"]').val(tablenumber);
	$('.order#order #tabs4 #listform input[name="person1"]').val('0');
	$('.order#order #tabs4 #listform input[name="person2"]').val('0');
	$('.order#order #tabs4 #listform input[name="person3"]').val('0');
	$('.order#order #tabs4 #listform .listcontent').html('');
	//tabs5
	$('.order#order #tabs5 #listform input[name="tempban"]').val('');
	$('.order#order #tabs5 #listform input[name="total"]').val('0');
	$('.order#order #tabs5 #listform .listcontent').html('');
	//console.log('1');
	/*result*/
	$('.result #viewwindow #submit').prop('disabled',false);
	$.ajax({
		url:'./lib/js/check.booking.php',
		method:'post',
		async:false,
		dataType:'html',
		success:function(d){
			if(d=='success'){
				if($('.order#order #content #MemberBill #list #funbox #point').css('background-color')=='red'){
				}
				else{
					$('.order#order #content #MemberBill #list #funbox #point').css({'background-color':'red','z-index':'3'});
				}
			}
			else{
				$('.order#order #content #MemberBill #list #funbox #point').css({'background-color':'','z-index':''});
			}
			//console.log(d);
		},
		error:function(e){
			console.log(e);
		}
	});

	if($('.order#order .initsetting #pointtree').val()=='1'){
		$('.pointtreememdata #tel').html('');
		$('.pointtreememdata #name').html('');
		$('.pointtreememdata #ismem').html('');
		$('.pointtreememdata #sex').html('');
		$('.pointtreememdata #balance').html('');
	}
	else{
	}
}
function temporder(bizdate,consecnumber,machinetype,company,usercode,username){
	initlisttype();
	initsumbox();
	initparameters();
	inittempbox();
	initlists();
	initorder();
	//console.log(bizdate);
	//console.log(consecnumber);
	$.ajax({
		url:'./lib/js/temporder.banner.php',
		method:'post',
		data:{'bizdate':bizdate,'consecnumber':consecnumber},
		dataType:'json',
		success:function(d){
			//console.log(d);
			if(d[0]['REMARKS'].toString().match(/-/g)){
				var temp=d[0]['REMARKS'].toString().split("-");
				$('.order#order #banner #type input[name="reservedatetime"]').val(temp[1]);
				if(temp[0]=='1'){
					$('.order#order #banner #type').css({'margin-right':'1px'});
					$('.order#order #banner #type button.inside').prop('disabled',true);
					$('.order#order #banner #tablenumber').prop('style','float: left;width: calc(42% / 5 - 2px);height: 100%;margin: 0px 1px;');
					if($('.order#order .initsetting #tabnum').val()==1){
						$('.order#order #banner #tablenumber').html('<div style="width:100%;height:50%;text-align:center;">內用桌號</div><div style="width:100%;height:50%;border:1px solid #898989;text-align:center;border-radius: 5px;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;">'+$.trim(d[0]['TABLENUMBER'])+'</div>');
					}
					else{
					}
					$('.order#order #banner #detail').css({'margin-left':'3px'});
					$('.order#order #banner #detail #viewtotal').val(d[0]['SALESTTLAMT']);
					$('.order#order #banner #detail #viewnumber').val(d[0]['SALESTTLQTY']);
				}
				else{
					$('.order#order #banner #type').css({'margin-right':'calc(42% / 5)'});
					if(temp[0]=='2'){
						$('.order#order #banner #type button.come').prop('disabled',true);
					}
					else if(temp[0]=='3'){
						$('.order#order #banner #type button.outside').prop('disabled',true);
					}
					else{
						$('.order#order #banner #type button.bysale').prop('disabled',true);
					}
					$('.order#order #banner #tablenumber').prop('style','float: left;');
					$('.order#order #banner #tablenumber').html('');
					$('.order#order #banner #detail').css({'margin-left':'3px'});
					$('.order#order #banner #detail #viewtotal').val(d[0]['SALESTTLAMT']);
					$('.order#order #banner #detail #viewnumber').val(d[0]['SALESTTLQTY']);
				}
			}
			else{
				if(d[0]['REMARKS']=='1'){
					$('.order#order #banner #type').css({'margin-right':'1px'});
					$('.order#order #banner #type button.inside').prop('disabled',true);
					$('.order#order #banner #tablenumber').prop('style','float: left;width: calc(42% / 5 - 2px);height: 100%;margin: 0px 1px;');
					if($('.order#order .initsetting #tabnum').val()==1){
						$('.order#order #banner #tablenumber').html('<div style="width:100%;height:50%;text-align:center;">內用桌號</div><div class="tabnumbox" style="width:100%;height:50%;border:1px solid #898989;text-align:center;border-radius: 5px;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;">'+$.trim(d[0]['TABLENUMBER'])+'</div>');
					}
					else{
					}
					$('.order#order #banner #detail').css({'margin-left':'3px'});
					$('.order#order #banner #detail #viewtotal').val(d[0]['SALESTTLAMT']);
					$('.order#order #banner #detail #viewnumber').val(d[0]['SALESTTLQTY']);
				}
				else{
					$('.order#order #banner #type').css({'margin-right':'calc(42% / 5)'});
					if(d[0]['REMARKS']=='2'){
						$('.order#order #banner #type button.come').prop('disabled',true);
					}
					else if(d[0]['REMARKS']=='3'){
						$('.order#order #banner #type button.outside').prop('disabled',true);
					}
					else{
						$('.order#order #banner #type button.bysale').prop('disabled',true);
					}
					$('.order#order #banner #tablenumber').prop('style','float: left;');
					$('.order#order #banner #tablenumber').html('');
					$('.order#order #banner #detail').css({'margin-left':'3px'});
					$('.order#order #banner #detail #viewtotal').val(d[0]['SALESTTLAMT']);
					$('.order#order #banner #detail #viewnumber').val(d[0]['SALESTTLQTY']);
				}
			}
			$.ajax({
				url:'./lib/js/temporder.list.php',
				method:'post',
				async: false,
				data:{'machinetype':machinetype,'company':company,'bizdate':bizdate,'consecnumber':consecnumber,'usercode':usercode,'username':username},
				dataType:'html',
				success:function(d){
					$('.order#order #MemberBill #list #tabs4 #listform').html(d);
					$('.setperson #view input[name="persons1"]').val($('.order#order #tabs4 #listform input[name="person1"]').val());
					$('.setperson #view input[name="persons2"]').val($('.order#order #tabs4 #listform input[name="person2"]').val());
					$('.setperson #view input[name="persons3"]').val($('.order#order #tabs4 #listform input[name="person3"]').val());
					$('.setperson #buttons #submit').trigger('click');
				},
				error:function(e){
					//console.log(e);
				}
			});
			$.ajax({
				url:'./lib/js/gettempmemdata.ajax.php',
				method:'post',
				async: false,
				data:{'company':company,'story':$('.order#order .companydata #story').val(),'memno':$('.order#order #tabs4 .listcontentbox #listform input[name="memno"]').val()},
				dataType:'json',
				success:function(d){
					//console.log(d);
					if(d.length>0){
						$('.order#order #tabs1 #membutton div:eq(0)').html(d[0]['name']);
						$('.order#order #tabs1 #membutton div:eq(1)').html(d[0]['tel']);
						$('.memdata #name').html(d[0]['name']);
						$('.memdata #tel').html(d[0]['tel']);
						if(d[0]['address']==null){
							$('.memdata #address').html('');
						}
						else{
							$('.memdata #address').html(d[0]['address']);
						}
						if(d[0]['tel2']==null){
							$('.memdata #tel2').html('');
						}
						else{
							$('.memdata #tel2').html(d[0]['tel2']);
						}
					}
					else{
						$('.order#order #tabs1 #membutton div:eq(0)').html('會員');
						$('.order#order #tabs1 #membutton div:eq(1)').html('');
						$('.memdata #name').html('');
						$('.memdata #tel').html('');
						$('.memdata #address').html('');
						$('.memdata #tel2').html('');
					}
				},
				error:function(e){
					//console.log(e);
				}
			});
		},
		error:function(e){
			console.log(e);
		}
	});
};
function initlisttype(){
	$('.order#order #banner #type').css({'margin-right':'15px'});
	$('.order#order #banner #type button').prop('disabled',false);
	$('.order#order #banner #tablenumber').prop('style','float:left;');
	$('.order#order #banner #tablenumber').html('');
	$('.order#order #banner #detail').css({'margin-left':'clac(47% - 478px)'});
};
function initsumbox(){
	$('.order#order #banner #detail #viewtotal').val('0');
	$('.order#order #banner #detail #viewnumber').val('0');
};
function initparameters(){
	$('.order#order .parameters #typeno').val('');
	$('.order#order .parameters #type').val('');
	$('.order#order .parameters #no').val('');
	$('.order#order .parameters #name').val('');
	$('.order#order .parameters #isgroup').val('');
	$('.order#order .parameters #childtype').val('');
	$('.order#order .parameters #msize').val('');
	$('.order#order .parameters input[id="mname1[]"').val('');
	$('.order#order .parameters input[id="mname2[]"').val('');
	$('.order#order .parameters input[id="money[]"').val('');
	$('.order#order .parameters input[id="mname1[]"').val('');
	$('.order#order .parameters input[id="mname2[]"').val('');
	$('.order#order .parameters input[id="money[]"').val('');
	$('.order#order .parameters input[id="mname1[]"').val('');
	$('.order#order .parameters input[id="mname2[]"').val('');
	$('.order#order .parameters input[id="money[]"').val('');
	$('.order#order .parameters input[id="mname1[]"').val('');
	$('.order#order .parameters input[id="mname2[]"').val('');
	$('.order#order .parameters input[id="money[]"').val('');
	$('.order#order .parameters input[id="mname1[]"').val('');
	$('.order#order .parameters input[id="mname2[]"').val('');
	$('.order#order .parameters input[id="money[]"').val('');
	$('.order#order .parameters input[id="mname1[]"').val('');
	$('.order#order .parameters input[id="mname2[]"').val('');
	$('.order#order .parameters input[id="money[]"').val('');
	$('.order#order .parameters #taste1').val('');
	$('.order#order .parameters #taste1name').val('');
	$('.order#order .parameters #taste2name').val('');
	$('.order#order .parameters #taste1money').val('');
	$('.order#order .parameters #background').val('');
	$('.order#order .parameters #sale').val('');
	$('.order#order .parameters #salename').val('');
};
function inittempbox(){
	$('.order#order #MemberBill #tabs1 #tempbox input[name="target"]').val('0');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="typeno"]').val('');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="type"]').val('');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="no"]').val('');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="name"]').val('');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="name2"]').val('');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="isgroup"]').val('');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="childtype"]').val('');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="mname1"]').val('');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="mname2"]').val('');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="insaleinv"]').val('');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="unitprice"]').val('0');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="money"]').val('0');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="discount"]').val('0');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="discontent"]').val('');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="number"]').val('0');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="subtotal"]').val('0');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="taste1"]').val('');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="taste1name"]').val('');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="taste1price"]').val('');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="taste1number"]').val('');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="taste1money"]').val('0');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="taste2"]').val('');
	$('.order#order #MemberBill #tabs1 #tempbox input[name="background"]').val('');
	$('.order#order #MemberBill #tabs1 #editview').val('');
};
function initlists(){
	//$('.order#order #MemberBill #list #tabs4 #listform').html('');
};
function initorder(){
	for(var i=0;i<6;i++){
		$('.order#order #menubox #itemfun .itemmname'+(i+1)+' div#name1').html('');
		$('.order#order #menubox #itemfun .itemmname'+(i+1)+' div#name2').html('');
		$('.order#order #menubox #itemfun .itemmname'+(i+1)).prop('disabled',true);
		$('.order#order #menubox #itemfun .itemmoney'+(i+1)).val('0');
	}
	for(i=0;i<10;i++){
		$('.order#order #menubox #itemfun #taste'+i+' div#name1').html('');
		$('.order#order #menubox #itemfun #taste'+i+' div#name2').html('');
		$('.order#order #menubox #itemfun #taste'+i).prop('disabled',true);
		$('.order#order #menubox #itemfun .tasteno'+i).val('');
		$('.order#order #menubox #itemfun .tasteprice'+i).val('');
		$('.order#order #menubox #itemfun #taste'+i+' div#name1').parent('button').css({'background-color':''});
	}
};
var responce=true;
var tempparameter=1;
jQuery.fn.putCursorAtEnd = function() {
	return this.each(function() {
		var $el = $(this),el = this;
		if (!$el.is(":focus")) {
			$el.focus();
		}
		if (el.setSelectionRange) {
			  var len = $el.val().length * 2;
			  setTimeout(function() {
					el.setSelectionRange(len, len);
			  }, 1);
		
		} else {
			  $el.val($el.val());
		}
		this.scrollTop = 999999;
  });
};
function detectZoom (){
	var ratio = 0,
	screen = window.screen,
	ua = navigator.userAgent.toLowerCase();

	if (window.devicePixelRatio !== undefined) {
		ratio = window.devicePixelRatio;
	}
	else if (~ua.indexOf('msie')) {
		if (screen.deviceXDPI && screen.logicalXDPI) {
			ratio = screen.deviceXDPI / screen.logicalXDPI;
		}
	}
	else if (window.outerWidth !== undefined && window.innerWidth !== undefined) {
		ratio = window.outerWidth / window.innerWidth;
	}

	if (ratio){
		ratio = Math.round(ratio * 100);
	}

	return ratio;
};
$(function(){
	//alert(detectZoom())
});
$(window).on('resize',function(){
	isScale();
});
function isScale(){
	var rate = detectZoom();
	if(rate != 100){
		//如何让页面的缩放比例自动为100,'transform':'scale(1,1)'没有用，又无法自动条用键盘事件，目前只能提示让用户如果想使用100%的比例手动去触发按ctrl+0
		console.log(1);
		alert('目前畫面不是100%顯示，請按鍵盤ctrl+0恢復100%顯示標準，以防畫面顯示錯亂！');
	}
}
$(document).ready(function(){
	/*禁止縮放螢幕*/
	// chrome 浏览器直接加上下面这个样式就行了，但是ff不识别
	$('body').css('zoom', 'reset');
	$(document).keydown(function (event) {
		if ((event.ctrlKey === true || event.metaKey === true) && (event.which === 61 || event.which === 107 || event.which === 173 || event.which === 109 || event.which === 187  || event.which === 189)){
			event.preventDefault();
		}
	});

	$(window).bind('mousewheel DOMMouseScroll', function (event) {
		if (event.ctrlKey === true || event.metaKey) {
			event.preventDefault();
		}
	});
	/*桌控*/
	if($('.order#order .initsetting #controltable').val()=='1'){
		inittable=$('.control#control .inittable').dialog({
			autoOpen:true,
			width:$(window).width(),
			height:$(window).height(),
			title:'桌控畫面(營業日期:'+$('.control#control #bizdate').val()+'；目前班別:'+$('.control#control #zcounter').val()+'；'+$('.control#control #mactype').val().substr(0,1).toUpperCase()+'-'+$('.control#control #'+$('.control#control #mactype').val()+'name').val()+')',
			classes:{
				'ui-dialog-titlebar-close':'hidden'
			},
			resizable:false,
			modal:true,
			draggable:false
		});
		changetable=$('.control#control .changetable').dialog({
			autoOpen:false,
			width:$(window).width(),
			height:$(window).height(),
			/*title:'換桌',*/
			resizable:false,
			modal:true,
			draggable:false,
			close:function(){
				$('.changetable #change').prop('disabled',true);
				$('.changetable #change #c1t').html('');
				$('.changetable #change #c2t').html('');
				$('.changetable #c1').val('empty');
				$('.changetable #c1consecnumber').val('');
				$('.changetable #c2').val('empty');
				$('.changetable .tablemap .chtable[id="notempty check"]').css({'border':'5px solid #898989','border-radius':'5px','background-color':'#ff0066','color':'#ffffff'});
				$('.changetable .tablemap .chtable[id="notempty check"]').prop('id','notempty');
				$('.changetable .tablemap .chtable#check').css({'border':'','border-radius':'','background-color':'','color':''});
				$('.changetable .tablemap .chtable#check').prop('id','');
			}
		});
		combine=$('.control#control .combine').dialog({
			autoOpen:false,
			width:$(window).width(),
			height:$(window).height(),
			/*title:'合併結帳',*/
			resizable:false,
			modal:true,
			draggable:false,
			close:function(){
				$('.combine .chtable').prop('id','');
				$('.combine .chtable #checkbox').html('');
			}
		});
		tablecombine=$('.control#control .tablecombine').dialog({
			autoOpen:false,
			width:$(window).width(),
			height:$(window).height(),
			/*title:'併桌',*/
			resizable:false,
			modal:true,
			draggable:false,
			close:function(){
				$('.tablecombine .chtable').prop('id','');
				$('.tablecombine .chtable #checkbox').html('');
			}
		});
		tablesplit=$('.control#control .tablesplit').dialog({
			autoOpen:false,
			width:$(window).width(),
			height:$(window).height(),
			/*title:'拆桌',*/
			resizable:false,
			modal:true,
			draggable:false,
			close:function(){
				$('.tablesplit .chtable').prop('id','');
				$('.tablesplit .chtable #checkbox').html('');
			}
		});
		tableclear=$('.control#control .tableclear').dialog({
			autoOpen:false,
			width:$(window).width(),
			height:$(window).height(),
			/*title:'拆桌',*/
			resizable:false,
			modal:true,
			draggable:false,
			close:function(){
				$('.tableclear .chtable').prop('id','');
				$('.tableclear .chtable #checkbox').html('');
			}
		});
		outsidelist=$('.control#control .outsidelist').dialog({
			autoOpen:false,
			width:500,
			height:768,
			/*title:'外帶帳單',*/
			resizable:false,
			modal:true,
			draggable:false
		});
		splittablelist=$('.control#control .splittablelist').dialog({
			autoOpen:false,
			width:500,
			height:768,
			/*title:'拆桌帳單',*/
			resizable:false,
			modal:true,
			draggable:false
		});
		conexitsys=$('.control#control .conexitsys').dialog({//系統訊息
			autoOpen:false,
			/*width:450,
			height:300,*/
			/*title:'系統訊息',*/
			resizable:false,
			modal:true,
			draggable:false
		});
		if($(window).width()==1920){
			conexitsys.dialog('option','width',450);
			conexitsys.dialog('option','height',300);
		}
		else{//if($(window).width()==1366)
			conexitsys.dialog('option','width',(450));
			conexitsys.dialog('option','height',(220));
		}
		checkcombine=$('.control#control .checkcombine').dialog({
			autoOpen:false,
			/*width:450,
			height:300,*/
			/*title:'系統訊息',*/
			resizable:false,
			modal:true,
			draggable:false
		});
		if($(window).width()==1920){
			checkcombine.dialog('option','width',450);
			checkcombine.dialog('option','height',400);
		}
		else{//if($(window).width()==1366)
			checkcombine.dialog('option','width',(450));
			checkcombine.dialog('option','height',(400));
		}
		checktablecombine=$('.control#control .checktablecombine').dialog({
			autoOpen:false,
			/*width:450,
			height:300,*/
			/*title:'系統訊息',*/
			resizable:false,
			modal:true,
			draggable:false
		});
		if($(window).width()==1920){
			checktablecombine.dialog('option','width',450);
			checktablecombine.dialog('option','height',400);
		}
		else{//if($(window).width()==1366)
			checktablecombine.dialog('option','width',(450));
			checktablecombine.dialog('option','height',(400));
		}
		checktablesplit=$('.control#control .checktablesplit').dialog({
			autoOpen:false,
			/*width:450,
			height:300,*/
			/*title:'系統訊息',*/
			resizable:false,
			modal:true,
			draggable:false
		});
		if($(window).width()==1920){
			checktablesplit.dialog('option','width',450);
			checktablesplit.dialog('option','height',400);
		}
		else{//if($(window).width()==1366)
			checktablesplit.dialog('option','width',(450));
			checktablesplit.dialog('option','height',(400));
		}
		checktableclear=$('.control#control .checktableclear').dialog({
			autoOpen:false,
			/*width:450,
			height:300,*/
			/*title:'系統訊息',*/
			resizable:false,
			modal:true,
			draggable:false
		});
		if($(window).width()==1920){
			checktableclear.dialog('option','width',450);
			checktableclear.dialog('option','height',200);
		}
		else{//if($(window).width()==1366)
			checktableclear.dialog('option','width',(450));
			checktableclear.dialog('option','height',(200));
		}
		tablehint=$('.control#control .tablehint').dialog({
			autoOpen:false,
			width:450,
			height:500,
			/*title:'時段提示',*/
			resizable:false,
			modal:true,
			draggable:false
		});
		funbox=$('.control#control .funbox').dialog({//功能區
			autoOpen:false,
			width:1024,
			height:500,
			/*title:'系統訊息',*/
			resizable:false,
			modal:true,
			draggable:false
		});
		consetchange=$('.control#control .consetchange').dialog({//設定找零金
			autoOpen:false,
			/*width:1044,
			height:966,*/
			/*title:'設定找零金',*/
			position:{my:'right bottom',at:'right bottom',of:'body'},
			resizable:false,
			modal:true,
			draggable:false,
			close:function(){
				$.ajax({
					url:'./lib/js/setchange.php',
					method:'post',
					data:{'change':$('.consetchange input[name="view"]').val(),'usercode':$('.control#control #tabs4 #listform input[name="usercode"]').val(),'username':$('.control#control #tabs4 #listform input[name="username"]').val(),'machinetype':$('.control#control #tabs4 #listform input[name="machinetype"]').val()},
					dataType:'html',
					success:function(){
					}
				});
				$('.control#control #MemberBill #billfun #billfun1button').prop('disabled',false);
				$('.control#control #MemberBill #billfun #billfun1button').trigger('click');
				//$billfun.tabs('enable',0);
				//$billfun.tabs('option','active',[0]);
			}
		});
		if($(window).width()==1920){
			consetchange.dialog('option','width',1044);
			consetchange.dialog('option','height',966);
		}
		else if($(window).width()==1366){
			consetchange.dialog('option','width',(1366*0.63-6.4-72.3));
			consetchange.dialog('option','height',(768*0.9-16));
		}
		else if($(window).width()==1280){
			consetchange.dialog('option','width',(1280*0.63-72.3));
			consetchange.dialog('option','height',(800*0.9-16));
		}
		else if($(window).width()==1024){
			consetchange.dialog('option','width',1024);
			consetchange.dialog('option','height',(768*0.9-16));
		}
		$('.verpsw #cancel').click(function(){
			verpsw.dialog('close');
		});
		$('.inittable #funbox').click(function(){
			funbox.dialog('open');
		});
		$('.changetable #action').css({'margin-top':'1'});
		$('.inittable #changetable').click(function(){
			$.ajax({
				url:'./lib/js/checkopen.ajax.php',
				async:false,
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'control checkopen.ajax.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
					if(d=='success'){
						$('.inittable input[name="window"]').val('changetable');
						changetable.dialog('open');
					}
					else{
						alert('目前尚未開班，請確認是否開班或重啟系統。');
					}
				},
				error:function(e){
					console.log(e);
				}
			});
		});
		$('.inittable #conexitsys').click(function(){
			console.log('1');
			conexitsys.dialog('open');
		});
		$('.conexitsys .no').click(function(){
			conexitsys.dialog('close');
		});
		$('.conexitsys .yes').click(function(){
			/*if($('.control#control #mactype').val()=='submachine'){
				//var mywin=window.open('exit://','','width=1px,height=1px');
			}
			else{
				if($('.control#control #mactype').val()=='machine'&&$('.control#control #machinename').val()!='m1'){
					//var mywin=window.open('exit://','','width=1px,height=1px');
				}
				else{*/
					$.ajax({
						url:'./lib/js/create.cmdtxt.php',
						method:'post',
						async: false,
						data:{'cmd':$('.order#order #tabs4 #listform input[name="machinetype"]').val()+'-exit'},
						dataType:'html',
						success:function(d){
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'control create.cmdtxt.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							//console.log(d);
						},
						error:function(e){
							console.log(e);
						}
					});
				/*}
			}*/
		});
		$('.funbox #punch').click(function(){
			$('.order#order #MemberBill #billfun #citybox #billfun3 #punch').trigger('click');
		});
		$('.funbox #logout').click(function(){
			$('.order#order #billfun #billfun3 .logout').trigger('click');
		});
		$('.funbox #updatemenu').click(function(){
			$('.order#order #updatemenu').trigger('click');
		});
		$('.funbox #voidsale').click(function(){
			$('.order#order #billfun #billfun2 #salevoid').trigger('click');
		});
		$('.funbox #kvm').click(function(){
			$('.order#order #MemberBill #billfun #citybox #billfun2 #kvm').trigger('click');
		});
		$('.funbox #historypaper').click(function(){
			$('.order#order #MemberBill #billfun #citybox #billfun3 #historypaper').trigger('click');
		});
		$('.funbox #editpunch').click(function(){
			$('.order#order #MemberBill #billfun #citybox #billfun3 #editpunch').trigger('click');
		});
		$('.funbox #salelist').click(function(){
			$('.order#order #billfun #billfun2 #salelist').trigger('click');
		});
		$('.funbox #AE').click(function(){
			$('.order#order #billfun #billfun2 .outmoney').trigger('click');
		});
		$('.inittable .tablemap .table').click(function(){
			var index=$('.inittable .tablemap button').index(this);
			var tabnum=$(this).find('#tablenumber input[name="tabnum"]').val();
			if($('.inittable .tablemap button:eq('+index+')[name="split"]').length>0){
				$.ajax({
					url:'./getsplittablelist.ajax.php',
					method:'post',
					async:false,
					data:{'bizdate':$('.control#control #bizdate').val(),'zcounter':$('.control#control #zcounter').val(),'tabnum':tabnum},
					dataType:'json',
					success:function(d){
						//console.log(d);
						$('.splittablelist').html('<button id="splittablebut" value="'+$('.inittable button:eq('+index+')[name="split"] #tablenumber input[name="tabnum"]').val()+'">拆桌</button>');
						$.each(d,function(index,value){
							if(index=='time'){
								return false;
							}
							else{
								$('.splittablelist').append('<button><div id="tablenum">'+value['tablenumber']+'<input type="hidden" name="tablenumber" value="'+value['tablenumber']+'"><input type="hidden" name="state" value="'+value['state']+'"></div><div id="consecnumber">'+index+'</div><div id="bizdate">'+value['bizdate']+'</div></button>');
							}
						});
					},
					error:function(e){
						console.log(e);
					}
				});
				splittablelist.dialog('open');
			}
			else{
				$.ajax({
					url:'./checktableini.ajax.php',
					method:'post',
					async:false,
					data:{'bizdate':$('.control#control #bizdate').val(),'zcounter':$('.control#control #zcounter').val(),'tabnum':tabnum,'submachine':$('.control#control #submachinename').val(),'machine':$('.control#control #machinename').val(),'type':'in'},
					dataType:'html',
					success:function(d){
						//console.log(d);
						var tempd=d.split('-');
						if(tempd[0]=='lock'){
							var res=confirm(tempd[1]+'點餐中。\n是否仍要點餐？');
							if(res==true){
								$.ajax({
									url:'./mandchange.ajax.php',
									method:'post',
									async:false,
									data:{'bizdate':$('.control#control #bizdate').val(),'zcounter':$('.control#control #zcounter').val(),'tabnum':tabnum,'submachine':$('.control#control #submachinename').val(),'machine':$('.control#control #machinename').val(),'type':'in'},
									dataType:'html',
									success:function(d){
										if($('.inittable .tablemap button:eq('+index+') input[name="consecnumber"]').val().length>0&&$('.inittable .tablemap button:eq('+index+') input[name="bizdate"]').val().length>0){
											inittable.dialog('close');
											temporder($('.inittable button:eq('+index+') input[name="bizdate"]').val(),$('.inittable button:eq('+index+') input[name="consecnumber"]').val(),$('.control#control #'+$('.control#control #mactype').val()+'name').val(),$('.order#order .companydata #company').val(),$('.control#control #usercode').val(),$('.control#control #username').val());

											//location.href='./order.php?<?php if(isset($_GET["submachine"]))echo "submachine=".$_GET["submachine"]."&";else if(isset($_GET["machine"]))echo "machine=".$_GET["machine"]."&";else; ?>usercode=<?php if(isset($_GET["usercode"]))echo $_GET["usercode"]; ?>&';
										}
										else{
											inittable.dialog('close');
											ClearWindow($('.inittable button:eq('+index+') input[name="tabnum"]').val(),'1');
											if(tabinput.dialog('isOpen')){
												tabinput.dialog('close');
											}
											else{
											}
											if($('#tablenumber .tabnumbox').length>0){
												$('#tablenumber .tabnumbox').html($('.inittable button:eq('+index+') input[name="tabnum"]').val());
											}
											else{
											}

											//location.href='./order.php?<?php if(isset($_GET["submachine"]))echo "submachine=".$_GET["submachine"]."&";else if(isset($_GET["machine"]))echo "machine=".$_GET["machine"]."&";else; ?>usercode=<?php if(isset($_GET["usercode"]))echo $_GET["usercode"]; ?>&username=<?php if(isset($_GET["username"]))echo $_GET["username"]; ?>&listtype=1&tabnum='+$('.control#control button:eq('+index+') input[name="tabnum"]').val();
										}
									},
									error:function(e){
										console.log(e);
									}
								});
							}
							else{
							}
						}
						else{
							if($('.inittable .tablemap button:eq('+index+') input[name="state"]').val()!='0'&&$('.inittable .tablemap button:eq('+index+') input[name="consecnumber"]').val().length>0&&$('.inittable .tablemap button:eq('+index+') input[name="bizdate"]').val().length>0){
								inittable.dialog('close');
								temporder($('.inittable button:eq('+index+') input[name="bizdate"]').val(),$('.inittable button:eq('+index+') input[name="consecnumber"]').val(),$('.control#control #'+$('.control#control #mactype').val()+'name').val(),$('.order#order .companydata #company').val(),$('.control#control #usercode').val(),$('.control#control #username').val());

								//location.href='./order.php?<?php if(isset($_GET["submachine"]))echo "submachine=".$_GET["submachine"]."&";else if(isset($_GET["machine"]))echo "machine=".$_GET["machine"]."&";else; ?>usercode=<?php if(isset($_GET["usercode"]))echo $_GET["usercode"]; ?>&username=<?php if(isset($_GET["username"]))echo $_GET["username"]; ?>&listtype=1&tabnum&bizdate='+$('.control#control button:eq('+index+') input[name="bizdate"]').val()+'&consecnumber='+$('.control#control button:eq('+index+') input[name="consecnumber"]').val();
							}
							else{
								inittable.dialog('close');
								ClearWindow($('.inittable button:eq('+index+') input[name="tabnum"]').val(),'1');
								if(tabinput.dialog('isOpen')){
									tabinput.dialog('close');
								}
								else{
								}
								if($('#tablenumber .tabnumbox').length>0){
									$('#tablenumber .tabnumbox').html($('.inittable button:eq('+index+') input[name="tabnum"]').val());
								}
								else{
								}

								//location.href='./order.php?<?php if(isset($_GET["submachine"]))echo "submachine=".$_GET["submachine"]."&";else if(isset($_GET["machine"]))echo "machine=".$_GET["machine"]."&";else; ?>usercode=<?php if(isset($_GET["usercode"]))echo $_GET["usercode"]; ?>&username=<?php if(isset($_GET["username"]))echo $_GET["username"]; ?>&listtype=1&tabnum='+$('.control#control button:eq('+index+') input[name="tabnum"]').val();
							}
						}
					},
					error:function(e){
						console.log(d);
					}
				});
			}
		});
		$(document).on('click','.funcmap .table',function(){
			var index=$('.inittable button').index(this);
			if($('.inittable button:eq('+index+') input[name="tabnum"]').val()=="outside"){
				$.ajax({
					url:'./getoutlist.ajax.php',
					dataType:'json',
					success:function(d){
						$.ajax({
							url:'./lib/js/getbuttonname.ajax.php',
							method:'post',
							async:false,
							data:{'name':'listtype2'},
							dataType:'json',
							success:function(d){
								//console.log(d);
								if(d[0]==''){
									$('.outsidelist').html('<button id="newlist">新增外帶單</button>');
								}
								else{
									$('.outsidelist').html('<button id="newlist">新增'+d[0]+'單</button>');
								}
							},
							error:function(e){
								console.log(e);
							}
						});
						$.each(d,function(index,value){
							if(index=='time'){
								return false;
							}
							else{
								$('.outsidelist').append('<button><div id="consecnumber">'+index+'</div><div id="bizdate">'+value+'</div></button>');
							}
						});
					},
					error:function(e){
						console.log(e);
					}
				});
				outsidelist.dialog('open');
			}
			else{
			}
		});
		$(document).on('click','.outsidelist button',function(){
			var index=$('.outsidelist button').index(this);
			if($(this).prop('id')=='newlist'){
				outsidelist.dialog('close');
				inittable.dialog('close');
				ClearWindow('','2');

				//location.href='./order.php?'+$('.control#control #mactype').val()+'='+$('.control#control #'+$('.control#control #mactype').val()+'name').val()+'&usercode='+$('.control#control #usercode').val()+'&username='+$('.control#control #username').val()+'&listtype=2';
			}
			else{
				outsidelist.dialog('close');
				inittable.dialog('close');
				temporder($('.outsidelist button:eq('+index+') #bizdate').html(),$('.outsidelist button:eq('+index+') #consecnumber').html(),$('.control#control #'+$('.control#control #mactype').val()+'name').val(),$('.order#order .companydata #company').val(),$('.control#control #usercode').val(),$('.control#control #username').val());
				
				//location.href='./order.php?'+$('.control#control #mactype').val()+'='+$('.control#control #'+$('.control#control #mactype').val()+'name').val()+'&usercode='+$('.control#control #usercode').val()+'&username='+$('.control#control #username').val()+'&listtype=2&bizdate='+$('.outsidelist button:eq('+index+') #bizdate').html()+'&consecnumber='+$('.outsidelist button:eq('+index+') #consecnumber').html();
			}
		});
		$(document).on('click','.splittablelist button',function(){
			if(tablesplit.dialog('isOpen')){
				if($(this).prop('id')=='splittablebut'){
					$.ajax({
						url:'./gettablelist.ajax.php',
						method:'post',
						data:{'bizdate':$('.control#control #bizdate').val(),'zcounter':$('.control#control #zcounter').val(),'tablenum':$(this).find('input[name="tablenumber"]').val()},
						dataType:'html',
						success:function(d){
							if(d=="目前點選之桌號已併桌，無法進行拆桌動作。"){
								$('.checktablesplit #text').html(d);
								$('.checktablesplit #sale').prop('disabled',true);
								checktablesplit.dialog('open');
							}
							else{
								$('.checktablesplit #text').html(d);
								$('.checktablesplit #sale').prop('disabled',false);
								checktablesplit.dialog('open');
							}
						},
						error:function(e){
							console.log(e);
						}
					});
				}
				else{
					$.ajax({
						url:'./checktableini.ajax.php',
						method:'post',
						async:false,
						data:{'bizdate':$('.control#control #bizdate').val(),'zcounter':$('.control#control #zcounter').val(),'tabnum':$('.splittablelist button:eq('+index+') #tablenum input[name="tablenumber"]').val(),'submachine':$('.control#control #submachinename').val(),'machine':$('.control#control #machinename').val(),'type':'in'},
						dataType:'html',
						success:function(d){
							console.log(d);
							var tempd=d.split('-');
							if(tempd[0]=='lock'){
								var res=confirm(tempd[1]+'點餐中。\n是否仍要點餐？');
								if(res==true){
									$.ajax({
										url:'./mandchange.ajax.php',
										method:'post',
										async:false,
										data:{'bizdate':$('.control#control #bizdate').val(),'zcounter':$('.control#control #zcounter').val(),'tabnum':tabnum,'submachine':$('.control#control #submachinename').val(),'machine':$('.control#control #machinename').val(),'type':'in'},
										dataType:'html',
										success:function(d){
											splittablelist.dialog('close');
											inittable.dialog('close');
											temporder($('.splittablelist button:eq('+index+') #bizdate').html(),$('.splittablelist button:eq('+index+') #consecnumber').html(),$('.control#control #'+$('.control#control #mactype').val()+'name').val(),$('.order#order .companydata #company').val(),$('.control#control #usercode').val(),$('.control#control #username').val());
											
											//location.href='./order.php?'+$('.control#control #mactype').val()+'='+$('.control#control #'+$('.control#control #mactype').val()+'name').val()+'&usercode='+$('.control#control #usercode').val()+'&username='+$('.control#control #username').val()+'&listtype=1&bizdate='+$('.splittablelist button:eq('+index+') #bizdate').html()+'&consecnumber='+$('.splittablelist button:eq('+index+') #consecnumber').html()+'&tabnum='+$('.splittablelist button:eq('+index+') #tablenum').html();
										},
										error:function(e){
											console.log(e);
										}
									});
								}
								else{
								}
							}
							else if(tempd[0]=='empty'){//結帳後不清桌控
								splittablelist.dialog('close');
								inittable.dialog('close');
								ClearWindow($('.splittablelist button:eq('+index+') #tablenum input[name="tablenumber"]').val(),'1');
								$('#tablenumber .tabnumbox').html($('.splittablelist button:eq('+index+') #tablenum input[name="tablenumber"]').val());
							}
							else{
								splittablelist.dialog('close');
								inittable.dialog('close');
								temporder($('.splittablelist button:eq('+index+') #bizdate').html(),$('.splittablelist button:eq('+index+') #consecnumber').html(),$('.control#control #'+$('.control#control #mactype').val()+'name').val(),$('.order#order .companydata #company').val(),$('.control#control #usercode').val(),$('.control#control #username').val());
								
								//location.href='./order.php?'+$('.control#control #mactype').val()+'='+$('.control#control #'+$('.control#control #mactype').val()+'name').val()+'&usercode='+$('.control#control #usercode').val()+'&username='+$('.control#control #username').val()+'&listtype=1&bizdate='+$('.splittablelist button:eq('+index+') #bizdate').html()+'&consecnumber='+$('.splittablelist button:eq('+index+') #consecnumber').html()+'&tabnum='+$('.splittablelist button:eq('+index+') #tablenum').html();
							}
						},
						error:function(e){
							console.log(d);
						}
					});
				}
			}
			else if(tableclear.dialog('isOpen')){
				$.ajax({
					url:'./gettableclear.ajax.php',
					method:'post',
					data:{'bizdate':$('.control#control #bizdate').val(),'zcounter':$('.control#control #zcounter').val(),'tablenum':$(this).find('input[name="tablenumber"]').val(),'state':$(this).find('input[name="state"]').val()},
					dataType:'html',
					success:function(d){
						$('.checktableclear #text').html(d);
						$('.checktableclear #sale').prop('disabled',false);
						checktableclear.dialog('open');
					},
					error:function(e){
						console.log(e);
					}
				});
			}
			else{
			}
		});
		$('.changetable .tablemap .chtable').click(function(){
			//console.log($(this).find('#tablenumber input[name="tabnum"]').val());
			if($(this).find('#tablenumber input[name="consecnumber"]').val()==''){
				if($('.changetable #c2').val()=='empty'){
					$('.changetable #c2').val($(this).find('#tablenumber input[name="tabnum"]').val());
					$(this).prop('id','check');
					$(this).css({'border':'5px solid #898989','border-radius':'5px','background-color':'#00ff66','color':'#ffffff'});
					var temptable=$(this).find('#tablenumber').html().split('<input');
					$('.changetable #change #c2t').html(temptable[0]);
				}
				else{
					if($('.changetable #c2').val()==$(this).find('#tablenumber input[name="tabnum"]').val()){
						$('.changetable #c2').val('empty');
						$(this).prop('id','');
						$(this).css({'border':'','border-radius':'','background-color':'','color':''});
						$('.changetable #change #c2t').html('');
					}
					else{
					}
				}
			}
			else{
				if($('.changetable #c1').val()=='empty'){
					$('.changetable #c1').val($(this).find('#tablenumber input[name="tabnum"]').val());
					$('.changetable #c1consecnumber').val($(this).find('#tablenumber input[name="consecnumber"]').val());
					$(this).prop('id','notempty check');
					$(this).css({'border':'5px solid #898989','border-radius':'5px','background-color':'#00ffff','color':'#ffffff'});
					var temptable=$(this).find('#tablenumber').html().split('<input');
					$('.changetable #change #c1t').html(temptable[0]);
				}
				else{
					if($('.changetable #c1').val()==$(this).find('#tablenumber input[name="tabnum"]').val()){
						$('.changetable #c1').val('empty');
						$('.changetable #c1consecnumber').val('');
						$(this).prop('id','notempty');
						$(this).css({'border':'5px solid #898989','border-radius':'5px','background-color':'#ff0066','color':'#ffffff'});
						$('.changetable #change #c1t').html('');
					}
					else{
					}
				}
			}
			if($('.changetable #change #c1t').html()==''||$('.changetable #change #c2t').html()==''){
				$('.changetable #change').prop('disabled',true);
			}
			else{
				$('.changetable #change').prop('disabled',false);
			}
		});
		$('.changetable .funcmap #return').click(function(){
			$('.inittable input[name="window"]').val('inittable');
			changetable.dialog('close');
		});
		$('.changetable .funcmap #change').click(function(){
			if($('.control#control .chnagetable #c1').val()=='empty'||$('.control#control .chnagetable #c2').val()=='empty'){
			}
			else{
				$('.changetable .funcmap #change').prop('disabled',true);
				$.ajax({
					url:'./lib/js/changetable.ajax.php',
					method:'post',
					data:{'c1':$('.changetable #c1').val(),'c1consecnumber':$('.changetable #c1consecnumber').val(),'c2':$('.changetable #c2').val(),'c2consecnumber':$('.changetable #c2consecnumber').val()},
					dataType:'html',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'control changetable.ajax.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						//console.log(d);
						$('.inittable input[name="window"]').val('inittable');
						$('.changetable .funcmap #change').prop('disabled',false);
						changetable.dialog('close');
						//location.reload();
					},
					error:function(e){
						console.log(e);
					}
				});
			}
		});
		$('.funbox #open').click(function(){
			$('.funbox button').prop('disabled',true);
			$('.order#order #billfun #billfun2 .open').trigger('click');
		});
		$('.funbox #close').click(function(){
			$('.funbox button').prop('disabled',true);
			$('.order#order #billfun #billfun2 .close').trigger('click');
		});
		$('.inittable #cashdrawer').click(function(){
			$('.order#order #billfun1 button:eq(2)').trigger('click');
		});
		$('.inittable #combine').click(function(){
			$.ajax({
				url:'./lib/js/checkopen.ajax.php',
				async:false,
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'control checkopen.ajax.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
					if(d=='success'){
						$('.inittable input[name="window"]').val('combine');
						combine.dialog('open');
					}
					else{
						alert('目前尚未開班，請確認是否開班或重啟系統。');
					}
				},
				error:function(e){
					console.log(e);
				}
			});
		});
		$('.inittable #tablecombine').click(function(){
			$.ajax({
				url:'./lib/js/checkopen.ajax.php',
				async:false,
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'control checkopen.ajax.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
					if(d=='success'){
						$('.inittable input[name="window"]').val('tablecombine');
						tablecombine.dialog('open');
					}
					else{
						alert('目前尚未開班，請確認是否開班或重啟系統。');
					}
				},
				error:function(e){
					console.log(e);
				}
			});
		});
		$('.inittable #tablesplit').click(function(){
			$.ajax({
				url:'./lib/js/checkopen.ajax.php',
				async:false,
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'control checkopen.ajax.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
					if(d=='success'){
						$('.inittable input[name="window"]').val('tablesplit');
						tablesplit.dialog('open');
					}
					else{
						alert('目前尚未開班，請確認是否開班或重啟系統。');
					}
				},
				error:function(e){
					console.log(e);
				}
			});
		});
		$('.inittable #tableclear').click(function(){
			$.ajax({
				url:'./lib/js/checkopen.ajax.php',
				async:false,
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'control checkopen.ajax.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					console.log(d);
					if(d=='success'){
						$('.inittable input[name="window"]').val('tableclear');
						tableclear.dialog('open');
					}
					else{
						alert('目前尚未開班，請確認是否開班或重啟系統。');
					}
				},
				error:function(e){
					console.log(e);
				}
			});
		});
		$('.funbox #tablehint').click(function(){
			$.ajax({
				url:'./gettimelist.ajax.php',
				async:false,
				dataType:'html',
				success:function(d){
					$('.tablehint #timelist').html(d);
					tablehint.dialog('open');
				},
				errpr:function(e){
					console.log(e);
				}
			});
			//console.log('1');
		});
		$('.tablehint #cancel').click(function(){
			$('.tablehint #tiemlist').html('');
			tablehint.dialog('close');
		});
		$(document).on('click','.combine .chtable#notempty',function(){
			$(this).prop('id','check');
			$(this).find('#checkbox').html('✔');
			$.ajax({
				url:'./lib/js/getcombinelist.ajax.php',
				method:'post',
				async:false,
				data:{'consecnumber':$(this).find('input[name="consecnumber"]').val(),'tablenumber':$(this).find('input[name="tabnum"]').val()},
				dataType:'html',
				success:function(d){
					console.log(d);
					if(d.match(/,/g)){
						var temp=d.split(/,/g);
						for(var i=0;i<temp.length;i++){
							$('.combine .tablemap #t:eq('+(Number(temp[i])-1)+') .chtable').prop('id','check');
							$('.combine .tablemap #t:eq('+(Number(temp[i])-1)+') .chtable').find('#checkbox').html('✔');
						}
					}
					else if(d==''){
					}
					else{
						//console.log($('.combine .tablemap #t:eq('+(Number(d)-1)+') .chtable #tablenumber input[name="tabnum"]').val());
						$('.combine .tablemap #t:eq('+(Number(d)-1)+') .chtable').prop('id','check');
						$('.combine .tablemap #t:eq('+(Number(d)-1)+') .chtable #checkbox').html('✔');
					}
				},
				error:function(e){
					console.log(e);
				}
			});
			if($('.combine #check').length>=2){
				$('.combine #sale').prop('disabled',false);
			}
			else{
				$('.combine #sale').prop('disabled',true);
			}
		});
		$(document).on('click','.tablecombine .chtable',function(){
			if($(this).prop('id')=='notempty'){
				if($('.tablecombine .chtable#check').length>0){
				}
				else{
					$(this).prop('id','check');
					$(this).find('#checkbox').html('✔');
					var chnum=Number($('.tablecombine #check').length)+Number($('.tablecombine #oncheck').length);
					if(Number(chnum)>=2){
						$('.tablecombine #sale').prop('disabled',false);
					}
					else{
						$('.tablecombine #sale').prop('disabled',true);
					}
				}
			}
			else if($(this).prop('id')=='check'){
				$(this).prop('id','notempty');
				$(this).find('#checkbox').html('');
				var chnum=Number($('.tablecombine #check').length)+Number($('.tablecombine #oncheck').length);
				if(Number(chnum)>=2){
					$('.tablecombine #sale').prop('disabled',false);
				}
				else{
					$('.tablecombine #sale').prop('disabled',true);
				}
			}
			else if($(this).prop('id')=='oncheck'){
				$(this).prop('id','');
				$(this).find('#checkbox').html('');
				var chnum=Number($('.tablecombine #check').length)+Number($('.tablecombine #oncheck').length);
				if(Number(chnum)>=2){
					$('.tablecombine #sale').prop('disabled',false);
				}
				else{
					$('.tablecombine #sale').prop('disabled',true);
				}
			}
			else if($(this).prop('id')==''){
				$(this).prop('id','oncheck');
				$(this).find('#checkbox').html('✔');
				var chnum=Number($('.tablecombine #check').length)+Number($('.tablecombine #oncheck').length);
				if(Number(chnum)>=2){
					$('.tablecombine #sale').prop('disabled',false);
				}
				else{
					$('.tablecombine #sale').prop('disabled',true);
				}
			}
			//console.log(chnum);
		});
		$(document).on('click','.tablesplit .chtable#notempty',function(){
			$.ajax({
				url:'./gettablelist.ajax.php',
				method:'post',
				data:{'bizdate':$('.control#control #bizdate').val(),'zcounter':$('.control#control #zcounter').val(),'tablenum':$(this).find('#tablenumber input[name="tabnum"]').val()},
				dataType:'html',
				success:function(d){
					if(d=="目前點選之桌號已併桌，無法進行拆桌動作。"){
						$('.checktablesplit #text').html(d);
						$('.checktablesplit #sale').prop('disabled',true);
						checktablesplit.dialog('open');
					}
					else{
						$('.checktablesplit #text').html(d);
						$('.checktablesplit #sale').prop('disabled',false);
						checktablesplit.dialog('open');
					}
				},
				error:function(e){
					console.log(e);
				}
			});
		});
		$(document).on('click','.tableclear .chtable#notempty',function(){
			var index=$('.tableclear .tablemap button').index(this);
			var tabnum=$(this).find('#tablenumber input[name="tabnum"]').val();
			if($('.tableclear .tablemap button:eq('+index+')[name="split"]').length>0){
				$.ajax({
					url:'./getsplittablelist.ajax.php',
					method:'post',
					async:false,
					data:{'bizdate':$('.control#control #bizdate').val(),'zcounter':$('.control#control #zcounter').val(),'tabnum':tabnum},
					dataType:'json',
					success:function(d){
						//console.log(d);
						$('.splittablelist').html('');
						$.each(d,function(index,value){
							if(index=='time'){
								return false;
							}
							else{
								$('.splittablelist').append('<button><div id="tablenum">'+value['tablenumber']+'<input type="hidden" name="tablenumber" value="'+value['tablenumber']+'"><input type="hidden" name="state" value="'+value['state']+'"></div><div id="consecnumber">'+index+'</div><div id="bizdate">'+value['bizdate']+'</div></button>');
							}
						});
					},
					error:function(e){
						console.log(e);
					}
				});
				splittablelist.dialog('open');
			}
			else{
				$.ajax({
					url:'./gettableclear.ajax.php',
					method:'post',
					data:{'bizdate':$('.control#control #bizdate').val(),'zcounter':$('.control#control #zcounter').val(),'tablenum':$(this).find('#tablenumber input[name="tabnum"]').val(),'state':$(this).find('#tablenumber input[name="state"]').val()},
					dataType:'html',
					success:function(d){
						$('.checktableclear #text').html(d);
						$('.checktableclear #sale').prop('disabled',false);
						checktableclear.dialog('open');
					},
					error:function(e){
						console.log(e);
					}
				});
			}
		});
		$(document).on('click','.combine .chtable#check',function(){
			$(this).prop('id','notempty');
			$(this).find('#checkbox').html('');
			$.ajax({
				url:'./lib/js/getcombinelist.ajax.php',
				method:'post',
				async:false,
				data:{'consecnumber':$(this).find('input[name="consecnumber"]').val(),'tablenumber':$(this).find('input[name="tabnum"]').val()},
				dataType:'html',
				success:function(d){
					//console.log(d);
					if(d.match(/,/g)){
						var temp=d.split(/,/g);
						for(var i=0;i<temp.length;i++){
							$('.combine .tablemap #t:eq('+(Number(temp[i])-1)+') .chtable').prop('id','notempty');
							$('.combine .tablemap #t:eq('+(Number(temp[i])-1)+') .chtable').find('#checkbox').html('');
						}
					}
					else if(d==''){
					}
					else{
						//console.log($('.combine .tablemap #t:eq('+(Number(d)-1)+') .chtable #tablenumber input[name="tabnum"]').val());
						$('.combine .tablemap #t:eq('+(Number(d)-1)+') .chtable').prop('id','notempty');
						$('.combine .tablemap #t:eq('+(Number(d)-1)+') .chtable #checkbox').html('');
					}
				},
				error:function(e){
					console.log(e);
				}
			});
			if($('.combine #check').length>=2){
				$('.combine #sale').prop('disabled',false);
			}
			else{
				$('.combine #sale').prop('disabled',true);
			}
		});
		$('.combine #sale').click(function(){
			var tt='';
			var tconsecnumber='';
			var tabnum=$('.combine #check:eq(0) #tablenumber input[name="tabnum"]').val();
			for(var i=0;i<$('.combine #check').length;i++){
				if(tt==''){
					tt=$('.combine #check:eq('+i+') #tablenumber input[name="tabnum"]').val();
					tconsecnumber=$('.combine #check:eq('+i+') #tablenumber input[name="consecnumber"]').val();
				}
				else{
					tt=tt+','+$('.combine #check:eq('+i+') #tablenumber input[name="tabnum"]').val();
					tconsecnumber=tconsecnumber+','+$('.combine #check:eq('+i+') #tablenumber input[name="consecnumber"]').val();
				}
			}
			$('.checkcombine #text').html('');
			$('.checkcombine #text').append('合併結帳之桌號：'+tt);
			$('.checkcombine #text').append('<input type="hidden" name="consecnumbers" value="'+tconsecnumber+'">');
			$('.checkcombine #text').append('<input type="hidden" name="tabnum" value="'+tabnum+'">');
			$('.checkcombine #text').append('<input type="hidden" name="tabini" value="'+tt+'">');
			checkcombine.dialog('open');
		});
		$('.tablecombine #sale').click(function(){
			var tt='';
			if($('.tablecombine #check').length>0){
				var consecnumber=$('.tablecombine #check:eq(0) #tablenumber input[name="consecnumber"]').val();
			}
			else{
				var consecnumber='';
			}
			for(var i=0;i<$('.tablecombine .chtable').length;i++){
				if($('.tablecombine .chtable:eq('+i+')').prop('id')=='oncheck'||$('.tablecombine .chtable:eq('+i+')').prop('id')=='check'){
					if(tt==''){
						tt=$('.tablecombine .chtable:eq('+i+') #tablenumber input[name="tabnum"]').val();
						tconsecnumber=$('.tablecombine .chtable:eq('+i+') #tablenumber input[name="consecnumber"]').val();
					}
					else{
						if($('.tablecombine .chtable:eq('+i+') #tablenumber input[name="consecnumber"]').val()!=''){
							tt=$('.tablecombine .chtable:eq('+i+') #tablenumber input[name="tabnum"]').val()+','+tt;
							tconsecnumber=$('.tablecombine .chtable:eq('+i+') #tablenumber input[name="consecnumber"]').val()+','+tconsecnumber;
						}
						else{
							tt=tt+','+$('.tablecombine .chtable:eq('+i+') #tablenumber input[name="tabnum"]').val();
							tconsecnumber=tconsecnumber+','+$('.tablecombine .chtable:eq('+i+') #tablenumber input[name="consecnumber"]').val();
						}
					}
				}
				else{
				}
			}
			$('.checktablecombine #text').html('');
			$('.checktablecombine #text').append('欲併桌之桌號：'+tt);
			$('.checktablecombine #text').append('<input type="hidden" name="consecnumbers" value="'+consecnumber+'">');
			$('.checktablecombine #text').append('<input type="hidden" name="tabnum" value="'+tt+'">');
			checktablecombine.dialog('open');
		});
		$('.checkcombine #cancel').click(function(){
			$('.checkcombine #text').html('');
			checkcombine.dialog('close');
		});
		$('.checktablecombine #cancel').click(function(){
			$('.checktablecombine #text').html('');
			checktablecombine.dialog('close');
		});
		$('.checktablesplit #cancel').click(function(){
			$('.checktablesplit #text').html('');
			$('.checktablesplit #sale').prop('disabled',false);
			checktablesplit.dialog('close');
		});
		$('.checktableclear #cancel').click(function(){
			$('.checktableclear #text').html('');
			$('.checktableclear #sale').prop('disabled',false);
			checktableclear.dialog('close');
		});
		$('.checkcombine #sale').click(function(){
			$('.checkcombine #sale').prop('disabled',true);
			$.ajax({
				url:'./combinelist.php',
				method:'post',
				async:false,
				data:{'usercode':$('.control#control #usercode').val(),'username':$('.control#control #username').val(),'consecnumbers':$('.checkcombine #text input[name="consecnumbers"]').val(),'tabnum':$('.checkcombine #text input[name="tabnum"]').val(),'tabini':$('.checkcombine #text input[name="tabini"]').val(),'machine':$('.control#control #'+$('.control#control #mactype').val()+'name').val()},
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'control combinelist.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
					var t=d.split(',');
					checkcombine.dialog('close');
					$('.checkcombine #sale').prop('disabled',false);
					
					combine.dialog('close');
					$('.inittable input[name="window"]').val('inittable');
					inittable.dialog('close');
					temporder(t[0],t[1],$('.control#control #'+$('.control#control #mactype').val()+'name').val(),$('.order#order .companydata #company').val(),$('.control#control #usercode').val(),$('.control#control #username').val());

					//location.href='./order.php?<?php if(isset($_GET["submachine"]))echo "submachine=".$_GET["submachine"]."&";else if(isset($_GET["machine"]))echo "machine=".$_GET["machine"]."&";else; ?>usercode=<?php if(isset($_GET["usercode"]))echo $_GET["usercode"]; ?>&username=<?php if(isset($_GET["username"]))echo $_GET["username"]; ?>&listtype=1&tabnum&bizdate='+t[0]+'&consecnumber='+t[1];
				},
				error:function(e){
					console.log(e);
				}
			});
		});
		$('.checktablecombine #sale').click(function(){
			$('.checktablecombine #sale').prop('disabled',true);
			$.ajax({
				url:'./combinetablelist.php',
				method:'post',
				async:false,
				data:{'machinetype':$('.control#control #'+$('.control#control #mactype').val()+'name').val(),'usercode':$('.control#control #usercode').val(),'username':$('.control#control #username').val(),'consecnumber':$('.checktablecombine #text input[name="consecnumbers"]').val(),'tabnum':$('.checktablecombine #text input[name="tabnum"]').val()},
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'control combinetablelist.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
					var t=d.split(',');
					checktablecombine.dialog('close');
					$('.checktablecombine #sale').prop('disabled',false);
					
					tablecombine.dialog('close');
					$('.inittable input[name="window"]').val('inittable');
					inittable.dialog('close');
					temporder(t[0],t[1],$('.control#control #'+$('.control#control #mactype').val()+'name').val(),$('.order#order .companydata #company').val(),$('.control#control #usercode').val(),$('.control#control #username').val());

					//location.href='./order.php?<?php if(isset($_GET["submachine"]))echo "submachine=".$_GET["submachine"]."&";else if(isset($_GET["machine"]))echo "machine=".$_GET["machine"]."&";else; ?>usercode=<?php if(isset($_GET["usercode"]))echo $_GET["usercode"]; ?>&username=<?php if(isset($_GET["username"]))echo $_GET["username"]; ?>&listtype=1&tabnum&bizdate='+t[0]+'&consecnumber='+t[1];
				},
				error:function(e){
					console.log(e);
				}
			});
		});
		$('.checktablesplit #sale').click(function(){
			$('.checktablesplit #sale').prop('disabled',true);//拆單－新增帳單
			$.ajax({
				url:'./splittable.php',
				method:'post',
				async:false,
				data:{'machinetype':$('.control#control #'+$('.control#control #mactype').val()+'name').val(),'usercode':$('.control#control #usercode').val(),'username':$('.control#control #username').val(),'tabnum':$('.checktablesplit #text input[name="lastnum"]').val()},
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'control splittable.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
					var t=d.split(',');
					checktablesplit.dialog('close');
					$('.checktablesplit #sale').prop('disabled',false);
					splittablelist.dialog('close');
					tablesplit.dialog('close');
					$('.inittable input[name="window"]').val('inittable');
					inittable.dialog('close');
					temporder(t[0],t[1],$('.control#control #'+$('.control#control #mactype').val()+'name').val(),$('.order#order .companydata #company').val(),$('.control#control #usercode').val(),$('.control#control #username').val());

					//location.href='./order.php?<?php if(isset($_GET["submachine"]))echo "submachine=".$_GET["submachine"]."&";else if(isset($_GET["machine"]))echo "machine=".$_GET["machine"]."&";else; ?>usercode=<?php if(isset($_GET["usercode"]))echo $_GET["usercode"]; ?>&username=<?php if(isset($_GET["username"]))echo $_GET["username"]; ?>&listtype=1&tabnum='+t[2]+'&bizdate='+t[0]+'&consecnumber='+t[1];
				},
				error:function(e){
					console.log(e);
				}
			});
		});
		$('.checktableclear #sale').click(function(){//清理桌面
			$('.checktablesplit #sale').prop('disabled',true);
			$.ajax({
				url:'./cleartable.php',
				method:'post',
				async:false,
				data:{'tabnum':$('.checktableclear #text input[name="lastnum"]').val()},
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'control splittable.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
					checktableclear.dialog('close');
					$('.checktablesplit #sale').prop('disabled',false);
					if(splittablelist.dialog('isOpen')){
						splittablelist.dialog('close');
					}
					else{
					}

					//location.href='./order.php?<?php if(isset($_GET["submachine"]))echo "submachine=".$_GET["submachine"]."&";else if(isset($_GET["machine"]))echo "machine=".$_GET["machine"]."&";else; ?>usercode=<?php if(isset($_GET["usercode"]))echo $_GET["usercode"]; ?>&username=<?php if(isset($_GET["username"]))echo $_GET["username"]; ?>&listtype=1&tabnum='+t[2]+'&bizdate='+t[0]+'&consecnumber='+t[1];
				},
				error:function(e){
					console.log(e);
				}
			});
		});
		$('.combine #return').click(function(){
			$('.inittable input[name="window"]').val('inittable');
			combine.dialog('close');
		});
		$('.tablecombine #return').click(function(){
			$('.inittable input[name="window"]').val('inittable');
			tablecombine.dialog('close');
		});
		$('.tablesplit #return').click(function(){
			$('.inittable input[name="window"]').val('inittable');
			tablesplit.dialog('close');
		});
		$('.tableclear #return').click(function(){
			$('.inittable input[name="window"]').val('inittable');
			tableclear.dialog('close');
		});
		$('.funbox #return').click(function(){
			funbox.dialog('close');
		});
		$('.consetchange .numbox').on('click','input',function(){
			var index=$('.consetchange .numbox input').index(this);
			if($('.consetchange input[name="view"]').val()==''&&$('.consetchange .numbox input:eq('+index+')').val()=='.'){
				$('.consetchange input[name="view"]').val('0.');
			}
			else if($('.consetchange input[name="view"]').val()=='0'){
				$('.consetchange input[name="view"]').val($('.consetchange .numbox input:eq('+index+')').val());
			}
			else{
				$('.consetchange input[name="view"]').val($('.consetchange input[name="view"]').val()+$('.consetchange .numbox input:eq('+index+')').val());
			}
		});
		$('.consetchange .numbox').on('click','button',function(){
			$('.consetchange input[name="view"]').val('0');
		});
		$('.consetchange').on('click','#settingchange',function(){
			consetchange.dialog('close');
		});
	}
	else{
	}
	/*點餐*/
	$.ajax({
		url:'./lib/js/check.booking.php',
		method:'post',
		async:false,
		dataType:'html',
		success:function(d){
			if(d=='success'){
				if($('.order#order #content #MemberBill #list #funbox #point').css('background-color')=='red'){
				}
				else{
					$('.order#order #content #MemberBill #list #funbox #point').css({'background-color':'red','z-index':'3'});
				}
			}
			else{
				$('.order#order #content #MemberBill #list #funbox #point').css({'background-color':'','z-index':''});
			}
			//console.log(d);
		},
		error:function(e){
			console.log(e);
		}
	});
	/**/
	function sleep(time){//依0.1秒為單位
		for(var i=0;i<time;){
			i=setTimeout(add(i),100);
		}
	}
	function add(temp){
		temp++;
	}
	setInterval(function(){
		if(responce==true){
			responce=false;
			$.ajax({
				url:'./lib/js/gettime.ajax.php',
				dataType:'html',
				async:false,
				success:function(d){
					//console.log(d);
					$('.order#order #billfun #butobx #time').val(d);
				},
				error:function(e){
					//console.log(e);
				}
			});
			if($('.order#order .initsetting #checkcontrol').val()=='1'&&$('.order#order .initsetting #controltable').val()=='1'&&tempparameter==1&&inittable.dialog('isOpen')){
				var tablepage='';
				//console.log(typeof $('.'+$('.inittable input[name="window"]').val()+' .tablemap #butbox .focus').prop('id'));
				if(typeof $('.'+$('.inittable input[name="window"]').val()+' .tablemap #butbox .focus').prop('id')==="undefined"){
				}
				else{
					tablepage=$('.'+$('.inittable input[name="window"]').val()+' .tablemap #butbox .focus').prop('id');
				}
				//console.log(tablepage);
				$.ajax({
					url:'./comput.ajax.php',
					method:'post',
					data:{'tablepage':tablepage},
					dataType:'json',
					async:false,
					success:function(d){
						$('.inittable #time').val(d['time']);
						//console.log(d);
						//console.log($('.inittable .table[id^="comput"]').length);
						if(tablepage!=''){
							var target=tablepage.substr(0,(tablepage.length-6));
							for(var i=0;i<$('.inittable #'+target+' .table[id^="comput"]').length;i++){
								if($('.inittable #'+target+' .table[id^="comput"]:eq('+i+') #tablenumber input[name="tabnum"]').val()!='outside'){
									var temptabnum=$('.inittable #'+target+' .table[id^="comput"]:eq('+i+') #tablenumber').html().split('<input');
									//console.log( d[$('.control#control #'+target+' .table[id^="comput"]:eq('+i+') #tablenumber input[name="tabnum"]').val()]);
									if(typeof d[temptabnum[0]]!="undefined"){
										if(d[temptabnum[0]]['splitnum']!='1'){
											$('.tableclear #'+target+' .chtable:eq('+i+')').prop('name','split');
											$('.inittable #'+target+' .table[id^="comput"]:eq('+i+')').prop('name','split');
										}
										else{
											$('.tableclear #'+target+' .chtable:eq('+i+')').prop('name','');
											$('.inittable #'+target+' .table[id^="comput"]:eq('+i+')').prop('name','');
										}
										$('.inittable #'+target+' .table[id^="comput"]:eq('+i+')').prop('id','comput notempty ');
										$('.inittable #'+target+' .table[id^="comput"]:eq('+i+') #tablenumber input[name="tabnum"]').val(d[temptabnum[0]]['inittablenum']);
										$('.inittable #'+target+' .table[id^="comput"]:eq('+i+') #tablenumber input[name="consecnumber"]').val(d[temptabnum[0]]['consecnumber']);
										$('.inittable #'+target+' .table[id^="comput"]:eq('+i+') #tablenumber input[name="state"]').val(d[temptabnum[0]]['state']);
										$('.inittable #'+target+' .table[id^="comput"]:eq('+i+') #createdatetime input[name="bizdate"]').val(d[temptabnum[0]]['bizdate']);
										$('.inittable #'+target+' .table[id^="comput"]:eq('+i+') #amt').html('<span>'+d[temptabnum[0]]['money']+'</span>');
										if(Number(d[temptabnum[0]]['persons'])>0){
											//console.log($('.control#control #'+target+' .table[id^="comput"]:eq('+i+') #persons').length);
											$('.inittable #'+target+' .table[id^="comput"]:eq('+i+') #persons').html(d[temptabnum[0]]['persons']+'位');
										}
										else{
											$('.inittable #'+target+' .table[id^="comput"]:eq('+i+') #persons').html('');
										}
										if($('.order#order .initsetting #hinttime').length>0&&parseInt(d[temptabnum[0]]['mins'])>parseInt($('.order#order .initsetting #hinttime').val())){
											$('.inittable #'+target+' .table[id^="comput"]:eq('+i+')').css({'background-color':''});
										}
										else if(parseInt(d[temptabnum[0]]['mins'])<=0){
											$('.inittable #'+target+' .table[id^="comput"]:eq('+i+')').css({'background-color':'#00d941'});
										}
										else if($('.order#order .initsetting #sechinttime').length>0&&parseInt(d[temptabnum[0]]['mins'])<=parseInt($('.order#order .initsetting #sechinttime').val())){
											$('.inittable #'+target+' .table[id^="comput"]:eq('+i+')').css({'background-color':'#e7f12c'});
										}
										else{
											$('.inittable #'+target+' .table[id^="comput"]:eq('+i+')').css({'background-color':'#73d7ec'});
										}
										$('.inittable #'+target+' .table[id^="comput"]:eq('+i+') #createdatetime #val').html(d[temptabnum[0]]['mins']);

										if($('.changetable #'+target+' .chtable:eq('+i+')[id="notempty check"]').length>0){
											//$('.combine #'+target+' .chtable:eq('+i+')').prop('id','notempty');
										}
										else{
											$('.changetable #'+target+' .chtable:eq('+i+')').prop('id','notempty');
											$('.changetable #'+target+' .chtable:eq('+i+')').css({'border':'5px solid #898989','border-radius':'5px','background-color':'#ff0066','color':'#ffffff'});
										}
										$('.changetable #'+target+' .chtable:eq('+i+') input[name="tabnum"]').val(d[temptabnum[0]]['inittablenum']);
										$('.changetable #'+target+' .chtable:eq('+i+') input[name="consecnumber"]').val(d[temptabnum[0]]['consecnumber']);
										if($('.combine #'+target+' .chtable:eq('+i+')[id="check"]').length>0){
											//$('.combine #'+target+' .chtable:eq('+i+')').prop('id','notempty');
										}
										else{
											$('.combine #'+target+' .chtable:eq('+i+')').prop('id','notempty');
											$('.combine #'+target+' .chtable:eq('+i+')').css({'border':'5px solid #898989','border-radius':'5px','background-color':'#ff0066','color':'#ffffff'});
										}
										$('.combine #'+target+' .chtable:eq('+i+') input[name="tabnum"]').val(d[temptabnum[0]]['inittablenum']);
										$('.combine #'+target+' .chtable:eq('+i+') input[name="consecnumber"]').val(d[temptabnum[0]]['consecnumber']);
										if($('.tablecombine #'+target+' .chtable:eq('+i+')[id="check"]').length>0){
											//$('.combine #'+target+' .chtable:eq('+i+')').prop('id','notempty');
										}
										else{
											$('.tablecombine #'+target+' .chtable:eq('+i+')').prop('id','notempty');
											$('.tablecombine #'+target+' .chtable:eq('+i+')').css({'border':'5px solid #898989','border-radius':'5px','background-color':'#ff0066','color':'#ffffff'});
										}
										$('.tablecombine #'+target+' .chtable:eq('+i+') input[name="tabnum"]').val(d[temptabnum[0]]['inittablenum']);
										$('.tablecombine #'+target+' .chtable:eq('+i+') input[name="consecnumber"]').val(d[temptabnum[0]]['consecnumber']);
										if($('.tablesplit #'+target+' .chtable:eq('+i+')[id="notempty check"]').length>0){
											//$('.combine #'+target+' .chtable:eq('+i+')').prop('id','notempty');
										}
										else{
											$('.tablesplit #'+target+' .chtable:eq('+i+')').prop('id','notempty');
											$('.tablesplit #'+target+' .chtable:eq('+i+')').css({'border':'5px solid #898989','border-radius':'5px','background-color':'#ff0066','color':'#ffffff'});
										}
										$('.tablesplit #'+target+' .chtable:eq('+i+') input[name="tabnum"]').val(d[temptabnum[0]]['inittablenum']);
										$('.tablesplit #'+target+' .chtable:eq('+i+') input[name="consecnumber"]').val(d[temptabnum[0]]['consecnumber']);
										if($('.tableclear #'+target+' .chtable:eq('+i+')[id="notempty check"]').length>0){
											//$('.combine #'+target+' .chtable:eq('+i+')').prop('id','notempty');
										}
										else{
											$('.tableclear #'+target+' .chtable:eq('+i+')').prop('id','notempty');
											$('.tableclear #'+target+' .chtable:eq('+i+')').css({'border':'5px solid #898989','border-radius':'5px','background-color':'#ff0066','color':'#ffffff'});
										}
										$('.tableclear #'+target+' .chtable:eq('+i+') input[name="tabnum"]').val(d[temptabnum[0]]['inittablenum']);
										$('.tableclear #'+target+' .chtable:eq('+i+') input[name="consecnumber"]').val(d[temptabnum[0]]['consecnumber']);
										$('.tableclear #'+target+' .chtable:eq('+i+') input[name="state"]').val(d[temptabnum[0]]['state']);
									}
									else{
										$('.inittable #'+target+' .table[id^="comput"]:eq('+i+')').prop('id','comput');
										var temptabnum=$('.inittable #'+target+' .table[id^="comput"]:eq('+i+') #tablenumber').html().split('<input');
										$('.inittable #'+target+' .table[id^="comput"]:eq('+i+') #tablenumber input[name="tabnum"]').val(temptabnum[0]);
										$('.inittable #'+target+' .table[id^="comput"]:eq('+i+') #tablenumber input[name="consecnumber"]').val('');
										$('.inittable #'+target+' .table[id^="comput"]:eq('+i+') #tablenumber input[name="state"]').val('0');
										$('.inittable #'+target+' .table[id^="comput"]:eq('+i+') #createdatetime input[name="bizdate"]').val('');
										$('.inittable #'+target+' .table[id^="comput"]:eq('+i+') #amt').html('');
										$('.inittable #'+target+' .table[id^="comput"]:eq('+i+') #persons').html('');
										$('.inittable #'+target+' .table[id^="comput"]:eq('+i+')').css({'background-color':''});
										$('.inittable #'+target+' .table[id^="comput"]:eq('+i+') #createdatetime #val').html('');
										if($('.changetable #'+target+' .chtable:eq('+i+')[id="check"]').length>0){
											//$('.changetable #'+target+' .chtable:eq('+i+')').prop('id','');
										}
										else{
											$('.changetable #'+target+' .chtable:eq('+i+')').prop('id','');
											$('.changetable #'+target+' .chtable:eq('+i+')').css({'border':'','border-radius':'','background-color':'','color':''});
										}
										$('.changetable #'+target+' .chtable:eq('+i+') input[name="consecnumber"]').val('');
										if($('.combine #'+target+' .chtable:eq('+i+')[id="check"]').length>0){
											//$('.changetable #'+target+' .chtable:eq('+i+')').prop('id','');
										}
										else{
											$('.combine #'+target+' .chtable:eq('+i+')').prop('id','');
											$('.combine #'+target+' .chtable:eq('+i+')').css({'border':'','border-radius':'','background-color':'','color':''});
										}
										$('.combine #'+target+' .chtable:eq('+i+') input[name="consecnumber"]').val('');
										if($('.tablecombine #'+target+' .chtable:eq('+i+')[id="oncheck"]').length>0){
											//$('.changetable #'+target+' .chtable:eq('+i+')').prop('id','');
										}
										else{
											$('.tablecombine #'+target+' .chtable:eq('+i+')').prop('id','');
											$('.tablecombine #'+target+' .chtable:eq('+i+')').css({'border':'','border-radius':'','background-color':'','color':''});
										}
										$('.tablecombine #'+target+' .chtable:eq('+i+') input[name="consecnumber"]').val('');
										if($('.tablesplit #'+target+' .chtable:eq('+i+')[id="check"]').length>0){
											//$('.changetable #'+target+' .chtable:eq('+i+')').prop('id','');
										}
										else{
											$('.tablesplit #'+target+' .chtable:eq('+i+')').prop('id','');
											$('.tablesplit #'+target+' .chtable:eq('+i+')').css({'border':'','border-radius':'','background-color':'','color':''});
										}
										$('.tablesplit #'+target+' .chtable:eq('+i+') input[name="consecnumber"]').val('');
										if($('.tableclear #'+target+' .chtable:eq('+i+')[id="check"]').length>0){
											//$('.changetable #'+target+' .chtable:eq('+i+')').prop('id','');
										}
										else{
											$('.tableclear #'+target+' .chtable:eq('+i+')').prop('id','');
											$('.tableclear #'+target+' .chtable:eq('+i+')').css({'border':'','border-radius':'','background-color':'','color':''});
										}
										$('.tableclear #'+target+' .chtable:eq('+i+') input[name="consecnumber"]').val('');
										$('.tableclear #'+target+' .chtable:eq('+i+') input[name="state"]').val('');
									}
								}
								else{
								}
							}
						}
						else{
							for(var i=0;i<$('.inittable .table[id^="comput"]').length;i++){
								if($('.inittable .table[id^="comput"]:eq('+i+') #tablenumber input[name="tabnum"]').val()!='outside'){
									var temptabnum=$('.inittable .table[id^="comput"]:eq('+i+') #tablenumber').html().split('<input');
									//console.log( d[$('.control#control .table[id^="comput"]:eq('+i+') #tablenumber input[name="tabnum"]').val()]);
									if(typeof d[temptabnum[0]]!="undefined"){
										if(d[temptabnum[0]]['splitnum']!='1'){
											$('.inittable .table[id^="comput"]:eq('+i+')').prop('name','split');
										}
										else{
											$('.inittable .table[id^="comput"]:eq('+i+')').prop('name','');
										}
										$('.inittable .table[id^="comput"]:eq('+i+')').prop('id','comput notempty ');
										$('.inittable .table[id^="comput"]:eq('+i+') #tablenumber input[name="tabnum"]').val(d[temptabnum[0]]['inittablenum']);
										$('.inittable .table[id^="comput"]:eq('+i+') #tablenumber input[name="consecnumber"]').val(d[temptabnum[0]]['consecnumber']);
										$('.inittable .table[id^="comput"]:eq('+i+') #tablenumber input[name="state"]').val(d[temptabnum[0]]['state']);
										$('.inittable .table[id^="comput"]:eq('+i+') #createdatetime input[name="bizdate"]').val(d[temptabnum[0]]['bizdate']);
										$('.inittable .table[id^="comput"]:eq('+i+') #amt').html('<span>'+d[temptabnum[0]]['money']+'</span>');
										if(Number(d[temptabnum[0]]['persons'])>0){
											//console.log($('.control#control .table[id^="comput"]:eq('+i+') #persons').length);
											$('.inittable .table[id^="comput"]:eq('+i+') #persons').html(d[temptabnum[0]]['persons']+'位');
										}
										else{
											$('.inittable .table[id^="comput"]:eq('+i+') #persons').html('');
										}
										if($('.order#order .initsetting #hinttime').length>0&&parseInt(d[temptabnum[0]]['mins'])>parseInt($('.order#order .initsetting #hinttime').val())){
											$('.inittable .table[id^="comput"]:eq('+i+')').css({'background-color':''});
										}
										else if(parseInt(d[temptabnum[0]]['mins'])<=0){
											$('.inittable .table[id^="comput"]:eq('+i+')').css({'background-color':'#00d941'});
										}
										else if($('.order#order .initsetting #sechinttime').length>0&&parseInt(d[temptabnum[0]]['mins'])<=parseInt($('.order#order .initsetting #sechinttime').val())){
											$('.inittable .table[id^="comput"]:eq('+i+')').css({'background-color':'#e7f12c'});
										}
										else{
											$('.inittable .table[id^="comput"]:eq('+i+')').css({'background-color':'#73d7ec'});
										}
										$('.inittable .table[id^="comput"]:eq('+i+') #createdatetime #val').html(d[temptabnum[0]]['mins']);

										if($('.changetable .chtable:eq('+i+')[id="notempty check"]').length>0){
											//$('.combine .chtable:eq('+i+')').prop('id','notempty');
										}
										else{
											$('.changetable .chtable:eq('+i+')').prop('id','notempty');
											$('.changetable .chtable:eq('+i+')').css({'border':'5px solid #898989','border-radius':'5px','background-color':'#ff0066','color':'#ffffff'});
										}
										$('.changetable .chtable:eq('+i+') input[name="tabnum"]').val(d[temptabnum[0]]['inittablenum']);
										$('.changetable .chtable:eq('+i+') input[name="consecnumber"]').val(d[temptabnum[0]]['consecnumber']);
										if($('.combine .chtable:eq('+i+')[id="check"]').length>0){
											//$('.combine .chtable:eq('+i+')').prop('id','notempty');
										}
										else{
											$('.combine .chtable:eq('+i+')').prop('id','notempty');
											$('.combine .chtable:eq('+i+')').css({'border':'5px solid #898989','border-radius':'5px','background-color':'#ff0066','color':'#ffffff'});
										}
										$('.combine .chtable:eq('+i+') input[name="tabnum"]').val(d[temptabnum[0]]['inittablenum']);
										$('.combine .chtable:eq('+i+') input[name="consecnumber"]').val(d[temptabnum[0]]['consecnumber']);
										if($('.tablecombine .chtable:eq('+i+')[id="check"]').length>0){
											//$('.combine .chtable:eq('+i+')').prop('id','notempty');
										}
										else{
											$('.tablecombine .chtable:eq('+i+')').prop('id','notempty');
											$('.tablecombine .chtable:eq('+i+')').css({'border':'5px solid #898989','border-radius':'5px','background-color':'#ff0066','color':'#ffffff'});
										}
										$('.tablecombine .chtable:eq('+i+') input[name="tabnum"]').val(d[temptabnum[0]]['inittablenum']);
										$('.tablecombine .chtable:eq('+i+') input[name="consecnumber"]').val(d[temptabnum[0]]['consecnumber']);
										if($('.tablesplit .chtable:eq('+i+')[id="notempty check"]').length>0){
											//$('.combine .chtable:eq('+i+')').prop('id','notempty');
										}
										else{
											$('.tablesplit .chtable:eq('+i+')').prop('id','notempty');
											$('.tablesplit .chtable:eq('+i+')').css({'border':'5px solid #898989','border-radius':'5px','background-color':'#ff0066','color':'#ffffff'});
										}
										$('.tablesplit .chtable:eq('+i+') input[name="tabnum"]').val(d[temptabnum[0]]['inittablenum']);
										$('.tablesplit .chtable:eq('+i+') input[name="consecnumber"]').val(d[temptabnum[0]]['consecnumber']);
										if($('.tableclear .chtable:eq('+i+')[id="notempty check"]').length>0){
											//$('.combine .chtable:eq('+i+')').prop('id','notempty');
										}
										else{
											$('.tableclear .chtable:eq('+i+')').prop('id','notempty');
											$('.tableclear .chtable:eq('+i+')').css({'border':'5px solid #898989','border-radius':'5px','background-color':'#ff0066','color':'#ffffff'});
										}
										$('.tableclear .chtable:eq('+i+') input[name="tabnum"]').val(d[temptabnum[0]]['inittablenum']);
										$('.tableclear .chtable:eq('+i+') input[name="consecnumber"]').val(d[temptabnum[0]]['consecnumber']);
										$('.tableclear .chtable:eq('+i+') input[name="state"]').val(d[temptabnum[0]]['state']);
									}
									else{
										$('.inittable .table[id^="comput"]:eq('+i+')').prop('id','comput');
										var temptabnum=$('.inittable .table[id^="comput"]:eq('+i+') #tablenumber').html().split('<input');
										$('.inittable .table[id^="comput"]:eq('+i+') #tablenumber input[name="tabnum"]').val(temptabnum[0]);
										$('.inittable .table[id^="comput"]:eq('+i+') #tablenumber input[name="consecnumber"]').val('');
										$('.inittable .table[id^="comput"]:eq('+i+') #tablenumber input[name="state"]').val('0');
										$('.inittable .table[id^="comput"]:eq('+i+') #createdatetime input[name="bizdate"]').val('');
										$('.inittable .table[id^="comput"]:eq('+i+') #amt').html('');
										$('.inittable .table[id^="comput"]:eq('+i+') #persons').html('');
										$('.inittable .table[id^="comput"]:eq('+i+')').css({'background-color':''});
										$('.inittable .table[id^="comput"]:eq('+i+') #createdatetime #val').html('');
										if($('.changetable .chtable:eq('+i+')[id="check"]').length>0){
											//$('.changetable .chtable:eq('+i+')').prop('id','');
										}
										else{
											$('.changetable .chtable:eq('+i+')').prop('id','');
											$('.changetable .chtable:eq('+i+')').css({'border':'','border-radius':'','background-color':'','color':''});
										}
										$('.changetable .chtable:eq('+i+') input[name="consecnumber"]').val('');
										if($('.combine .chtable:eq('+i+')[id="check"]').length>0){
											//$('.changetable .chtable:eq('+i+')').prop('id','');
										}
										else{
											$('.combine .chtable:eq('+i+')').prop('id','');
											$('.combine .chtable:eq('+i+')').css({'border':'','border-radius':'','background-color':'','color':''});
										}
										$('.combine .chtable:eq('+i+') input[name="consecnumber"]').val('');
										if($('.tablecombine .chtable:eq('+i+')[id="oncheck"]').length>0){
											//$('.changetable .chtable:eq('+i+')').prop('id','');
										}
										else{
											$('.tablecombine .chtable:eq('+i+')').prop('id','');
											$('.tablecombine .chtable:eq('+i+')').css({'border':'','border-radius':'','background-color':'','color':''});
										}
										$('.tablecombine .chtable:eq('+i+') input[name="consecnumber"]').val('');
										if($('.tablesplit .chtable:eq('+i+')[id="check"]').length>0){
											//$('.changetable .chtable:eq('+i+')').prop('id','');
										}
										else{
											$('.tablesplit .chtable:eq('+i+')').prop('id','');
											$('.tablesplit .chtable:eq('+i+')').css({'border':'','border-radius':'','background-color':'','color':''});
										}
										$('.tablesplit .chtable:eq('+i+') input[name="consecnumber"]').val('');
										if($('.tableclear .chtable:eq('+i+')[id="check"]').length>0){
											//$('.changetable .chtable:eq('+i+')').prop('id','');
										}
										else{
											$('.tableclear .chtable:eq('+i+')').prop('id','');
											$('.tableclear .chtable:eq('+i+')').css({'border':'','border-radius':'','background-color':'','color':''});
										}
										$('.tableclear .chtable:eq('+i+') input[name="consecnumber"]').val('');
										$('.tableclear .chtable:eq('+i+') input[name="state"]').val('');
									}
								}
								else{
								}
							}
						}
						if(d['outside']>0){
							$('.inittable .table #QTY').html('尚有'+d['outside']+'單');
						}
						else{
							$('.inittable .table #QTY').html('');
						}
					},
					error:function(e){
						console.log(e);
					}
				});
			}
			else{
			}
			responce=true;
		}
		else{
		}
	},1000);
	if($('.order#order .initsetting #weborder').length>0&&$('.order#order .initsetting #weborder').val()=='1'){
		if($('.order#order .initsetting #webordersec').length>0){
			var checksec=$('.order#order .initsetting #webordersec').val();
		}
		else{
			var checksec='300';
		}
		setInterval(function(){
			$.ajax({
				url:'https://www.quickcode.com.tw/outposandorder/demopos/lib/js/getweborder.ajax.php',
				method:'post',
				data:{'company':$('.order#order .companydata #company').val(),'dep':$('.order#order .companydata #story').val()},
				dataType:'html',
				timeout:5000,
				success:function(d){
					console.log(d);
					if(d=='empty'){
						//$('.order#order #billfun #butobx #time').val(d);
						$('.order#order #content #MemberBill #billfun #billfun1 #point').css({'background-color':'red','z-index':'0'});
					}
					else{
						if($('.order#order #content #MemberBill #billfun #billfun1 #point').css('background-color')=='red'){
							//$('.order#order #content #MemberBill #list #funbox #point').css({'background-color':'red','z-index':'3'});
						}
						else{
							$('.order#order #content #MemberBill #billfun #billfun1 #point').css({'background-color':'red','z-index':'3'});
						}
					}
					//console.log(d);
				},
				error:function(e,status){
					if(status==='timeout'){
						console.log('timeout');
					}
					else{
						console.log(e);
					}
				}
			});
		},parseInt(checksec)*1000);
	}
	else{
	}
	if($('.order#order .initsetting #secview').val()=='1'){
		$.ajax({
			url:'../secview/cleartemp.ajax.php',
			async: false,
			dataType:'html',
			success:function(d){
				//console.log(d);
			},
			error:function(e){
				//console.log(e);
			}
		});
	}
	else{
	}
	if($('.order#order #MemberBill #tabs4 #listform input[name="consecnumber"]').val().length>0&&$('.order#order #MemberBill #tabs4 #listform input[name="bizdate"]').val().length>0){
		temporder($('.order#order #MemberBill #tabs4 #listform input[name="bizdate"]').val(),$('.order#order #MemberBill #tabs4 #listform input[name="consecnumber"]').val(),$('.order#order #tabs4 #listform input[name="machinetype"]').val(),$('.order#order .companydata #company').val(),$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val(),$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val());
		/*initlisttype();
		initsumbox();
		initparameters();
		inittempbox();
		initlists();
		initorder();
		$.ajax({
			url:'./lib/js/temporder.banner.php',
			method:'post',
			data:{'bizdate':$('.order#order #MemberBill #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #MemberBill #tabs4 #listform input[name="consecnumber"]').val()},
			dataType:'json',
			success:function(d){
				//console.log(d);
				if(d[0]['REMARKS'].toString().match(/-/g)){
					var temp=d[0]['REMARKS'].toString().split("-");
					$('.order#order #banner #type input[name="reservedatetime"]').val(temp[1]);
					if(temp[0]=='1'){
						$('.order#order #banner #type').css({'margin-right':'1px'});
						$('.order#order #banner #type button.inside').prop('disabled',true);
						$('.order#order #banner #tablenumber').prop('style','float: left;width: calc(42% / 5 - 2px);height: 100%;margin: 0px 1px;');
						if($('.order#order .initsetting #tabnum').val()==1){
							$('.order#order #banner #tablenumber').html('<div style="width:100%;height:50%;text-align:center;">內用桌號</div><div style="width:100%;height:50%;border:1px solid #898989;text-align:center;border-radius: 5px;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;">'+$.trim(d[0]['TABLENUMBER'])+'</div>');
						}
						else{
						}
						$('.order#order #banner #detail').css({'margin-left':'3px'});
						$('.order#order #banner #detail #viewtotal').val(d[0]['SALESTTLAMT']);
						$('.order#order #banner #detail #viewnumber').val(d[0]['SALESTTLQTY']);
					}
					else{
						$('.order#order #banner #type').css({'margin-right':'calc(42% / 5)'});
						if(temp[0]=='2'){
							$('.order#order #banner #type button.come').prop('disabled',true);
						}
						else if(temp[0]=='3'){
							$('.order#order #banner #type button.outside').prop('disabled',true);
						}
						else{
							$('.order#order #banner #type button.bysale').prop('disabled',true);
						}
						$('.order#order #banner #tablenumber').prop('style','float: left;');
						$('.order#order #banner #tablenumber').html('');
						$('.order#order #banner #detail').css({'margin-left':'3px'});
						$('.order#order #banner #detail #viewtotal').val(d[0]['SALESTTLAMT']);
						$('.order#order #banner #detail #viewnumber').val(d[0]['SALESTTLQTY']);
					}
				}
				else{
					if(d[0]['REMARKS']=='1'){
						$('.order#order #banner #type').css({'margin-right':'1px'});
						$('.order#order #banner #type button.inside').prop('disabled',true);
						$('.order#order #banner #tablenumber').prop('style','float: left;width: calc(42% / 5 - 2px);height: 100%;margin: 0px 1px;');
						if($('.order#order .initsetting #tabnum').val()==1){
							$('.order#order #banner #tablenumber').html('<div style="width:100%;height:50%;text-align:center;">內用桌號</div><div style="width:100%;height:50%;border:1px solid #898989;text-align:center;border-radius: 5px;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;">'+$.trim(d[0]['TABLENUMBER'])+'</div>');
						}
						else{
						}
						$('.order#order #banner #detail').css({'margin-left':'3px'});
						$('.order#order #banner #detail #viewtotal').val(d[0]['SALESTTLAMT']);
						$('.order#order #banner #detail #viewnumber').val(d[0]['SALESTTLQTY']);
					}
					else{
						$('.order#order #banner #type').css({'margin-right':'calc(42% / 5)'});
						if(d[0]['REMARKS']=='2'){
							$('.order#order #banner #type button.come').prop('disabled',true);
						}
						else if(d[0]['REMARKS']=='3'){
							$('.order#order #banner #type button.outside').prop('disabled',true);
						}
						else{
							$('.order#order #banner #type button.bysale').prop('disabled',true);
						}
						$('.order#order #banner #tablenumber').prop('style','float: left;');
						$('.order#order #banner #tablenumber').html('');
						$('.order#order #banner #detail').css({'margin-left':'3px'});
						$('.order#order #banner #detail #viewtotal').val(d[0]['SALESTTLAMT']);
						$('.order#order #banner #detail #viewnumber').val(d[0]['SALESTTLQTY']);
					}
				}
				$.ajax({
					url:'./lib/js/temporder.list.php',
					method:'post',
					async: false,
					data:{'machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val(),'company':$('.order#order .companydata #company').val(),'bizdate':$('.order#order #MemberBill #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #MemberBill #tabs4 #listform input[name="consecnumber"]').val(),'usercode':$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val(),'username':$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val()},
					dataType:'html',
					success:function(d){
						$('.order#order #MemberBill #list #tabs4 #listform').html(d);
						$('.setperson #view input[name="persons1"]').val($('.order#order #tabs4 #listform input[name="person1"]').val());
						$('.setperson #view input[name="persons2"]').val($('.order#order #tabs4 #listform input[name="person2"]').val());
						$('.setperson #view input[name="persons3"]').val($('.order#order #tabs4 #listform input[name="person3"]').val());
						$('.setperson #buttons #submit').trigger('click');
					},
					error:function(e){
						//console.log(e);
					}
				});
				$.ajax({
					url:'./lib/js/gettempmemdata.ajax.php',
					method:'post',
					data:{'memno':$('.order#order #tabs4 .listcontentbox #listform input[name="memno"]').val()},
					dataType:'json',
					success:function(d){
						if(d.length>0){
							$('.order#order #tabs1 #membutton div:eq(0)').html(d[0]['name']);
							$('.order#order #tabs1 #membutton div:eq(1)').html(d[0]['tel']);
							$('.memdata #name').html(d[0]['name']);
							$('.memdata #tel').html(d[0]['tel']);
							if(d[0]['address']==null){
								$('.memdata #address').html('');
							}
							else{
								$('.memdata #address').html(d[0]['address']);
							}
							if(d[0]['tel2']==null){
								$('.memdata #tel2').html('');
							}
							else{
								$('.memdata #tel2').html(d[0]['tel2']);
							}
						}
						else{
							$('.order#order #tabs1 #membutton div:eq(0)').html('會員');
							$('.order#order #tabs1 #membutton div:eq(1)').html('');
							$('.memdata #name').html('');
							$('.memdata #tel').html('');
							$('.memdata #address').html('');
							$('.memdata #tel2').html('');
						}
					},
					error:function(e){
						//console.log(e);
					}
				});
			},
			error:function(e){
				//console.log(e);
			}
		});*/
	}
	else{
		
	}
	/*按鈕取號*/
	var a; 
	var button; 
	/*function buzzer_music(m) {
	  var musicNotes = {};
	  musicNotes.notes = [];
	  musicNotes.tempos = [];
	  if (m[0].notes.length > 1) {
		for (var i = 0; i < m.length; i++) {
		  if (Array.isArray(m[i].notes)) {
			var cn = musicNotes.notes.concat(m[i].notes);
			musicNotes.notes = cn;
		  } else {
			musicNotes.notes.push(m[i].notes);
		  }
		  if (Array.isArray(m[i].tempos)) {
			var ct = musicNotes.tempos.concat(m[i].tempos);
			musicNotes.tempos = ct;
		  } else {
			musicNotes.tempos.push(m[i].tempos);
		  }
		}
	  } else {
		musicNotes.notes = [m[0].notes];
		musicNotes.tempos = [m[0].tempos];
	  }
	  return musicNotes;
	}
	boardReady({url: '192.168.88.254', transport: 'websocket'}, function (board) {
		board.systemReset(); 
		board.samplingInterval = 250;
		buzzer = getBuzzer(board, 14);
		button = getButton(board, 10); 
		button.on("pressed", function(){ 
			//console.log("pressed"); 
			buzzer.play(buzzer_music([  {notes : ["C6","D6","E6","F6","G6","A6","B6"] , tempos : ["8","8","8","8","8","8","8"] }]).notes ,buzzer_music([  {notes : ["C6","D6","E6","F6","G6","A6","B6"] , tempos : ["8","8","8","8","8","8","8"] }]).tempos );
			$.ajax({
				url:'./lib/js/print.numtag.ajax.php',
				success:function(){
					//console.log('success');
				},
				complete:function(){
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'123'},
						dataType:'html',
						success:function(d){
							//console.log(d);
						},
						error:function(e){
							//console.log(e);
						}
					});
				},
				error:function(e){
					//console.log(e);
				}
			});
		}); 
	});*/
	/**/
	if($('.order#order #tabs4 #listform input[name="usercode"]').val().length==0||$('.order#order #tabs4 #listform input[name="username"]').val().length==0){
		//location.href='./index.php';
	}
	else{
	}
	//$list=$('.order#order #MemberBill #list').tabs();
	//$list.tabs('option','disabled',[1]);
	//$billfun=$('.order#order #MemberBill #billfun').tabs();
	emptyitemsvoidlist=$('.emptyitemsvoidlist').dialog({
		autoOpen:false,
		width:450,
		height:300,
		/*title:'系統訊息',*/
		resizable:false,
		modal:true,
		draggable:false
	});
	spend=$('.spend').dialog({//系統訊息
		autoOpen:false,
		/*width:450,
		height:300,*/
		/*title:'系統訊息',*/
		resizable:false,
		modal:true,
		draggable:false
	});
	if($(window).width()==1920){
		spend.dialog('option','width',450);
		spend.dialog('option','height',380);
	}
	else if($(window).width()==1366){
		spend.dialog('option','width',450);
		spend.dialog('option','height',380);
	}
	else if($(window).width()==1280){
		spend.dialog('option','width',450);
		spend.dialog('option','height',380);
	}
	else if($(window).width()==1024){
		spend.dialog('option','width',450);
		spend.dialog('option','height',380);
	}
	if($('.order#order .initsetting #pointtree').val()=='1'){
		pointtreememdata=$('.pointtreememdata').dialog({//集點樹會員資訊
			autoOpen:false,
			/*width:450,
			height:300,*/
			/*title:'系統訊息',*/
			resizable:false,
			modal:true,
			draggable:false
		});
		if($(window).width()==1920){
			pointtreememdata.dialog('option','width',450);
			pointtreememdata.dialog('option','height',300);
		}
		else if($(window).width()==1366){
			pointtreememdata.dialog('option','width',450);
			pointtreememdata.dialog('option','height',300);
		}
		else if($(window).width()==1280){
			pointtreememdata.dialog('option','width',450);
			pointtreememdata.dialog('option','height',300);
		}
		else if($(window).width()==1024){
			pointtreememdata.dialog('option','width',450);
			pointtreememdata.dialog('option','height',300);
		}
	}
	else{
	}
	sysmeg=$('.sysmeg').dialog({//系統訊息
		autoOpen:false,
		/*width:450,
		height:300,*/
		/*title:'系統訊息',*/
		resizable:false,
		modal:true,
		draggable:false,
		close:function(){
			$('.sysmeg div[id^="name"]').css({'display':'none'});
			$('.sysmeg button div[id^="name"]').css({'display':''});
		}
	});
	if($(window).width()==1920){
		sysmeg.dialog('option','width',450);
		sysmeg.dialog('option','height',300);
	}
	else if($(window).width()==1366){
		sysmeg.dialog('option','width',(450));
		sysmeg.dialog('option','height',(220));
	}
	else if($(window).width()==1280){
		sysmeg.dialog('option','width',450);
		sysmeg.dialog('option','height',220);
	}
	else if($(window).width()==1024){
		sysmeg.dialog('option','width',450);
		sysmeg.dialog('option','height',220);
	}
	sysmeg4=$('.sysmeg4').dialog({//系統訊息
		autoOpen:false,
		/*width:450,
		height:300,*/
		/*title:'系統訊息',*/
		resizable:false,
		modal:true,
		draggable:false,
		classes:{
			'ui-dialog-titlebar-close':'hidden'
		}
	});
	if($(window).width()==1920){
		sysmeg4.dialog('option','width',450);
		sysmeg4.dialog('option','height',300);
	}
	else if($(window).width()==1366){
		sysmeg4.dialog('option','width',(450));
		sysmeg4.dialog('option','height',(220));
	}
	else if($(window).width()==1280){
		sysmeg4.dialog('option','width',450);
		sysmeg4.dialog('option','height',220);
	}
	else if($(window).width()==1024){
		sysmeg4.dialog('option','width',450);
		sysmeg4.dialog('option','height',220);
	}
	sysmeg5=$('.sysmeg5').dialog({//系統訊息
		autoOpen:false,
		/*width:450,
		height:300,*/
		/*title:'系統訊息',*/
		resizable:false,
		modal:true,
		draggable:false
	});
	if($(window).width()==1920){
		sysmeg5.dialog('option','width',450);
		sysmeg5.dialog('option','height',300);
	}
	else if($(window).width()==1366){
		sysmeg5.dialog('option','width',(450));
		sysmeg5.dialog('option','height',(220));
	}
	else if($(window).width()==1280){
		sysmeg5.dialog('option','width',450);
		sysmeg5.dialog('option','height',220);
	}
	else if($(window).width()==1024){
		sysmeg5.dialog('option','width',450);
		sysmeg5.dialog('option','height',220);
	}
	exitsys=$('.exitsys').dialog({//系統訊息
		autoOpen:false,
		/*width:450,
		height:300,*/
		/*title:'系統訊息',*/
		resizable:false,
		modal:true,
		draggable:false
	});
	if($(window).width()==1920){
		exitsys.dialog('option','width',450);
		exitsys.dialog('option','height',300);
	}
	else if($(window).width()==1366){
		exitsys.dialog('option','width',450);
		exitsys.dialog('option','height',220);
	}
	else if($(window).width()==1280){
		exitsys.dialog('option','width',450);
		exitsys.dialog('option','height',220);
	}
	else if($(window).width()==1024){
		exitsys.dialog('option','width',450);
		exitsys.dialog('option','height',220);
	}
	setperson=$('.setperson').dialog({//人數設定
		autoOpen:false,
		/*width:1044,
		height:966,*/
		/*title:'人數設定',*/
		position:{my:'right bottom',at:'right bottom',of:'body'},
		resizable:false,
		modal:true,
		draggable:false
	});
	if($(window).width()==1920){
		setperson.dialog('option','width',1044);
		setperson.dialog('option','height',966);
	}
	else if($(window).width()==1366){
		setperson.dialog('option','width',(1366*0.63-6.4-72.3));
		setperson.dialog('option','height',(768*0.9-16));
	}
	else if($(window).width()==1280){
		setperson.dialog('option','width',(1280*0.63-72.3));
		setperson.dialog('option','height',(800*0.9-16));
	}
	else if($(window).width()==1024){
		setperson.dialog('option','width',1024);
		setperson.dialog('option','height',(768*0.9-16));
	}
	/*taste1=$('.order#order .taste1').dialog({//備註
		autoOpen:false,
		width:1044,
		height:966,
		title:'商品備註',
		position:{my:'right bottom',at:'right bottom',of:'body'},
		resizable:false,
		modal:true,
		draggable:false
	});*/
	taste2=$('.taste2').dialog({//備註與加料
		autoOpen:false,
		/*width:1044,
		height:966,*/
		/*title:'商品備註與加料',*/
		position:{my:'right bottom',at:'right bottom',of:'body'},
		resizable:false,
		modal:true,
		draggable:false
	});
	if($(window).width()==1920){
		taste2.dialog('option','width',1044);
		taste2.dialog('option','height',966);
	}
	else if($(window).width()==1366){
		taste2.dialog('option','width',(1366*0.63-6.4-72.3));
		taste2.dialog('option','height',(768*0.9-16));
	}
	else if($(window).width()==1280){
		taste2.dialog('option','width',(1280*0.63-72.3));
		taste2.dialog('option','height',(800*0.9-16));
	}
	else if($(window).width()==1024){
		taste2.dialog('option','width',1024);
		taste2.dialog('option','height',(768*0.9-16));
	}
	result=$('.result').dialog({//結帳畫面
		autoOpen:false,
		/*width:1044,
		height:966,*/
		/*title:'結帳',*/
		position:{my:'right bottom',at:'right bottom',of:'body'},
		resizable:false,
		modal:true,
		draggable:false,
		open:function(){
			$('.result .sendviewwindow input[name="creditcard"]').val('');
		}
	});
	if($(window).width()==1920){
		//result.dialog('option','width',1044);
		result.dialog('option','width',1920);
		result.dialog('option','height',1080);
	}
	else if($(window).width()==1366){
		//result.dialog('option','width',(1366*0.63-6.4-72.3));
		result.dialog('option','width',1366);
		result.dialog('option','height',768);
	}
	else if($(window).width()==1280){
		//result.dialog('option','width',(1280*0.63-72.3));
		result.dialog('option','width',1280);
		result.dialog('option','height',800);
	}
	else if($(window).width()==1024){
		//result.dialog('option','width',1024);
		result.dialog('option','width',1024);
		result.dialog('option','height',768);
	}
	itemdis=$('.itemdis').dialog({//單品促銷畫面
		autoOpen:false,
		/*width:1044,
		height:966,*/
		/*title:'單品促銷',*/
		position:{my:'right bottom',at:'right bottom',of:'body'},
		resizable:false,
		modal:true,
		draggable:false
	});
	if($(window).width()==1920){
		itemdis.dialog('option','width',1044);
		itemdis.dialog('option','height',966);
	}
	else if($(window).width()==1366){
		itemdis.dialog('option','width',1024);
		itemdis.dialog('option','height',(768*0.9-16));
	}
	else if($(window).width()==1280){
		itemdis.dialog('option','width',1024);
		itemdis.dialog('option','height',(800*0.9-16));
	}
	else if($(window).width()==1024){
		itemdis.dialog('option','width',1024);
		itemdis.dialog('option','height',(768*0.9-16));
	}
	change=$('.changehint').dialog({//找零提示視窗
		autoOpen:false,
		/*width:450,
		height:300,*/
		/*title:'系統訊息',*/
		resizable:false,
		modal:true,
		draggable:false,
		open:function(){
			logouttime=$('.order#order .initsetting #changeclose').val();
			$('.changehint #timehint #time').html($('.order#order .initsetting #changeclose').val());
			tim1=setInterval(function(){timer1()},1000);//啟動倒數
		},
		close:function(){
			if($('.order#order .initsetting #secview').val()=='1'){
				$.ajax({
					url:'../secview/cleartemp.ajax.php',
					async: false,
					dataType:'html',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'changehint cleartemp.ajax.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						//console.log(d);
					},
					error:function(e){
						//console.log(e);
					}
				});
			}
			else{
			}
			if($('.order#order .initsetting #controltable').val()=='1'){
				/*if($('.order#order .companydata #submachine').length>0){
					location.href='./control.php?submachine&usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
				}
				else{
					if($('.order#order #tabs4 #listform input[name="machinetype"]').val()=='m1'){
						location.href='./control.php?usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
					}
					else{
						location.href='./control.php?machine='+$('.order#order #tabs4 #listform input[name="machinetype"]').val()+'&usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
					}
				}*/
				//result.dialog('close');
				inittable.dialog('open');
				ClearWindow('','');
				
			}
			else{
				if($('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val().length>0){
					//location.href='./order.php?usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
					clearInterval(tim1);
					ClearWindow('','');
				}
				else{
					//location.href='./order.php';
					clearInterval(tim1);
					ClearWindow('','');
				}
			}
		}
	});
	if($(window).width()==1920){
		change.dialog('option','width',450);
		change.dialog('option','height',400);
	}
	else if($(window).width()==1366){
		change.dialog('option','width',450);
		change.dialog('option','height',400);
	}
	else if($(window).width()==1280){
		change.dialog('option','width',450);
		change.dialog('option','height',400);
	}
	else if($(window).width()==1024){
		change.dialog('option','width',450);
		change.dialog('option','height',400);
	}
	setchange=$('.setchange').dialog({//設定找零金
		autoOpen:false,
		/*width:1044,
		height:966,*/
		/*title:'設定找零金',*/
		position:{my:'right bottom',at:'right bottom',of:'body'},
		resizable:false,
		modal:true,
		draggable:false,
		close:function(){
			$.ajax({
				url:'./lib/js/setchange.php',
				method:'post',
				data:{'change':$('.setchange input[name="view"]').val(),'usercode':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'username':$('.order#order #tabs4 #listform input[name="username"]').val(),'machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val()},
				dataType:'html',
				success:function(){
				}
			});
			$('.order#order #MemberBill #billfun #billfun1button').prop('disabled',false);
			$('.order#order #MemberBill #billfun #billfun1button').trigger('click');
			//$billfun.tabs('enable',0);
			//$billfun.tabs('option','active',[0]);
		}
	});
	if($(window).width()==1920){
		setchange.dialog('option','width',1044);
		setchange.dialog('option','height',966);
	}
	else if($(window).width()==1366){
		setchange.dialog('option','width',(1366*0.63-6.4-72.3));
		setchange.dialog('option','height',(768*0.9-16));
	}
	else if($(window).width()==1280){
		setchange.dialog('option','width',(1280*0.63-72.3));
		setchange.dialog('option','height',(800*0.9-16));
	}
	else if($(window).width()==1024){
		setchange.dialog('option','width',1024);
		setchange.dialog('option','height',(768*0.9-16));
	}
	oinv=$('.oinv').dialog({//設定發票
		autoOpen:false,
		/*width:1044,
		height:966,*/
		/*title:'設定發票',*/
		position:{my:'right bottom',at:'right bottom',of:'body'},
		resizable:false,
		modal:true,
		draggable:false
	});
	if($(window).width()==1920){
		oinv.dialog('option','width',1044);
		oinv.dialog('option','height',966);
	}
	else if($(window).width()==1366){
		oinv.dialog('option','width',(1366*0.63-6.4-72.3));
		oinv.dialog('option','height',(768*0.9-16));
	}
	else if($(window).width()==1280){
		oinv.dialog('option','width',(1280*0.63-72.3));
		oinv.dialog('option','height',(800*0.9-16));
	}
	else if($(window).width()==1024){
		oinv.dialog('option','width',1024);
		oinv.dialog('option','height',(768*0.9-16));
	}
	cancelinv=$('.cancelinv').dialog({//作廢發票
		autoOpen:false,
		/*width:1044,
		height:966,*/
		/*title:'設定發票',*/
		position:{my:'right bottom',at:'right bottom',of:'body'},
		resizable:false,
		modal:true,
		draggable:false
	});
	if($(window).width()==1920){
		cancelinv.dialog('option','width',1044);
		cancelinv.dialog('option','height',966);
	}
	else if($(window).width()==1366){
		cancelinv.dialog('option','width',(1366*0.63-6.4-72.3));
		cancelinv.dialog('option','height',(768*0.9-16));
	}
	else if($(window).width()==1280){
		cancelinv.dialog('option','width',(1280*0.63-72.3));
		cancelinv.dialog('option','height',(800*0.9-16));
	}
	else if($(window).width()==1024){
		cancelinv.dialog('option','width',1024);
		cancelinv.dialog('option','height',(768*0.9-16));
	}
	salelist=$('.salelist').dialog({//瀏覽帳單
		autoOpen:false,
		/*width:1044,
		height:966,*/
		/*title:'設定發票',*/
		position:{my:'right bottom',at:'right bottom',of:'body'},
		resizable:false,
		modal:true,
		draggable:false
	});
	if($(window).width()==1920){
		salelist.dialog('option','width',1044);
		salelist.dialog('option','height',966);
	}
	else if($(window).width()==1366){
		salelist.dialog('option','width',1360);
		salelist.dialog('option','height',768);
	}
	else if($(window).width()==1280){
		salelist.dialog('option','width',1280);
		salelist.dialog('option','height',800);
	}
	else if($(window).width()==1024){
		salelist.dialog('option','width',1024);
		salelist.dialog('option','height',768);
	}
	salevoid=$('.salevoid').dialog({//作廢帳單
		autoOpen:false,
		/*width:1044,
		height:966,*/
		/*title:'設定發票',*/
		position:{my:'right bottom',at:'right bottom',of:'body'},
		resizable:false,
		modal:true,
		draggable:false
	});
	if($(window).width()==1920){
		salevoid.dialog('option','width',1044);
		salevoid.dialog('option','height',966);
	}
	else if($(window).width()==1366){
		salevoid.dialog('option','width',1360);
		salevoid.dialog('option','height',768);
	}
	else if($(window).width()==1280){
		salevoid.dialog('option','width',1280);
		salevoid.dialog('option','height',800);
	}
	else if($(window).width()==1024){
		salevoid.dialog('option','width',1024);
		salevoid.dialog('option','height',768);
	}
	viewtemp=$('.viewtemp').dialog({//未結帳單
		autoOpen:false,
		/*width:1044,
		height:966,*/
		/*title:'設定發票',*/
		position:{my:'right bottom',at:'right bottom',of:'body'},
		resizable:false,
		modal:true,
		draggable:false,
		close:function(){
			$('.viewtemp #salelist #salecontent .listitems').prop('id','');
			$('.viewtemp #listno').html('');
			$('.viewtemp #list #listcontent').html('');
			$('.viewtemp #date').html('');
			$('.viewtemp #credate').html('');
			$('.viewtemp #otherfun button#plus').prop('disabled',true);
			$('.viewtemp #otherfun button#openinv').prop('disabled',true);
			$('.viewtemp #viewvoid').prop('disabled',true);
			$('.viewtemp #fun button#forall').prop('disabled',true);
			$('.viewtemp #fun button#list').prop('disabled',true);
			$('.viewtemp #fun button#tag').prop('disabled',true);
			$('.viewtemp #fun button#kitchen').prop('disabled',true);
			$('.viewtemp #fun button#changecheck').prop('disabled',true);
		}
	});
	if($(window).width()==1920){
		viewtemp.dialog('option','width',1044);
		viewtemp.dialog('option','height',966);
	}
	else if($(window).width()==1366){
		viewtemp.dialog('option','width',1360);
		viewtemp.dialog('option','height',768);
	}
	else if($(window).width()==1280){
		viewtemp.dialog('option','width',1280);
		viewtemp.dialog('option','height',800);
	}
	else if($(window).width()==1024){
		viewtemp.dialog('option','width',1024);
		viewtemp.dialog('option','height',768);
	}
	keybord=$('.keybord').dialog({//數字鍵盤
		autoOpen:false,
		width:500,
		height:700,
		/*title:'數字鍵盤',*/
		position:{my:'center center',at:'center center',of:'body'},
		resizable:false,
		modal:true,
		draggable:false,
		open:function(){
			if(typeof $('.keybord input[name="type"]')!="undefined"&&$('.keybord input[name="type"]').val()=='creditcard'){
				$('.keybord input[name="num"]').val('');
				$('.keybord input[name="num"]').prop('max','9999');
				$('.keybord #add').prop('disabled',true);
				$('.keybord #diff').prop('disabled',true);
			}
			else{
				$.ajax({
					url:'./lib/js/getnow.ajax.php',
					dataType:'html',
					success:function(d){
						//console.log(d);
						$('.keybord input[name="num"]').prop('max','999');
						$('.keybord input[name="num"]').val(d);
						$('.keybord input[name="num"]').trigger('focus');
					},
					error:function(e){
						//console.log(e);
					}
				});
			}
		},
		close:function(){
			$('.keybord #add').prop('disabled',false);
			$('.keybord #diff').prop('disabled',false);
			$('.keybord input[name="type"]').val('bord');
			$('.keybord input[name="num"]').val('');
		}
	});
	punch=$('.punch').dialog({//員工打卡
		autoOpen:false,
		width:500,
		height:700,
		/*title:'員工打卡',*/
		position:{my:'center center',at:'center center',of:'body'},
		resizable:false,
		modal:true,
		draggable:false,
		close:function(){
			$('.punch input[name="num"]').val('');
		}
	});
	kvm=$('.order#order .kvm').dialog({
		autoOpen:false,
		//width:1024,
		//height:700,
		//title:'打卡紀錄',
		position:{my:'center center',at:'center center',of:'body'},
		resizable:false,
		modal:true,
		draggable:false,
		close:function(){
			$('.kvm #salelist #salecontent').html('');
			$('.kvm #listno').html('');
			$('.kvm #date').html('');
			$('.kvm #credate').html('');
			$('.kvm #list #listcontent').html('');
			$('.kvm #delete').prop('disabled',true);
			//$('.punch input[name="num"]').val('');
		}
	});
	if($(window).width()==1920){
		kvm.dialog('option','width',1920);
		kvm.dialog('option','height',966);
	}
	else if($(window).width()==1366){
		kvm.dialog('option','width',1366);
		kvm.dialog('option','height',(768*0.9-16));
	}
	else if($(window).width()==1280){
		kvm.dialog('option','width',1280);
		kvm.dialog('option','height',(800*0.9-16));
	}
	else if($(window).width()==1024){
		kvm.dialog('option','width',1024);
		kvm.dialog('option','height',(768*0.9-16));
	}
	editpunch=$('.order#order .editpunch').dialog({
		autoOpen:false,
		width:1024,
		height:700,
		/*title:'打卡紀錄',*/
		position:{my:'center center',at:'center center',of:'body'},
		resizable:false,
		modal:true,
		draggable:false,
		close:function(){
			var d=new Date();
			$(".editpunch #startpunch").datepicker('setDate',d.getFullYear()+"-"+('0'+(Number(d.getMonth())+1)).substr(-2)+"-"+d.getDate());
			$(".editpunch #endpunch").datepicker('setDate',d.getFullYear()+"-"+('0'+(Number(d.getMonth())+1)).substr(-2)+"-"+d.getDate());
			$('.editpunch #searchresult').html('');
			$('.editpunch #editperson').val('');
			$('.editpunch #editperno').val('');
			$('.editpunch #initeditDATE').val('');
			$('.editpunch #initeditTIME').val('');
			$('.editpunch #initeditH').val('');
			$('.editpunch #initeditI').val('');

			$(".editpunch #editDATE").datepicker('setDate','');
			$('.editpunch #editDATE').prop('disabled',true);
			$('.editpunch #editH option').prop('selected',false);
			$('.editpunch #editH option:eq(0)').prop('selected',true);
			$('.editpunch #editH').prop('disabled',true);
			$('.editpunch #editI option').prop('selected',false);
			$('.editpunch #editI option:eq(0)').prop('selected',true);
			$('.editpunch #editI').prop('disabled',true);
			
			$('.editpunch #cancel').prop('disabled',true);
			$('.editpunch #save').prop('disabled',true);
			$('.editpunch #printpunch').prop('disabled',true);
		}
	});
	memdeposit=$('.order#order .memdeposit').dialog({
		autoOpen:false,
		width:550,
		height:450,
		/*title:'儲值',*/
		position:{my:'center center',at:'center center',of:'body'},
		resizable:false,
		modal:true,
		draggable:false
	});
	paywindow=$('.paywindow').dialog({//其他付款方式
		autoOpen:false,
		width:500,
		height:700,
		/*title:'其他付款方式',*/
		position:{my:'center center',at:'center center',of:'body'},
		resizable:false,
		modal:true,
		draggable:false
	});
	tabinput=$('.tabinput').dialog({//內用桌號
		autoOpen:false,
		/*width:1044,
		height:966,*/
		/*title:'設定發票',*/
		position:{my:'right bottom',at:'right bottom',of:'body'},
		resizable:false,
		modal:true,
		draggable:false
	});
	if($(window).width()==1920){
		tabinput.dialog('option','width',1044);
		tabinput.dialog('option','height',966);
	}
	else if($(window).width()==1366){
		tabinput.dialog('option','width',(1366*0.63-6.4-72.3));
		tabinput.dialog('option','height',(768*0.9-16));
	}
	else if($(window).width()==1280){
		tabinput.dialog('option','width',(1280*0.63-72.3));
		tabinput.dialog('option','height',(800*0.9-16));
	}
	else if($(window).width()==1024){
		tabinput.dialog('option','width',1024);
		tabinput.dialog('option','height',(768*0.9-16));
	}
	openmoney=$('.openmoney').dialog({//開放金額初始價格
		autoOpen:false,
		/*width:1044,
		height:966,*/
		/*title:'開放金額初始價格',*/
		position:{my:'right bottom',at:'right bottom',of:'body'},
		resizable:false,
		modal:true,
		draggable:false
	});
	if($(window).width()==1920){
		openmoney.dialog('option','width',1044);
		openmoney.dialog('option','height',966);
	}
	else if($(window).width()==1366){
		openmoney.dialog('option','width',(1366*0.63-6.4-72.3));
		openmoney.dialog('option','height',(768*0.9-16));
	}
	else if($(window).width()==1280){
		openmoney.dialog('option','width',(1280*0.63-72.3));
		openmoney.dialog('option','height',(800*0.9-16));
	}
	else if($(window).width()==1024){
		openmoney.dialog('option','width',1024);
		openmoney.dialog('option','height',(768*0.9-16));
	}
	meminput=$('.meminput').dialog({//會員輸入視窗
		autoOpen:false,
		/*width:1044,
		height:966,*/
		/*title:'會員輸入視窗',*/
		position:{my:'right bottom',at:'right bottom',of:'body'},
		resizable:false,
		modal:true,
		draggable:false
	});
	if($(window).width()==1920){
		meminput.dialog('option','width',1044);
		meminput.dialog('option','height',966);
	}
	else if($(window).width()==1366){
		meminput.dialog('option','width',(1366*0.7));
		meminput.dialog('option','height',(768*0.9-16));
	}
	else if($(window).width()==1280){
		meminput.dialog('option','width',(1280*0.7));
		meminput.dialog('option','height',(800*0.9-16));
	}
	else if($(window).width()==1024){
		meminput.dialog('option','width',1024);
		meminput.dialog('option','height',(768*0.9-16));
	}
	cremem=$('.cremem').dialog({
		autoOpen:false,
		width:550,
		height:450,
		/*title:'系統訊息',*/
		resizable:false,
		modal:true,
		draggable:false
	});
	memdata=$('.memdata').dialog({//瀏覽會員資料
		autoOpen:false,
		width:550,
		height:600,
		/*title:'系統訊息',*/
		resizable:false,
		modal:true,
		draggable:false
	});
	outmoney=$('#outmoney').dialog({
		autoOpen:false,
		width:600,
		height:$(window).height(),
		/*title:'支出費用',*/
		resizable:false,
		modal:true,
		draggable:false,
		open:function(){
			getzcounter('#outmoney','#picbizdate');
		},
		close:function(){
			$("#outmoney #picbizdate").datepicker('setDate',$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(0,4)+"-"+$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(4,2)+"-"+$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(6,2));
			$('#outmoney select[name="zcounter"]').html('');
			$('#outmoney #moneytype').val('');
			$('#outmoney input[name="moneytype"]').val('');
			$('#outmoney input[name="moneysubtype"]').val('');
			$('#outmoney input[name="money"]').val('0');
			$('#outmoney textarea[name="remarks"]').val('');
		}
	});
	selecttype=$('.selecttype').dialog({
		autoOpen:false,
		width:$(window).width()*0.9,
		height:178,
		/*title:'選擇類別',*/
		resizable:false,
		modal:true,
		draggable:false
	});
	setmoney=$('.setmoney').dialog({
		autoOpen:false,
		width:600,
		height:$(window).height()*7/10,
		/*title:'金額',*/
		position:{my:'bottom',at:'bottom',of:'body'},
		resizable:false,
		modal:true,
		draggable:false
	});
	editpay=$('.editpay').dialog({//修改付款
		autoOpen:false,
		width:800,
		height:610,
		/*title:'修改付款',*/
		position:{my:'center center',at:'center center',of:'body'},
		resizable:false,
		modal:true,
		draggable:false,
		close:function(){
			$('.editpay input[name="num"]').val('');
		}
	});
	temptoinv=$('.temptoinv').dialog({//暫結視窗(開立發票選擇)
		autoOpen:false,
		width:450,
		height:220,
		/*title:'暫結視窗(開立發票選擇)',*/
		resizable:false,
		modal:true,
		draggable:false
	});
	historypaper=$('.historypaper').dialog({
		autoOpen:false,
		width:600,
		height:300,
		/*title:'列印報表',*/
		resizable:false,
		modal:true,
		draggable:false,
		open:function(){
			if($('.historypaper #papbizdateS').val()==$('.historypaper #papbizdateE').val()){
				getzcounter('.historypaper','#papbizdateS');
				$('.historypaper select[name="zcounter"]').prop('disabled',false);
			}
			else{
				$('.historypaper select[name="zcounter"]').prop('disabled',true);
				$('.historypaper select[name="zcounter"]').html('<option value="allday">整個營業日</option>');
			}
		},
		close:function(){
			$(".historypaper #papbizdateS").datepicker('setDate',$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(0,4)+"-"+$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(4,2)+"-"+$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(6,2));
			$(".historypaper #papbizdateE").datepicker('setDate',$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(0,4)+"-"+$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(4,2)+"-"+$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(6,2));
		}
	});
	viewpaper=$('.viewpaper').dialog({
		autoOpen:false,
		width:$(window).width()-40,
		height:$(window).height()-40,
		/*title:'列印報表',*/
		position:{my:'top left',at:'top 20px left 20px',of:'body'},
		resizable:false,
		modal:true,
		draggable:false,
		open:function(){
			if($('.historypaper #papbizdateS').val()==$('.historypaper #papbizdateE').val()){
				getzcounter('.historypaper','#papbizdateS');
				$('.historypaper select[name="zcounter"]').prop('disabled',false);
			}
			else{
				$('.historypaper select[name="zcounter"]').prop('disabled',true);
				$('.historypaper select[name="zcounter"]').html('<option value="allday">整個營業日</option>');
			}
		},
		close:function(){
			$(".historypaper #papbizdateS").datepicker('setDate',$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(0,4)+"-"+$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(4,2)+"-"+$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(6,2));
			$(".historypaper #papbizdateE").datepicker('setDate',$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(0,4)+"-"+$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(4,2)+"-"+$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(6,2));
		}
	});
	/*$('.order#order .inittable #outmoney').click(function(){
		outmoney.dialog('open');
		if($('#outmoney #moneytype').val()==''){
			selecttype.dialog('open');
		}
		else{
		}
	});*/
	$("#outmoney #picbizdate").datepicker();
	$("#outmoney #picbizdate").datepicker('setDate',$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(0,4)+"-"+$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(4,2)+"-"+$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(6,2));
	$("#outmoney #picbizdate").datepicker( "option", "dateFormat", "yy-mm-dd" );
	$('#outmoney #picbizdate').change(function(){
		getzcounter('#outmoney','#picbizdate');
	});
	$(".historypaper #papbizdateS").datepicker();
	$(".historypaper #papbizdateS").datepicker('setDate',$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(0,4)+"-"+$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(4,2)+"-"+$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(6,2));
	$(".historypaper #papbizdateS").datepicker( "option", "dateFormat", "yy-mm-dd" );
	$(".historypaper #papbizdateE").datepicker();
	$(".historypaper #papbizdateE").datepicker('setDate',$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(0,4)+"-"+$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(4,2)+"-"+$('.order#order #tabs4 #listform input[name="bizdate"]').val().substr(6,2));
	$(".historypaper #papbizdateE").datepicker( "option", "dateFormat", "yy-mm-dd" );
	$('.historypaper #papbizdateS').change(function(){
		if($('.historypaper #papbizdateS').val()==$('.historypaper #papbizdateE').val()){
			getzcounter('.historypaper','#papbizdateS');
			$('.historypaper select[name="zcounter"]').prop('disabled',false);
		}
		else{
			$('.historypaper select[name="zcounter"]').prop('disabled',true);
			$('.historypaper select[name="zcounter"]').html('<option value="allday">'+$('.historypaper select[name="zcounter"] option:eq(0)').html()+'</option>');
		}
	});
	$('.historypaper #papbizdateE').change(function(){
		if($('.historypaper #papbizdateS').val()==$('.historypaper #papbizdateE').val()){
			getzcounter('.historypaper','#papbizdateE');
			$('.historypaper select[name="zcounter"]').prop('disabled',false);
		}
		else{
			$('.historypaper select[name="zcounter"]').prop('disabled',true);
			$('.historypaper select[name="zcounter"]').html('<option value="allday">'+$('.historypaper select[name="zcounter"] option:eq(0)').html()+'</option>');
		}
	});
	var d=new Date();
	$(".editpunch #startpunch").datepicker();
	$(".editpunch #startpunch").datepicker('setDate',d.getFullYear()+"-"+('0'+(Number(d.getMonth())+1)).substr(-2)+"-"+d.getDate());
	$(".editpunch #startpunch").datepicker( "option", "dateFormat", "yy-mm-dd" );
	$(".editpunch #endpunch").datepicker();
	$(".editpunch #endpunch").datepicker('setDate',d.getFullYear()+"-"+('0'+(Number(d.getMonth())+1)).substr(-2)+"-"+d.getDate());
	$(".editpunch #endpunch").datepicker( "option", "dateFormat", "yy-mm-dd" );
	$(".editpunch #editDATE").datepicker();
	function getzcounter(type,input){
		$.ajax({
			url:'./getzcounter.ajax.php',
			method:'post',
			async:false,
			data:{'bizdate':$(type+' '+input).val(),'type':type},
			dataType:'html',
			success:function(d){
				//console.log(d);
				$(type+' select[name="zcounter"]').html(d);
			},
			error:function(e){
				//console.log(e);
			}
		});
	}
	$('#outmoney').on('click','#moneytype',function(){
		selecttype.dialog('open');
	});
	$('.selecttype').on('click','#buttype',function(){
		var index=$('.selecttype #buttype').index(this);
		$('#outmoney #moneytype').val($(this).find('div').html());
		$('#outmoney input[name="moneytype"]').val($(this).find('#typevalue').val());
		selecttype.dialog('close');
		if(Number($('#outmoney input[name="money"]').val())<=0){
			setmoney.dialog('open');
		}
		else{
		}
	});
	$('#outmoney').on('click','input[name="money"]',function(){
		if(Number($('#outmoney input[name="money"]').val())<=0){
			$('.setmoney input[name="viewnumber"]').val('0');
		}
		else{
			$('.setmoney input[name="viewnumber"]').val($('#outmoney input[name="money"]').val());
		}
		setmoney.dialog('open');
	});
	$('.setmoney').on('click','#numbut',function(){
		if(Number($('.setmoney input[name="viewnumber"]').val())<=0){
			$('.setmoney input[name="viewnumber"]').val($(this).find('div').html());
		}
		else{
			$('.setmoney input[name="viewnumber"]').val($('.setmoney input[name="viewnumber"]').val()+$(this).find('div').html());
		}
	});
	$('.setmoney').on('click','#reset',function(){
		$('.setmoney input[name="viewnumber"]').val('0');
	});
	$('.setmoney').on('click','#send',function(){
		$('#outmoney input[name="money"]').val($('.setmoney input[name="viewnumber"]').val());
		$('.setmoney input[name="viewnumber"]').val('');
		setmoney.dialog('close');
	});
	$('#outmoney').on('click','#send',function(){
		if($('#outmoney #picbizdate').val()==''||$('#outmoney select[name="zcounter"] option:selected').length==0||$('#outmoney input[name="moneytype"]').val()==''){
			alert('請填寫營業日期、班別與選擇一樣科目。');
		}
		else{
			$.ajax({
				url:'./write.AE.php',
				method:'post',
				data:{'machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val(),'usercode':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'username':$('.order#order #tabs4 #listform input[name="username"]').val(),'type':$('#outmoney input[name="aetype"]:checked').val(),'bizdate':$('#outmoney #picbizdate').val(),'zcounter':$('#outmoney select[name="zcounter"] option:selected').val(),'moneytype':$('#outmoney input[name="moneytype"]').val(),'moneytypename':$('#outmoney #moneytype').val(),'subtype':$('#outmoney input[name="moneysubtype"]').val(),'money':$('#outmoney input[name="money"]').val(),'radius':$('#outmoney input[name="radius"]:checked').val(),'remarks':$('#outmoney textarea[name="remarks"]').val()},
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'write.AE.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					$.ajax({
						url:'./lib/js/create.cmdtxt.php',
						method:'post',
						async: false,
						data:{'cmd':'report'},
						dataType:'html',
						success:function(d){
							//console.log(d);
						},
						error:function(e){
							//console.log(e);
						}
					});
					//console.log(d);
					alert('其他收/支費用輸入成功');
					outmoney.dialog('close');
				},
				error:function(e){
					//console.log(e);
				}
			});
		}
	});
	$('#outmoney').on('click','#cancel',function(){
		$('#outmoney #moneytype').val('');
		$('#outmoney input[name="moneytype"]').val('');
		$('#outmoney input[name="moneysubtype"]').val('');
		$('#outmoney input[name="money"]').val('0');
		$('#outmoney textarea[name="remarks"]').val('');
		outmoney.dialog('close');
	});
	reason=$('.order#order #reason').dialog({//刪除已出單產品之原因
		autoOpen:false,
		width:980,
		height:500,
		/*title:'刪除原因',*/
		resizable:false,
		modal:true,
		draggable:false
	});
	reasoninput=$('.order#order #reasoninput').dialog({//刪除已出單產品之原因(手key)
		autoOpen:false,
		width:980,
		height:200,
		/*title:'刪除原因',*/
		resizable:false,
		modal:true,
		draggable:false
	});
	verpsw=$('.verpsw').dialog({//補印發票之驗證密碼視窗
		autoOpen:false,
		width:500,
		height:500,
		/*title:'驗證密碼',*/
		resizable:false,
		modal:true,
		draggable:false,
		close:function(){
			$('.verpsw input[name="type"]').val('');
			$('.verpsw input[name="verpsw"]').val('');
			$('.verpsw #buttons .input:eq(0)').val('7');
			$('.verpsw #buttons .input:eq(1)').val('8');
			$('.verpsw #buttons .input:eq(2)').val('9');
			$('.verpsw #buttons .input:eq(3)').val('4');
			$('.verpsw #buttons .input:eq(4)').val('5');
			$('.verpsw #buttons .input:eq(5)').val('6');
			$('.verpsw #buttons .input:eq(6)').val('1');
			$('.verpsw #buttons .input:eq(7)').val('2');
			$('.verpsw #buttons .input:eq(8)').val('3');
			$('.verpsw #buttons .input:eq(9)').val('0');
			$('.verpsw #buttons .input:eq(10)').val('');
			$('.verpsw #buttons .input:eq(11)').val('');
			$('.verpsw #buttons .input:eq(0)').prop('disabled',false);
			$('.verpsw #buttons .input:eq(1)').prop('disabled',false);
			$('.verpsw #buttons .input:eq(2)').prop('disabled',false);
			$('.verpsw #buttons .input:eq(3)').prop('disabled',false);
			$('.verpsw #buttons .input:eq(4)').prop('disabled',false);
			$('.verpsw #buttons .input:eq(5)').prop('disabled',false);
			$('.verpsw #buttons .input:eq(6)').prop('disabled',false);
			$('.verpsw #buttons .input:eq(7)').prop('disabled',false);
			$('.verpsw #buttons .input:eq(8)').prop('disabled',false);
			$('.verpsw #buttons .input:eq(9)').prop('disabled',false);
			$('.verpsw #buttons .input:eq(10)').prop('disabled',true);
			$('.verpsw #buttons .input:eq(11)').prop('disabled',true);
			$('.verpsw #buttons .pre').prop('disabled',true);
			$('.verpsw #buttons .next').prop('disabled',true);
		}
	});
	container=$('.container').dialog({//手機條碼輸入視窗
		autoOpen:false,
		width:500,
		height:200,
		/*title:'輸入載具',*/
		resizable:false,
		modal:true,
		draggable:false
	});
	container2=$('.container2').dialog({//自然人憑證輸入視窗
		autoOpen:false,
		width:500,
		height:200,
		/*title:'輸入載具',*/
		resizable:false,
		modal:true,
		draggable:false
	});
	donatewin=$('.donatewin').dialog({//愛心碼輸入視窗
		autoOpen:false,
		width:500,
		height:200,
		/*title:'輸入載具',*/
		resizable:false,
		modal:true,
		draggable:false
	});
	$(document).resize(function(){
		if($(window).width()==1920){
			spend.dialog('option','width',450);
			spend.dialog('option','height',380);
		}
		else if($(window).width()==1366){
			spend.dialog('option','width',450);
			spend.dialog('option','height',380);
		}
		else if($(window).width()==1280){
			spend.dialog('option','width',450);
			spend.dialog('option','height',380);
		}
		else if($(window).width()==1024){
			spend.dialog('option','width',450);
			spend.dialog('option','height',380);
		}

		if($(window).width()==1920){
			pointtreememdata.dialog('option','width',450);
			pointtreememdata.dialog('option','height',300);
		}
		else if($(window).width()==1366){
			pointtreememdata.dialog('option','width',450);
			pointtreememdata.dialog('option','height',300);
		}
		else if($(window).width()==1280){
			pointtreememdata.dialog('option','width',450);
			pointtreememdata.dialog('option','height',300);
		}
		else if($(window).width()==1024){
			pointtreememdata.dialog('option','width',450);
			pointtreememdata.dialog('option','height',300);
		}

		if($(window).width()==1920){
			sysmeg.dialog('option','width',450);
			sysmeg.dialog('option','height',300);
		}
		else if($(window).width()==1366){
			sysmeg.dialog('option','width',(450));
			sysmeg.dialog('option','height',(220));
		}
		else if($(window).width()==1280){
			sysmeg.dialog('option','width',450);
			sysmeg.dialog('option','height',220);
		}
		else if($(window).width()==1024){
			sysmeg.dialog('option','width',450);
			sysmeg.dialog('option','height',220);
		}

		if($(window).width()==1920){
			sysmeg4.dialog('option','width',450);
			sysmeg4.dialog('option','height',300);
		}
		else if($(window).width()==1366){
			sysmeg4.dialog('option','width',(450));
			sysmeg4.dialog('option','height',(220));
		}
		else if($(window).width()==1280){
			sysmeg4.dialog('option','width',450);
			sysmeg4.dialog('option','height',220);
		}
		else if($(window).width()==1024){
			sysmeg4.dialog('option','width',450);
			sysmeg4.dialog('option','height',220);
		}

		if($(window).width()==1920){
			sysmeg5.dialog('option','width',450);
			sysmeg5.dialog('option','height',300);
		}
		else if($(window).width()==1366){
			sysmeg5.dialog('option','width',(450));
			sysmeg5.dialog('option','height',(220));
		}
		else if($(window).width()==1280){
			sysmeg5.dialog('option','width',450);
			sysmeg5.dialog('option','height',220);
		}
		else if($(window).width()==1024){
			sysmeg5.dialog('option','width',450);
			sysmeg5.dialog('option','height',220);
		}

		if($(window).width()==1920){
			exitsys.dialog('option','width',450);
			exitsys.dialog('option','height',300);
		}
		else if($(window).width()==1366){
			exitsys.dialog('option','width',450);
			exitsys.dialog('option','height',220);
		}
		else if($(window).width()==1280){
			exitsys.dialog('option','width',450);
			exitsys.dialog('option','height',220);
		}
		else if($(window).width()==1024){
			exitsys.dialog('option','width',450);
			exitsys.dialog('option','height',220);
		}

		if($(window).width()==1920){
			setperson.dialog('option','width',1044);
			setperson.dialog('option','height',966);
		}
		else if($(window).width()==1366){
			setperson.dialog('option','width',(1366*0.63-6.4-72.3));
			setperson.dialog('option','height',(768*0.9-16));
		}
		else if($(window).width()==1280){
			setperson.dialog('option','width',(1280*0.63-72.3));
			setperson.dialog('option','height',(800*0.9-16));
		}
		else if($(window).width()==1024){
			setperson.dialog('option','width',1024);
			setperson.dialog('option','height',(768*0.9-16));
		}

		if($(window).width()==1920){
			taste2.dialog('option','width',1044);
			taste2.dialog('option','height',966);
		}
		else if($(window).width()==1366){
			taste2.dialog('option','width',(1366*0.63-6.4-72.3));
			taste2.dialog('option','height',(768*0.9-16));
		}
		else if($(window).width()==1280){
			taste2.dialog('option','width',(1280*0.63-72.3));
			taste2.dialog('option','height',(800*0.9-16));
		}
		else if($(window).width()==1024){
			taste2.dialog('option','width',1024);
			taste2.dialog('option','height',(768*0.9-16));
		}

		if($(window).width()==1920){
			result.dialog('option','width',1920);
			result.dialog('option','height',1080);
		}
		else if($(window).width()==1366){
			result.dialog('option','width',1366);
			result.dialog('option','height',768);
		}
		else if($(window).width()==1280){
			result.dialog('option','width',1280);
			result.dialog('option','height',800);
		}
		else if($(window).width()==1024){
			result.dialog('option','width',1024);
			result.dialog('option','height',768);
		}

		if($(window).width()==1920){
			itemdis.dialog('option','width',1044);
			itemdis.dialog('option','height',966);
		}
		else if($(window).width()==1366){
			itemdis.dialog('option','width',1024);
			itemdis.dialog('option','height',(768*0.9-16));
		}
		else if($(window).width()==1280){
			itemdis.dialog('option','width',1024);
			itemdis.dialog('option','height',(800*0.9-16));
		}
		else if($(window).width()==1024){
			itemdis.dialog('option','width',1024);
			itemdis.dialog('option','height',(768*0.9-16));
		}

		if($(window).width()==1920){
			change.dialog('option','width',450);
			change.dialog('option','height',400);
		}
		else if($(window).width()==1366){
			change.dialog('option','width',450);
			change.dialog('option','height',400);
		}
		else if($(window).width()==1280){
			change.dialog('option','width',450);
			change.dialog('option','height',400);
		}
		else if($(window).width()==1024){
			change.dialog('option','width',450);
			change.dialog('option','height',400);
		}

		if($(window).width()==1920){
			setchange.dialog('option','width',1044);
			setchange.dialog('option','height',966);
		}
		else if($(window).width()==1366){
			setchange.dialog('option','width',(1366*0.63-6.4-72.3));
			setchange.dialog('option','height',(768*0.9-16));
		}
		else if($(window).width()==1280){
			setchange.dialog('option','width',(1280*0.63-72.3));
			setchange.dialog('option','height',(800*0.9-16));
		}
		else if($(window).width()==1024){
			setchange.dialog('option','width',1024);
			setchange.dialog('option','height',(768*0.9-16));
		}

		if($(window).width()==1920){
			oinv.dialog('option','width',1044);
			oinv.dialog('option','height',966);
		}
		else if($(window).width()==1366){
			oinv.dialog('option','width',(1366*0.63-6.4-72.3));
			oinv.dialog('option','height',(768*0.9-16));
		}
		else if($(window).width()==1280){
			oinv.dialog('option','width',(1280*0.63-72.3));
			oinv.dialog('option','height',(800*0.9-16));
		}
		else if($(window).width()==1024){
			oinv.dialog('option','width',1024);
			oinv.dialog('option','height',(768*0.9-16));
		}

		if($(window).width()==1920){
			cancelinv.dialog('option','width',1044);
			cancelinv.dialog('option','height',966);
		}
		else if($(window).width()==1366){
			cancelinv.dialog('option','width',(1366*0.63-6.4-72.3));
			cancelinv.dialog('option','height',(768*0.9-16));
		}
		else if($(window).width()==1280){
			cancelinv.dialog('option','width',(1280*0.63-72.3));
			cancelinv.dialog('option','height',(800*0.9-16));
		}
		else if($(window).width()==1024){
			cancelinv.dialog('option','width',1024);
			cancelinv.dialog('option','height',(768*0.9-16));
		}

		if($(window).width()==1920){
			salelist.dialog('option','width',1044);
			salelist.dialog('option','height',966);
		}
		else if($(window).width()==1366){
			salelist.dialog('option','width',1360);
			salelist.dialog('option','height',768);
		}
		else if($(window).width()==1280){
			salelist.dialog('option','width',1280);
			salelist.dialog('option','height',800);
		}
		else if($(window).width()==1024){
			salelist.dialog('option','width',1024);
			salelist.dialog('option','height',768);
		}

		if($(window).width()==1920){
			salevoid.dialog('option','width',1044);
			salevoid.dialog('option','height',966);
		}
		else if($(window).width()==1366){
			salevoid.dialog('option','width',1360);
			salevoid.dialog('option','height',768);
		}
		else if($(window).width()==1280){
			salevoid.dialog('option','width',1280);
			salevoid.dialog('option','height',800);
		}
		else if($(window).width()==1024){
			salevoid.dialog('option','width',1024);
			salevoid.dialog('option','height',768);
		}

		if($(window).width()==1920){
			viewtemp.dialog('option','width',1044);
			viewtemp.dialog('option','height',966);
		}
		else if($(window).width()==1366){
			viewtemp.dialog('option','width',1360);
			viewtemp.dialog('option','height',768);
		}
		else if($(window).width()==1280){
			viewtemp.dialog('option','width',1280);
			viewtemp.dialog('option','height',800);
		}
		else if($(window).width()==1024){
			viewtemp.dialog('option','width',1024);
			viewtemp.dialog('option','height',768);
		}
		
		if($(window).width()==1920){
			tabinput.dialog('option','width',1044);
			tabinput.dialog('option','height',966);
		}
		else if($(window).width()==1366){
			tabinput.dialog('option','width',(1366*0.63-6.4-72.3));
			tabinput.dialog('option','height',(768*0.9-16));
		}
		else if($(window).width()==1280){
			tabinput.dialog('option','width',(1280*0.63-72.3));
			tabinput.dialog('option','height',(800*0.9-16));
		}
		else if($(window).width()==1024){
			tabinput.dialog('option','width',1024);
			tabinput.dialog('option','height',(768*0.9-16));
		}
		
		if($(window).width()==1920){
			openmoney.dialog('option','width',1044);
			openmoney.dialog('option','height',966);
		}
		else if($(window).width()==1366){
			openmoney.dialog('option','width',(1366*0.63-6.4-72.3));
			openmoney.dialog('option','height',(768*0.9-16));
		}
		else if($(window).width()==1280){
			openmoney.dialog('option','width',(1280*0.63-72.3));
			openmoney.dialog('option','height',(800*0.9-16));
		}
		else if($(window).width()==1024){
			openmoney.dialog('option','width',1024);
			openmoney.dialog('option','height',(768*0.9-16));
		}

		if($(window).width()==1920){
			meminput.dialog('option','width',1044);
			meminput.dialog('option','height',966);
		}
		else if($(window).width()==1366){
			meminput.dialog('option','width',(1366*0.63-6.4-72.3));
			meminput.dialog('option','height',(768*0.9-16));
		}
		else if($(window).width()==1280){
			meminput.dialog('option','width',(1280*0.63-72.3));
			meminput.dialog('option','height',(800*0.9-16));
		}
		else if($(window).width()==1024){
			meminput.dialog('option','width',1024);
			meminput.dialog('option','height',(768*0.9-16));
		}
	});
	var logouttime=$('.order#order .initsetting #changeclose').val();
	var tim1;
	if($('.order#order .companydata #isopen').val()=='1'){
		$('.order#order #MemberBill #billfun #billfun1button').prop('disabled',true);
		$('.order#order #MemberBill #billfun #billfun2button').trigger('click');
		//$billfun.tabs('option','disabled',[0]);
		//$billfun.tabs('option','active',[1]);
	}
	else{
	}
	function timer1(){//待機逾時後，跳轉至待機畫面
		logouttime--;
		$('.changehint #timehint #time').html(logouttime);
			if(logouttime==0){
				/*if($('.order#order .initsetting #controltable').val()=='1'){
					if($('.order#order .companydata #submachine').length>0){
						location.href='./control.php?submachine&usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
					}
					else{
						if($('.order#order #tabs4 #listform input[name="machinetype"]').val()=='m1'){
							location.href='./control.php?usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
						}
						else{
							location.href='./control.php?machine='+$('.order#order #tabs4 #listform input[name="machinetype"]').val()+'&usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
						}
					}
				}
				else{
					//location.href='./order.php?usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
					change.dialog('close');
					if(viewtemp.dialog('isOpen')){
						viewtemp.dialog('close');
						$('.order#order #list #funbox #view').trigger('click');
					}
					else{
					}
				}*/
				change.dialog('close');
				if(viewtemp.dialog('isOpen')){
					viewtemp.dialog('close');
					$('.order#order #list #funbox #view').trigger('click');
				}
				else{
				}
			}
	}
	/*groupset=$('.order#order .groupset').dialog({
		autoOpen:false,
		title:'套餐選項',
		position:{my:'right bottom',at:'right bottom',of:'body'},
		resizable:false,
		modal:true,
		draggable:false
	});
	if($(window).width()==1920){
		groupset.dialog('option','width',1044);
		groupset.dialog('option','height',966);
	}
	else if($(window).width()==1366){
		groupset.dialog('option','width',(1366*0.55-6.4));
		groupset.dialog('option','height',(768*0.9));
	}*/
	$('.order#order #banner #detail').on('click','.viewtotal',function(){
		//$('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val();
		var total=0;
		var dis=0;
		var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
		$.each($('.order#order #tabs4 #listform .label'),function(index,value){
			total=Number(total)+(Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="money[]"]').val())*Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="number[]"]').val()));
			dis=Number(dis)+Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="discount[]"]').val());
		});
		if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
			total=roundfun(total,precision);
		}
		else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
			total=ceilfun($('.spend #charge').html(),precision);
		}
		else{//無條件捨去
			total=floorfun($('.spend #charge').html(),precision);
		}
		//console.log(total);
		$('.spend #initspend').html(total);
		$('.spend #disspend').html(dis);
		if($('.order#order .initsetting #comfloor').val()=='1'){
			if(Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())>Number($('.spend #spend').html())){
				$('.spend #difffloor').html(Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())-Number(total));
			}
			else{
				$('.spend #difffloor').html('0');
			}
		}
		else{
			if(Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())>Number($('.order#order #banner #detail .viewtotal').val())){
				$('.spend #difffloor').html(Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())-Number($('.order#order #banner #detail .viewtotal').val()));
			}
			else{
				$('.spend #difffloor').html('0');
			}
		}
		$('.spend #spend').html($('.order#order #banner #detail .viewtotal').val());
		if($('.order#order .initsetting #openchar').val()=='1'&&$('.order#order .initsetting #charge').val()=='1'){
			if(Number($('.spend #difffloor').html())>0){
				$('.spend #charge').html((Number($('.spend #spend').html())+Number($('.spend #difffloor').html()))*Number($('.order#order .initsetting #chargenumber').val())/100);
			}
			else{
				if($('.order#order .initsetting #chargeeq').val()=='1'){
					$('.spend #charge').html(Number(total)*Number($('.order#order .initsetting #chargenumber').val())/100);
				}
				else{
					$('.spend #charge').html((Number(total)-Number(dis))*Number($('.order#order .initsetting #chargenumber').val())/100);
				}
			}
			/*設定檔內可設定使用何種進位*/
			if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
				$('.spend #charge').html( roundfun($('.spend #charge').html(),precision));
			}
			else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
				$('.spend #charge').html( ceilfun($('.spend #charge').html(),precision));
			}
			else{//無條件捨去
				$('.spend #charge').html( floorfun($('.spend #charge').html(),precision));
			}
		}
		else{
			$('.spend #charge').html('0');
		}
		$.ajax({
			url:'./lib/js/getnowcounter.ajax.php',
			async:false,
			dataType:'html',
			success:function(d){
				var temp=d.split(';');
				$('.spend #nowbizdate').html(temp[0]);
				$('.spend #nowzcounter').html(temp[1]);
			},
			error:function(e){
				console.log(e);
			}
		});
		$('.spend #tempsum').html(Number($('.spend #charge').html())+Number($('.spend #spend').html())+Number($('.spend #difffloor').html()));
		if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
			$('.spend #tempsum').html( roundfun($('.spend #tempsum').html(),precision));
		}
		else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
			$('.spend #tempsum').html( ceilfun($('.spend #tempsum').html(),precision));
		}
		else{//無條件捨去
			$('.spend #tempsum').html( floorfun($('.spend #tempsum').html(),precision));
		}
		spend.dialog('open');
	});
	$('.spend').on('click','.closesysmeg',function(){
		spend.dialog('close');
	});
	$(document).on('keypress',document,function(event){
		$('.order#order #banner #tw input[name="psw"]').val($('.order#order #banner #tw input[name="psw"]').val()+(event.which-48));
	});
	$('.order#order #MemberBill #tabs1').on('click','#persons',function(){
		setperson.dialog('open');
	});
	$('.setperson #buttons').on('click','.input',function(){
		if($('.setperson #view input[name="'+$('.setperson #buttons input[name="tag"]').val()).val()=='0'){
			$('.setperson #view input[name="'+$('.setperson #buttons input[name="tag"]').val()+'"]').val($(this).val());
		}
		else{
			$('.setperson #view input[name="'+$('.setperson #buttons input[name="tag"]').val()+'"]').val($('.setperson #view input[name="'+$('.setperson #buttons input[name="tag"]').val()+'"]').val()+$(this).val());
		}
	});
	$('.setperson #buttons').on('click','#back',function(){
		if($('.setperson #view input[name="'+$('.setperson #buttons input[name="tag"]').val()).val().length==1){
			$('.setperson #view input[name="'+$('.setperson #buttons input[name="tag"]').val()+'"]').val('0');
		}
		else{
			$('.setperson #view input[name="'+$('.setperson #buttons input[name="tag"]').val()+'"]').val($('.setperson #view input[name="'+$('.setperson #buttons input[name="tag"]').val()+'"]').val().substr(0,($('.setperson #view input[name="'+$('.setperson #buttons input[name="tag"]').val()+'"]').val().length-1)));
		}
	});
	$('.setperson #buttons').on('click','#ac',function(){
		$('.setperson #view input[name="'+$('.setperson #buttons input[name="tag"]').val()+'"]').val('0');
	});
	$('.setperson #view').on('click','#person',function(){
		$('.setperson #view #person').css({'background-color':'#fbf4ec'});
		$(this).css({'background-color':'#ffffff'});
		$('.setperson #buttons input[name="tag"]').val($(this).prop('name'));
	});
	$('.setperson #buttons').on('click','#submit',function(){
		var ttlperson=0;
		var flooramt=0;
		if($('.setperson #view input[name="persons1"]').length>0){
			ttlperson=parseInt(ttlperson)+parseInt($('.setperson #view input[name="persons1"]').val());
			$('.order#order #tabs4 #listform input[name="person1"]').val($('.setperson #view input[name="persons1"]').val());
			flooramt=Number(flooramt)+Number(parseInt($('.setperson #view input[name="persons1"]').val())*Number($('.setperson #view input[name="personfloor1"]').val()));
		}
		else{
		}
		if($('.setperson #view input[name="persons2"]').length>0){
			ttlperson=parseInt(ttlperson)+parseInt($('.setperson #view input[name="persons2"]').val());
			$('.order#order #tabs4 #listform input[name="person2"]').val($('.setperson #view input[name="persons2"]').val());
			flooramt=Number(flooramt)+Number(parseInt($('.setperson #view input[name="persons2"]').val())*Number($('.setperson #view input[name="personfloor2"]').val()));
		}
		else{
		}
		if($('.setperson #view input[name="persons3"]').length>0){
			ttlperson=parseInt(ttlperson)+parseInt($('.setperson #view input[name="persons3"]').val());
			$('.order#order #tabs4 #listform input[name="person3"]').val($('.setperson #view input[name="persons3"]').val());
			flooramt=Number(flooramt)+Number(parseInt($('.setperson #view input[name="persons3"]').val())*Number($('.setperson #view input[name="personfloor3"]').val()));
		}
		else{
		}
		$('.order#order #MemberBill #tabs1 #persons').val(ttlperson);
		$('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val(flooramt);
		setperson.dialog('close');
	});
	$('.setperson #buttons').on('click','#cancel',function(){
		/*$('.setperson #view #person').css({'background-color':'#fbf4ec'});
		$(this).css({'background-color':'#ffffff'});
		$('.setperson #buttons input[name="tag"]').val($(this).prop('name'));*/
		/*回復原始輸入之人數*/
		setperson.dialog('close');
	});
	$('.order#order #MemberBill #list #funbox').on('keypress','.quickorder',function(event){
		if(event.which==13){
			if($('.order#order .initsetting #quickorderbarlength').val()!='0'&&$('.order#order .initsetting #quickorderlength').val()!=0&&(($('.order#order #MemberBill #list #funbox .quickorder').val().length==13&&($('.order#order #MemberBill #list #funbox .quickorder').val().substr(0,1)=='2'||$('.order#order #MemberBill #list #funbox .quickorder').val().substr(0,2)=='02'))||($('.order#order #MemberBill #list #funbox .quickorder').val().length==12&&$('.order#order #MemberBill #list #funbox .quickorder').val().substr(0,1)=='2'))){
				var inumber=$('.order#order #MemberBill #list #funbox .quickorder').val().substr($('.order#order .initsetting #quickorderstart').val(),$('.order#order .initsetting #quickorderlength').val());
				var money=parseInt($('.order#order #MemberBill #list #funbox .quickorder').val().substr($('.order#order .initsetting #quickmoneystart').val(),$('.order#order .initsetting #quickmoneylength').val()));
			}
			else{
				var inumber=$('.order#order #MemberBill #list #funbox .quickorder').val();
			}
			if($.isNumeric($('.order#order #MemberBill #list #funbox .quickorder').val())){
				$.ajax({
					url:'./lib/js/checklimit.ajax.php',
					method:'post',
					data:{'inumber':inumber},
					dataType:'html',
					async:false,
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'checklimit.ajax.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						if(d=='fail'){
							//console.log('數量已滿。');
						}
						else if(d=='error'){
							//console.log('輸入錯誤。');
						}
						else if(d.length>16){
							//console.log(d);
						}
						else{
							//console.log(d);
							limit=d.split('*');
							var num=limit[3];
							if(Number(limit[2])>0){
								if(limit[0]=='2'){
									if($('.order#order #tabs4 .listcontent div[class^="label"]').length>0){
										for(var i=0;i<$('.order#order #tabs4 .listcontent div[class^="label"] input[name="no[]"]').length;i++){
											if(Number($('.order#order #tabs4 .listcontent div[class^="label"]:eq('+i+') input[name="no[]"]').val())==Number(limit[1])){
												num++;
											}
											else{
											}
										}
									}
									else{
									}
									if(num>=limit[2]){
										//console.log('overflow');
									}
									else{
										$('.order#order #tabs4 .listcontent .label').prop('class','label');
										$('.order#order #tabs4 .listcontent .label input[id="checkbox[]"]').prop('checked',false);
										getdata('',limit[1],'quickcode','','');
										if(typeof money==="undefined"){
										}
										else{
											$('.openmoney #view #money').html(money);
											if(openmoney.dialog('isOpen')){
												$('.openmoney #buttons #submit').trigger('click');
											}
											else{
											}
										}
									}
								}
								else if(limit[0]=='3'){
									if($('.order#order #tabs4 .listcontent div[class^="label"]').length>0){
										for(var i=0;i<$('.order#order #tabs4 .listcontent div[class^="label"] input[name="no[]"]').length;i++){
											if(Number($('.order#order #tabs4 .listcontent div[class^="label"]:eq('+i+') input[name="no[]"]').val())==Number(limit[1])){
												return;
											}
											else{
											}
										}
										$('.order#order #tabs4 .listcontent .label').prop('class','label');
										$('.order#order #tabs4 .listcontent .label input[id="checkbox[]"]').prop('checked',false);
										getdata('',limit[1],'quickcode','','');
										if(typeof money==="undefined"){
										}
										else{
											$('.openmoney #view #money').html(money);
											if(openmoney.dialog('isOpen')){
												$('.openmoney #buttons #submit').trigger('click');
											}
											else{
											}
										}
									}
									else{
										$('.order#order #tabs4 .listcontent .label').prop('class','label');
										$('.order#order #tabs4 .listcontent .label input[id="checkbox[]"]').prop('checked',false);
										getdata('',limit[1],'quickcode','','');
										if(typeof money==="undefined"){
										}
										else{
											$('.openmoney #view #money').html(money);
											if(openmoney.dialog('isOpen')){
												$('.openmoney #buttons #submit').trigger('click');
											}
											else{
											}
										}
									}
								}
							}
							else{
								$('.order#order #tabs4 .listcontent .label').prop('class','label');
								$('.order#order #tabs4 .listcontent .label input[id="checkbox[]"]').prop('checked',false);
								getdata('',limit[1],'quickcode','','');
								if(typeof money==="undefined"){
								}
								else{
									$('.openmoney #view #money').html(money);
									if(openmoney.dialog('isOpen')){
										$('.openmoney #buttons #submit').trigger('click');
									}
									else{
									}
								}
							}
						}
					},
					error:function(e){
						//console.log(e);
					}
				});
			}
			else{
			}
			$('.order#order #MemberBill #list #funbox .quickorder').val('');
		}
		else{
		}
	});
	function changetagtarget(){
		if($('.order#order #MemberBill #list #tabs5button').prop('disabled')){
			return 'tabs4';
		}
		else{
			return 'tabs5';
		}
	};
	$('.order#order button').on('touchstart',function(){
		$('.order#order button').css({'opacity':'1'});
		if($(this).prop('disabled')==true){
		}
		else{
			$(this).css({'opacity':'0.5'});
		}
	});
	$('.order#order input[type="button"]').on('touchstart',function(){
		$('.order#order input[type="button"]').css({'opacity':'1'});
		if($(this).prop('disabled')==true){
		}
		else{
			$(this).css({'opacity':'0.5'});
		}
	});
	$('.order#order button').on('mousedown',function(){
		$('.order#order button').css({'opacity':'1'});
		if($(this).prop('disabled')==true){
		}
		else{
			$(this).css({'opacity':'0.5'});
		}
	});
	$('.order#order input[type="button"]').on('mousedown',function(){
		$('.order#order input[type="button"]').css({'opacity':'1'});
		if($(this).prop('disabled')==true){
		}
		else{
			$(this).css({'opacity':'0.5'});
		}
	});
	$(document).on('mouseup',document,function(){
		$('button').css({'opacity':'1'});
		$('input[type="button"]').css({'opacity':'1'});
	});
	$(document).on('touchend',document,function(){
		$('button').css({'opacity':'1'});
		$('input[type="button"]').css({'opacity':'1'});
	});
	$('.order#order #banner #type').on('click','.inside',function(){
		$('.order#order #banner #type #button').prop('disabled',false);
		$('.order#order #banner #type .inside').prop('disabled',true);
		//$('.order#order #detail #typetitle').html('內用');
		$('.order#order #MemberBill #list #tabs4 .listcontentbox #listform input[name="listtype"]').val('1');
		$('.order#order #MemberBill #list #tabs4 .listcontentbox #listform input[name="typename"]').val($('.order#order #banner #type .inside #name1').html());
		if($('.order#order #banner #type input[name="initabnum"]').val()=='1'){
			$('.order#order #banner #type').css({'margin-right':'1px'});
			$('.order#order #banner #detail').css({'margin-left':'3px'});
			$('.order#order #banner #tablenumber').css({'width':'calc(42% / 5 - 2px)','height':'100%','margin':'0 1px'});
			$('.order#order #banner #tablenumber').html('<div style="width:100%;height:50%;text-align:center;">內用桌號</div><div class="tabnumbox" style="width:100%;height:50%;border:1px solid #898989;text-align:center;border-radius: 5px;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;"></div>');
			$('.tabinput #view #tabnum').html($('.order#order #banner #tablenumber .tabnumbox').html());
			if($('.order#order .initsetting #controltable').val()=='0'){
				tabinput.dialog('open');
			}
			else{
			}
		}
		else{
		}
	});
	$('.order#order #banner #type').on('click','.come',function(){
		$('.order#order #banner #type #button').prop('disabled',false);
		$('.order#order #banner #type .come').prop('disabled',true);
		//$('.order#order #detail #typetitle').html('來店');
		$('.order#order #MemberBill #list #tabs4 .listcontentbox #listform input[name="listtype"]').val('2');
		$('.order#order #MemberBill #list #tabs4 .listcontentbox #listform input[name="typename"]').val($('.order#order #banner #type .come #name1').html());
		if($('.order#order #banner #type input[name="initabnum"]').val()=='1'){
			$('.order#order #banner #type').css({'margin-right':'calc(42% / 5)'});
			$('.order#order #banner #detail').css({'margin-left':'3px'});
			$('.order#order #banner #tablenumber').css({'width':'','height':'','margin':''});
			$('.order#order #banner #tablenumber').html('');
			$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="tablenumber"]').val('');
		}
		else{
		}
	});
	$('.order#order #banner #type').on('click','.outside',function(){
		$('.order#order #banner #type #button').prop('disabled',false);
		$('.order#order #banner #type .outside').prop('disabled',true);
		//$('.order#order #detail #typetitle').html('外送');
		$('.order#order #MemberBill #list #tabs4 .listcontentbox #listform input[name="listtype"]').val('3');
		$('.order#order #MemberBill #list #tabs4 .listcontentbox #listform input[name="typename"]').val($('.order#order #banner #type .outside #name1').html());
		if($('.order#order #banner #type input[name="initabnum"]').val()=='1'){
			$('.order#order #banner #type').css({'margin-right':'calc(42% / 5)'});
			$('.order#order #banner #detail').css({'margin-left':'3px'});
			$('.order#order #banner #tablenumber').css({'width':'','height':'','margin':''});
			$('.order#order #banner #tablenumber').html('');
			$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="tablenumber"]').val('');
		}
		else{
		}
	});
	$('.order#order #banner #type').on('click','.bysale',function(){
		$('.order#order #banner #type #button').prop('disabled',false);
		$('.order#order #banner #type .bysale').prop('disabled',true);
		//$('.order#order #detail #typetitle').html('自取');
		$('.order#order #MemberBill #list #tabs4 .listcontentbox #listform input[name="listtype"]').val('4');
		$('.order#order #MemberBill #list #tabs4 .listcontentbox #listform input[name="typename"]').val($('.order#order #banner #type .bysale #name1').html());
		if($('.order#order #banner #type input[name="initabnum"]').val()=='1'){
			$('.order#order #banner #type').css({'margin-right':'calc(42% / 5)'});
			$('.order#order #banner #detail').css({'margin-left':'3px'});
			$('.order#order #banner #tablenumber').css({'width':'','height':'','margin':''});
			$('.order#order #banner #tablenumber').html('');
			$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="tablenumber"]').val('');
		}
		else{
		}
	});
	$('.order#order #teamviewer').click(function(){
		var mywin=window.open('posteamviewer://','','width=1px,height=1px');
		$('.order#order #banner #tw').css({'display':''});
		$('.order#order #banner #tw input[name="psw"]').val('');
	});
	$('.order#order #updatemenu').click(function(){
		$('.order#order #updatemenu').prop('disabled',true);
		$.ajax({
			url:'./lib/js/create.cmdtxt.php',
			method:'post',
			async: false,
			data:{'cmd':'update'},
			dataType:'html',
			success:function(d){
				//console.log(d);
			},
			error:function(e){
				//console.log(e);
			}
		});
		$('.order#order #updatemenu').prop('disabled',false);
	});
	$('.order#order #menubox #itemtype').on('click','.typebut',function(){//點選分類按鈕，撈出該分類中所有產品
		var index=$('.order#order #menubox #itemtype .typebut').index(this);
		$('.order#order #menubox #itemtype .typebut').removeClass('focus');
		$('.order#order #menubox #itemtype .typebut:eq('+index+')').addClass('focus');
		$.ajax({
			url:'./lib/js/getitems.ajax.php',
			method:'post',
			data:{'company':$('.order#order .companydata #company').val(),'itemtype':$('.order#order #menubox #itemtype .front:eq('+index+')').val()},
			dataType:'json',
			success:function(items){
				var col=$('.order#order .initsetting #menucol').val(),row=$('.order#order .initsetting #menurow').val();
				$('.order#order #menubox #items').html('');
				var number=0;
				//console.log(items);
				if($('.order#order .initsetting #menutype').val()==3){
					var ttlnumber=col*row-1;
				}
				else{
					var ttlnumber=col*row;
				}
				$.each(items,function(index,value){
					if(number<ttlnumber){
						var temp=value[2].split(';');
						if($.trim(temp[0])!=''||$.trim(temp[3])!=''){
							var tt="<div class='item' style='width:calc(100% / "+col+" - 2px);height:calc(100% / "+row+" - 2px);'><button value='"+(temp[0]+value[3])+"'";

							if(value[4]=='null');
							else tt=tt+" style='background-color:"+value[4]+";'";

							tt=tt+"><div id='name1' style='float:left;width:100%;font-size:"+value[5]+"px;color:"+value[7]+";";
							if(value[9]=='1'){
								tt=tt+"font-weight:bold;";
							}
							else{
							}
							tt=tt+"'>"+temp[0]+"</div><div id='name2' style='float:left;width:100%;font-size:"+value[6]+"px;color:"+value[8]+";";
							if(value[10]=='1'){
								tt=tt+"font-wright:bold;";
							}
							else{
							}
							tt=tt+"'>"+value[3]+"</div></button><input type='hidden' name='no' value='"+value[1]+"'><input type='hidden' name='typeno' value='"+value[0]+"'></div>";
						}
						else{
							var tt="<div class='item' style='width:calc(100% / "+col+" - 2px);height:calc(100% / "+row+" - 2px);'><button value='"+(temp[0]+value[3])+"'";

							if(value[4]=='null');
							else tt=tt+" style='background-color:"+value[4]+";'";

							tt=tt+" disabled><div id='name1' style='float:left;width:100%;font-size:"+value[5]+"px;color:"+value[7]+";";
							if(value[9]=='1'){
								tt=tt+"font-weight:bold;";
							}
							else{
							}
							tt=tt+"'></div><div id='name2' style='float:left;width:100%;font-size:"+value[6]+"px;color:"+value[8]+";";
							if(value[10]=='1'){
								tt=tt+"font-wright:bold;";
							}
							else{
							}
							tt=tt+"'></div></button><input type='hidden' name='no' value='"+value[1]+"'><input type='hidden' name='typeno' value='"+value[0]+"'></div>";
						}
						$('.order#order #menubox #items').append(tt);
					}
					else{
						return false;
					}
					number++;
				});
				if(number>=ttlnumber){
				}
				else{
					for(var i=number;i<ttlnumber;i++){
						$('.order#order #menubox #items').append("<div class='item' style='width:calc(100% / "+col+" - 2px);height:calc(100% / "+row+" - 2px);'><button value='' id='empty' disabled><div id='name1'></div><div id='name2'></div></button></div>");
					}
				}
				if($('.order#order .initsetting #menutype').val()==3){
					$('.order#order #menubox #items').append("<div class='item' style='width:calc(100% / "+col+" - 2px);height:calc(100% / "+row+" - 2px);'><button value='' id='empty'><img src='./lib/return.png' style='width:100%;height:100%;' /><div id='name1'></div><div id='name2'></div></button></div>");
					$('.order#order #menubox #itemtype').css({'display':'none'});
					$('.order#order #menubox #items').css({'display':''});
				}
				else{
				}
				/*for(var i=0;i<items[0];i++){
					for(var j=0;j<items[1];j++){
						if(((i*items[0]+j)*2+2)<items.length){
							$('.order#order #menubox #items').append("<div class='item' style='width:calc(100% / "+items[1]+");height:calc(100% / "+items[0]+");'><input type='button' value='"+items[(i*items[0]+j)*2+2]+"'><input type='hidden' name='no' value='"+items[(i*items[0]+j)*2+3]+"'></div>");
						}
						else{
							$('.order#order #menubox #items').append("<div class='item' style='width:calc(100% / "+items[1]+");height:calc(100% / "+items[0]+");'><input type='button' value='' disabled></div>");
						}
					}
				}*/
			},
			error:function(e){
				console.log(e);
			}
		});
		if(typeof $('.order#order #content #funbox .quickorder').val()==="undefined"){
		}
		else{
			$('.order#order #content #funbox .quickorder').focus();
		}
	});
	$('.order#order #menubox #items').on('click','.item',function(){//點選產品按鈕後，撈出該產品資料
		var tabs=changetagtarget();
		if($('.order#order .initsetting #menutype').val()==3&&(($(this).index('.order#order #menubox #items .item')==($('.order#order .initsetting #menucol').val()*$('.order#order .initsetting #menurow').val()-1)&&tabs=='tabs4')||($(this).index('.order#order #menubox #items .item')==($('.order#order .initsetting #groupchildcol').val()*$('.order#order .initsetting #groupchildrow').val()-1)&&tabs=='tabs5'))){
			$('.order#order #menubox #itemtype').css({'display':''});
			$('.order#order #menubox #items').css({'display':'none'});
		}
		else{
			$('.order#order #tabs1 #tempbox input[name="target"]').val('0');
			$('.order#order #tabs1 #tempbox input[name="linenumber"]').val('0');
			$('.order#order #tabs1 #tempbox input[name="typeno"]').val('');
			$('.order#order #tabs1 #tempbox input[name="type"]').val('');
			$('.order#order #tabs1 #tempbox input[name="no"]').val('');
			$('.order#order #tabs1 #tempbox input[name="personcount"]').val('0');
			$('.order#order #tabs1 #tempbox input[name="needcharge"]').val('1');
			$('.order#order #tabs1 #tempbox input[name="dis1"]').val('');
			$('.order#order #tabs1 #tempbox input[name="dis2"]').val('');
			$('.order#order #tabs1 #tempbox input[name="dis3"]').val('');
			$('.order#order #tabs1 #tempbox input[name="dis4"]').val('');
			$('.order#order #tabs1 #tempbox input[name="name"]').val('');
			$('.order#order #tabs1 #tempbox input[name="name2"]').val('');
			$('.order#order #tabs1 #tempbox input[name="isgroup"]').val('');
			$('.order#order #tabs1 #tempbox input[name="childtype"]').val('');
			$('.order#order #tabs1 #tempbox input[name="mname1"]').val('');
			$('.order#order #tabs1 #tempbox input[name="mname2"]').val('');
			$('.order#order #tabs1 #tempbox input[name="insaleinv"]').val('');
			$('.order#order #tabs1 #tempbox input[name="unitprice"]').val('0');
			$('.order#order #tabs1 #tempbox input[name="money"]').val('0');
			$('.order#order #tabs1 #tempbox input[name="discount"]').val('0');
			$('.order#order #tabs1 #tempbox input[name="discontent"]').val('');
			$('.order#order #tabs1 #tempbox input[name="number"]').val('0');
			$('.order#order #tabs1 #tempbox input[name="subtotal"]').val('0');
			$('.order#order #tabs1 #tempbox input[name="taste1"]').val('');
			$('.order#order #tabs1 #tempbox input[name="taste1name"]').val('');
			$('.order#order #tabs1 #tempbox input[name="taste2name"]').val('');
			$('.order#order #tabs1 #tempbox input[name="taste2"]').val('');
			$('.order#order #tabs1 #tempbox input[name="taste1price"]').val('');
			$('.order#order #tabs1 #tempbox input[name="taste1number"]').val('');
			$('.order#order #tabs1 #tempbox input[name="taste1money"]').val('0');
			$('.order#order #tabs1 #tempbox input[name="background"]').val('');
			$('.order#order #tabs1 #editview').val('');
			$('.order#order #tabs4 .listcontent .label').prop('class','label');
			$('.order#order #tabs4 .listcontent .label input[id="checkbox[]"]').prop('checked',false);
			getdata($('.order#order #menubox #items .item:eq('+$('.order#order #menubox #items .item').index(this)+') input[name="typeno"]').val(),$('.order#order #menubox #items .item:eq('+$('.order#order #menubox #items .item').index(this)+') input[name="no"]').val(),'new','','');
		}
		if(typeof $('.order#order #content #funbox .quickorder').val()==="undefined"){
		}
		else{
			$('.order#order #content #funbox .quickorder').focus();
		}
	});
	$('.order#order #menubox #itemtype').on('click','.childtype',function(){//點選套餐選項類別後，撈出該類別選項
		var index=$('.order#order #menubox #itemtype .childtype').index(this);
		$('.order#order #menubox #itemtype .childtype').removeClass('focus');
		$('.order#order #menubox #itemtype .childtype:eq('+index+')').addClass('focus');
		//console.log($('.order#order .companydata #company').val());
		$.ajax({
			url:'./lib/js/getitems.ajax.php',
			method:'post',
			data:{'company':$('.order#order .companydata #company').val(),'itemtype':$('.order#order #menubox #itemtype .items:eq('+index+')').val(),'group':''},
			dataType:'json',
			success:function(items){
				var col=$('.order#order .initsetting #groupchildcol').val(),row=$('.order#order .initsetting #groupchildrow').val();
				$('.order#order #menubox #items').html('');
				var number=0;
				//console.log(items);
				if($('.order#order .initsetting #menutype').val()==3){
					var ttlnumber=col*row-1;
				}
				else{
					var ttlnumber=col*row;
				}
				$.each(items,function(index,value){
					if(number<ttlnumber){
						var temp=value[2].split(';');
						if($.trim(temp[0])!=''||$.trim(temp[3])!=''){
							var tt="<div class='item' style='width:calc(100% / "+col+" - 2px);height:calc(100% / "+row+" - 2px);'><button value='"+(temp[0]+value[3])+"'";

							if(value[4]=='null');
							else tt=tt+" style='background-color:"+value[4]+";'";

							tt=tt+"><div id='name1' style='float:left;width:100%;font-size:"+value[5]+"px;color:"+value[7]+";";
							if(value[9]=='1'){
								tt=tt+"font-weight:bold;";
							}
							else{
							}
							tt=tt+"'>"+temp[0]+"</div><div id='name2' style='float:left;width:100%;font-size:"+value[6]+"px;color:"+value[8]+";";
							if(value[10]=='1'){
								tt=tt+"font-wright:bold;";
							}
							else{
							}
							tt=tt+"'>"+value[3]+"</div></button><input type='hidden' name='no' value='"+value[1]+"'><input type='hidden' name='typeno' value='"+value[0]+"'></div>";
						}
						else{
							var tt="<div class='item' style='width:calc(100% / "+col+" - 2px);height:calc(100% / "+row+" - 2px);'><button value='"+(temp[0]+value[3])+"'";

							if(value[4]=='null');
							else tt=tt+" style='background-color:"+value[4]+";'";

							tt=tt+" disabled><div id='name1' style='float:left;width:100%;font-size:"+value[5]+"px;color:"+value[7]+";";
							if(value[9]=='1'){
								tt=tt+"font-weight:bold;";
							}
							else{
							}
							tt=tt+"'></div><div id='name2' style='float:left;width:100%;font-size:"+value[6]+"px;color:"+value[8]+";";
							if(value[10]=='1'){
								tt=tt+"font-wright:bold;";
							}
							else{
							}
							tt=tt+"'></div></button><input type='hidden' name='no' value='"+value[1]+"'><input type='hidden' name='typeno' value='"+value[0]+"'></div>";
						}
						$('.order#order #menubox #items').append(tt);
					}
					else{
						return false;
					}
					number++;
				});
				if(number>=ttlnumber){
				}
				else{
					for(var i=number;i<ttlnumber;i++){
						$('.order#order #menubox #items').append("<div class='item' style='width:calc(100% / "+col+" - 2px);height:calc(100% / "+row+" - 2px);'><button value='' id='empty' disabled><div id='name1'></div><div id='name2'></div></button></div>");
					}
				}
				if($('.order#order .initsetting #menutype').val()==3){
					$('.order#order #menubox #items').append("<div class='item' style='width:calc(100% / "+col+" - 2px);height:calc(100% / "+row+" - 2px);'><button value='' id='empty'><img src='./lib/return.png' style='width:100%;height:100%;' /><div id='name1'></div><div id='name2'></div></button></div>");
					$('.order#order #menubox #itemtype').css({'display':'none'});
					$('.order#order #menubox #items').css({'display':''});
				}
				else{
				}
				/*var col=$('.order#order .initsetting #groupchildcol').val(),row=$('.order#order .initsetting #groupchildrow').val();
				$('.order#order #menubox #items').html('');
				var number=0;
				$.each(items,function(index,value){
					if(number<col*row){
						$('.order#order #menubox #items').append("<div class='childitem' style='width:calc(100% / "+col+" - 2px);height:calc(100% / "+row+" - 2px);'><input type='button' value='"+value[2]+"'><input type='hidden' name='no' value='"+value[1]+"'><input type='hidden' name='typeno' value='"+value[0]+"'></div>");
					}
					else{
						return false;
					}
					number++;
				});
				if(number>=col*row){
				}
				else{
					for(var i=number;i<col*row;i++){
						$('.order#order #menubox #items').append("<div class='item' style='width:calc(100% / "+col+" - 2px);height:calc(100% / "+row+" - 2px);'><input type='button' value='' disabled></div>");
					}
				}*/
			},
			error:function(e){
				//console.log(e);
			}
		});
		if(typeof $('.order#order #content #funbox .quickorder').val()==="undefined"){
		}
		else{
			$('.order#order #content #funbox .quickorder').focus();
		}
	});
	/*$('.order#order #menubox #items').on('click','.childitem',function(){//點選套餐選項按鈕後，撈出該產品資料
		$('.order#order #tabs5 .listcontent .label').prop('class','label');
		$('.order#order #tabs5 .listcontent .label input[id="checkbox[]"]').prop('checked',false);
		getdata($('.order#order #menubox #items .childitem:eq('+$('.order#order #menubox #items .childitem').index(this)+') input[name="typeno"]').val(),$('.order#order #menubox #items .childitem:eq('+$('.order#order #menubox #items .childitem').index(this)+') input[name="no"]').val(),'new','g','');
	});*/
	function getdata(itemtype,itemno,type,group,ordercon){
		var tabs=changetagtarget();
		if(tabs=='tabs4'){
			$.ajax({
				url:'./lib/js/getdata.ajax.php',
				method:'post',
				async:false,
				data:{'company':$('.order#order .companydata #company').val(),'itemtype':itemtype,'no':itemno,'dep':group},
				dataType:'json',
				success:function(data){
					//console.log(data);
					var i=0;
					$('.order#order .parameters #typeno').val(data[0]['fronttype']);
					$('.order#order .parameters #type').val(data[0]['depname']);
					$('.order#order .parameters #no').val(data[0]['number']);
					$('.order#order .parameters #name').val(data[0]['name']);
					$('.order#order .parameters #msize').val(data[0]['mnumber']);
					for(i=0;i<6;i++){
						//if(i<data[0]['mnumber']){
							//console.log(data[0]['mname'+(i+1)+$('.order#order .initsetting #firlan').val()]);
							if(data[0]['money'+(i+1)]==""){
								$('.order#order .parameters input[id="mname1[]"]:eq('+i+')').val('');
								$('.order#order .parameters input[id="mname2[]"]:eq('+i+')').val('');
								$('.order#order .parameters input[id^="money"]:eq('+i+')').val('');
							}
							else{
								if(data[0]['mname'+(i+1)+$('.order#order .initsetting #firlan').val()]==''){
									if((Number(data[0]['money'+(i+1)])+Number(data[0]['dis']))<=0){
										$('.order#order .parameters input[id="mname'+$('.order#order .initsetting #firlan').val()+'[]"]:eq('+i+')').val('0');
									}
									else{
										$('.order#order .parameters input[id="mname'+$('.order#order .initsetting #firlan').val()+'[]"]:eq('+i+')').val((Number(data[0]['money'+(i+1)])+Number(data[0]['dis'])));
									}
								}
								else{
									$('.order#order .parameters input[id="mname1[]"]:eq('+i+')').val(data[0]['mname'+(i+1)+'1']);
									$('.order#order .parameters input[id="mname2[]"]:eq('+i+')').val(data[0]['mname'+(i+1)+'2']);
								}
								$('.order#order .parameters input[id="money[]"]:eq('+i+')').val((Number(data[0]['money'+(i+1)])+Number(data[0]['dis'])));
							}
						/*}
						else{
							$('.order#order .parameters input[id="mname1[]"]:eq('+i+')').val('');
							$('.order#order .parameters input[id="mname2[]"]:eq('+i+')').val('');
							$('.order#order .parameters input[id^="money"]:eq('+i+')').val('');
						}*/
					}
					$('.order#order .parameters #taste1').val(data[0]['taste']);
					$('.order#order .parameters #taste1name').val(data[0]['tastename1']);
					$('.order#order .parameters #taste2name').val(data[0]['tastename2']);
					$('.order#order .parameters #taste1money').val(data[0]['tastemoney']);
					$('.order#order .parameters #background').val(data[0]['background']);
					$('.order#order #menubox #itemfun .startchangetaste').val('0');
					$('.order#order #menubox #itemfun .itemfun').trigger( "click" );
					
					$('.order#order #numbox input[type="button"]:eq(0)').val('number');
					$('.order#order #numbox button:eq(1) #name').html('$');
					
					if(type=='old'){
						if(data[0]['openmoney']==1&&$('.order#order #tabs4 #listform .listcontent .label:eq('+$('.order#order #tabs1 #tempbox input[name="target"]').val()+') input[name="templistitem[]"]').length==0){
							$('.order#order #numbox button:eq(1)').prop('disabled',false);
							$('.order#order #numbox button:eq(1)').css({'color':'#000000'});
							$('.openmoney #view #money').html($('.order#order .parameters input[id="money[]"]:eq(0)').val());
							openmoney.dialog('open');
						}
						else{
							$('.order#order #numbox button:eq(1)').prop('disabled',true);
							$('.order#order #numbox button:eq(1)').css({'color':'#a8a8a8'});
						}
					}
					else{
						if(data[0]['openmoney']==1&&$('.order#order #tabs4 #listform .listcontent .label:eq('+$('.order#order #tabs1 #tempbox input[name="target"]').val()+') input[name="templistitem[]"]').length==0){
							$('.order#order #numbox button:eq(1)').prop('disabled',false);
							$('.order#order #numbox button:eq(1)').css({'color':'#000000'});
							$('.openmoney #view #money').html($('.order#order .parameters input[id="money[]"]:eq(0)').val());
							openmoney.dialog('open');
						}
						else{
							$('.order#order #numbox button:eq(1)').prop('disabled',true);
							$('.order#order #numbox button:eq(1)').css({'color':'#a8a8a8'});
						}
						if(data[0]['personcount']=='0'){
						}
						else{
							if($('.setperson #view input[name="persons'+data[0]['personcount']+'"]').length>0){
								$('.setperson #view input[name="persons'+data[0]['personcount']+'"]').val(parseInt($('.setperson #view input[name="persons'+data[0]['personcount']+'"]').val())+1);
								$('.setperson #buttons #submit').trigger('click');
							}
							else{
							}
						}
						$('.order#order #tabs1 #tempbox input[name="target"]').val($('.order#order #'+tabs+' .listcontent .label').length);
						if($('.order#order #'+tabs+' .listcontent input[name="linenumber[]"]').length==0){
							$('.order#order #tabs1 #tempbox input[name="linenumber"]').val(1);
						}
						else{
							$('.order#order #tabs1 #tempbox input[name="linenumber"]').val(parseInt($('.order#order #'+tabs+' .listcontent input[name="linenumber[]"]:eq('+($('.order#order #'+tabs+' .listcontent input[name="linenumber[]"]').length-1)+')').val())+2);
						}
						$('.order#order #tabs1 #tempbox input[name="typeno"]').val(data[0]['fronttype']);
						$('.order#order #tabs1 #tempbox input[name="type"]').val(data[0]['depname']);
						$('.order#order #tabs1 #tempbox input[name="no"]').val(data[0]['inumber']);
						$('.order#order #tabs1 #tempbox input[name="personcount"]').val(data[0]['personcount']);
						$('.order#order #tabs1 #tempbox input[name="needcharge"]').val(data[0]['charge']);
						$('.order#order #tabs1 #tempbox input[name="dis1"]').val(data[0]['dis1']);
						$('.order#order #tabs1 #tempbox input[name="dis2"]').val(data[0]['dis2']);
						$('.order#order #tabs1 #tempbox input[name="dis3"]').val(data[0]['dis3']);
						$('.order#order #tabs1 #tempbox input[name="dis4"]').val(data[0]['dis4']);
						$('.order#order #tabs1 #tempbox input[name="name"]').val(data[0]['name']);
						$('.order#order #tabs1 #tempbox input[name="name2"]').val(data[0]['name2']);
						if(ordercon==''){
							$('.order#order #tabs1 #tempbox input[name="isgroup"]').val(data[0]['isgroup']);
						}
						else{
							$('.order#order #tabs1 #tempbox input[name="isgroup"]').val(ordercon);
						}
						$('.order#order #tabs1 #tempbox input[name="childtype"]').val(data[0]['childtype']);
						$('.order#order #tabs1 #tempbox input[name="mname1"]').val(data[0]['mname1'+$('.order#order .initsetting #firlan').val()]);
						$('.order#order #tabs1 #tempbox input[name="mname2"]').val(data[0]['mname1'+$('.order#order .initsetting #seclan').val()]);
						$('.order#order #tabs1 #tempbox input[name="insaleinv"]').val(data[0]['insaleinv']);
						$('.order#order #tabs1 #tempbox input[name="unitprice"]').val((Number(data[0]['money1'])+Number(data[0]['dis'])));
						$('.order#order #tabs1 #tempbox input[name="money"]').val((Number(data[0]['money1'])+Number(data[0]['dis'])));
						$('.order#order #tabs1 #tempbox input[name="discount"]').val('0');
						$('.order#order #tabs1 #tempbox input[name="discontent"]').val('');
						$('.order#order #tabs1 #tempbox input[name="number"]').val(1);
						$('.order#order #tabs1 #tempbox input[name="subtotal"]').val((Number(data[0]['money1'])+Number(data[0]['dis'])));
						$('.order#order #tabs1 #tempbox input[name="taste1"]').val('');
						$('.order#order #tabs1 #tempbox input[name="taste1name"]').val('');
						$('.order#order #tabs1 #tempbox input[name="taste2name"]').val('');
						$('.order#order #tabs1 #tempbox input[name="taste2"]').val('');
						$('.order#order #tabs1 #tempbox input[name="taste1price"]').val('');
						$('.order#order #tabs1 #tempbox input[name="taste1number"]').val('');
						$('.order#order #tabs1 #tempbox input[name="taste1money"]').val('0');
						$('.order#order #tabs1 #tempbox input[name="background"]').val('');
						data[0]['terminalnumber']=$('.order#order #tabs4 #listform input[name="tablenumber"]').val();
						data[0]['consecnumber']=$('.order#order #tabs4 #listform input[name="consecnumber"]').val();
						data[0]['listtype']=$('.order#order #tabs4 #listform input[name="listtype"]').val();
						data[0]['machinetype']=$('.order#order #tabs4 #listform input[name="machinetype"]');
						/*$('.order#order #tabs1 #tempbox input[name="taste2"]').val('');
						$('.order#order #tabs1 #tempbox input[name="taste2name"]').val('');*/
						if($('.order#order #tabs1 #tempbox input[name="isgroup"]').val()!=0&&$('.order#order #tabs1 #tempbox input[name="isgroup"]').val()!='－'){
							if($('.order#order #tabs1 #tempbox input[name="childtype"]').val().length>0){
								$.ajax({
									url:'./lib/js/getchildtype.ajax.php',
									method:'post',
									data:{'company':$('.order#order .companydata #company').val(),'childtype':$('.order#order #tabs1 #tempbox input[name="childtype"]').val()},
									dataType:'json',
									success:function(value){
										$('.order#order #MemberBill #list #tabs4button').prop('disabled',true);
										$('.order#order #MemberBill #list #tabs5button').prop('disabled',false);
										$('.order#order #MemberBill #list #tabs5button').trigger('click');
										/*$list.tabs('option','disabled',[0]);
										$list.tabs('option','enabled',[1]);
										$list.tabs('option','active',1);*/
										$('.order#order #billfun #billfun1 button:eq(3)').prop('disabled',true);
										$('.order#order #billfun #billfun1 button:eq(4)').prop('disabled',true);
										$('.order#order #billfun #billfun1 button:eq(5)').prop('disabled',true);
										$('.order#order #billfun #billfun1 button:eq(6)').prop('disabled',true);

										$('.order#order #billfun #billfun2 button:eq(0)').prop('disabled',true);
										$('.order#order #billfun #billfun2 button:eq(1)').prop('disabled',true);
										//$('.order#order #billfun #billfun2 button:eq(2)').prop('disabled',true);
										$('.order#order #billfun #billfun2 button:eq(3)').prop('disabled',true);
										$('.order#order #billfun #billfun2 button:eq(4)').prop('disabled',true);
										$('.order#order #billfun #billfun2 button:eq(5)').val('套餐確認');
										$.ajax({
											url:'./lib/js/getsetname.ajax.php',
											method:'post',
											data:{'type':'sendset'},
											dataType:'json',
											success:function(d){
												$('.order#order #billfun #billfun2 button:eq(5) div#name1').html(d['button1']);
												$('.order#order #billfun #billfun2 button:eq(5) div#name2').html(d['button2']);
											},
											error:function(e){
												//console.log(e);
											}
										});
										$('.order#order #billfun #billfun2 button:eq(5)').prop('disabled',false);
										$('.order#order #billfun #billfun2 button:eq(6)').prop('disabled',true);
										$('.order#order #billfun #billfun2 button:eq(7)').prop('disabled',true);
										$('.order#order #billfun #billfun3button').prop('disabled',true);
										$('.order#order #MemberBill #billfun #billfun2button').trigger('click');

										tabs=changetagtarget();
										$('.order#order #tabs1 #tempbox input[name="target"]').val($('.order#order #'+tabs+' .listcontent .label').length);

										$('.order#order #MemberBill #billfun #billfun1 input[type="button"]').prop('disabled',true);
										$('.order#order #MemberBill #billfun #billfun1 input[type="button"]').css({'color':'#a8a8a8'});
										$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(2)').prop('disabled',false);
										$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(2)').css({'color':'#ffffff'});
										$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(4)').prop('disabled',false);
										$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(4)').css({'color':'#ffffff'});
										$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(10)').prop('disabled',false);
										$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(10)').css({'color':'#000000'});
										//console.log(value);
										if(Object.keys(value).length>0){
											var maxtyperow=$('.order#order .initsetting #groupchildtyperow').val();
											var maxtypecol=$('.order#order .initsetting #groupchildtypecol').val();
											var maxrow=$('.order#order .initsetting #groupchildrow').val();
											var maxcol=$('.order#order .initsetting #groupchildcol').val();
											$('.order#order #menubox #itemtype').html('');
											$('.order#order #menubox #items').html('');
											var i=0;
											//console.log(value);
											$.each(value,function(key,v){
												if(key!='other'){
												}
												else{
													$.each(v,function(key,val){
														if(i<(maxtyperow*maxtypecol-1)){
															$('.order#order #menubox #itemtype').append('<div class="type" style="width:calc(100% / '+maxtypecol+' - 2px);height:calc(100% / '+maxtyperow+' - 2px);overflow:hidden;"><button class="childtype" value="'+val['front']+'"><div id="name1">'+val['front']+'</div><input type="hidden" class="number" value="'+val['number']+'"></button><input type="hidden" class="childfront" value="'+key+'"><input type="hidden" class="items" value="'+val['items']+'"></div>');
															i++;
														}
														else{
															return;
														}
													});
												}
											});
											/*for(var i=0;i<value.length;i++){
												if(i<(maxtyperow*maxtypecol-1)){
													$('.order#order #menubox #itemtype').append('<div class="type" style="width:calc(100% / '+maxtypecol+' - 2px);height:calc(100% / '+maxtyperow+' - 2px);overflow:hidden;"><button class="childtype" value="'+value[i]['name1']+'"><div id="name1">'+value[i]['name1']+'</div></button><input type="hidden" class="childfront" value="'+value[i]['front']+'"></div>');
												}
												else{
													break;
												}
											}*/
											if(i<(maxtyperow*maxtypecol)){
												for(;i<(maxtyperow*maxtypecol);i++){
													$('.order#order #menubox #itemtype').append('<div class="type" style="width:calc(100% / '+maxtypecol+' - 2px);height:calc(100% / '+maxtyperow+' - 2px);overflow:hidden;"><input type="button" class="childtype" value="" disabled><input type="hidden" class="childfront" value=""></div>');
												}
											}
											else{
											}
											for(var i=0;i<(maxrow*maxcol);i++){
												$('.order#order #menubox #items').append('<div class="item" style="width:calc(100% / '+maxcol+' - 2px);height:calc(100% / '+maxrow+' - 2px);overflow:hidden;"><input type="button" value="" disabled></div>');
											}
											$('.order#order #tabs1 #editview').trigger('change');
											updateview();
											if($('.order#order .initsetting #menutype').val()==3){
												$('.order#order #menubox #itemtype').css({'display':''});
												$('.order#order #menubox #items').css({'display':'none'});
											}
											else{
											}
										}
										else{
											//console.log('套餐類別未設定');
										}
									},
									error:function(e){
										//console.log(e);
									}
								});
							}
							else{
								//console.log('套餐類別未設定');
							}
						}
						else{
							$('.order#order #tabs1 #editview').trigger('change');
							updateview();
							sumsubtotal();
							if($('.order#order #tabs1 #tempbox input[name="childtype"]').val()==''){
							}
							else{
								var temp=$('.order#order #tabs1 #tempbox input[name="childtype"]').val().split(',');
								for(var i=0;i<temp.length;i++){
									var tt=temp[i].split('-');
									getdata(tt[0],tt[1],'new','','－');
								}
								
							}
						}
					}
				},
				error:function(e){
					console.log(e);
				}
			});
			/*$.ajax({
				url:'../secview/writeitem.ajax.php',
				method:'post',
				data:{'company':$('.order#order .companydata #company').val(),'listtype':$('.order#order #tabs4 #listform input[name="listtype"]').val(),'machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'itemtype':itemtype,'no':itemno,'dep':group},
				async: false
				dataType:'json',
				success:function(d){
					//console.log(d);
				},
				error:function(e){
					//console.log(e);
				}
			});*/
		}
		else{
			var temp=0;
			for(var i=1;i<$('.order#order #'+tabs+' #listform .label').length;i++){
				if($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="order[]"]').val()=='－'){
				}
				else{
					if($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="typeno[]"]').val()!=itemtype){
					}
					else{
						temp=Number(temp)+Number($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="number[]"]').val());
					}
				}
			}
			$.ajax({
				url:'./lib/js/getchilddata.ajax.php',
				method:'post',
				async:false,
				data:{'company':$('.order#order .companydata #company').val(),'childtype':itemtype,'no':itemno,'dep':group},
				dataType:'json',
				success:function(data){
					//console.log(data);
					var i=0;
					$('.order#order .parameters #typeno').val(data['itemdep']);
					$('.order#order .parameters #type').val(data['depname']);
					$('.order#order .parameters #no').val(data['number']);
					$('.order#order .parameters #name').val(data['name']);
					$('.order#order .parameters #msize').val(data['mnumber']);
					for(i=0;i<6;i++){
						//if(i<data[0]['mnumber']){
							//console.log(data[0]['mname'+(i+1)+$('.order#order .initsetting #firlan').val()]);
							if(data['money'+(i+1)]==""){
								$('.order#order .parameters input[id="mname1[]"]:eq('+i+')').val('');
								$('.order#order .parameters input[id="mname2[]"]:eq('+i+')').val('');
								$('.order#order .parameters input[id^="money"]:eq('+i+')').val('');
							}
							else{
								if(data['mname'+(i+1)+$('.order#order .initsetting #firlan').val()]==''){
									if((Number(data['money'+(i+1)])+Number(data['dis']))<=0){
										$('.order#order .parameters input[id="mname'+$('.order#order .initsetting #firlan').val()+'[]"]:eq('+i+')').val('0');
									}
									else{
										$('.order#order .parameters input[id="mname'+$('.order#order .initsetting #firlan').val()+'[]"]:eq('+i+')').val(Number(data['money'+(i+1)]));//(Number(data['money'+(i+1)])+Number(data['dis']))
									}
								}
								else{
									$('.order#order .parameters input[id="mname1[]"]:eq('+i+')').val(data['mname'+(i+1)+'1']);
									$('.order#order .parameters input[id="mname2[]"]:eq('+i+')').val(data['mname'+(i+1)+'2']);
								}
								if((Number(data['money'+(i+1)]))<=0){
									$('.order#order .parameters input[id="money[]"]:eq('+i+')').val(0);
								}
								else{
									$('.order#order .parameters input[id="money[]"]:eq('+i+')').val((Number(data['money'+(i+1)])));
								}
							}
						/*}
						else{
							$('.order#order .parameters input[id="mname1[]"]:eq('+i+')').val('');
							$('.order#order .parameters input[id="mname2[]"]:eq('+i+')').val('');
							$('.order#order .parameters input[id^="money"]:eq('+i+')').val('');
						}*/
					}
					/*for(i=0;i<6;i++){
						if(i<data['mnumber']){
							if(data['mname'+i+'1']==''){
								if((Number(data['money'+(i+1)])+Number(data['dis']))<=0){
									$('.order#order .parameters input[id="mname1[]"]:eq('+i+')').val('0');
									$('.order#order .parameters input[id="mname2[]"]:eq('+i+')').val('');
								}
								else{
									//$('.order#order .parameters input[id="mname1[]"]:eq('+i+')').val((Number(data['money'+(i+1)])+Number(data['dis']))+'');
									$('.order#order .parameters input[id="mname1[]"]:eq('+i+')').val((Number(data['money'+(i+1)]))+'');
									$('.order#order .parameters input[id="mname2[]"]:eq('+i+')').val('');
								}
							}
							else{
								$('.order#order .parameters input[id="mname1[]"]:eq('+i+')').val(data['mname'+(i+1)+'1']);
								$('.order#order .parameters input[id="mname2[]"]:eq('+i+')').val(data['mname'+(i+1)+'2']);
							}
							//if((Number(data['money'+(i+1)])+Number(data['dis']))<=0){
							if((Number(data['money'+(i+1)]))<=0){
								$('.order#order .parameters input[id^="money"]:eq('+i+')').val(0);
							}
							else{
								//$('.order#order .parameters input[id^="money"]:eq('+i+')').val((Number(data[0]['money'+(i+1)])+Number(data[0]['dis'])));
								$('.order#order .parameters input[id^="money"]:eq('+i+')').val((Number(data['money'+(i+1)])));
							}
						}
						else{
							$('.order#order .parameters input[id="mname1[]"]:eq('+i+')').val('');
							$('.order#order .parameters input[id="mname2[]"]:eq('+i+')').val('');
							$('.order#order .parameters input[id^="money"]:eq('+i+')').val('');
						}
					}*/
					$('.order#order .parameters #taste1').val(data['taste']);
					$('.order#order .parameters #taste1name').val(data['tastename1']);
					$('.order#order .parameters #taste2name').val(data['tastename2']);
					$('.order#order .parameters #taste1money').val(data['tastemoney']);
					$('.order#order .parameters #background').val(data['background']);
					$('.order#order #menubox #itemfun .startchangetaste').val('0');
					$('.order#order #menubox #itemfun .itemfun').trigger( "click" );
					
					if(type=='old'){
					}
					else{
						if(Number(temp)>=Number($('.order#order #itemtype .childtype.focus .number').val())){
							$('.order#order #tabs1 #tempbox input[name="target"]').val('');
							$('.order#order #tabs1 #tempbox input[name="linenumber"]').val('');
							$('.order#order #tabs1 #tempbox input[name="typeno"]').val('');
							$('.order#order #tabs1 #tempbox input[name="type"]').val('');
							$('.order#order #tabs1 #tempbox input[name="no"]').val('');
							$('.order#order #tabs1 #tempbox input[name="personcount"]').val('0');
							$('.order#order #tabs1 #tempbox input[name="needcharge"]').val('1');
							$('.order#order #tabs1 #tempbox input[name="dis1"]').val('');
							$('.order#order #tabs1 #tempbox input[name="dis2"]').val('');
							$('.order#order #tabs1 #tempbox input[name="dis3"]').val('');
							$('.order#order #tabs1 #tempbox input[name="dis4"]').val('');
							$('.order#order #tabs1 #tempbox input[name="name"]').val('');
							$('.order#order #tabs1 #tempbox input[name="name2"]').val('');
							$('.order#order #tabs1 #tempbox input[name="isgroup"]').val('0');
							$('.order#order #tabs1 #tempbox input[name="childtype"]').val('');
							$('.order#order #tabs1 #tempbox input[name="mname1"]').val('');
							$('.order#order #tabs1 #tempbox input[name="mname2"]').val('');
							$('.order#order #tabs1 #tempbox input[name="insaleinv"]').val('');
							$('.order#order #tabs1 #tempbox input[name="unitprice"]').val('');
							$('.order#order #tabs1 #tempbox input[name="money"]').val('');
							$('.order#order #tabs1 #tempbox input[name="discount"]').val('0');
							$('.order#order #tabs1 #tempbox input[name="discontent"]').val('');
							$('.order#order #tabs1 #tempbox input[name="number"]').val('');
							$('.order#order #tabs1 #tempbox input[name="subtotal"]').val('');
							$('.order#order #tabs1 #tempbox input[name="taste1"]').val('');
							$('.order#order #tabs1 #tempbox input[name="taste1name"]').val('');
							$('.order#order #tabs1 #tempbox input[name="taste2name"]').val('');
							$('.order#order #tabs1 #tempbox input[name="taste1price"]').val('');
							$('.order#order #tabs1 #tempbox input[name="taste1number"]').val('');
							$('.order#order #tabs1 #tempbox input[name="taste1money"]').val('0');
							$('.order#order #tabs1 #tempbox input[name="background"]').val('');
							$('.order#order #tabs1 #editview').val('');
						}
						else{
							$('.order#order #tabs1 #tempbox input[name="target"]').val($('.order#order #'+tabs+' .listcontent .label').length);
							if($('.order#order #'+tabs+' .listcontent input[name="linenumber[]"]').length==0){
								$('.order#order #tabs1 #tempbox input[name="linenumber"]').val(1);
							}
							else{
								$('.order#order #tabs1 #tempbox input[name="linenumber"]').val(parseInt($('.order#order #'+tabs+' .listcontent input[name="linenumber[]"]:eq('+($('.order#order #'+tabs+' .listcontent input[name="linenumber[]"]').length-1)+')').val())+2);
							}
							$('.order#order #tabs1 #tempbox input[name="typeno"]').val(data['itemdep']);
							$('.order#order #tabs1 #tempbox input[name="type"]').val(data['depname']);
							$('.order#order #tabs1 #tempbox input[name="no"]').val(data['number']);
							$('.order#order #tabs1 #tempbox input[name="personcount"]').val(data['personcount']);
							$('.order#order #tabs1 #tempbox input[name="needcharge"]').val(data['charge']);
							$('.order#order #tabs1 #tempbox input[name="dis1"]').val(data['dis1']);
							$('.order#order #tabs1 #tempbox input[name="dis2"]').val(data['dis2']);
							$('.order#order #tabs1 #tempbox input[name="dis3"]').val(data['dis3']);
							$('.order#order #tabs1 #tempbox input[name="dis4"]').val(data['dis4']);
							$('.order#order #tabs1 #tempbox input[name="name"]').val(data['name']);
							$('.order#order #tabs1 #tempbox input[name="name2"]').val(data['name2']);
							$('.order#order #tabs1 #tempbox input[name="isgroup"]').val(data['isgroup']);
							$('.order#order #tabs1 #tempbox input[name="childtype"]').val(data['childtype']);
							$('.order#order #tabs1 #tempbox input[name="mname1"]').val(data['mname1'+$('.order#order .initsetting #firlan').val()]);
							$('.order#order #tabs1 #tempbox input[name="mname2"]').val(data['mname1'+$('.order#order .initsetting #seclan').val()]);
							$('.order#order #tabs1 #tempbox input[name="insaleinv"]').val(data['insaleinv']);
							//$('.order#order #tabs1 #tempbox input[name="unitprice"]').val((Number(data['money1'])+Number(data['dis'])));
							$('.order#order #tabs1 #tempbox input[name="unitprice"]').val((Number(data['money1'])));
							//$('.order#order #tabs1 #tempbox input[name="money"]').val((Number(data[0]['money1'])+Number(data[0]['dis'])));
							$('.order#order #tabs1 #tempbox input[name="money"]').val((Number(data['money1'])));
							$('.order#order #tabs1 #tempbox input[name="discount"]').val('0');
							$('.order#order #tabs1 #tempbox input[name="discontent"]').val('');
							$('.order#order #tabs1 #tempbox input[name="number"]').val(1);
							///$('.order#order #tabs1 #tempbox input[name="subtotal"]').val((Number(data['money1'])+Number(data[0]['dis'])));
							$('.order#order #tabs1 #tempbox input[name="subtotal"]').val((Number(data['money1'])));
							$('.order#order #tabs1 #tempbox input[name="taste1"]').val('');
							$('.order#order #tabs1 #tempbox input[name="taste1name"]').val('');
							$('.order#order #tabs1 #tempbox input[name="taste2name"]').val('');
							$('.order#order #tabs1 #tempbox input[name="taste1price"]').val('');
							$('.order#order #tabs1 #tempbox input[name="taste1number"]').val('');
							$('.order#order #tabs1 #tempbox input[name="taste1money"]').val('0');
							$('.order#order #tabs1 #tempbox input[name="background"]').val('');
							$('.order#order #tabs1 #editview').trigger('change');
							updateview();
							//sumsubtotal();
						}
					}
				},
				error:function(e){
					//console.log(e);
				}
			});
		}
		if(type=='old'){//判斷是否為加點品項
		}
		else{
			$.ajax({
				url:'./lib/js/change.button4.php',
				method:'post',
				data:{'type':'a'},
				dataType:'json',
				success:function(d){
					//console.log(d);
					if($('.order#order #billfun #billfun1 button:eq(4) #name1').length>0){
						$('.order#order #billfun #billfun1 button:eq(4) #name1').html(d[0]);
					}
					else{
					}
					if($('.order#order #billfun #billfun1 button:eq(4) #name2').length>0){
						$('.order#order #billfun #billfun1 button:eq(4) #name2').html(d[1]);
					}
					else{
					}
					if($('.order#order .initsetting #controltable').val()=='1'&&$('.order#order .initsetting #opentemp').val()=='0'){
						$('.order#order #billfun #billfun1 button:eq(4)').prop('disabled',true);
					}
					else{
					}
					$('.order#order #billfun #billfun1 button:eq(4)').val(d[2]);
				},
				error:function(e){
					//console.log(e);
				}
			});
		}
	};
	function sumsubtotal(){
		var tabs=changetagtarget();
		var viewtotal=0;
		var viewnumber=0;
		for(var i=0;i<$('.order#order #tabs4 #listform .label').length;i++){
			viewtotal=Number(viewtotal)+Number($('.order#order #tabs4 #listform .label:eq('+i+') input[name="subtotal[]"]').val());
			viewnumber=Number(viewnumber)+Number($('.order#order #tabs4 #listform .label:eq('+i+') input[name="number[]"]').val());
		}
		var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
		if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
			viewtotal=roundfun(viewtotal,precision);
			viewnumber=roundfun(viewnumber,precision);
		}
		else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
			viewtotal=ceilfun(viewtotal,precision);
			viewnumber=ceilfun(viewnumber,precision);
		}
		else{//無條件捨去
			viewtotal=floorfun(viewtotal,precision);
			viewnumber=floorfun(viewnumber,precision);
		}
		$('.order#order #tabs4 #listform input[name="total"]').val(viewtotal);
		$('.order#order #tabs4 #listform input[name="totalnumber"]').val(viewnumber);
		$('.order#order #banner #detail #viewtotal').val(viewtotal);
		$('.order#order #banner #detail #viewnumber').val(viewnumber);
		if($('.order#order .initsetting #secview').val()=='1'){
			$.ajax({
				url:'../secview/writeitem.ajax.php',
				method:'post',
				data:{'linenumber':$('.order#order #tabs1 #tempbox input[name="linenumber"]').val(),'usercode':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'username':$('.order#order #tabs4 #listform input[name="username"]').val(),'company':$('.order#order .companydata #company').val(),'listtype':$('.order#order #tabs4 #listform input[name="listtype"]').val(),'machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'itemtype':$('.order#order #tabs1 #tempbox input[name="typeno"]').val(),'no':$('.order#order #tabs1 #tempbox input[name="no"]').val(),'dep':'','number':$('.order#order #tabs1 #tempbox input[name="number"]').val(),'mname':$('.order#order #tabs1 #tempbox input[name="mname1"]').val(),'money1':$('.order#order #tabs1 #tempbox input[name="unitprice"]').val(),'taste':$('.order#order #tabs1 #tempbox input[name="taste1"]').val(),'tastenumber':$('.order#order #tabs1 #tempbox input[name="taste1number"]').val(),'tastemoney':$('.order#order #tabs1 #tempbox input[name="taste1money"]').val(),'subtotal':$('.order#order #tabs1 #tempbox input[name="subtotal"]').val()},
				async: false,
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'writeitem.ajax.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
				},
				error:function(e){
					//console.log(e);
				}
			});
		}
		else{
		}
	};
	$('.order#order #numbox').on('click','input',function(){//點選中間數字鍵
		var tabs=changetagtarget();
		var disindex=$('.result #funbox button[class^="listdisbut"]').index(this);
		var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
		if($.trim($('.order#order #tabs1 #tempbox input[name="name"]').val()).length<=0){
		}
		else{
			if(tabs=='tabs4'){
				diff();
				var index=$('.order#order #numbox input').index(this);
				if(index==1){
					if($('.order#order #numbox input[type="button"]:eq(0)').val()=='number'){
						if($('.order#order #numbox input[name="type"]').val()=='new'){
							$('.order#order #numbox input[name="type"]').val('old');
						}
						else{
							$('.order#order #tabs1 #tempbox input[name="number"]').val($('.order#order #tabs1 #tempbox input[name="number"]').val()+$('.order#order #numbox input:eq('+index+')').val());
						}
					}
					else{
						if(Number($('.order#order #tabs1 #tempbox input[name="unitprice"]').val())==0){
							$('.order#order #tabs1 #tempbox input[name="unitprice"]').val($('.order#order #numbox input:eq('+index+')').val());
						}
						else{
							$('.order#order #tabs1 #tempbox input[name="unitprice"]').val($('.order#order #tabs1 #tempbox input[name="unitprice"]').val()+Number($('.order#order #numbox input:eq('+index+')').val()));
						}
						$('.order#order #tabs1 #tempbox input[name="money"]').val(Number($('.order#order #tabs1 #tempbox input[name="taste1money"]').val())+Number($('.order#order #tabs1 #tempbox input[name="unitprice"]').val()));
					}
				}
				else if(index<10){
					if($('.order#order #numbox input[type="button"]:eq(0)').val()=='number'){
						if($('.order#order #numbox input[name="type"]').val()=='new'){
							$('.order#order #numbox input[name="type"]').val('old');
							if(Number($('.order#order #tabs1 #tempbox input[name="number"]').val())<=1){
								$('.order#order #tabs1 #tempbox input[name="number"]').val($('.order#order #numbox input:eq('+index+')').val());
							}
							else{
								$('.order#order #tabs1 #tempbox input[name="number"]').val($('.order#order #tabs1 #tempbox input[name="number"]').val().toString()+$('.order#order #numbox input:eq('+index+')').val().toString());
							}
						}
						else{
							$('.order#order #tabs1 #tempbox input[name="number"]').val($('.order#order #tabs1 #tempbox input[name="number"]').val().toString()+$('.order#order #numbox input:eq('+index+')').val().toString());
						}
						/*if(Number($('.order#order #tabs1 #tempbox input[name="number"]').val())==1){
							$('.order#order #tabs1 #tempbox input[name="number"]').val($('.order#order #numbox input:eq('+index+')').val());
						}
						else{
							$('.order#order #tabs1 #tempbox input[name="number"]').val($('.order#order #tabs1 #tempbox input[name="number"]').val()+Number($('.order#order #numbox input:eq('+index+')').val()));
						}*/
					}
					else{
						if(Number($('.order#order #tabs1 #tempbox input[name="unitprice"]').val())==0){
							$('.order#order #tabs1 #tempbox input[name="unitprice"]').val($('.order#order #numbox input:eq('+index+')').val());
						}
						else{
							$('.order#order #tabs1 #tempbox input[name="unitprice"]').val($('.order#order #tabs1 #tempbox input[name="unitprice"]').val()+Number($('.order#order #numbox input:eq('+index+')').val()));
						}
						$('.order#order #tabs1 #tempbox input[name="money"]').val(Number($('.order#order #tabs1 #tempbox input[name="taste1money"]').val())+Number($('.order#order #tabs1 #tempbox input[name="unitprice"]').val()));
					}
				}
				else if(index==10){
					if($('.order#order #numbox input[type="button"]:eq(0)').val()=='number'){
						if($('.order#order #numbox input[name="type"]').val()=='new'){
						}
						else{
							$('.order#order #tabs1 #tempbox input[name="number"]').val($('.order#order #tabs1 #tempbox input[name="number"]').val()+Number($('.order#order #numbox input:eq('+index+')').val()));
						}
						//$('.order#order #tabs1 #tempbox input[name="number"]').val($('.order#order #tabs1 #tempbox input[name="number"]').val()+Number($('.order#order #numbox input:eq('+index+')').val()));
					}
					else{
						if(Number($('.order#order #tabs1 #tempbox input[name="unitprice"]').val())==0){
						}
						else{
							$('.order#order #tabs1 #tempbox input[name="unitprice"]').val($('.order#order #tabs1 #tempbox input[name="unitprice"]').val()+Number($('.order#order #numbox input:eq('+index+')').val()));
						}
						$('.order#order #tabs1 #tempbox input[name="money"]').val(Number($('.order#order #tabs1 #tempbox input[name="taste1money"]').val())+Number($('.order#order #tabs1 #tempbox input[name="unitprice"]').val()));
					}
				}
				else if(index==11){
					if($('.order#order #numbox input[type="button"]:eq(0)').val()=='number'){
						if($('.order#order #numbox input[name="type"]').val()=='new'){
							$('.order#order #numbox input[name="type"]').val('old');
						}
						else{
						}
						$('.order#order #tabs1 #tempbox input[name="number"]').val(Number($('.order#order #tabs1 #tempbox input[name="number"]').val())+1);
					}
					else{
						$('.order#order #tabs1 #tempbox input[name="unitprice"]').val(Number($('.order#order #tabs1 #tempbox input[name="unitprice"]').val())+1);
						$('.order#order #tabs1 #tempbox input[name="money"]').val(Number($('.order#order #tabs1 #tempbox input[name="taste1money"]').val())+Number($('.order#order #tabs1 #tempbox input[name="unitprice"]').val()));
					}
				}
				else if(index==12){
					if($('.order#order #numbox input[type="button"]:eq(0)').val()=='number'){
						if($('.order#order #numbox input[name="type"]').val()=='new'){
							$('.order#order #numbox input[name="type"]').val('old');
						}
						else{
						}
						if((Number($('.order#order #tabs1 #tempbox input[name="number"]').val())-1)>1){
							$('.order#order #tabs1 #tempbox input[name="number"]').val(Number($('.order#order #tabs1 #tempbox input[name="number"]').val())-1);
						}
						else{
							$('.order#order #numbox input[name="type"]').val('new');
							$('.order#order #tabs1 #tempbox input[name="number"]').val(1);
						}
					}
					else{
						if((Number($('.order#order #tabs1 #tempbox input[name="unitprice"]').val())-1)>=0){
							$('.order#order #tabs1 #tempbox input[name="unitprice"]').val(Number($('.order#order #tabs1 #tempbox input[name="unitprice"]').val())-1);
						}
						else{
							$('.order#order #tabs1 #tempbox input[name="unitprice"]').val(0);
						}
						$('.order#order #tabs1 #tempbox input[name="money"]').val(Number($('.order#order #tabs1 #tempbox input[name="taste1money"]').val())+Number($('.order#order #tabs1 #tempbox input[name="unitprice"]').val()));
					}
				}
				if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
					$('.order#order #tabs1 #tempbox input[name="money"]').val( roundfun($('.order#order #tabs1 #tempbox input[name="money"]').val(),precision));
				}
				else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
					$('.order#order #tabs1 #tempbox input[name="money"]').val( ceilfun($('.order#order #tabs1 #tempbox input[name="money"]').val(),precision));
				}
				else{//無條件捨去
					$('.order#order #tabs1 #tempbox input[name="money"]').val( floorfun($('.order#order #tabs1 #tempbox input[name="money"]').val(),precision));
				}
				$('.order#order #tabs1 #tempbox input[name="subtotal"]').val(Number($('.order#order #tabs1 #tempbox input[name="number"]').val())*Number($('.order#order #tabs1 #tempbox input[name="money"]').val()));
				if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
					$('.order#order #tabs1 #tempbox input[name="subtotal"]').val( roundfun($('.order#order #tabs1 #tempbox input[name="subtotal"]').val(),precision));
				}
				else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
					$('.order#order #tabs1 #tempbox input[name="subtotal"]').val( ceilfun($('.order#order #tabs1 #tempbox input[name="subtotal"]').val(),precision));
				}
				else{//無條件捨去
					$('.order#order #tabs1 #tempbox input[name="subtotal"]').val( floorfun($('.order#order #tabs1 #tempbox input[name="subtotal"]').val(),precision));
				}
				$('.order#order #tabs1 #tempbox input[name="discount"]').val('0');
				$('.order#order #tabs1 #tempbox input[name="discontent"]').val('');
				$('.order#order #editview').trigger('change');
				sumsubtotal();
			}
			else{
				//套餐設定時，先設定單一套餐後，再到外層(tabs4)設定數量，因此在內層(tabs5)不用設定數量
			}
		}
	});
	$('.order#order #numbox').on('click','button',function(){
		var tabs=changetagtarget();
		if($.trim($('.order#order #tabs1 #tempbox input[name="name"]').val()).length<=0){
		}
		else{
			if(tabs=='tabs4'){
				diff();
				var index=$('.order#order #numbox button').index(this);
				if(index==0){
					if($('.order#order #numbox input:eq(0)').val()=='number'){
						$('.order#order #numbox input[name="type"]').val('new');
						$('.order#order #tabs1 #tempbox input[name="number"]').val(1);
					}
					else{
						$('.order#order #tabs1 #tempbox input[name="unitprice"]').val(0);
						$('.order#order #tabs1 #tempbox input[name="money"]').val(Number($('.order#order #tabs1 #tempbox input[name="taste1money"]').val())+Number($('.order#order #tabs1 #tempbox input[name="unitprice"]').val()));
					}
				}
				else{
					/*if($('.order#order #numbox input[type="button"]:eq(0)').val()=='number'){
						$('.order#order #numbox input:eq(0)').val('money');
						$('.order#order #numbox button:eq(1) #name').html('確認金額');
					}
					else{
						$('.order#order #numbox input:eq(0)').val('number');
						$('.order#order #numbox button:eq(1) #name').html('$');
					}*/
					$('.openmoney #view #money').html($('.order#order #tabs1 #tempbox input[name="unitprice"]').val());
					openmoney.dialog('open');
				}
				$('.order#order #tabs1 #tempbox input[name="subtotal"]').val(Number($('.order#order #tabs1 #tempbox input[name="number"]').val())*Number($('.order#order #tabs1 #tempbox input[name="money"]').val()));
				$('.order#order #tabs1 #tempbox input[name="discount"]').val('0');
				$('.order#order #tabs1 #tempbox input[name="discontent"]').val('');
				$('.order#order #editview').trigger('change');
				sumsubtotal();
			}
			else{
				//套餐設定時，先設定單一套餐後，再到外層(tabs4)設定數量，因此在內層(tabs5)不用設定數量
			}
		}
	});
	$('.order#order #menubox #itemfun').on('click','button[class^="itemmname"]',function(){//點選產品價格
		if($.trim($('.order#order #tabs1 #tempbox input[name="name"]').val()).length<=0){
		}
		else{
			switch($('.order#order #menubox #itemfun button[class^="itemmname"]').index(this)){
				case 0://第一項價格
					if($('.order#order #menubox #itemfun .itemmname1 div#name1').html()==''&&$('.order#order #menubox #itemfun .itemmoney1').val()==''){
					}
					else{
						diff();
						$('.order#order #tabs1 #tempbox input[name="mname1"]').val($('.order#order #menubox #itemfun .itemmname1 div#name1').html());
						$('.order#order #tabs1 #tempbox input[name="mname2"]').val($('.order#order #menubox #itemfun .itemmname1 div#name2').html());
						$('.order#order #tabs1 #tempbox input[name="unitprice"]').val($('.order#order #menubox #itemfun .itemmoney1').val());
					}
					break;
				case 1://第二項價格
					if($('.order#order #menubox #itemfun .itemmname2 div#name1').html()==''&&$('.order#order #menubox #itemfun .itemmoney2').val()==''){
					}
					else{
						diff();
						$('.order#order #tabs1 #tempbox input[name="mname1"]').val($('.order#order #menubox #itemfun .itemmname2 div#name1').html());
						$('.order#order #tabs1 #tempbox input[name="mname2"]').val($('.order#order #menubox #itemfun .itemmname2 div#name2').html());
						$('.order#order #tabs1 #tempbox input[name="unitprice"]').val($('.order#order #menubox #itemfun .itemmoney2').val());
					}
					break;
				case 2://第三項價格
					if($('.order#order #menubox #itemfun .itemmname3 div#name1').html()==''&&$('.order#order #menubox #itemfun .itemmoney3').val()==''){
					}
					else{
						diff();
						$('.order#order #tabs1 #tempbox input[name="mname1"]').val($('.order#order #menubox #itemfun .itemmname3 div#name1').html());
						$('.order#order #tabs1 #tempbox input[name="mname2"]').val($('.order#order #menubox #itemfun .itemmname3 div#name2').html());
						$('.order#order #tabs1 #tempbox input[name="unitprice"]').val($('.order#order #menubox #itemfun .itemmoney3').val());
					}
					break;
				case 3://第四項價格
					if($('.order#order #menubox #itemfun .itemmname4 div#name1').html()==''&&$('.order#order #menubox #itemfun .itemmoney4').val()==''){
					}
					else{
						diff();
						$('.order#order #tabs1 #tempbox input[name="mname1"]').val($('.order#order #menubox #itemfun .itemmname4 div#name1').html());
						$('.order#order #tabs1 #tempbox input[name="mname2"]').val($('.order#order #menubox #itemfun .itemmname4 div#name2').html());
						$('.order#order #tabs1 #tempbox input[name="unitprice"]').val($('.order#order #menubox #itemfun .itemmoney4').val());
					}
					break;
				case 4://第五項價格
					if($('.order#order #menubox #itemfun .itemmname5 div#name1').html()==''&&$('.order#order #menubox #itemfun .itemmoney5').val()==''){
					}
					else{
						diff();
						$('.order#order #tabs1 #tempbox input[name="mname1"]').val($('.order#order #menubox #itemfun .itemmname5 div#name1').html());
						$('.order#order #tabs1 #tempbox input[name="mname2"]').val($('.order#order #menubox #itemfun .itemmname5 div#name2').html());
						$('.order#order #tabs1 #tempbox input[name="unitprice"]').val($('.order#order #menubox #itemfun .itemmoney5').val());
					}
					break;
				case 5://第六項價格
					if($('.order#order #menubox #itemfun .itemmname6 div#name1').html()==''&&$('.order#order #menubox #itemfun .itemmoney6').val()==''){
					}
					else{
						diff();
						$('.order#order #tabs1 #tempbox input[name="mname1"]').val($('.order#order #menubox #itemfun .itemmname6 div#name1').html());
						$('.order#order #tabs1 #tempbox input[name="mname2"]').val($('.order#order #menubox #itemfun .itemmname6 div#name2').html());
						$('.order#order #tabs1 #tempbox input[name="unitprice"]').val($('.order#order #menubox #itemfun .itemmoney6').val());
					}
					break;
				default:
					break;
			}
			$('.order#order #tabs1 #tempbox input[name="money"]').val(Number($('.order#order #tabs1 #tempbox input[name="unitprice"]').val())+Number($('.order#order #tabs1 #tempbox input[name="taste1money"]').val()));
			$('.order#order #tabs1 #tempbox input[name="subtotal"]').val(Number($('.order#order #tabs1 #tempbox input[name="number"]').val())*Number($('.order#order #tabs1 #tempbox input[name="money"]').val())-Number($('.order#order #tabs1 #tempbox input[name="discount"]').val()));
			$('.order#order #editview').trigger('change');
			updateview();
			sumsubtotal();
		}
	});
	$('.order#order #menubox #itemfun').on('click','button[id^="taste"]',function(){//點選產品前十項備註與加料
		if($.trim($('.order#order #tabs1 #tempbox input[name="name"]').val()).length<=0){
		}
		else{
			var temptaste=[],temptaste1=[];
			var tempname1=[];
			var tempprice=[];
			var tempnumber=[];
			var tempcolor=[];
			var tasteindex=$('.order#order #menubox #itemfun button[id^="taste"]').index(this);
			if($('.order#order #menubox #itemfun .tasteno'+tasteindex).val()==''&&$('.order#order #menubox #itemfun .tasteprice'+tasteindex).val()==''){
			}
			else{
				if($('.order#order #tabs1 #tempbox input[name="taste1"]').val().length>0){
					temptaste=$('.order#order #tabs1 #tempbox input[name="taste1"]').val().split(',');
					temptaste1=$('.order#order #tabs1 #tempbox input[name="taste1"]').val().split(',');
					tempname1=$('.order#order #tabs1 #tempbox input[name="taste1name"]').val().split(',');
					tempprice=$('.order#order #tabs1 #tempbox input[name="taste1price"]').val().split(',');
					tempnumber=$('.order#order #tabs1 #tempbox input[name="taste1number"]').val().split(',');
					tempcolor=$('.order#order #tabs1 #tempbox input[name="background"]').val().split(',');
				}
				else{
				}
				if($.inArray($('.order#order #menubox #itemfun .tasteno'+tasteindex).val(),temptaste)>=0){
					var deleteindex=$.inArray($('.order#order #menubox #itemfun .tasteno'+tasteindex).val(),temptaste);
					temptaste.splice(deleteindex,1);
					temptaste1.splice(deleteindex,1);
					tempname1.splice(deleteindex,1);
					tempprice.splice(deleteindex,1);
					tempnumber.splice(deleteindex,1);
					tempcolor.splice(deleteindex,1);
					$('.order#order #tabs1 #tempbox input[name="taste1money"]').val(Number($('.order#order #tabs1 #tempbox input[name="taste1money"]').val())-Number($('.order#order #menubox #itemfun .tasteprice'+tasteindex).val()));
					/*if(tempprice[$.inArray($('.order#order #menubox #itemfun .tasteno'+tasteindex).val(),temptaste)]=='0'){
					}
					else{
						tempnumber[$.inArray($('.order#order #menubox #itemfun .tasteno'+tasteindex).val(),temptaste)]=Number(tempnumber[$.inArray($('.order#order #menubox #itemfun .tasteno'+tasteindex).val(),temptaste)])+1;
					}*/
				}
				else{
					temptaste.push($('.order#order #menubox #itemfun .tasteno'+tasteindex).val().toString());
					temptaste1.push($('.order#order #menubox #itemfun .tasteno'+tasteindex).val().toString());
					if($('.order#order #menubox #itemfun #taste'+tasteindex+' div#name2').html().length==0){
						tempname1.push($('.order#order #menubox #itemfun #taste'+tasteindex+' div#name1').html());
					}
					else{
						tempname1.push($('.order#order #menubox #itemfun #taste'+tasteindex+' div#name1').html()+' /'+$('.order#order #menubox #itemfun #taste'+tasteindex+' div#name2').html());
					}
					tempprice.push($('.order#order #menubox #itemfun .tasteprice'+tasteindex).val());
					tempnumber.push('1');
					tempcolor.push($('.order#order #menubox #itemfun #background'+tasteindex).val());
					$('.order#order #tabs1 #tempbox input[name="taste1money"]').val(Number($('.order#order #tabs1 #tempbox input[name="taste1money"]').val())+Number($('.order#order #menubox #itemfun .tasteprice'+tasteindex).val()));
				}
			}
			var tasteno='',tastename1='',tastename3='',tasteprice='',tastenumber='',tastecolor='';
			var sorttemp=quicksort(temptaste1);
			diff();
			$.each(sorttemp,function(index,value){
				if(tasteno.length>0){
					tasteno=tasteno+','+value;
					if(tempnumber[$.inArray(value,temptaste)]>2){
						if($('.order#order #menubox #itemfun .tasteno'+tasteindex).val()==value){
							tastename1=tastename1+','+tempname1[$.inArray(value,temptaste)].substr(0,(tempname1[$.inArray(value,temptaste)].toString().length-Number((Number(tempnumber[$.inArray(value,temptaste)])-1).toString().length+1)))+'*'+tempnumber[$.inArray(value,temptaste)];
							tastename3=tastename3+'<br>&nbsp;&nbsp;&nbsp;&nbsp;+'+tempname1[$.inArray(value,temptaste)].substr(0,(tempname1[$.inArray(value,temptaste)].toString().length-Number((Number(tempnumber[$.inArray(value,temptaste)])-1).toString().length+1)))+'*'+tempnumber[$.inArray(value,temptaste)];
						}
						else{
							tastename1=tastename1+','+tempname1[$.inArray(value,temptaste)];
							tastename3=tastename3+'<br>&nbsp;&nbsp;&nbsp;&nbsp;+'+tempname1[$.inArray(value,temptaste)];
						}
						tasteprice=tasteprice+','+tempprice[$.inArray(value,temptaste)];
						tastenumber=tastenumber+','+tempnumber[$.inArray(value,temptaste)];
						tastecolor=tastecolor+','+tempcolor[$.inArray(value,temptaste)];
					}
					else if(tempnumber[$.inArray(value,temptaste)]=='1' || tempnumber[$.inArray(value,temptaste)]=='2'){
						if(tempnumber[$.inArray(value,temptaste)]=='2'){
							tastename1=tastename1+','+tempname1[$.inArray(value,temptaste)]+'*2';
							tastename3=tastename3+'<br>&nbsp;&nbsp;&nbsp;&nbsp;+'+tempname1[$.inArray(value,temptaste)]+'*2';
						}
						else{
							tastename1=tastename1+','+tempname1[$.inArray(value,temptaste)];
							tastename3=tastename3+'<br>&nbsp;&nbsp;&nbsp;&nbsp;+'+tempname1[$.inArray(value,temptaste)];
						}
						tasteprice=tasteprice+','+tempprice[$.inArray(value,temptaste)];
						tastenumber=tastenumber+','+tempnumber[$.inArray(value,temptaste)];
						tastecolor=tastecolor+','+tempcolor[$.inArray(value,temptaste)];
					}
					else{
					}
				}
				else{
					tasteno=tasteno+value;
					if(tempnumber[$.inArray(value,temptaste)]>2){
						if($('.order#order #menubox #itemfun .tasteno'+tasteindex).val()==value){
							tastename1=tastename1+tempname1[$.inArray(value,temptaste)].substr(0,(tempname1[$.inArray(value,temptaste)].toString().length-Number((Number(tempnumber[$.inArray(value,temptaste)])-1).toString().length+1)))+'*'+tempnumber[$.inArray(value,temptaste)];
							tastename3=tastename3+tempname1[$.inArray(value,temptaste)].substr(0,(tempname1[$.inArray(value,temptaste)].toString().length-Number((Number(tempnumber[$.inArray(value,temptaste)])-1).toString().length+1)))+'*'+tempnumber[$.inArray(value,temptaste)];
						}
						else{
							tastename1=tastename1+tempname1[$.inArray(value,temptaste)];
							tastename3=tastename3+tempname1[$.inArray(value,temptaste)];
						}
						tasteprice=tasteprice+tempprice[$.inArray(value,temptaste)];
						tastenumber=tastenumber+tempnumber[$.inArray(value,temptaste)];
						tastecolor=tastecolor+tempcolor[$.inArray(value,temptaste)];
					}
					else if(tempnumber[$.inArray(value,temptaste)]=='1' || tempnumber[$.inArray(value,temptaste)]=='2'){
						if(tempnumber[$.inArray(value,temptaste)]=='2'){
							tastename1=tastename1+tempname1[$.inArray(value,temptaste)]+'*2';
							tastename3=tastename3+tempname1[$.inArray(value,temptaste)]+'*2';
						}
						else{
							tastename1=tastename1+tempname1[$.inArray(value,temptaste)];
							tastename3=tastename3+tempname1[$.inArray(value,temptaste)];
						}
						tasteprice=tasteprice+tempprice[$.inArray(value,temptaste)];
						tastenumber=tastenumber+tempnumber[$.inArray(value,temptaste)];
						tastecolor=tastecolor+tempcolor[$.inArray(value,temptaste)];
					}
					else{
					}
				}
			});
				
			$('.order#order #tabs1 #tempbox input[name="taste1"]').val(tasteno);
			$('.order#order #tabs1 #tempbox input[name="taste1name"]').val(tastename1);
			$('.order#order #tabs1 #tempbox input[name="taste2"]').val(tastename3);
			$('.order#order #tabs1 #tempbox input[name="taste1price"]').val(tasteprice);
			$('.order#order #tabs1 #tempbox input[name="taste1number"]').val(tastenumber);
			$('.order#order #tabs1 #tempbox input[name="background"]').val(tastecolor);
			//console.log($('.order#order #tabs1 #tempbox input[name="taste1money"]').val());
			if(Number($('.order#order #tabs1 #tempbox input[name="unitprice"]').val())+Number($('.order#order #tabs1 #tempbox input[name="taste1money"]').val())<=0){
				$('.order#order #tabs1 #tempbox input[name="money"]').val(0);
			}
			else{
				$('.order#order #tabs1 #tempbox input[name="money"]').val(Number($('.order#order #tabs1 #tempbox input[name="unitprice"]').val())+Number($('.order#order #tabs1 #tempbox input[name="taste1money"]').val()));
			}
			$('.order#order #tabs1 #tempbox input[name="subtotal"]').val(Number($('.order#order #tabs1 #tempbox input[name="money"]').val())*Number($('.order#order #tabs1 #tempbox input[name="number"]').val())-Number($('.order#order #tabs1 #tempbox input[name="discount"]').val()));
			$('.order#order #editview').trigger('change');
			updateview();
			
			/*if(tabs=='tabs5'){
			}
			else{*/
				sumsubtotal();
			//}
		}
	});
	function diff(){//變更前回復狀態
		var index=$('.order#order #tabs1 #tempbox input[name="target"]').val();
		var tabs=changetagtarget();
		if(index>=0){
			if(tabs=='tabs4'){
				if($('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="order[]"]').val()=='－'){
					var index2=index;
					var index3=(index-1);
					while($('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="order[]"]').val()=='－'){
						$('.order#order #'+tabs+' .listcontent input[name^="number"]:eq('+index2+')').val('0');
						$('.order#order #'+tabs+' .listcontent input[name^="subtotal"]:eq('+index2+')').val('0');

						$('.order#order #'+tabs+' .listcontent .label:eq('+index2+') #number').html('0');
						$('.order#order #'+tabs+' .listcontent .label:eq('+index2+') #subtotal').html('0');
						index2++;
					}
					while($('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="order[]"]').val()=='－'){
						$('.order#order #'+tabs+' .listcontent input[name^="number"]:eq('+index3+')').val('0');
						$('.order#order #'+tabs+' .listcontent input[name^="subtotal"]:eq('+index3+')').val('0');

						$('.order#order #'+tabs+' .listcontent .label:eq('+index3+') #number').html('0');
						$('.order#order #'+tabs+' .listcontent .label:eq('+index3+') #subtotal').html('0');
						index3--;
					}
					$('.order#order #'+tabs+' .listcontent input[name^="number"]:eq('+index3+')').val(Number($('.order#order #'+tabs+' .listcontent input[name^="number"]:eq('+index3+')').val())-Number($('.order#order #tabs1 #tempbox input[name="number"]').val()));
					$('.order#order #'+tabs+' .listcontent input[name^="subtotal"]:eq('+index3+')').val(Number($('.order#order #'+tabs+' .listcontent input[name^="subtotal"]:eq('+index3+')').val())-(Number($('.order#order #'+tabs+' .listcontent input[name^="money"]:eq('+index3+')').val())*Number($('.order#order #tabs1 #tempbox input[name="number"]').val())));

					$('.order#order #'+tabs+' .listcontent .label:eq('+index3+') #number').html($('.order#order #'+tabs+' .listcontent input[name^="number"]:eq('+index3+')').val());
					$('.order#order #'+tabs+' .listcontent .label:eq('+index3+') #subtotal').html($('.order#order #'+tabs+' .listcontent input[name^="subtotal"]:eq('+index3+')').val());
					//console.log('未加入人頭數量回復');
				}
				else if($('.order#order #'+tabs+' .listcontent .label:eq('+(Number(index)+1)+') input[name="order[]"]').val()=='－'){
					var index2=Number(index)+1;
					$('.order#order #'+tabs+' .listcontent input[name^="number"]:eq('+index+')').val('0');
					$('.order#order #'+tabs+' .listcontent input[name^="subtotal"]:eq('+index+')').val('0');

					$('.order#order #'+tabs+' .listcontent .label:eq('+index+') #number').html('0');
					$('.order#order #'+tabs+' .listcontent .label:eq('+index+') #subtotal').html('0');
					while($('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="order[]"]').val()=='－'){
						$('.order#order #'+tabs+' .listcontent input[name^="number"]:eq('+index2+')').val('0');
						$('.order#order #'+tabs+' .listcontent input[name^="subtotal"]:eq('+index2+')').val('0');

						$('.order#order #'+tabs+' .listcontent .label:eq('+index2+') #number').html('0');
						$('.order#order #'+tabs+' .listcontent .label:eq('+index2+') #subtotal').html('0');
						index2++;
					}
					//console.log('未加入人頭數量回復');
				}
				else{
					$('.order#order #'+tabs+' .listcontent input[name^="number"]:eq('+index+')').val('0');
					$('.order#order #'+tabs+' .listcontent input[name^="subtotal"]:eq('+index+')').val('0');

					$('.order#order #'+tabs+' .listcontent .label:eq('+index+') #number').html('0');
					$('.order#order #'+tabs+' .listcontent .label:eq('+index+') #subtotal').html('0');

					if($('.setperson #view input[name="persons'+$('.order#order #'+tabs+' .listcontent input[name^="personcount"]:eq('+index+')').val()+'"]').length>0){
						$('.setperson #view input[name="persons'+$('.order#order #'+tabs+' .listcontent input[name^="personcount"]:eq('+index+')').val()+'"]').val(parseInt($('.setperson #view input[name="persons'+$('.order#order #'+tabs+' .listcontent input[name^="personcount"]:eq('+index+')').val()+'"]').val())-parseInt($('.order#order #tabs1 #tempbox input[name="number"]').val()));
					}
					else{
					}
				}
			}
			else{
				$('.order#order #'+tabs+' .listcontent input[name^="number"]:eq('+index+')').val(Number($('.order#order #'+tabs+' .listcontent input[name^="number"]:eq('+index+')').val())-Number($('.order#order #tabs1 #tempbox input[name="number"]').val()));
				$('.order#order #'+tabs+' .listcontent input[name^="subtotal"]:eq('+index+')').val(Number($('.order#order #'+tabs+' .listcontent input[name^="subtotal"]:eq('+index+')').val())-(Number($('.order#order #'+tabs+' .listcontent input[name^="money"]:eq('+index+')').val())*Number($('.order#order #tabs1 #tempbox input[name="number"]').val())));

				$('.order#order #'+tabs+' .listcontent .label:eq('+index+') #number').html($('.order#order #'+tabs+' .listcontent input[name^="number"]:eq('+index+')').val());
				$('.order#order #'+tabs+' .listcontent .label:eq('+index+') #subtotal').html($('.order#order #'+tabs+' .listcontent input[name^="subtotal"]:eq('+index+')').val());

				if($('.setperson #view input[name="persons'+$('.order#order #'+tabs+' .listcontent input[name^="personcount"]:eq('+index+')').val()+'"]').length>0){
					$('.setperson #view input[name="persons'+$('.order#order #'+tabs+' .listcontent input[name^="personcount"]:eq('+index+')').val()+'"]').val(parseInt($('.setperson #view input[name="persons'+$('.order#order #'+tabs+' .listcontent input[name^="personcount"]:eq('+index+')').val()+'"]').val())-parseInt($('.order#order #tabs1 #tempbox input[name="number"]').val()));
				}
				else{
				}
			}
		}
		else{
		}
	};
	$('.order#order #tabs1').on('change','#editview',function(){//變更後增加
		var tabs=changetagtarget();
		if($('.order#order #'+tabs+' .listcontent .label').length==0){
			if($('.order#order #tabs1 #tempbox input[name="isgroup"]').val()=='－'){
				$('.order#order #'+tabs+' .listcontent').append("<div class='label focus' style='width:100%;border-top:1px solid #dfdfdf;'><input type='hidden' name='linenumber[]' value='"+$('.order#order #tabs1 #tempbox input[name="linenumber"]').val()+"'><input type='hidden' name='order[]' value='－'><input type='hidden' name='typeno[]' value='"+$('.order#order #tabs1 #tempbox input[name="typeno"]').val()+"'><input type='hidden' name='type[]' value='"+$('.order#order #tabs1 #tempbox input[name="type"]').val()+"'><input type='hidden' name='no[]' value='"+$('.order#order #tabs1 #tempbox input[name="no"]').val()+"'><input type='hidden' name='needcharge[]' value='"+$('.order#order #tabs1 #tempbox input[name="needcharge"]').val()+"'><input type='hidden' name='personcount[]' value='"+$('.order#order #tabs1 #tempbox input[name="personcount"]').val()+"'><input type='hidden' name='dis1[]' value='"+$('.order#order #tabs1 #tempbox input[name="dis1"]').val()+"'><input type='hidden' name='dis2[]' value='"+$('.order#order #tabs1 #tempbox input[name="dis2"]').val()+"'><input type='hidden' name='dis3[]' value='"+$('.order#order #tabs1 #tempbox input[name="dis3"]').val()+"'><input type='hidden' name='dis4[]' value='"+$('.order#order #tabs1 #tempbox input[name="dis4"]').val()+"'><input type='hidden' name='name[]' value='"+$('.order#order #tabs1 #tempbox input[name="name"]').val()+"'><input type='hidden' name='name2[]' value='"+$('.order#order #tabs1 #tempbox input[name="name2"]').val()+"'><input type='hidden' name='isgroup[]' value='0'><input type='hidden' name='childtype[]' value='"+$('.order#order #tabs1 #tempbox input[name="childtype"]').val()+"'><input type='hidden' name='mname1[]' value='"+$('.order#order #tabs1 #tempbox input[name="mname1"]').val()+"'><input type='hidden' name='mname2[]' value='"+$('.order#order #tabs1 #tempbox input[name="mname2"]').val()+"'><input type='hidden' name='insaleinv[]' value='"+$('.order#order #tabs1 #tempbox input[name="insaleinv"]').val()+"'><input type='hidden' name='unitprice[]' value='"+$('.order#order #tabs1 #tempbox input[name="money"]').val()+"'><input type='hidden' name='money[]' value='"+$('.order#order #tabs1 #tempbox input[name="money"]').val()+"'><input type='hidden' name='discount[]' value='0'><input type='hidden' name='discontent[]' value=''><input type='hidden' name='number[]' value='1'><input type='hidden' name='subtotal[]' value='"+$('.order#order #tabs1 #tempbox input[name="money"]').val()+"'><input type='hidden' name='taste1[]' value=''><input type='hidden' name='taste1name[]' value=''><input type='hidden' name='taste1price[]' value=''><input type='hidden' name='taste1number[]' value=''><input type='hidden' name='taste1money[]' value='0'><div style='width:3%;padding:3px 0;'><input type='checkbox' id='checkbox[]'></div><div style='width:10%;padding:3px 0 3px 3px;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;'>1</div><div style='width:calc(57%);padding:3px 0;' id='view'>"+$('.order#order #tabs1 #tempbox input[name="name"]').val()+$('.order#order #tabs1 #tempbox input[name="name2"]').val()+"("+$('.order#order #tabs1 #tempbox input[name="mname1"]').val()+")</div><div style='width:10%;text-align:right;padding:3px 0;' id='unitprice'>"+$('.result .frontunit').val()+$('.order#order #tabs1 #tempbox input[name="unitprice"]').val()+$('.result .unit').val()+"</div><div style='width:10%;text-align:center;padding:3px 0;' id='number'>1</div><div style='width:10%;text-align:right;padding:3px 0;' id='subtotal'>"+$('.result .frontunit').val()+$('.order#order #tabs1 #tempbox input[name="money"]').val()+$('.result .unit').val()+"</div></div>");
			}
			else{
				$('.order#order #'+tabs+' .listcontent').append("<div class='label focus' style='width:100%;border-top:1px solid #dfdfdf;'><input type='hidden' name='linenumber[]' value='"+$('.order#order #tabs1 #tempbox input[name="linenumber"]').val()+"'><input type='hidden' name='order[]' value='1'><input type='hidden' name='typeno[]' value='"+$('.order#order #tabs1 #tempbox input[name="typeno"]').val()+"'><input type='hidden' name='type[]' value='"+$('.order#order #tabs1 #tempbox input[name="type"]').val()+"'><input type='hidden' name='no[]' value='"+$('.order#order #tabs1 #tempbox input[name="no"]').val()+"'><input type='hidden' name='needcharge[]' value='"+$('.order#order #tabs1 #tempbox input[name="needcharge"]').val()+"'><input type='hidden' name='personcount[]' value='"+$('.order#order #tabs1 #tempbox input[name="personcount"]').val()+"'><input type='hidden' name='dis1[]' value='"+$('.order#order #tabs1 #tempbox input[name="dis1"]').val()+"'><input type='hidden' name='dis2[]' value='"+$('.order#order #tabs1 #tempbox input[name="dis2"]').val()+"'><input type='hidden' name='dis3[]' value='"+$('.order#order #tabs1 #tempbox input[name="dis3"]').val()+"'><input type='hidden' name='dis4[]' value='"+$('.order#order #tabs1 #tempbox input[name="dis4"]').val()+"'><input type='hidden' name='name[]' value='"+$('.order#order #tabs1 #tempbox input[name="name"]').val()+"'><input type='hidden' name='name2[]' value='"+$('.order#order #tabs1 #tempbox input[name="name2"]').val()+"'><input type='hidden' name='isgroup[]' value='"+$('.order#order #tabs1 #tempbox input[name="isgroup"]').val()+"'><input type='hidden' name='childtype[]' value='"+$('.order#order #tabs1 #tempbox input[name="childtype"]').val()+"'><input type='hidden' name='mname1[]' value='"+$('.order#order #tabs1 #tempbox input[name="mname1"]').val()+"'><input type='hidden' name='mname2[]' value='"+$('.order#order #tabs1 #tempbox input[name="mname2"]').val()+"'><input type='hidden' name='insaleinv[]' value='"+$('.order#order #tabs1 #tempbox input[name="insaleinv"]').val()+"'><input type='hidden' name='unitprice[]' value='"+$('.order#order #tabs1 #tempbox input[name="money"]').val()+"'><input type='hidden' name='money[]' value='"+$('.order#order #tabs1 #tempbox input[name="money"]').val()+"'><input type='hidden' name='discount[]' value='0'><input type='hidden' name='discontent[]' value=''><input type='hidden' name='number[]' value='1'><input type='hidden' name='subtotal[]' value='"+$('.order#order #tabs1 #tempbox input[name="money"]').val()+"'><input type='hidden' name='taste1[]' value=''><input type='hidden' name='taste1name[]' value=''><input type='hidden' name='taste1price[]' value=''><input type='hidden' name='taste1number[]' value=''><input type='hidden' name='taste1money[]' value='0'><div style='width:3%;padding:3px 0;'><input type='checkbox' id='checkbox[]'></div><div style='width:10%;padding:3px 0 3px 3px;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;'>1</div><div style='width:calc(57%);padding:3px 0;' id='view'>"+$('.order#order #tabs1 #tempbox input[name="name"]').val()+$('.order#order #tabs1 #tempbox input[name="name2"]').val()+"("+$('.order#order #tabs1 #tempbox input[name="mname1"]').val()+")</div><div style='width:10%;text-align:right;padding:3px 0;' id='unitprice'>"+$('.result .frontunit').val()+$('.order#order #tabs1 #tempbox input[name="unitprice"]').val()+$('.result .unit').val()+"</div><div style='width:10%;text-align:center;padding:3px 0;' id='number'>1</div><div style='width:10%;text-align:right;padding:3px 0;' id='subtotal'>"+$('.result .frontunit').val()+$('.order#order #tabs1 #tempbox input[name="money"]').val()+$('.result .unit').val()+"</div></div>");
			}
			//$('.order#order #'+tabs+' .listcontent').append("<div class='label' style='width:100%;border-top:1px solid #dfdfdf;'><input type='hidden' name='linenumber[]' value='"+$('.order#order #tabs1 #tempbox input[name="linenumber"]').val()+"'><input type='hidden' name='order[]' value='1'><input type='hidden' name='typeno[]' value='"+$('.order#order #tabs1 #tempbox input[name="typeno"]').val()+"'><input type='hidden' name='type[]' value='"+$('.order#order #tabs1 #tempbox input[name="type"]').val()+"'><input type='hidden' name='no[]' value='"+$('.order#order #tabs1 #tempbox input[name="no"]').val()+"'><input type='hidden' name='personcount[]' value='"+$('.order#order #tabs1 #tempbox input[name="personcount"]').val()+"'><input type='hidden' name='name[]' value='"+$('.order#order #tabs1 #tempbox input[name="name"]').val()+"'><input type='hidden' name='name2[]' value='"+$('.order#order #tabs1 #tempbox input[name="name2"]').val()+"'><input type='hidden' name='isgroup[]' value='"+$('.order#order #tabs1 #tempbox input[name="isgroup"]').val()+"'><input type='hidden' name='childtype[]' value='"+$('.order#order #tabs1 #tempbox input[name="childtype"]').val()+"'><input type='hidden' name='mname1[]' value='"+$('.order#order #tabs1 #tempbox input[name="mname1"]').val()+"'><input type='hidden' name='mname2[]' value='"+$('.order#order #tabs1 #tempbox input[name="mname2"]').val()+"'><input type='hidden' name='insaleinv[]' value='"+$('.order#order #tabs1 #tempbox input[name="insaleinv"]').val()+"'><input type='hidden' name='unitprice[]' value='"+$('.order#order #tabs1 #tempbox input[name="money"]').val()+"'><input type='hidden' name='money[]' value='"+$('.order#order #tabs1 #tempbox input[name="money"]').val()+"'><input type='hidden' name='discount[]' value='0'><input type='hidden' name='discontent[]' value=''><input type='hidden' name='number[]' value='1'><input type='hidden' name='subtotal[]' value='"+$('.order#order #tabs1 #tempbox input[name="money"]').val()+"'><input type='hidden' name='taste1[]' value=''><input type='hidden' name='taste1name[]' value=''><input type='hidden' name='taste1price[]' value=''><input type='hidden' name='taste1number[]' value=''><input type='hidden' name='taste1money[]' value='0'><div style='width:3%;padding:3px 0;'><input type='checkbox' id='checkbox[]'></div><div style='width:10%;padding:3px 0 3px 3px;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;'>1</div><div style='width:calc(57%);padding:3px 0;' id='view'>"+$('.order#order #tabs1 #tempbox input[name="name"]').val()+$('.order#order #tabs1 #tempbox input[name="name2"]').val()+"("+$('.order#order #tabs1 #tempbox input[name="mname1"]').val()+")</div><div style='width:10%;text-align:right;padding:3px 0;' id='unitprice'>"+$('.result .frontunit').val()+$('.order#order #tabs1 #tempbox input[name="unitprice"]').val()+$('.result .unit').val()+"</div><div style='width:10%;text-align:center;padding:3px 0;' id='number'>1</div><div style='width:10%;text-align:right;padding:3px 0;' id='subtotal'>"+$('.result .frontunit').val()+$('.order#order #tabs1 #tempbox input[name="money"]').val()+$('.result .unit').val()+"</div></div>");
			$('.order#order #numbox input[name="type"]').val('new');
			if($('.order#order #tabs1 #tempbox input[name="isgroup"]').val()!='0'){
				var tempchitype=$('.order#order #tabs1 #tempbox input[name="childtype"]').val().split(',');
				linenumber=$('.order#order #tabs1 #tempbox input[name="linenumber"]').val();
				$.each(tempchitype,function(i,v){
					linenumber=Number(linenumber)+2;
					var tempv=v.split('-');
					if(tempv.length==2&&tempv[1]!=''){
						$.ajax({
							url:'./lib/js/getdetail.child.php',
							method:'post',
							async: false,
							data:{'company':$('.order#order .companydata #company').val(),'type':tempv[0],'item':tempv[1]},
							dataType:'json',
							success:function(d){
								if(d["mname11"]==''){
									var mname='';
								}
								else{
									var mname='('+d["mname11"]+')';
								}
								if(typeof  d['insaleinv'] != "undefined"){
								}
								else{
									d['insaleinv']='1';
								}
								$('.order#order #'+tabs+' .listcontent').append("<div class='label' style='width:100%;border-top:1px solid #dfdfdf;'><input type='hidden' name='linenumber[]' value='"+linenumber+"'><input type='hidden' name='order[]' value='－'><input type='hidden' name='typeno[]' value='"+tempv[0]+"'><input type='hidden' name='type[]' value=''><input type='hidden' name='no[]' value='"+tempv[1]+"'><input type='hidden' name='needcharge[]' value='"+$('.order#order #tabs1 #tempbox input[name="needcharge"]').val()+"'><input type='hidden' name='personcount[]' value='"+$('.order#order #tabs1 #tempbox input[name="personcount"]').val()+"'><input type='hidden' name='dis1[]' value='"+d["dis1"]+"'><input type='hidden' name='dis2[]' value='"+d["dis2"]+"'><input type='hidden' name='dis3[]' value='"+d["dis3"]+"'><input type='hidden' name='dis4[]' value='"+d["dis4"]+"'><input type='hidden' name='name[]' value='"+d['name1']+"'><input type='hidden' name='name2[]' value='"+d['name2']+"'><input type='hidden' name='isgroup[]' value='"+d['isgroup']+"'><input type='hidden' name='childtype[]' value=''><input type='hidden' name='mname1[]' value='"+d['mname11']+"'><input type='hidden' name='mname2[]' value='"+d['mname12']+"'><input type='hidden' name='insaleinv[]' value='"+d["insaleinv"]+"'><input type='hidden' name='unitprice[]' value='"+d['money1']+"'><input type='hidden' name='money[]' value='"+d['money1']+"'><input type='hidden' name='discount[]' value='0'><input type='hidden' name='discontent[]' value=''><input type='hidden' name='number[]' value='1'><input type='hidden' name='subtotal[]' value='"+d['money1']+"'><input type='hidden' name='taste1[]' value=''><input type='hidden' name='taste1name[]' value=''><input type='hidden' name='taste1price[]' value=''><input type='hidden' name='taste1number[]' value=''><input type='hidden' name='taste1money[]' value='0'><div style='width:3%;padding:3px 0;'><input type='checkbox' id='checkbox[]'></div><div style='width:10%;padding:3px 0 3px 3px;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;'>"+($('.order#order #'+tabs+' .listcontent .label').length+1)+"</div><div style='width:calc(57%);padding:3px 0;' id='view'>"+d['name1']+d['name2']+mname+"</div><div style='width:10%;text-align:right;padding:3px 0;' id='unitprice'>"+$('.result .frontunit').val()+d['money1']+$('.result .unit').val()+"</div><div style='width:10%;text-align:center;padding:3px 0;' id='number'>1</div><div style='width:10%;text-align:right;padding:3px 0;' id='subtotal'>"+$('.result .frontunit').val()+d['money1']+$('.result .unit').val()+"</div></div>");
							},
							error:function(e){
								//console.log(e);
							}
						});
					}
					else{
					}
				});
			}
			else{
			}
			$('.order#order #'+tabs+' .listcontentbox').scrollTop($('.order#order #'+tabs+' .listcontent').height());
		}
		else if($('.order#order #tabs1 #tempbox input[name="target"]').val()==$('.order#order #'+tabs+' .listcontent .label').length){
			var targetindex=$('.order#order #'+tabs+' .listcontent .label').length;
			ordernumber=Number(targetindex)+1;
			var nametemp=$('.order#order #tabs1 #tempbox input[name="name"]').val().split(';');
			var nametemp2=$('.order#order #tabs1 #tempbox input[name="name2"]').val().split(';');
			if($('.order#order #tabs1 #tempbox input[name="isgroup"]').val()=='－'){
				$('.order#order #'+tabs+' .listcontent').append("<div class='label focus' style='width:100%;border-top:1px solid #dfdfdf;'><input type='hidden' name='linenumber[]' value='"+$('.order#order #tabs1 #tempbox input[name="linenumber"]').val()+"'><input type='hidden' name='order[]' value='－'><input type='hidden' name='typeno[]' value='"+$('.order#order #tabs1 #tempbox input[name="typeno"]').val()+"'><input type='hidden' name='type[]' value='"+$('.order#order #tabs1 #tempbox input[name="type"]').val()+"'><input type='hidden' name='no[]' value='"+$('.order#order #tabs1 #tempbox input[name="no"]').val()+"'><input type='hidden' name='needcharge[]' value='"+$('.order#order #tabs1 #tempbox input[name="needcharge"]').val()+"'><input type='hidden' name='personcount[]' value='"+$('.order#order #tabs1 #tempbox input[name="personcount"]').val()+"'><input type='hidden' name='dis1[]' value='"+$('.order#order #tabs1 #tempbox input[name="dis1"]').val()+"'><input type='hidden' name='dis2[]' value='"+$('.order#order #tabs1 #tempbox input[name="dis2"]').val()+"'><input type='hidden' name='dis3[]' value='"+$('.order#order #tabs1 #tempbox input[name="dis3"]').val()+"'><input type='hidden' name='dis4[]' value='"+$('.order#order #tabs1 #tempbox input[name="dis4"]').val()+"'><input type='hidden' name='name[]' value='"+$('.order#order #tabs1 #tempbox input[name="name"]').val()+"'><input type='hidden' name='name2[]' value='"+$('.order#order #tabs1 #tempbox input[name="name2"]').val()+"'><input type='hidden' name='isgroup[]' value='0'><input type='hidden' name='childtype[]' value='"+$('.order#order #tabs1 #tempbox input[name="childtype"]').val()+"'><input type='hidden' name='mname1[]' value='"+$('.order#order #tabs1 #tempbox input[name="mname1"]').val()+"'><input type='hidden' name='mname2[]' value='"+$('.order#order #tabs1 #tempbox input[name="mname2"]').val()+"'><input type='hidden' name='insaleinv[]' value='"+$('.order#order #tabs1 #tempbox input[name="insaleinv"]').val()+"'><input type='hidden' name='unitprice[]' value='"+$('.order#order #tabs1 #tempbox input[name="money"]').val()+"'><input type='hidden' name='money[]' value='"+$('.order#order #tabs1 #tempbox input[name="money"]').val()+"'><input type='hidden' name='discount[]' value='0'><input type='hidden' name='discontent[]' value=''><input type='hidden' name='number[]' value='1'><input type='hidden' name='subtotal[]' value='"+$('.order#order #tabs1 #tempbox input[name="money"]').val()+"'><input type='hidden' name='taste1[]' value=''><input type='hidden' name='taste1name[]' value=''><input type='hidden' name='taste1price[]' value=''><input type='hidden' name='taste1number[]' value=''><input type='hidden' name='taste1money[]' value='0'><div style='width:3%;padding:3px 0;'><input type='checkbox' id='checkbox[]'></div><div style='width:10%;padding:3px 0 3px 3px;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;'>"+ordernumber+"</div><div style='width:calc(57%);padding:3px 0;' id='view'>"+nametemp[0]+nametemp2[0]+"("+$('.order#order #tabs1 #tempbox input[name="mname1"]').val()+")</div><div style='width:10%;text-align:right;padding:3px 0;' id='unitprice'>"+$('.result .frontunit').val()+$('.order#order #tabs1 #tempbox input[name="unitprice"]').val()+$('.result .unit').val()+"</div><div style='width:10%;text-align:center;padding:3px 0;' id='number'>1</div><div style='width:10%;text-align:right;padding:3px 0;' id='subtotal'>"+$('.result .frontunit').val()+$('.order#order #tabs1 #tempbox input[name="money"]').val()+$('.result .unit').val()+"</div></div>");
			}
			else{
				$('.order#order #'+tabs+' .listcontent').append("<div class='label focus' style='width:100%;border-top:1px solid #dfdfdf;'><input type='hidden' name='linenumber[]' value='"+$('.order#order #tabs1 #tempbox input[name="linenumber"]').val()+"'><input type='hidden' name='order[]' value='"+ordernumber+"'><input type='hidden' name='typeno[]' value='"+$('.order#order #tabs1 #tempbox input[name="typeno"]').val()+"'><input type='hidden' name='type[]' value='"+$('.order#order #tabs1 #tempbox input[name="type"]').val()+"'><input type='hidden' name='no[]' value='"+$('.order#order #tabs1 #tempbox input[name="no"]').val()+"'><input type='hidden' name='needcharge[]' value='"+$('.order#order #tabs1 #tempbox input[name="needcharge"]').val()+"'><input type='hidden' name='personcount[]' value='"+$('.order#order #tabs1 #tempbox input[name="personcount"]').val()+"'><input type='hidden' name='dis1[]' value='"+$('.order#order #tabs1 #tempbox input[name="dis1"]').val()+"'><input type='hidden' name='dis2[]' value='"+$('.order#order #tabs1 #tempbox input[name="dis2"]').val()+"'><input type='hidden' name='dis3[]' value='"+$('.order#order #tabs1 #tempbox input[name="dis3"]').val()+"'><input type='hidden' name='dis4[]' value='"+$('.order#order #tabs1 #tempbox input[name="dis4"]').val()+"'><input type='hidden' name='name[]' value='"+$('.order#order #tabs1 #tempbox input[name="name"]').val()+"'><input type='hidden' name='name2[]' value='"+$('.order#order #tabs1 #tempbox input[name="name2"]').val()+"'><input type='hidden' name='isgroup[]' value='"+$('.order#order #tabs1 #tempbox input[name="isgroup"]').val()+"'><input type='hidden' name='childtype[]' value='"+$('.order#order #tabs1 #tempbox input[name="childtype"]').val()+"'><input type='hidden' name='mname1[]' value='"+$('.order#order #tabs1 #tempbox input[name="mname1"]').val()+"'><input type='hidden' name='mname2[]' value='"+$('.order#order #tabs1 #tempbox input[name="mname2"]').val()+"'><input type='hidden' name='insaleinv[]' value='"+$('.order#order #tabs1 #tempbox input[name="insaleinv"]').val()+"'><input type='hidden' name='unitprice[]' value='"+$('.order#order #tabs1 #tempbox input[name="money"]').val()+"'><input type='hidden' name='money[]' value='"+$('.order#order #tabs1 #tempbox input[name="money"]').val()+"'><input type='hidden' name='discount[]' value='0'><input type='hidden' name='discontent[]' value=''><input type='hidden' name='number[]' value='1'><input type='hidden' name='subtotal[]' value='"+$('.order#order #tabs1 #tempbox input[name="money"]').val()+"'><input type='hidden' name='taste1[]' value=''><input type='hidden' name='taste1name[]' value=''><input type='hidden' name='taste1price[]' value=''><input type='hidden' name='taste1number[]' value=''><input type='hidden' name='taste1money[]' value='0'><div style='width:3%;padding:3px 0;'><input type='checkbox' id='checkbox[]'></div><div style='width:10%;padding:3px 0 3px 3px;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;'>"+ordernumber+"</div><div style='width:calc(57%);padding:3px 0;' id='view'>"+nametemp[0]+nametemp2[0]+"("+$('.order#order #tabs1 #tempbox input[name="mname1"]').val()+")</div><div style='width:10%;text-align:right;padding:3px 0;' id='unitprice'>"+$('.result .frontunit').val()+$('.order#order #tabs1 #tempbox input[name="unitprice"]').val()+$('.result .unit').val()+"</div><div style='width:10%;text-align:center;padding:3px 0;' id='number'>1</div><div style='width:10%;text-align:right;padding:3px 0;' id='subtotal'>"+$('.result .frontunit').val()+$('.order#order #tabs1 #tempbox input[name="money"]').val()+$('.result .unit').val()+"</div></div>");
			}
			//$('.order#order #'+tabs+' .listcontent').append("<div class='label focus check' style='width:100%;border-top:1px solid #dfdfdf;'><input type='hidden' name='linenumber[]' value='"+$('.order#order #tabs1 #tempbox input[name="linenumber"]').val()+"'><input type='hidden' name='order[]' value='"+ordernumber+"'><input type='hidden' name='typeno[]' value='"+$('.order#order #tabs1 #tempbox input[name="typeno"]').val()+"'><input type='hidden' name='type[]' value='"+$('.order#order #tabs1 #tempbox input[name="type"]').val()+"'><input type='hidden' name='no[]' value='"+$('.order#order #tabs1 #tempbox input[name="no"]').val()+"'><input type='hidden' name='personcount[]' value='"+$('.order#order #tabs1 #tempbox input[name="personcount"]').val()+"'><input type='hidden' name='name[]' value='"+$('.order#order #tabs1 #tempbox input[name="name"]').val()+"'><input type='hidden' name='name2[]' value='"+$('.order#order #tabs1 #tempbox input[name="name2"]').val()+"'><input type='hidden' name='isgroup[]' value='"+$('.order#order #tabs1 #tempbox input[name="isgroup"]').val()+"'><input type='hidden' name='childtype[]' value='"+$('.order#order #tabs1 #tempbox input[name="childtype"]').val()+"'><input type='hidden' name='mname1[]' value='"+$('.order#order #tabs1 #tempbox input[name="mname1"]').val()+"'><input type='hidden' name='mname2[]' value='"+$('.order#order #tabs1 #tempbox input[name="mname2"]').val()+"'><input type='hidden' name='insaleinv[]' value='"+$('.order#order #tabs1 #tempbox input[name="insaleinv"]').val()+"'><input type='hidden' name='unitprice[]' value='"+$('.order#order #tabs1 #tempbox input[name="money"]').val()+"'><input type='hidden' name='money[]' value='"+$('.order#order #tabs1 #tempbox input[name="money"]').val()+"'><input type='hidden' name='discount[]' value='0'><input type='hidden' name='discontent[]' value=''><input type='hidden' name='number[]' value='1'><input type='hidden' name='subtotal[]' value='"+$('.order#order #tabs1 #tempbox input[name="money"]').val()+"'><input type='hidden' name='taste1[]' value=''><input type='hidden' name='taste1name[]' value=''><input type='hidden' name='taste1price[]' value=''><input type='hidden' name='taste1number[]' value=''><input type='hidden' name='taste1money[]' value='0'><div style='width:3%;padding:3px 0;'><input type='checkbox' id='checkbox[]' checked></div><div style='width:10%;padding:3px 0 3px 3px;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;'>"+ordernumber+"</div><div style='width:calc(57%);padding:3px 0;' id='view'>"+nametemp[0]+nametemp2[0]+"("+$('.order#order #tabs1 #tempbox input[name="mname1"]').val()+")</div><div style='width:10%;text-align:right;padding:3px 0;' id='unitprice'>"+$('.result .frontunit').val()+$('.order#order #tabs1 #tempbox input[name="unitprice"]').val()+$('.result .unit').val()+"</div><div style='width:10%;text-align:center;padding:3px 0;' id='number'>1</div><div style='width:10%;text-align:right;padding:3px 0;' id='subtotal'>"+$('.result .frontunit').val()+$('.order#order #tabs1 #tempbox input[name="money"]').val()+$('.result .unit').val()+"</div></div>");
			$('.order#order #numbox input[name="type"]').val('new');
			if(nametemp.length>1){
				var subname=nametemp[1].split('/');
				var subname2=nametemp2[1].split('/');
				for(var i=0;i<subname.length;i++){
					$('.order#order #'+tabs+' .listcontent').append("<div class='label' style='width:100%;border-top:1px solid #dfdfdf;'><input type='hidden' name='order[]' value='－'><input type='hidden' name='typeno[]' value='"+$('.order#order #tabs1 #tempbox input[name="typeno"]').val()+"'><input type='hidden' name='type[]' value='"+$('.order#order #tabs1 #tempbox input[name="type"]').val()+"'><input type='hidden' name='no[]' value='"+$('.order#order #tabs1 #tempbox input[name="no"]').val()+"'><input type='hidden' name='needcharge[]' value='"+$('.order#order #tabs1 #tempbox input[name="needcharge"]').val()+"'><input type='hidden' name='personcount[]' value='"+$('.order#order #tabs1 #tempbox input[name="personcount"]').val()+"'><input type='hidden' name='name[]' value='"+subname[i]+"'><input type='hidden' name='name2[]' value='"+subname2[i]+"'><input type='hidden' name='isgroup[]' value='2'><input type='hidden' name='childtype[]' value=''><input type='hidden' name='mname1[]' value=''><input type='hidden' name='mname2[]' value=''><input type='hidden' name='insaleinv[]' value='"+$('.order#order #tabs1 #tempbox input[name="insaleinv"]').val()+"'><input type='hidden' name='unitprice[]' value='0'><input type='hidden' name='money[]' value='0'><input type='hidden' name='discount[]' value='0'><input type='hidden' name='discontent[]' value=''><input type='hidden' name='number[]' value='1'><input type='hidden' name='subtotal[]' value='0'><input type='hidden' name='taste1[]' value=''><input type='hidden' name='taste1name[]' value=''><input type='hidden' name='taste1price[]' value=''><input type='hidden' name='taste1number[]' value=''><input type='hidden' name='taste1money[]' value='0'><div style='width:3%;padding:3px 0;'><input type='checkbox' id='checkbox[]'></div><div style='width:10%;padding:3px 0 3px 3px;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;'>－</div><div style='width:calc(57%);padding:3px 0;' id='view'>"+subname[i]+subname2[i]+"</div><div style='width:10%;text-align:right;padding:3px 0;' id='unitprice'>0</div><div style='width:10%;text-align:center;padding:3px 0;' id='number'>1</div><div style='width:10%;text-align:right;padding:3px 0;' id='subtotal'>0</div></div>");
				}
			}
			else{
			}
			$('.order#order #'+tabs+' .listcontentbox').scrollTop($('.order#order #'+tabs+' .listcontent').height());
		}
		else{
			var index=$('.order#order #tabs1 #tempbox input[name="target"]').val();
			if(index>=0){
				$('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="mname1[]"]').val($('.order#order #tabs1 #tempbox input[name="mname1"]').val());
				$('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="mname2[]"]').val($('.order#order #tabs1 #tempbox input[name="mname2"]').val());
				$('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="unitprice[]"]').val($('.order#order #tabs1 #tempbox input[name="unitprice"]').val());
				$('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="money[]"]').val($('.order#order #tabs1 #tempbox input[name="money"]').val());
				$('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="discount[]"]').val($('.order#order #tabs1 #tempbox input[name="discount"]').val());
				$('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="discontent[]"]').val($('.order#order #tabs1 #tempbox input[name="discontent"]').val());
				$('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="number[]"]').val($('.order#order #tabs1 #tempbox input[name="number"]').val());
				$('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="subtotal[]"]').val($('.order#order #tabs1 #tempbox input[name="subtotal"]').val());
				$('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="taste1[]"]').val($('.order#order #tabs1 #tempbox input[name="taste1"]').val());
				$('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="taste1name[]"]').val($('.order#order #tabs1 #tempbox input[name="taste1name"]').val());
				$('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="taste2name[]"]').val($('.order#order #tabs1 #tempbox input[name="taste2name"]').val());
				$('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="taste1price[]"]').val($('.order#order #tabs1 #tempbox input[name="taste1price"]').val());
				$('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="taste1number[]"]').val($('.order#order #tabs1 #tempbox input[name="taste1number"]').val());
				$('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="taste1money[]"]').val($('.order#order #tabs1 #tempbox input[name="taste1money"]').val());
				$('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="background[]"]').val($('.order#order #tabs1 #tempbox input[name="background"]').val());

				$('.order#order #'+tabs+' .listcontent .label:eq('+index+') #unitprice').html($('.order#order #'+tabs+' .listcontent input[name^="unitprice"]:eq('+index+')').val());
				$('.order#order #'+tabs+' .listcontent .label:eq('+index+') #number').html($('.order#order #'+tabs+' .listcontent input[name^="number"]:eq('+index+')').val());
				$('.order#order #'+tabs+' .listcontent .label:eq('+index+') #subtotal').html($('.order#order #'+tabs+' .listcontent input[name^="subtotal"]:eq('+index+')').val());
				if(tabs=='tabs4'){
					if($('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="order[]"]').val()=='－'){
						var index2=Number(index)+1;
						var index3=index-1;
						while($('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="order[]"]').val()=='－'){
							$('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="number[]"]').val($('.order#order #tabs1 #tempbox input[name="number"]').val());
							
							$('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="subtotal[]"]').val((Number($('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="money[]"]').val())-Number($('.order#order #'+tabs+' .listcontent .label:eq('+index2+')  input[name="discount[]"]').val()))*Number($('.order#order #tabs1 #tempbox input[name="number"]').val()));
							var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
							/*設定檔內可設定使用何種進位*/
							if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
								$('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="subtotal[]"]').val( roundfun($('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="subtotal[]"]').val(),precision));
							}
							else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
								$('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="subtotal[]"]').val( ceilfun($('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="subtotal[]"]').val(),precision));
							}
							else{//無條件捨去
								$('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="subtotal[]"]').val( floorfun($('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="subtotal[]"]').val(),precision));
							}

							$('.order#order #'+tabs+' .listcontent .label:eq('+index2+') #number').html($('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="number[]"]').val());
							$('.order#order #'+tabs+' .listcontent .label:eq('+index2+') #subtotal').html($('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="subtotal[]"]').val());
							index2++;
						}
						while($('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="order[]"]').val()=='－'){
							$('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="number[]"]').val($('.order#order #tabs1 #tempbox input[name="number"]').val());
							$('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="subtotal[]"]').val((Number($('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="money[]"]').val())-Number($('.order#order #'+tabs+' .listcontent .label:eq('+index3+')  input[name="discount[]"]').val()))*Number($('.order#order #tabs1 #tempbox input[name="number"]').val()));
							var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
							/*設定檔內可設定使用何種進位*/
							if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
								$('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="subtotal[]"]').val( roundfun($('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="subtotal[]"]').val(),precision));
							}
							else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
								$('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="subtotal[]"]').val( ceilfun($('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="subtotal[]"]').val(),precision));
							}
							else{//無條件捨去
								$('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="subtotal[]"]').val( floorfun($('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="subtotal[]"]').val(),precision));
							}
							$('.order#order #'+tabs+' .listcontent .label:eq('+index3+') #number').html($('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="number[]"]').val());
							$('.order#order #'+tabs+' .listcontent .label:eq('+index3+') #subtotal').html($('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="subtotal[]"]').val());
							index3--;
						}
						$('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="number[]"]').val($('.order#order #tabs1 #tempbox input[name="number"]').val());
						$('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="subtotal[]"]').val((Number($('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="money[]"]').val())-Number($('.order#order #'+tabs+' .listcontent .label:eq('+index3+')  input[name="discount[]"]').val()))*Number($('.order#order #tabs1 #tempbox input[name="number"]').val()));
						var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
						/*設定檔內可設定使用何種進位*/
						if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
							$('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="subtotal[]"]').val( roundfun($('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="subtotal[]"]').val(),precision));
						}
						else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
							$('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="subtotal[]"]').val( ceilfun($('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="subtotal[]"]').val(),precision));
						}
						else{//無條件捨去
							$('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="subtotal[]"]').val( floorfun($('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="subtotal[]"]').val(),precision));
						}
						$('.order#order #'+tabs+' .listcontent .label:eq('+index3+') #number').html($('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="number[]"]').val());
						$('.order#order #'+tabs+' .listcontent .label:eq('+index3+') #subtotal').html($('.order#order #'+tabs+' .listcontent .label:eq('+index3+') input[name="subtotal[]"]').val());
					}
					else if($('.order#order #'+tabs+' .listcontent .label:eq('+(Number(index)+1)+') input[name="order[]"]').val()=='－'){
						//console.log('here');
						var index2=Number(index)+1;
						$('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="number[]"]').val($('.order#order #tabs1 #tempbox input[name="number"]').val());
						$('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="subtotal[]"]').val((Number($('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="money[]"]').val())-Number($('.order#order #'+tabs+' .listcontent .label:eq('+index+')  input[name="discount[]"]').val()))*Number($('.order#order #tabs1 #tempbox input[name="number"]').val()));
						var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
						/*設定檔內可設定使用何種進位*/
						if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
							$('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="subtotal[]"]').val( roundfun($('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="subtotal[]"]').val(),precision));
						}
						else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
							$('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="subtotal[]"]').val( ceilfun($('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="subtotal[]"]').val(),precision));
						}
						else{//無條件捨去
							$('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="subtotal[]"]').val( floorfun($('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="subtotal[]"]').val(),precision));
						}
						$('.order#order #'+tabs+' .listcontent .label:eq('+index+') #number').html($('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="number[]"]').val());
						$('.order#order #'+tabs+' .listcontent .label:eq('+index+') #subtotal').html($('.order#order #'+tabs+' .listcontent .label:eq('+index+') input[name="subtotal[]"]').val());
						while($('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="order[]"]').val()=='－'){
							$('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="number[]"]').val($('.order#order #tabs1 #tempbox input[name="number"]').val());
							$('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="subtotal[]"]').val((Number($('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="money[]"]').val())-Number($('.order#order #'+tabs+' .listcontent .label:eq('+index2+')  input[name="discount[]"]').val()))*Number($('.order#order #tabs1 #tempbox input[name="number"]').val()));
							var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
							/*設定檔內可設定使用何種進位*/
							if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
								$('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="subtotal[]"]').val( roundfun($('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="subtotal[]"]').val(),precision));
							}
							else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
								$('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="subtotal[]"]').val( ceilfun($('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="subtotal[]"]').val(),precision));
							}
							else{//無條件捨去
								$('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="subtotal[]"]').val( floorfun($('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="subtotal[]"]').val(),precision));
							}
							$('.order#order #'+tabs+' .listcontent .label:eq('+index2+') #number').html($('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="number[]"]').val());
							$('.order#order #'+tabs+' .listcontent .label:eq('+index2+') #subtotal').html($('.order#order #'+tabs+' .listcontent .label:eq('+index2+') input[name="subtotal[]"]').val());
							index2++;
						}
					}
					else{
					}
				}
				else{
				}
				if($('.order#order #tabs1 #tempbox input[name="personcount"]').length>0){
					if($('.setperson #view input[name="persons'+$('.order#order #tabs1 #tempbox input[name="personcount"]').val()+'"]').length>0){
						$('.setperson #view input[name="persons'+$('.order#order #tabs1 #tempbox input[name="personcount"]').val()+'"]').val(parseInt($('.setperson #view input[name="persons'+$('.order#order #tabs1 #tempbox input[name="personcount"]').val()+'"]').val())+parseInt($('.order#order #tabs1 #tempbox input[name="number"]').val()));
						$('.setperson #buttons #submit').trigger('click');
					}
					else{
					}
				}
				else{
				}
			}
			else{
			}
			//$('.order#order #'+tabs+' .listcontentbox').scrollTop($('.order#order #'+tabs+' .listcontent').height());
		}
	});
	function updateview(){//更新目前點餐狀況
		var tabs=changetagtarget();
		var temp=$('.order#order #tabs1 #tempbox input[name="name"]').val().split(';');
		var temp2=$('.order#order #tabs1 #tempbox input[name="name2"]').val().split(';');
		var tobottom=0;
		if(temp2[0].length==0){
			var s=temp[0];
		}
		else{
			var s=temp[0]+' /'+temp2[0];
		}
		if($('.order#order #tabs1 #tempbox input[name="mname2"]').val()==''){
			var t1=$('.order#order #tabs1 #tempbox input[name="mname1"]').val();
			if($('.order#order #tabs1 #tempbox input[name="mname1"]').val()==''){
				var t3='';
			}
			else{
				var t3='('+$('.order#order #tabs1 #tempbox input[name="mname1"]').val()+')';
			}
		}
		else{
			var t1=$('.order#order #tabs1 #tempbox input[name="mname1"]').val()+' /'+$('.order#order #tabs1 #tempbox input[name="mname2"]').val();
			if($('.order#order #tabs1 #tempbox input[name="mname1"]').val()==''){
				var t3='('+$('.order#order #tabs1 #tempbox input[name="mname2"]').val()+')';
			}
			else{
				var t3='('+$('.order#order #tabs1 #tempbox input[name="mname1"]').val()+' /'+$('.order#order #tabs1 #tempbox input[name="mname2"]').val()+')';
			}

		}
		if($.trim(t1).length>0&&$.trim($('.order#order #tabs1 #tempbox input[name="taste1name"]').val()).length>0){
			t1=t1+','+$('.order#order #tabs1 #tempbox input[name="taste1name"]').val();
		}
		else{
			//t1=t1+$('.order#order #tabs1 #tempbox input[name="taste1name"]').val()+'/'+$('.order#order #tabs1 #tempbox input[name="taste2name"]').val();
		}
		if($.trim($('.order#order #tabs1 #tempbox input[name="taste1name"]').val()).length>0){
			t3=t3+'<br>&nbsp;&nbsp;&nbsp;&nbsp;+'+$('.order#order #tabs1 #tempbox input[name="taste2"]').val();
		}
		else{
		}
		if($.trim(t1).length>0){
			t1='('+t1+')';
		}
		else{
		}
		$('.order#order #tabs1 #editview').val(s+t1);
		if($('.order#order #'+tabs+' .listcontent .label:eq('+$('.order#order #tabs1 #tempbox input[name="target"]').val()+') div:eq(1)').html()==''){
			$('.order#order #'+tabs+' .listcontent .label:eq('+$('.order#order #tabs1 #tempbox input[name="target"]').val()+') #view').html('+'+$('.order#order #tabs1 #editview').val());
		}
		else{
			//$('.order#order #'+tabs+' .listcontent .label:eq('+$('.order#order #tabs1 #tempbox input[name="target"]').val()+') #view').html($('.order#order #tabs1 #editview').val());
			$('.order#order #'+tabs+' .listcontent .label:eq('+$('.order#order #tabs1 #tempbox input[name="target"]').val()+') #view').html(s+t3);
		}
		//console.log($('.order#order #tabs4 .focus').index('#tabs4 .label'));
		if(parseInt($('.order#order #tabs4 .focus').index('#tabs4 .label'))+1==$('.order#order #tabs4 .label').length){
			$('.order#order #'+tabs+' .listcontentbox').scrollTop($('.order#order #'+tabs+' .listcontent').height());
		}
		else{
		}
		/*$.ajax({
			url:'../secview/writeitem.ajax.php',
			method:'post',
			data:{'target':$('.order#order #tabs1 #tempbox input[name="target"]').val(),'usercode':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'username':$('.order#order #tabs4 #listform input[name="username"]').val(),'company':$('.order#order .companydata #company').val(),'listtype':$('.order#order #tabs4 #listform input[name="listtype"]').val(),'machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'itemtype':$('.order#order #tabs1 #tempbox input[name="typeno"]').val(),'no':$('.order#order #tabs1 #tempbox input[name="no"]').val(),'dep':'','number':$('.order#order #tabs1 #tempbox input[name="number"]').val(),'mname':$('.order#order #tabs1 #tempbox input[name="mname1"]').val(),'money1':$('.order#order #tabs1 #tempbox input[name="unitprice"]').val(),'taste':$('.order#order #tabs1 #tempbox input[name="taste1"]').val(),'tastenumber':$('.order#order #tabs1 #tempbox input[name="taste1number"]').val(),'tastemoney':$('.order#order #tabs1 #tempbox input[name="taste1money"]').val(),'subtotal':$('.order#order #tabs1 #tempbox input[name="subtotal"]').val()},
			async: false,
			dataType:'json',
			success:function(d){
				//console.log(d);
			},
			error:function(e){
				//console.log(e);
			}
		});*/
	}
	$('.order#order #menubox #itemfun').on('click','.itemfun12',function(){//備註與加料按鈕
		var temp1=$('.order#order .parameters #taste1').val().split('-');
		temp1=temp1[0].split(';');
		var page=Number($('.order#order .initsetting #tastecol').val())*Number($('.order#order .initsetting #tasterow').val());
		
		if($('.order#order .parameters #taste1').val().length>0&&temp1[0]=='1'){
			var i=0;
			var temp1=$('.order#order .parameters #taste1').val().split('-');
			var temp2=$('.order#order .parameters #taste1name').val().split('-');
			var temp3=$('.order#order .parameters #taste1money').val().split('*');
			var temp4=$('.order#order .parameters #taste2name').val().split('-');
			var temp5=$('.order#order .parameters #background').val().split('-');
			var temp11=temp1[0].split(';');
			var temp22=temp2[0].split(';');
			var temp33=temp3[0].split(';');
			var temp44=temp4[0].split(';');
			var temp55=temp5[0].split(';');
			var tastearray=temp11[1].split(',');
			var tastenamearray=temp22[1].split(',');
			var tastemoneyarray=temp33[1].split(',');
			var tastenamearray2=temp44[1].split(',');
			var tastebackground=temp55[1].split(',');
			$('.taste2 #pre').prop('disabled',true);
			if(tastearray.length>Number(page)){
				$('.taste2 #next').prop('disabled',false);
			}
			else{
				$('.taste2 #next').prop('disabled',true);
			}
			$('.taste2 .tasteparameters').html('<input type="hidden" name="page" value="0">');
			$('.taste2 button[id^="tastebut"] div#name1').html('');
			$('.taste2 button[id^="tastebut"] div#name2').html('');
			$('.taste2 button[id^="tasteno"]').val('');
			$('.taste2 button[id^="tastemoney"]').val('');
			$('.taste2 button[id^="tastebut"]').prop('disabled',true);
			$('.taste2 button[id^="tastebut"]').css({'background-color':'transparent'});
			for(var i=0;i<tastearray.length;i++){
				if($('.taste2 .tasteparameters input[id="taste[]"]:eq('+i+')').length>0){
					$('.taste2 .tasteparameters input[id^="taste"]:eq('+i+')').val(tastearray[$('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i]);
					$('.taste2 .tasteparameters input[id^="tastename"]:eq('+i+')').val(tastenamearray[$('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i]);
					$('.taste2 .tasteparameters input[id^="tastename2"]:eq('+i+')').val(tastenamearray2[$('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i]);
					$('.taste2 .tasteparameters input[id^="tastemoney"]:eq('+i+')').val(tastemoneyarray[$('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i]);
					$('.taste2 .tasteparameters input[id^="background"]:eq('+i+')').val(tastebackground[$('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i]);
				}
				else{
					$('.taste2 .tasteparameters').append('<input type="hidden" id="taste[]" value="'+tastearray[$('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i]+'">');
					$('.taste2 .tasteparameters').append('<input type="hidden" id="tastename[]" value="'+tastenamearray[$('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i]+'">');
					$('.taste2 .tasteparameters').append('<input type="hidden" id="tastename2[]" value="'+tastenamearray2[$('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i]+'">');
					$('.taste2 .tasteparameters').append('<input type="hidden" id="tastemoney[]" value="'+tastemoneyarray[$('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i]+'">');
					$('.taste2 .tasteparameters').append('<input type="hidden" id="background[]" value="'+tastebackground[$('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i]+'">');
				}
				
				if(i<((parseInt($('.taste2 .tasteparameters input[name="page"]').val()+1)*Number(page)))){
					$('.taste2 #tastebut'+i+' div#name1').html(tastenamearray[$('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i]);
					$('.taste2 #tastebut'+i+' div#name2').html(tastenamearray2[$('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i]);
					$('.taste2 #tasteno'+i).val(tastearray[$('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i]);
					$('.taste2 #tastemoney'+i).val(tastemoneyarray[$('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i]);
					$('.taste2 #tastebut'+i).prop('disabled',false);
					$('.taste2 #tastebut'+i).css({'background-color':tastebackground[$('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i]});
				}
				else{
				}
			}
			/*for(;i<Number(page);i++){
				$('.taste2 #tastebut'+i).prop('disabled',true);
			}*/
			$('.taste2 #tastecontent').html('');
			if($.trim($('.order#order #tabs1 #tempbox input[name="taste1"]').val()).length>0){
				var tasteno=$('.order#order #tabs1 #tempbox input[name="taste1"]').val().split(',');
				var tastename=$('.order#order #tabs1 #tempbox input[name="taste1name"]').val().split(',');
				var tasteprice=$('.order#order #tabs1 #tempbox input[name="taste1price"]').val().split(',');
				var tastenumber=$('.order#order #tabs1 #tempbox input[name="taste1number"]').val().split(',');
				var tastecolor=$('.order#order #tabs1 #tempbox input[name="background"]').val().split(',');
				var newstr='';
				for(var i=0;i<tasteno.length;i++){
					newstr='<div class="label" style="width:100%;padding:0;margin:0;overflow:hidden;"><div style="width:13%;height:40px;float:left;text-align:center;"><input type="checkbox" name="tastecheck[]" style="width:20px;height:20px;"></div><div style="width:34%;float:left;">';
					if(Number(tastenumber[i])>1){
						newstr=newstr+tastename[i].substr(0,(Number(tastename[i].length)-1-Number(tastenumber[i].length)))+'<input type="hidden" class="name" value="'+tastename[i].substr(0,(Number(tastename[i].length)-1-Number(tastenumber[i].length)))+'"><input type="hidden" class="no" value="'+tasteno[i]+'">';
					}
					else{
						newstr=newstr+tastename[i]+'<input type="hidden" class="name" value="'+tastename[i]+'"><input type="hidden" class="no" value="'+tasteno[i]+'">';
					}
					newstr=newstr+'</div><div style="width:17%;float:left;text-align:center;" id="unitprice">'+tasteprice[i]+'</div><div style="width:17%;float:left;text-align:center;" id="number">'+tastenumber[i]+'</div><div style="width:19%;float:left;text-align:center;" id="subtotal">'+(Number(tasteprice[i])*Number(tastenumber[i]))+'</div></div>';
					$('.taste2 #tastecontent').append(newstr);
				}
			}
			else{
			}
			taste2.dialog('open');
		}
		else{
			if($('.sysmeg #name1.syshint1').length>0){
				$('.sysmeg #name1.syshint1').css({'display':''});
			}
			else{
			}
			if($('.sysmeg #name2.syshint1').length>0){
				$('.sysmeg #name2.syshint1').css({'display':''});
			}
			else{
			}
			sysmeg.dialog('open');
		}
	});
	$('.taste2').on('click','button[id^="tastebut"]',function(){//點選加料選項
		if($.trim($('.taste2 #tastecontent').html()).length>0){
			var findkey=$.inArray($('.taste2 #tasteno'+$('.taste2 button[id^="tastebut"]').index(this)).val(),$('.taste2 #tastecontent .no').map(function(){return $(this).val();}).get());
			if(findkey>=0){
				if(Number($('.taste2 #tastecontent #number:eq('+findkey+')').html())==0){
					$('.taste2 #tastecontent #number:eq('+findkey+')').html(Number($('.taste2 #tastecontent #number:eq('+findkey+')').html())+1);
					$('.taste2 #tastecontent #subtotal:eq('+findkey+')').html(Number($('.taste2 #tastecontent #number:eq('+findkey+')').html())*Number($('.taste2 #tastemoney'+$('.taste2 button[id^="tastebut"]').index(this)).val()));
				}
				else if(Number($('.taste2 #tastecontent #unitprice:eq('+findkey+')').html())>0){
					$('.taste2 #tastecontent #number:eq('+findkey+')').html(Number($('.taste2 #tastecontent #number:eq('+findkey+')').html())+1);
					$('.taste2 #tastecontent #subtotal:eq('+findkey+')').html(Number($('.taste2 #tastecontent #number:eq('+findkey+')').html())*Number($('.taste2 #tastemoney'+$('.taste2 button[id^="tastebut"]').index(this)).val()));
				}
				else{
				}
			}
			else{
				var tt="<div class='label' style='width:100%;min-height:27px;padding:0;margin:0;overflow:hidden;'><div style='width:13%;height:27px;float:left;text-align:center;'><input type='checkbox' name='tastecheck[]' style='width:20px;height:20px;'></div><div style='width:34%;float:left;'>"+$('.taste2 #tastebut'+$('.taste2 button[id^="tastebut"]').index(this)+' div#name1').html()+'<br>'+$('.taste2 #tastebut'+$('.taste2 button[id^="tastebut"]').index(this)+' div#name2').html()+"<input type='hidden' class='name' value='"+$('.taste2 #tastebut'+$('.taste2 button[id^="tastebut"]').index(this)+' div#name1').html();
				if($('.taste2 #tastebut'+$('.taste2 button[id^="tastebut"]').index(this)+' div#name2').html().length>0)tt=tt+'/'+$('.taste2 #tastebut'+$('.taste2 button[id^="tastebut"]').index(this)+' div#name2').html();
				tt=tt+"'><input type='hidden' class='no' value='"+$('.taste2 #tasteno'+$('.taste2 button[id^="tastebut"]').index(this)).val()+"'>"+"</div><div style='width:17%;height:100%;min-height:27px;float:left;text-align:center;' id='unitprice'>"+$('.taste2 #tastemoney'+$('.taste2 button[id^="tastebut"]').index(this)).val()+"</div><div style='width:17%;height:100%;min-height:27px;float:left;text-align:center;' id='number'>1</div><div style='width:19%;height:100%;min-height:27px;float:left;text-align:center;' id='subtotal'>"+$('.taste2 #tastemoney'+$('.taste2 button[id^="tastebut"]').index(this)).val()+"</div></div>";
				$('.taste2 #tastecontent').append(tt);
			}
		}
		else{
			var tt="<div class='label' style='width:100%;min-height:27px;padding:0;margin:0;overflow:hidden;'><div style='width:13%;height:27px;float:left;text-align:center;'><input type='checkbox' name='tastecheck[]' style='width:20px;height:20px;'></div><div style='width:34%;float:left;'>"+$('.taste2 #tastebut'+$('.taste2 button[id^="tastebut"]').index(this)+' div#name1').html()+'<br>'+$('.taste2 #tastebut'+$('.taste2 button[id^="tastebut"]').index(this)+' div#name2').html()+"<input type='hidden' class='name' value='"+$('.taste2 #tastebut'+$('.taste2 button[id^="tastebut"]').index(this)+' div#name1').html();
			if($('.taste2 #tastebut'+$('.taste2 button[id^="tastebut"]').index(this)+' div#name2').html().length>0)tt=tt+'/'+$('.taste2 #tastebut'+$('.taste2 button[id^="tastebut"]').index(this)+' div#name2').html();
			tt=tt+"'><input type='hidden' class='no' value='"+$('.taste2 #tasteno'+$('.taste2 button[id^="tastebut"]').index(this)).val()+"'>"+"</div><div style='width:17%;height:100%;min-height:27px;float:left;text-align:center;' id='unitprice'>"+$('.taste2 #tastemoney'+$('.taste2 button[id^="tastebut"]').index(this)).val()+"</div><div style='width:17%;height:100%;min-height:27px;float:left;text-align:center;' id='number'>1</div><div style='width:19%;height:100%;min-height:27px;float:left;text-align:center;' id='subtotal'>"+$('.taste2 #tastemoney'+$('.taste2 button[id^="tastebut"]').index(this)).val()+"</div></div>";
			$('.taste2 #tastecontent').html(tt);
		}
	});
	$('.taste2 #tastecontentbox').on('click','.label',function(){//加料清單中，模擬label tag
		var index=$('.taste2 #tastecontentbox .label').index(this);
		$('.taste2 #tastecontentbox .label').removeClass('check');
		$('.taste2 #tastecontentbox .label:eq('+index+')').addClass('check');
		if($('.taste2 #tastecontentbox .label:eq('+index+') input[name^="tastecheck"]').prop('checked')){
			$('.taste2 #tastecontentbox .label:eq('+index+') input[name^="tastecheck"]').prop('checked',false);
		}
		else{
			$('.taste2 #tastecontentbox .label:eq('+index+') input[name^="tastecheck"]').prop('checked',true);
		}
	});
	$('.taste2').on('click','#tastefun1',function(){//遞增備註與加料選項的數量
		if(Number($('.taste2 #tastecontent .check #number').html())==0){
			$('.taste2 #tastecontent .check #number').html(Number($('.taste2 #tastecontent .check #number').html())+1);
			$('.taste2 #tastecontent .check #subtotal').html(Number($('.taste2 #tastecontent .check #subtotal').html())+Number($('.taste2 #tastecontent .check #unitprice').html()));
		}
		else if(Number($('.taste2 #tastecontent .check #unitprice').html())>0){
			$('.taste2 #tastecontent .check #number').html(Number($('.taste2 #tastecontent .check #number').html())+1);
			$('.taste2 #tastecontent .check #subtotal').html(Number($('.taste2 #tastecontent .check #subtotal').html())+Number($('.taste2 #tastecontent .check #unitprice').html()));
		}
		else{
		}
	});
	$('.taste2').on('click','#tastefun2',function(){//遞減備註與加料選項的數量
		if((Number($('.taste2 #tastecontent .check #number').html())-1)>=0){
			$('.taste2 #tastecontent .check #number').html(Number($('.taste2 #tastecontent .check #number').html())-1);
			$('.taste2 #tastecontent .check #subtotal').html(Number($('.taste2 #tastecontent .check #subtotal').html())-Number($('.taste2 #tastecontent .check #unitprice').html()));
		}
		else{
			//$('.taste2 #tastecontent .check #number').html(0);
			//$('.taste2 #tastecontent .check #subtotal').html(0);
		}
		if(Number($('.taste2 #tastecontent .check #number').html())==0){
			$('.taste2 #tastecontent .check').remove();
		}
		else{
		}
	});
	$('.taste2').on('click','#pre',function(){//遞減備註與加料的頁數
		var page=Number($('.order#order .initsetting #tastecol').val())*Number($('.order#order .initsetting #tasterow').val());
		var i=0;

		$('.taste2 .tasteparameters input[name="page"]').val((parseInt($('.taste2 .tasteparameters input[name="page"]').val())-1));
		
		$('.taste2 #next').prop('disabled',false);
		if(parseInt($('.taste2 .tasteparameters input[name="page"]').val())==0){
			$('.taste2 #pre').prop('disabled',true);
		}
		else{
			$('.taste2 #pre').prop('disabled',false);
		}
		for(i=0;i<parseInt(page);i++){
			if(($('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i)<$('.taste2 .tasteparameters input[id="taste[]"]').length){
				$('.taste2 #tastebut'+i+' div#name1').html($('.taste2 .tasteparameters input[id="tastename[]"]:eq('+($('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i)+')').val());
				$('.taste2 #tastebut'+i+' div#name2').html($('.taste2 .tasteparameters input[id="tastename2[]"]:eq('+($('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i)+')').val());
				$('.taste2 #tasteno'+i).val($('.taste2 .tasteparameters input[id="taste[]"]:eq('+($('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i)+')').val());
				$('.taste2 #tastemoney'+i).val($('.taste2 .tasteparameters input[id="tastemoney[]"]:eq('+($('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i)+')').val());
				$('.taste2 #tastebut'+i).prop('disabled',false);
				$('.taste2 #tastebut'+i).css({'background-color':$('.taste2 .tasteparameters input[id="background[]"]:eq('+($('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i)+')').val()});
			}
			else{
				break;
			}
		}
		for(;i<parseInt(page);i++){
			$('.taste2 #tastebut'+i+' div#name1').html('');
			$('.taste2 #tastebut'+i+' div#name2').html('');
			$('.taste2 #tasteno'+i).val('');
			$('.taste2 #tastemoney'+i).val('0');
			$('.taste2 #tastebut'+i).prop('disabled',true);
			$('.taste2 #tastebut'+i).css({'background-color':'transparent'});
		}
	});
	$('.taste2').on('click','#next',function(){//遞增備註與加料的頁數
		var page=Number($('.order#order .initsetting #tastecol').val())*Number($('.order#order .initsetting #tasterow').val());
		var i=0;
		
		$('.taste2 .tasteparameters input[name="page"]').val((parseInt($('.taste2 .tasteparameters input[name="page"]').val())+1));
		
		$('.taste2 #pre').prop('disabled',false);
		if(((parseInt($('.taste2 .tasteparameters input[name="page"]').val())+1)*parseInt(page))>=$('.taste2 .tasteparameters input[id="taste[]"]').length){
			$('.taste2 #next').prop('disabled',true);
		}
		else{
			$('.taste2 #next').prop('disabled',false);
		}

		for(i=0;i<parseInt(page);i++){
			if(($('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i)<$('.taste2 .tasteparameters input[id="taste[]"]').length){
				$('.taste2 #tastebut'+i+' div#name1').html($('.taste2 .tasteparameters input[id="tastename[]"]:eq('+($('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i)+')').val());
				$('.taste2 #tastebut'+i+' div#name2').html($('.taste2 .tasteparameters input[id="tastename2[]"]:eq('+($('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i)+')').val());
				$('.taste2 #tasteno'+i).val($('.taste2 .tasteparameters input[id="taste[]"]:eq('+($('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i)+')').val());
				$('.taste2 #tastemoney'+i).val($('.taste2 .tasteparameters input[id="tastemoney[]"]:eq('+($('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i)+')').val());
				$('.taste2 #tastebut'+i).prop('disabled',false);
				$('.taste2 #tastebut'+i).css({'background-color':$('.taste2 .tasteparameters input[id="background[]"]:eq('+($('.taste2 .tasteparameters input[name="page"]').val()*Number(page)+i)+')').val()});
			}
			else{
				break;
			}
		}
		for(;i<parseInt(page);i++){
			$('.taste2 #tastebut'+i+' div#name1').html('');
			$('.taste2 #tastebut'+i+' div#name2').html('');
			$('.taste2 #tasteno'+i).val('');
			$('.taste2 #tastemoney'+i).val('0');
			$('.taste2 #tastebut'+i).prop('disabled',true);
			$('.taste2 #tastebut'+i).css({'background-color':'transparent'});
		}
	});
	$('.taste2').on('click','#tastefun5',function(){//刪除已點的備註或加料選項
		$('.taste2 #tastecontent input[name^="tastecheck"]:checked').parents('.label').remove();
	});
	$('.taste2').on('click','#tastefun6',function(){//確認以點的備註與加料
		tastediff();
		var noarray=$('.taste2 #tastecontent .label .no').map(function(){return $.strPad($(this).val(),4);}).get();
		var sortarray=quicksort(noarray);
		var tasteno='',tastename='',tastename2='',tasteprice='',tastenumber='',tastemoney=0,tastecolor='';
		$.each(sortarray,function(index,value){
			if($.trim(tasteno).length>0){
				if(Number($('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') #number').html())>1){
					tasteno=tasteno+','+Number(value);
					tastename=tastename+','+$('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') .name').val()+'*'+$('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') #number').html();
					tastename2=tastename2+'<br>&nbsp;&nbsp;&nbsp;&nbsp;+'+$('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') .name').val()+'*'+$('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') #number').html();
					tasteprice=tasteprice+','+$('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') #unitprice').html();
					tastenumber=tastenumber+','+$('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') #number').html();
				}
				else if(Number($('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') #number').html())==1){
					tasteno=tasteno+','+Number(value);
					tastename=tastename+','+$('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') .name').val();
					tastename2=tastename2+'<br>&nbsp;&nbsp;&nbsp;&nbsp;+'+$('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') .name').val();
					tasteprice=tasteprice+','+$('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') #unitprice').html();
					tastenumber=tastenumber+','+$('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') #number').html();
				}
				else{
				}
			}
			else{
				if(Number($('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') #number').html())>1){
					tasteno=Number(value);
					tastename=$('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') .name').val()+'*'+$('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') #number').html();
					tastename2=$('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') .name').val()+'*'+$('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') #number').html();
					tasteprice=$('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') #unitprice').html();
					tastenumber=$('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') #number').html();
				}
				else if(Number($('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') #number').html())==1){
					tasteno=Number(value);
					tastename=$('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') .name').val();
					tastename2=$('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') .name').val();
					tasteprice=$('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') #unitprice').html();
					tastenumber=$('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') #number').html();
				}
				else{
				}
			}
			tastemoney=Number(tastemoney)+Number($('.taste2 #tastecontent .label:eq('+$.inArray(value,noarray)+') #subtotal').html());
		});
		taste2.dialog('close');
		diff();
		$('.order#order #tabs1 #tempbox input[name="taste1"]').val(tasteno);
		$('.order#order #tabs1 #tempbox input[name="taste1name"]').val(tastename);
		$('.order#order #tabs1 #tempbox input[name="taste1price"]').val(tasteprice);
		$('.order#order #tabs1 #tempbox input[name="taste1number"]').val(tastenumber);
		$('.order#order #tabs1 #tempbox input[name="taste1money"]').val(tastemoney);
		$('.order#order #tabs1 #tempbox input[name="taste2"]').val(tastename2);
		$('.order#order #tabs1 #tempbox input[name="money"]').val(Number($('.order#order #tabs1 #tempbox input[name="unitprice"]').val())+Number(tastemoney));
		$('.order#order #tabs1 #tempbox input[name="subtotal"]').val(Number($('.order#order #tabs1 #tempbox input[name="money"]').val())*Number($('.order#order #tabs1 #tempbox input[name="number"]').val())-Number($('.order#order #tabs1 #tempbox input[name="discount"]').val()));
		$('.order#order #editview').trigger('change');
		updateview();
		sumsubtotal();
	});
	function tastediff(){//先行清空備註與加料的資料，方便更新備註與加料
		if($('.order#order #tabs1 #tempbox input[name="taste1money"]').val().length>1){
			$('.order#order #tabs1 #tempbox input[name="money"]').val(Number($('.order#order #tabs1 #tempbox input[name="money"]').val())-Number($('.order#order #tabs1 #tempbox input[name="taste1money"]').val()));
		}
		else{
		}
		$('.order#order #tabs1 #tempbox input[name="subtotal"]').val(Number($('.order#order #tabs1 #tempbox input[name="money"]').val())*Number($('.order#order #tabs1 #tempbox input[name="number"]').val()));
	}
	function quicksort(origArray) {//快速排序
		if (origArray.length <= 1) { 
			return origArray;
		}
		else {

			var left = [];
			var right = [];
			var newArray = [];
			var pivot = origArray.pop();
			var length = origArray.length;

			for (var i = 0; i < length; i++) {
				if ((9999-Number(origArray[i])) >= (9999-Number(pivot))) {
					left.push(origArray[i]);
				} else {
					right.push(origArray[i]);
				}
			}

			return newArray.concat(quicksort(left), pivot, quicksort(right));
		}
	}
	$.strPad = function(i,l,s) {//自動補0
		var o = i.toString();
		if (!s) { s = '0'; }
		while (o.length < l) {
			o = s + o;
		}
		return o;
	};
	$('.sysmeg .closesysmeg').click(function(){
		sysmeg.dialog('close');
	});
	/*使點餐清單中的title與content不會因為scroll bar而跑位*/
	/*if($('.order#order .listcontent').height()>$('.order#order .listcontentbox').height()){
		$('.order#order .listtitle').css({'width':'calc(100% - 15px)','padding-right':'15px'});
	}
	else{
		$('.order#order .listtitle').css({'width':'calc(100% - 5px)','padding-right':'5px'});
	}
	$('.order#order .listcontent').resize(function(){
		console.log($('.order#order .listcontent').height()>$('.order#order .listcontentbox').height());
		console.log($('.order#order .listcontent').height());
		console.log($('.order#order .listcontentbox').height());
		if($('.order#order .listcontent').height()>$('.order#order .listcontentbox').height()){
			$('.order#order .listtitle').css({'width':'calc(100% - 15px)','padding-right':'15px'});
		}
		else{
			$('.order#order .listtitle').css({'width':'calc(100% - 5px)','padding-right':'5px'});
		}
	});*/
	/******************************************************/
	/*使加料清單中的title與content不會因為scroll bar而跑位*/
	if($('.order#order #tastecontent').height()>$('.order#order #tastecontentbox').height()){
		$('.order#order #tastetitle').css({'width':'calc(100% - 10px)','padding-right':'10px'});
	}
	else{
		$('.order#order #tastetitle').css({'width':'100%','padding-right':'0'});
	}
	$('.order#order #tastecontent').resize(function(){
		if($('.order#order #tastecontent').height()>$('.order#order #tastecontentbox').height()){
			$('.order#order #tastetitle').css({'width':'calc(100% - 10px)','padding-right':'10px'});
		}
		else{
			$('.order#order #tastetitle').css({'width':'100%','padding-right':'0'});
		}
	});
	/******************************************************/
	$('.order#order #tabs4').on('click','.listcontent .label',function(){//點餐清單中，模擬label tag
		//console.log('1');
		var index=$('.order#order #tabs4 .listcontent .label').index(this);
		if($('.order#order #tabs4 .listcontent .label:eq('+index+')').prop('class')=='label focus'){
			$('.order#order #tabs4 .listcontent .label').removeClass( "focus" );
			$('.order#order #tabs4 .listcontent .label:eq('+index+')').addClass( "focus" );
			if($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name="order[]"]').val()=='－'){
				console.log('11');
				var index2=index;
				var index3=(index-1);
				while($('.order#order #tabs4 .listcontent .label:eq('+index2+') input[name="order[]"]').val()=='－'){
					$('.order#order #tabs4 .listcontent .label:eq('+index2+')').addClass( "check" );
					$('.order#order #tabs4 .listcontent .label:eq('+index2+') input[type="checkbox"]').prop('checked',true);
					$('.order#order #tabs4 .listcontent .label:eq('+index2+')').addClass( "focus" );
					index2++;
				}
				while($('.order#order #tabs4 .listcontent .label:eq('+index3+') input[name="order[]"]').val()=='－'){
					$('.order#order #tabs4 .listcontent .label:eq('+index3+')').addClass( "check" );
					$('.order#order #tabs4 .listcontent .label:eq('+index3+') input[type="checkbox"]').prop('checked',true);
					$('.order#order #tabs4 .listcontent .label:eq('+index3+')').addClass( "focus" );
					index3--;
				}
				$('.order#order #tabs4 .listcontent .label:eq('+index3+')').addClass( "focus" );
				$('.order#order #tabs4 .listcontent .label:eq('+index3+')').addClass( "check" );
				$('.order#order #tabs4 .listcontent .label:eq('+index3+') input[type="checkbox"]').prop('checked',true);
			}
			else if($('.order#order #tabs4 .listcontent .label:eq('+(Number(index)+1)+') input[name="order[]"]').val()=='－'){
				//console.log('12');
				var index2=Number(index)+1;
				$('.order#order #tabs4 .listcontent .label:eq('+index+')').addClass( "check" );
				$('.order#order #tabs4 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked',true);
				while($('.order#order #tabs4 .listcontent .label:eq('+index2+') input[name="order[]"]').val()=='－'){
					$('.order#order #tabs4 .listcontent .label:eq('+index2+')').addClass( "check" );
					$('.order#order #tabs4 .listcontent .label:eq('+index2+') input[type="checkbox"]').prop('checked',true);
					$('.order#order #tabs4 .listcontent .label:eq('+index2+')').addClass( "focus" );
					index2++;
				}
			}
			else{
				//console.log('13');
				$('.order#order #tabs4 .listcontent .label:eq('+index+')').addClass( "check" );
				$('.order#order #tabs4 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked',true);
				/*if($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="typeno"]').val()=='sys'){//猜測當初用來分辨是否為低銷溢收品項，但因為將低銷溢收轉至結帳畫面，因此無須判斷
				}
				else{*/
					getdata($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="typeno"]').val(),$('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="no"]').val(),'old','','');
				//}
				/*if($('.order#order #tabs4 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked')){
					$('.order#order #tabs4 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked',false);
				}
				else{
					$('.order#order #tabs4 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked',true);
				}*/
			}
		}
		else if($('.order#order #tabs4 .listcontent .label:eq('+index+')').prop('class')=='label check focus'||$('.order#order #tabs4 .listcontent .label:eq('+index+')').prop('class')=='label focus check'){
			$('.order#order #tabs4 .listcontent .label').removeClass( "focus" );
			$('.order#order #tabs4 .listcontent .label:eq('+index+')').addClass( "focus" );
			if($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name="order[]"]').val()=='－'){
				var index2=index;
				var index3=(index-1);
				while($('.order#order #tabs4 .listcontent .label:eq('+index2+') input[name="order[]"]').val()=='－'){
					$('.order#order #tabs4 .listcontent .label:eq('+index2+')').removeClass( "check" );
					$('.order#order #tabs4 .listcontent .label:eq('+index2+') input[type="checkbox"]').prop('checked',false);
					$('.order#order #tabs4 .listcontent .label:eq('+index2+')').addClass( "focus" );
					index2++;
				}
				while($('.order#order #tabs4 .listcontent .label:eq('+index3+') input[name="order[]"]').val()=='－'){
					$('.order#order #tabs4 .listcontent .label:eq('+index3+')').removeClass( "check" );
					$('.order#order #tabs4 .listcontent .label:eq('+index3+') input[type="checkbox"]').prop('checked',false);
					$('.order#order #tabs4 .listcontent .label:eq('+index3+')').addClass( "focus" );
					index3--;
				}
				$('.order#order #tabs4 .listcontent .label:eq('+index3+')').addClass( "focus" );
				$('.order#order #tabs4 .listcontent .label:eq('+index3+')').removeClass( "check" );
				$('.order#order #tabs4 .listcontent .label:eq('+index3+') input[type="checkbox"]').prop('checked',false);
			}
			else if($('.order#order #tabs4 .listcontent .label:eq('+(Number(index)+1)+') input[name="order[]"]').val()=='－'){
				var index2=Number(index)+1;
				$('.order#order #tabs4 .listcontent .label:eq('+index+')').removeClass( "check" );
				$('.order#order #tabs4 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked',false);
				while($('.order#order #tabs4 .listcontent .label:eq('+index2+') input[name="order[]"]').val()=='－'){
					$('.order#order #tabs4 .listcontent .label:eq('+index2+')').removeClass( "check" );
					$('.order#order #tabs4 .listcontent .label:eq('+index2+') input[type="checkbox"]').prop('checked',false);
					$('.order#order #tabs4 .listcontent .label:eq('+index2+')').addClass( "focus" );
					index2++;
				}
			}
			else{
				$('.order#order #tabs4 .listcontent .label:eq('+index+')').removeClass( "check" );
				$('.order#order #tabs4 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked',false);
				/*if($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="typeno"]').val()=='sys'){//猜測當初用來分辨是否為低銷溢收品項，但因為將低銷溢收轉至結帳畫面，因此無須判斷
				}
				else{*/
					getdata($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="typeno"]').val(),$('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="no"]').val(),'old','','');
				//}
				/*if($('.order#order #tabs4 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked')){
					$('.order#order #tabs4 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked',false);
				}
				else{
					$('.order#order #tabs4 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked',true);
				}*/
			}
		}
		else{
			$('.order#order #tabs4 .listcontent .label').removeClass( "focus" );
			$('.order#order #tabs4 .listcontent .label:eq('+index+')').addClass( "focus" );
			if($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name="order[]"]').val()=='－'){
				$('.order#order #tabs1 #tempbox input[name="target"]').val('0');
				$('.order#order #tabs1 #tempbox input[name="linenumber"]').val('');
				$('.order#order #tabs1 #tempbox input[name="typeno"]').val('');
				$('.order#order #tabs1 #tempbox input[name="type"]').val('');
				$('.order#order #tabs1 #tempbox input[name="no"]').val('');
				$('.order#order #tabs1 #tempbox input[name="name"]').val('');
				$('.order#order #tabs1 #tempbox input[name="name2"]').val('');
				$('.order#order #tabs1 #tempbox input[name="isgroup"]').val('0');
				$('.order#order #tabs1 #tempbox input[name="childtype"]').val('');
				$('.order#order #tabs1 #tempbox input[name="mname1"]').val('');
				$('.order#order #tabs1 #tempbox input[name="mname2"]').val('');
				$('.order#order #tabs1 #tempbox input[name="unitprice"]').val('');
				$('.order#order #tabs1 #tempbox input[name="money"]').val('');
				$('.order#order #tabs1 #tempbox input[name="discount"]').val('0');
				$('.order#order #tabs1 #tempbox input[name="discontent"]').val('');
				$('.order#order #tabs1 #tempbox input[name="number"]').val('');
				$('.order#order #tabs1 #tempbox input[name="subtotal"]').val('');
				$('.order#order #tabs1 #tempbox input[name="taste1"]').val('');
				$('.order#order #tabs1 #tempbox input[name="taste1name"]').val('');
				$('.order#order #tabs1 #tempbox input[name="taste2name"]').val('');
				$('.order#order #tabs1 #tempbox input[name="taste1price"]').val('');
				$('.order#order #tabs1 #tempbox input[name="taste1number"]').val('');
				$('.order#order #tabs1 #tempbox input[name="taste1money"]').val('0');
				$('.order#order #tabs1 #tempbox input[name="taste2"]').val('');
				$('.order#order #tabs1 #editview').val('');
				$('.order#order .parameters #typeno').val('');
				$('.order#order .parameters #type').val('');
				$('.order#order .parameters #no').val('');
				$('.order#order .parameters #name').val('');
				$('.order#order .parameters #msize').val('');
				$('.order#order .parameters input[id^="mname"]').val('');
				$('.order#order .parameters input[id^="money"]').val('');
				$('.order#order .parameters #taste1').val('');
				$('.order#order .parameters #taste1name').val('');
				$('.order#order .parameters #taste1money').val('');
				$('.order#order #menubox #itemfun .startchangetaste').val('0');
				$('.order#order #menubox #itemfun .itemfun').trigger( "click" );
				var index2=index;
				var index3=(index-1);
				while($('.order#order #tabs4 .listcontent .label:eq('+index2+') input[name="order[]"]').val()=='－'){
					$('.order#order #tabs4 .listcontent .label:eq('+index2+')').addClass( "focus" );
					index2++;
				}
				while($('.order#order #tabs4 .listcontent .label:eq('+index3+') input[name="order[]"]').val()=='－'){
					$('.order#order #tabs4 .listcontent .label:eq('+index3+')').addClass( "focus" );
					index3--;
				}
				$('.order#order #tabs4 .listcontent .label:eq('+index3+')').addClass( "focus" );
			}
			else if($('.order#order #tabs4 .listcontent .label:eq('+(Number(index)+1)+') input[name="order[]"]').val()=='－'){
				$('.order#order #tabs1 #tempbox input[name="target"]').val('0');
				$('.order#order #tabs1 #tempbox input[name="linenumber"]').val('');
				$('.order#order #tabs1 #tempbox input[name="typeno"]').val('');
				$('.order#order #tabs1 #tempbox input[name="type"]').val('');
				$('.order#order #tabs1 #tempbox input[name="no"]').val('');
				$('.order#order #tabs1 #tempbox input[name="name"]').val('');
				$('.order#order #tabs1 #tempbox input[name="name2"]').val('');
				$('.order#order #tabs1 #tempbox input[name="isgroup"]').val('0');
				$('.order#order #tabs1 #tempbox input[name="childtype"]').val('');
				$('.order#order #tabs1 #tempbox input[name="mname1"]').val('');
				$('.order#order #tabs1 #tempbox input[name="mname2"]').val('');
				$('.order#order #tabs1 #tempbox input[name="unitprice"]').val('');
				$('.order#order #tabs1 #tempbox input[name="money"]').val('');
				$('.order#order #tabs1 #tempbox input[name="discount"]').val('0');
				$('.order#order #tabs1 #tempbox input[name="discontent"]').val('');
				$('.order#order #tabs1 #tempbox input[name="number"]').val('');
				$('.order#order #tabs1 #tempbox input[name="subtotal"]').val('');
				$('.order#order #tabs1 #tempbox input[name="taste1"]').val('');
				$('.order#order #tabs1 #tempbox input[name="taste1name"]').val('');
				$('.order#order #tabs1 #tempbox input[name="taste2name"]').val('');
				$('.order#order #tabs1 #tempbox input[name="taste1price"]').val('');
				$('.order#order #tabs1 #tempbox input[name="taste1number"]').val('');
				$('.order#order #tabs1 #tempbox input[name="taste1money"]').val('0');
				$('.order#order #tabs1 #tempbox input[name="taste2"]').val('');
				$('.order#order #tabs1 #editview').val('');
				$('.order#order .parameters #typeno').val('');
				$('.order#order .parameters #type').val('');
				$('.order#order .parameters #no').val('');
				$('.order#order .parameters #name').val('');
				$('.order#order .parameters #msize').val('');
				$('.order#order .parameters input[id^="mname"]').val('');
				$('.order#order .parameters input[id^="money"]').val('');
				$('.order#order .parameters #taste1').val('');
				$('.order#order .parameters #taste1name').val('');
				$('.order#order .parameters #taste1money').val('');
				$('.order#order #menubox #itemfun .startchangetaste').val('0');
				$('.order#order #menubox #itemfun .itemfun').trigger( "click" );
				//console.log('12');
				var index2=Number(index)+1;
				$('.order#order #tabs4 .listcontent .label:eq('+index+')').addClass( "check" );
				while($('.order#order #tabs4 .listcontent .label:eq('+index2+') input[name="order[]"]').val()=='－'){
					$('.order#order #tabs4 .listcontent .label:eq('+index2+')').addClass( "focus" );
					index2++;
				}
			}
			else{
				/*if($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="typeno"]').val()=='sys'){//猜測當初用來分辨是否為低銷溢收品項，但因為將低銷溢收轉至結帳畫面，因此無須判斷
				}
				else{*/
					getdata($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="typeno"]').val(),$('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="no"]').val(),'old','','');
				//}
			}
		}
		
		$('.order#order #tabs1 #tempbox input[name="target"]').val(index);
		$('.order#order #tabs1 #tempbox input[name="linenumber"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="linenumber"]').val());
		$('.order#order #tabs1 #tempbox input[name="typeno"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="typeno"]').val());
		$('.order#order #tabs1 #tempbox input[name="type"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="type"]').val());
		$('.order#order #tabs1 #tempbox input[name="no"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="no"]').val());
		$('.order#order #tabs1 #tempbox input[name="personcount"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="personcount"]').val());
		$('.order#order #tabs1 #tempbox input[name="needcharge"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="needcharge"]').val());
		$('.order#order #tabs1 #tempbox input[name="dis1"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="dis1"]').val());
		$('.order#order #tabs1 #tempbox input[name="dis2"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="dis2"]').val());
		$('.order#order #tabs1 #tempbox input[name="dis3"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="dis3"]').val());
		$('.order#order #tabs1 #tempbox input[name="dis4"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="dis4"]').val());
		$('.order#order #tabs1 #tempbox input[name="name"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="name"]').val());
		$('.order#order #tabs1 #tempbox input[name="name2"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="name2"]').val());
		$('.order#order #tabs1 #tempbox input[name="isgroup"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="isgroup"]').val());
		$('.order#order #tabs1 #tempbox input[name="childtype"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="childtype"]').val());
		$('.order#order #tabs1 #tempbox input[name="mname1"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name="mname1[]"]').val());
		$('.order#order #tabs1 #tempbox input[name="mname2"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name="mname2[]"]').val());
		$('.order#order #tabs1 #tempbox input[name="insaleinv"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name="insaleinv[]"]').val());
		$('.order#order #tabs1 #tempbox input[name="unitprice"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="unitprice"]').val());
		$('.order#order #tabs1 #tempbox input[name="money"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="money"]').val());
		$('.order#order #tabs1 #tempbox input[name="discount"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="discount"]').val());
		$('.order#order #tabs1 #tempbox input[name="discontent"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="discontent"]').val());
		$('.order#order #tabs1 #tempbox input[name="number"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="number"]').val());
		$('.order#order #tabs1 #tempbox input[name="subtotal"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="subtotal"]').val());
		$('.order#order #tabs1 #tempbox input[name="taste1"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="taste1"]').val());
		$('.order#order #tabs1 #tempbox input[name="taste1name"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="taste1name"]').val());
		$('.order#order #tabs1 #tempbox input[name="taste1price"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="taste1price"]').val());
		$('.order#order #tabs1 #tempbox input[name="taste1number"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="taste1number"]').val());
		$('.order#order #tabs1 #tempbox input[name="taste1money"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="taste1money"]').val());
		$('.order#order #tabs1 #tempbox input[name="taste2"]').val($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="taste1name"]').val().replace(/,/g,'<br>&nbsp;&nbsp;&nbsp;&nbsp;+'));
		$('.order#order #tabs1 #tempbox input[name="background"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="background"]').val());
		if($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name="templistitem[]"]').length>0){
			$('.order#order #content #numbox input').prop('disabled',true);
			$('.order#order #content #numbox button').prop('disabled',true);
			$('.order#order #content #menubox #itemfun table button[class^="itemmname"]').prop('disabled',true);
		}
		else{
			$('.order#order #content #numbox input').prop('disabled',false);
			$('.order#order #content #numbox button').prop('disabled',false);
			for(var i=1;i<=6;i++){
				if($('.order#order #content #menubox #itemfun table .itemmoney'+i).val()=='0'){
					$('.order#order #content #menubox #itemfun table .itemmname'+i).prop('disabled',true);
				}
				else{
					$('.order#order #content #menubox #itemfun table .itemmname'+i).prop('disabled',false);
				}
			}
		}
		$('.order#order #numbox input[name="type"]').val('new');
		getdata($('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="typeno"]').val(),$('.order#order #tabs4 .listcontent .label:eq('+index+') input[name^="no"]').val(),'old','','');
		updateview();
		if(($('.order#order #tabs4 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked')&&!$('.order#order #tabs4 .listcontent .label:eq('+index+')').hasClass('check'))||(!$('.order#order #tabs4 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked')&&$('.order#order #tabs4 .listcontent .label:eq('+index+')').hasClass('check'))){
			$('.order#order #tabs4 .listcontent .label:eq('+index+')').trigger('click');
		}
		else{
		}
	});
	$('.order#order #tabs5').on('click','.listcontent .label',function(){//套餐選項清單中，模擬label tag
		var index=$('.order#order #tabs5 .listcontent .label').index(this);
		
		//$('.order#order #tabs5 .listcontent .label').removeClass( "focus" );
		if($('.order#order #tabs5 .listcontent .label:eq('+index+')').prop('class')=='label focus'){
			if($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name="order[]"]').val()=='－'){
				var index2=index;
				var index3=(index-1);
				while($('.order#order #tabs5 .listcontent .label:eq('+index2+') input[name="order[]"]').val()=='－'){
					$('.order#order #tabs5 .listcontent .label:eq('+index2+')').addClass( "check" );
					$('.order#order #tabs5 .listcontent .label:eq('+index2+') input[type="checkbox"]').prop('checked',true);
					index2++;
				}
				while($('.order#order #tabs5 .listcontent .label:eq('+index3+') input[name="order[]"]').val()=='－'){
					$('.order#order #tabs5 .listcontent .label:eq('+index3+')').addClass( "check" );
					$('.order#order #tabs5 .listcontent .label:eq('+index3+') input[type="checkbox"]').prop('checked',true);
					index3--;
				}
				$('.order#order #tabs5 .listcontent .label:eq('+index3+')').addClass( "check" );
				$('.order#order #tabs5 .listcontent .label:eq('+index3+') input[type="checkbox"]').prop('checked',true);
			}
			else if($('.order#order #tabs5 .listcontent .label:eq('+(Number(index)+1)+') input[name="order[]"]').val()=='－'){
				var index2=Number(index)+1;
				$('.order#order #tabs5 .listcontent .label:eq('+index+')').addClass( "check" );
				$('.order#order #tabs5 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked',true);
				while($('.order#order #tabs5 .listcontent .label:eq('+index2+') input[name="order[]"]').val()=='－'){
					$('.order#order #tabs5 .listcontent .label:eq('+index2+')').addClass( "check" );
					$('.order#order #tabs5 .listcontent .label:eq('+index2+') input[type="checkbox"]').prop('checked',true);
					index2++;
				}
			}
			else{
				$('.order#order #tabs5 .listcontent .label:eq('+index+')').addClass( "check" );
				$('.order#order #tabs5 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked',true);
				/*if($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="typeno"]').val()=='sys'){//猜測當初用來分辨是否為低銷溢收品項，但因為將低銷溢收轉至結帳畫面，因此無須判斷
				}
				else{*/
					getdata($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="typeno"]').val(),$('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="no"]').val(),'old','','');
				//}
				/*if($('.order#order #tabs4 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked')){
					$('.order#order #tabs4 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked',false);
				}
				else{
					$('.order#order #tabs4 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked',true);
				}*/
			}
		}
		else if($('.order#order #tabs5 .listcontent .label:eq('+index+')').prop('class')=='label check focus'||$('.order#order #tabs5 .listcontent .label:eq('+index+')').prop('class')=='label focus check'){
			if($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name="order[]"]').val()=='－'){
				var index2=index;
				var index3=(index-1);
				while($('.order#order #tabs5 .listcontent .label:eq('+index2+') input[name="order[]"]').val()=='－'){
					$('.order#order #tabs5 .listcontent .label:eq('+index2+')').removeClass( "check" );
					$('.order#order #tabs5 .listcontent .label:eq('+index2+') input[type="checkbox"]').prop('checked',false);
					index2++;
				}
				while($('.order#order #tabs5 .listcontent .label:eq('+index3+') input[name="order[]"]').val()=='－'){
					$('.order#order #tabs5 .listcontent .label:eq('+index3+')').removeClass( "check" );
					$('.order#order #tabs5 .listcontent .label:eq('+index3+') input[type="checkbox"]').prop('checked',false);
					index3--;
				}
				$('.order#order #tabs5 .listcontent .label:eq('+index3+')').removeClass( "check" );
				$('.order#order #tabs5 .listcontent .label:eq('+index3+') input[type="checkbox"]').prop('checked',false);
			}
			else if($('.order#order #tabs5 .listcontent .label:eq('+(Number(index)+1)+') input[name="order[]"]').val()=='－'){
				var index2=Number(index)+1;
				$('.order#order #tabs5 .listcontent .label:eq('+index+')').removeClass( "check" );
				$('.order#order #tabs5 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked',false);
				while($('.order#order #tabs5 .listcontent .label:eq('+index2+') input[name="order[]"]').val()=='－'){
					$('.order#order #tabs5 .listcontent .label:eq('+index2+')').removeClass( "check" );
					$('.order#order #tabs5 .listcontent .label:eq('+index2+') input[type="checkbox"]').prop('checked',false);
					index2++;
				}
			}
			else{
				$('.order#order #tabs5 .listcontent .label:eq('+index+')').removeClass( "check" );
				$('.order#order #tabs5 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked',false);
				/*if($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="typeno"]').val()=='sys'){//猜測當初用來分辨是否為低銷溢收品項，但因為將低銷溢收轉至結帳畫面，因此無須判斷
				}
				else{*/
					getdata($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="typeno"]').val(),$('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="no"]').val(),'old','','');
				//}
				/*if($('.order#order #tabs4 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked')){
					$('.order#order #tabs4 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked',false);
				}
				else{
					$('.order#order #tabs4 .listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked',true);
				}*/
			}
		}
		else{
			$('.order#order #tabs5 .listcontent .label').removeClass( "focus" );
			$('.order#order #tabs5 .listcontent .label:eq('+index+')').addClass( "focus" );
		}
		$('.order#order #tabs1 #tempbox input[name="target"]').val($('.order#order #tabs5 .listcontent .label').index(this));
		$('.order#order #tabs1 #tempbox input[name="linenumber"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="linenumber"]').val());
		$('.order#order #tabs1 #tempbox input[name="typeno"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="typeno"]').val());
		$('.order#order #tabs1 #tempbox input[name="type"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="type"]').val());
		$('.order#order #tabs1 #tempbox input[name="no"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="no"]').val());
		$('.order#order #tabs1 #tempbox input[name="personcount"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="personcount"]').val());
		$('.order#order #tabs1 #tempbox input[name="needcharge"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="needcharge"]').val());
		$('.order#order #tabs1 #tempbox input[name="dis1"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="dis1"]').val());
		$('.order#order #tabs1 #tempbox input[name="dis2"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="dis2"]').val());
		$('.order#order #tabs1 #tempbox input[name="dis3"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="dis3"]').val());
		$('.order#order #tabs1 #tempbox input[name="dis4"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="dis4"]').val());
		$('.order#order #tabs1 #tempbox input[name="name"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="name"]').val());
		$('.order#order #tabs1 #tempbox input[name="name2"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="name2"]').val());
		$('.order#order #tabs1 #tempbox input[name="isgroup"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="isgroup"]').val());
		$('.order#order #tabs1 #tempbox input[name="childtype"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="childtype"]').val());
		$('.order#order #tabs1 #tempbox input[name="mname1"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="mname1"]').val());
		$('.order#order #tabs1 #tempbox input[name="mname2"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="mname2"]').val());
		$('.order#order #tabs1 #tempbox input[name="insaleinv"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name="insaleinv[]"]').val());
		$('.order#order #tabs1 #tempbox input[name="unitprice"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="unitprice"]').val());
		$('.order#order #tabs1 #tempbox input[name="money"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="money"]').val());
		$('.order#order #tabs1 #tempbox input[name="discount"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="discount"]').val());
		$('.order#order #tabs1 #tempbox input[name="discontent"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="discontent"]').val());
		$('.order#order #tabs1 #tempbox input[name="number"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="number"]').val());
		$('.order#order #tabs1 #tempbox input[name="subtotal"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="subtotal"]').val());
		$('.order#order #tabs1 #tempbox input[name="taste1"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="taste1"]').val());
		$('.order#order #tabs1 #tempbox input[name="taste1name"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="taste1name"]').val());
		$('.order#order #tabs1 #tempbox input[name="taste1price"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="taste1price"]').val());
		$('.order#order #tabs1 #tempbox input[name="taste1number"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="taste1number"]').val());
		$('.order#order #tabs1 #tempbox input[name="taste1money"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="taste1money"]').val());
		$('.order#order #tabs1 #tempbox input[name="background"]').val($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="background"]').val());
		getdata($('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="typeno"]').val(),$('.order#order #tabs5 .listcontent .label:eq('+index+') input[name^="no"]').val(),'old','g','');
		updateview();
	});
	$('.order#order #menubox #itemfun').on('click','.itemfun',function(){//將產品資訊中的價格與前十項的備註與加料填入按鈕中
		for(var i=0;i<6;i++){
			if($('.order#order .parameters input[id="mname'+$('.order#order .initsetting #firlan').val()+'[]"]:eq('+i+')').val()!=""){
				$('.order#order #menubox #itemfun .itemmname'+(i+1)+' div#name1').html($('.order#order .parameters input[id="mname'+$('.order#order .initsetting #firlan').val()+'[]"]:eq('+i+')').val());
				$('.order#order #menubox #itemfun .itemmname'+(i+1)+' div#name2').html($('.order#order .parameters input[id="mname'+$('.order#order .initsetting #seclan').val()+'[]"]:eq('+i+')').val());
				$('.order#order #menubox #itemfun .itemmname'+(i+1)).prop('disabled',false);
				$('.order#order #menubox #itemfun .itemmoney'+(i+1)).val($('.order#order .parameters input[id="money[]"]:eq('+i+')').val());
			}
			else{
				$('.order#order #menubox #itemfun .itemmname'+(i+1)+' div#name1').html('');
				$('.order#order #menubox #itemfun .itemmname'+(i+1)+' div#name2').html('');
				$('.order#order #menubox #itemfun .itemmname'+(i+1)).prop('disabled',true);
				$('.order#order #menubox #itemfun .itemmoney'+(i+1)).val('0');
			}
		}
		var tabs=changetagtarget();
		var temp1=[];
		var temp2=[];
		var temp3=[];
		var temp4=[];
		var tasteset1=$('.order#order .parameters #taste1').val().split('-');
		var tasteset2=$('.order#order .parameters #taste1name').val().split('-');
		var tasteset3=$('.order#order .parameters #taste2name').val().split('-');
		var tasteset4=$('.order#order .parameters #taste1money').val().split('*');
		var tasteset5=$('.order#order .parameters #background').val().split('-');
		var tastearray1=[];
		var tastearray2=[];
		var tastearray3=[];
		var tastearray4=[];
		var tastearray5=[];
		for(var i=0;i<tasteset1.length;i++){
			var t1=tasteset1[i].split(';');
			var t2=tasteset2[i].split(';');
			var t3=tasteset3[i].split(';');
			var t4=tasteset4[i].split(';');
			var t5=tasteset5[i].split(';');
			tastearray1.push(t1[0],t1[1]);
			tastearray2.push(t2[0],t2[1]);
			tastearray3.push(t3[0],t3[1]);
			tastearray4.push(t4[0],t4[1]);
			tastearray5.push(t5[0],t5[1]);
		}
		if(tastearray1[0]=='1'&&$('.order#order #'+tabs+' #listform .label:eq('+$('.order#order #tabs1 #tempbox input[name="target"]').val()+') input[name="order[]"]').val()!='－'){
			if(tastearray1[1].length>0){
				temp1=tastearray1[1].split(',');
				temp2=tastearray2[1].split(',');
				temp3=tastearray3[1].split(',');
				temp4=tastearray4[1].split(',');
				temp5=tastearray5[1].split(',');
			}
			else{
			}
			for(i=0;i<10;i++){
				if((Number(i)+Number($('.order#order #menubox #itemfun .startchangetaste').val())*10)<temp1.length){
					$('.order#order #menubox #itemfun #taste'+i+' div#name1').html(temp2[(Number(i)+Number($('.order#order #menubox #itemfun .startchangetaste').val())*10)]);
					$('.order#order #menubox #itemfun #taste'+i+' div#name2').html(temp3[(Number(i)+Number($('.order#order #menubox #itemfun .startchangetaste').val())*10)]);
					$('.order#order #menubox #itemfun #taste'+i).prop('disabled',false);
					$('.order#order #menubox #itemfun .tasteno'+i).val(temp1[(Number(i)+Number($('.order#order #menubox #itemfun .startchangetaste').val())*10)]);
					$('.order#order #menubox #itemfun .tasteprice'+i).val(temp4[(Number(i)+Number($('.order#order #menubox #itemfun .startchangetaste').val())*10)]);
					$('.order#order #menubox #itemfun #taste'+i+' div#name1').parent('button').css({'background-color':temp5[(Number(i)+Number($('.order#order #menubox #itemfun .startchangetaste').val())*10)]});
				}
				else{
					$('.order#order #menubox #itemfun #taste'+i+' div#name1').html('');
					$('.order#order #menubox #itemfun #taste'+i+' div#name2').html('');
					$('.order#order #menubox #itemfun #taste'+i).prop('disabled',true);
					$('.order#order #menubox #itemfun .tasteno'+i).val('');
					$('.order#order #menubox #itemfun .tasteprice'+i).val('');
					$('.order#order #menubox #itemfun #taste'+i+' div#name1').parent('button').css({'background-color':''});
				}
			}
		}
		else if(tastearray1[0]=='1'&&$('.order#order #'+tabs+' #listform .label:eq('+$('.order#order #tabs1 #tempbox input[name="target"]').val()+') input[name="order[]"]').val()=='－'){
			if(tastearray1[1].length>0){
				temp1=tastearray1[1].split(',');
				temp2=tastearray2[1].split(',');
				temp3=tastearray3[1].split(',');
				temp4=tastearray4[1].split(',');
				temp5=tastearray5[1].split(',');
			}
			else{
			}
			for(i=0;i<10;i++){
				if((Number(i)+Number($('.order#order #menubox #itemfun .startchangetaste').val())*10)<temp1.length){
					$('.order#order #menubox #itemfun #taste'+i+' div#name1').html(temp2[(Number(i)+Number($('.order#order #menubox #itemfun .startchangetaste').val())*10)]);
					$('.order#order #menubox #itemfun #taste'+i+' div#name2').html(temp3[(Number(i)+Number($('.order#order #menubox #itemfun .startchangetaste').val())*10)]);
					$('.order#order #menubox #itemfun #taste'+i).prop('disabled',false);
					$('.order#order #menubox #itemfun .tasteno'+i).val(temp1[(Number(i)+Number($('.order#order #menubox #itemfun .startchangetaste').val())*10)]);
					$('.order#order #menubox #itemfun .tasteprice'+i).val(temp4[(Number(i)+Number($('.order#order #menubox #itemfun .startchangetaste').val())*10)]);
					$('.order#order #menubox #itemfun #taste'+i+' div#name1').parent('button').css({'background-color':temp5[(Number(i)+Number($('.order#order #menubox #itemfun .startchangetaste').val())*10)]});
				}
				else{
					$('.order#order #menubox #itemfun #taste'+i+' div#name1').html('');
					$('.order#order #menubox #itemfun #taste'+i+' div#name2').html('');
					$('.order#order #menubox #itemfun #taste'+i).prop('disabled',true);
					$('.order#order #menubox #itemfun .tasteno'+i).val('');
					$('.order#order #menubox #itemfun .tasteprice'+i).val('');
					$('.order#order #menubox #itemfun #taste'+i+' div#name1').parent('button').css({'background-color':''});
				}
			}
			/*var targetindex=$('.order#order #tabs1 #tempbox input[name="target"]').val();
			var i=0;
			while($('.order#order #'+tabs+' #listform .label:eq('+(Number($('.order#order #tabs1 #tempbox input[name="target"]').val())-i)+') input[name="order[]"]').val()=='－'){
				//console.log($('.order#order #'+tabs+' #listform .label:eq('+(Number($('.order#order #tabs1 #tempbox input[name="target"]').val())-i)+') input[name="order[]"]').val());
				i++;
			}
			i++;
			if($.inArray(i.toString(),tastearray1)>=0){
				if(tastearray1[$.inArray(i.toString(),tastearray1)+1].length>0){
					temp1=tastearray1[$.inArray(i.toString(),tastearray1)+1].split(',');
					temp2=tastearray2[$.inArray(i.toString(),tastearray1)+1].split(',');
					temp3=tastearray3[$.inArray(i.toString(),tastearray1)+1].split(',');
					temp4=tastearray4[$.inArray(i.toString(),tastearray1)+1].split(',');
					temp5=tastearray5[$.inArray(i.toString(),tastearray1)+1].split(',');
				}
				else{
				}
				for(i=0;i<10;i++){
					if(i<temp1.length){
						$('.order#order #menubox #itemfun #taste'+i+' div#name1').html(temp2[i]);
						$('.order#order #menubox #itemfun #taste'+i+' div#name2').html(temp3[i]);
						$('.order#order #menubox #itemfun #taste'+i).prop('disabled',false);
						$('.order#order #menubox #itemfun .tasteno'+i).val(temp1[i]);
						$('.order#order #menubox #itemfun .tasteprice'+i).val(temp4[i]);
						$('.order#order #menubox #itemfun #taste'+i+' div#name1').parent('button').css({'background-color':temp5[i]});
					}
					else{
						$('.order#order #menubox #itemfun #taste'+i+' div#name1').html('');
						$('.order#order #menubox #itemfun #taste'+i+' div#name2').html('');
						$('.order#order #menubox #itemfun #taste'+i).prop('disabled',true);
						$('.order#order #menubox #itemfun .tasteno'+i).val('');
						$('.order#order #menubox #itemfun .tasteprice'+i).val('');
						$('.order#order #menubox #itemfun #taste'+i+' div#name1').parent('button').css({'background-color':''});
					}
				}
			}
			else{
				for(i=0;i<10;i++){
					$('.order#order #menubox #itemfun #taste'+i+' div#name1').html('');
					$('.order#order #menubox #itemfun #taste'+i+' div#name2').html('');
					$('.order#order #menubox #itemfun #taste'+i).prop('disabled',true);
					$('.order#order #menubox #itemfun .tasteno'+i).val('');
					$('.order#order #menubox #itemfun .tasteprice'+i).val('');
					$('.order#order #menubox #itemfun #taste'+i+' div#name1').parent('button').css({'background-color':''});
				}
			}*/
		}
		else{
			for(i=0;i<10;i++){
				$('.order#order #menubox #itemfun #taste'+i+' div#name1').html('');
				$('.order#order #menubox #itemfun #taste'+i+' div#name2').html('');
				$('.order#order #menubox #itemfun #taste'+i).prop('disabled',true);
				$('.order#order #menubox #itemfun .tasteno'+i).val('');
				$('.order#order #menubox #itemfun .tasteprice'+i).val('');
				$('.order#order #menubox #itemfun #taste'+i+' div#name1').parent('button').css({'background-color':''});
			}
		}
		//console.log('tabs:'+tabs);
		//console.log('target:'+$('.order#order #tabs1 #tempbox input[name="target"]').val());
		//console.log('length:'+$('.order#order #'+tabs+' .listcontentbox .listcontent div[class^="label"]:eq('+$('.order#order #tabs1 #tempbox input[name="target"]').val()+')').find('input[name="templistitem[]"]').length);
		//console.log('no:'+$('.order#order #tabs1 #tempbox input[name="no"]').val());
		if($('.order#order #'+tabs+' .listcontentbox .listcontent div[class^="label"]:eq('+$('.order#order #tabs1 #tempbox input[name="target"]').val()+')').find('input[name="templistitem[]"]').length>0&&$('.order#order #tabs1 #tempbox input[name="no"]').val()!=''){
			//console.log('2');
			$('.order#order #content #numbox input').prop('disabled',true);
			$('.order#order #content #numbox button').prop('disabled',true);
			$('.order#order #content #menubox #itemfun table button').prop('disabled',true);
		}
		else{
			//console.log('1');
			$('.order#order #content #numbox input').prop('disabled',false);
			$('.order#order #content #numbox button').prop('disabled',false);
			//$('.order#order #content #menubox #itemfun table button').prop('disabled',false);
			for(var item=0;item<6;item++){
				if($('.order#order .parameters input[id="mname'+$('.order#order .initsetting #firlan').val()+'[]"]:eq('+item+')').val()!=""){
					$('.order#order #menubox #itemfun .itemmname'+(item+1)).prop('disabled',false);
				}
				else{
					$('.order#order #menubox #itemfun .itemmname'+(item+1)).prop('disabled',true);

				}
			}
		}
		if(temp1.length<=10){
			$('.order#order #menubox #itemfun #changetaste').prop('disabled',true);
		}
		else{
			$('.order#order #menubox #itemfun #changetaste').prop('disabled',false);
		}
	});
	$('.order#order #list #funbox').on('click','#all',function(){//全選點餐明細
		var tabs=changetagtarget();
		$('.order#order #'+tabs+' #listform .label').addClass('check');
		$('.order#order #'+tabs+' #listform .label input[id="checkbox[]"]').prop('checked',true);
	});
	$('.order#order #list #funbox').on('click','#cancel',function(){//取消勾選之點餐明細
		var tabs=changetagtarget();
		$('.order#order #'+tabs+' #listform .label').removeClass('check');
		$('.order#order #'+tabs+' #listform .label').removeClass('focus');
		$('.order#order #'+tabs+' #listform .label input[id="checkbox[]"]').prop('checked',false);
	});
	$('.order#order #billfun1').on('click','button',function(){//功能區1功能按鈕
		var tabs=changetagtarget();
		switch($('.order#order #billfun1 button').index(this)){
			case 0://'促銷'按鈕
				var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
				$('.itemdis #viewwindow .name1').html('');
				if($('.itemdis #viewwindow .name2').length>0){
					$('.itemdis #viewwindow .name2').html('');
				}
				else{
				}
				$('.itemdis #viewwindow #unitprice').html('0');
				//$('.itemdis #viewwindow #taste').html('');
				$('.itemdis #viewwindow #tastemoney').html('0');
				$('.itemdis #viewwindow #number').html('0');
				$('.itemdis #viewwindow #subtotal').html('0');
				$('.itemdis #viewwindow #dis1').html('0');
				$('.itemdis #viewwindow #dis2').html('0');
				$('.itemdis #viewwindow #total').html('0');
				if($('.order#order #tabs1 #tempbox input[name="no"]').val().length<=0){
				}
				else{
					$('.itemdis #viewwindow .name1').html($('.order#order #tabs1 #tempbox input[name="name"]').val());
					if($('.itemdis #viewwindow .name2').length>0){
						$('.itemdis #viewwindow .name2').html($('.order#order #tabs1 #tempbox input[name="name2"]').val());
					}
					else{
					}
					$('.itemdis #viewwindow #unitprice').html($('.order#order #tabs1 #tempbox input[name="unitprice"]').val());
					//$('.itemdis #viewwindow #taste').html($('.order#order #tabs1 #tempbox input[name="taste1name"]').val());
					$('.itemdis #viewwindow #tastemoney').html($('.order#order #tabs1 #tempbox input[name="taste1money"]').val());
					$('.itemdis #viewwindow #number').html($('.order#order #tabs1 #tempbox input[name="number"]').val());
					$('.itemdis #viewwindow #subtotal').html((Number($('.order#order #tabs1 #tempbox input[name="unitprice"]').val())+Number($('.order#order #tabs1 #tempbox input[name="taste1money"]').val()))*Number($('.order#order #tabs1 #tempbox input[name="number"]').val()));
					if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
						$('.itemdis #viewwindow #subtotal').html( roundfun($('.itemdis #viewwindow #subtotal').html(),precision));
					}
					else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
						$('.itemdis #viewwindow #subtotal').html( ceilfun($('.itemdis #viewwindow #subtotal').html(),precision));
					}
					else{//無條件捨去
						$('.itemdis #viewwindow #subtotal').html( floorfun($('.itemdis #viewwindow #subtotal').html(),precision));
					}
					$('.itemdis #viewwindow #dis2').html($('.order#order #tabs1 #tempbox input[name="discount"]').val());
					$('.itemdis #viewwindow #disbut').val($('.order#order #tabs1 #tempbox input[name="discontent"]').val());
					$('.itemdis #viewwindow #total').html($('.order#order #tabs1 #tempbox input[name="subtotal"]').val());
					itemdis.dialog('open');
				}
				break;
			case 1://'刪除'按鈕
				if($('.order#order #'+tabs+' #listform .focus').length==0&&$('.order#order #'+tabs+' #listform .label.check').length==0){
				}
				else{
					if(tabs=='tabs5'&&($('.order#order #'+tabs+' #listform .label:eq(0) input[id="checkbox[]"]').prop('checked')||($('.order#order #'+tabs+' #listform .label').index($('.order#order #'+tabs+' #listform .label.focus'))==0))){
						var r=confirm("您確認要取消套餐嗎？");
						if(r==true){
							if($('.order#order .initsetting #opentemp').val()=='1'){
								$('.order#order #billfun #billfun1 button:eq(4)').prop('disabled',false);
							}
							else{
								$('.order#order #billfun #billfun1 button:eq(4)').prop('disabled',true);
							}
							$('.order#order #billfun #billfun2 button:eq(5)').prop('disabled',true);
							/*$('.order#order #billfun #billfun2 button:eq(5)').val('套餐修改');
							$.ajax({
								url:'./lib/js/getsetname.ajax.php',
								method:'post',
								data:{'type':'set'},
								dataType:'json',
								success:function(d){
									$('.order#order #billfun #billfun2 button:eq(5) div#name1').html(d['button1']);
									$('.order#order #billfun #billfun2 button:eq(5) div#name2').html(d['button2']);
								},
								error:function(e){
									//console.log(e);
								}
							});*/
							if($('.order#order .companydata #ispad').val()=='submachine'){
								$('.order#order #billfun #billfun1 button:eq(3)').prop('disabled',true);
							}
							else{
								$('.order#order #billfun #billfun1 button:eq(3)').prop('disabled',false);
							}
							if($('.order#order .initsetting #openfloor').val()=='1'||$('.order#order .companydata #ispad').val()=='submachine'||$('.order#order .initsetting #salecash').val()=='0'){
								$('.order#order #billfun #billfun1 button:eq(6)').prop('disabled',true);
							}
							else{
								$('.order#order #billfun #billfun1 button:eq(6)').prop('disabled',false);
							}
							$('.order#order #'+tabs+' #listform .listcontent').html('');
							$('.order#order #MemberBill #list #tabs4button').prop('disabled',false);
							$('.order#order #MemberBill #list #tabs5button').prop('disabled',true);
							$('.order#order #MemberBill #list #tabs4button').trigger('click');
							initmenu($('.order#order .initsetting #menutyperow').val(),$('.order#order .initsetting #menutypecol').val(),$('.order#order .initsetting #menurow').val(),$('.order#order .initsetting #menucol').val());
							$('.order#order #tabs1 #tempbox input[name="target"]').val('0');
							$('.order#order #tabs1 #tempbox input[name="linenumber"]').val('0');
							$('.order#order #tabs1 #tempbox input[name="typeno"]').val('');
							$('.order#order #tabs1 #tempbox input[name="type"]').val('');
							$('.order#order #tabs1 #tempbox input[name="no"]').val('');
							$('.order#order #tabs1 #tempbox input[name="personcount"]').val('0');
							$('.order#order #tabs1 #tempbox input[name="needcharge"]').val('1');
							$('.order#order #tabs1 #tempbox input[name="dis1"]').val('');
							$('.order#order #tabs1 #tempbox input[name="dis2"]').val('');
							$('.order#order #tabs1 #tempbox input[name="dis3"]').val('');
							$('.order#order #tabs1 #tempbox input[name="dis4"]').val('');
							$('.order#order #tabs1 #tempbox input[name="name"]').val('');
							$('.order#order #tabs1 #tempbox input[name="name2"]').val('');
							$('.order#order #tabs1 #tempbox input[name="isgroup"]').val('');
							$('.order#order #tabs1 #tempbox input[name="childtype"]').val('');
							$('.order#order #tabs1 #tempbox input[name="mname1"]').val('');
							$('.order#order #tabs1 #tempbox input[name="mname2"]').val('');
							$('.order#order #tabs1 #tempbox input[name="insaleinv"]').val('');
							$('.order#order #tabs1 #tempbox input[name="unitprice"]').val('0');
							$('.order#order #tabs1 #tempbox input[name="money"]').val('0');
							$('.order#order #tabs1 #tempbox input[name="discount"]').val('0');
							$('.order#order #tabs1 #tempbox input[name="discontent"]').val('');
							$('.order#order #tabs1 #tempbox input[name="number"]').val('0');
							$('.order#order #tabs1 #tempbox input[name="subtotal"]').val('0');
							$('.order#order #tabs1 #tempbox input[name="taste1"]').val('');
							$('.order#order #tabs1 #tempbox input[name="taste1name"]').val('');
							$('.order#order #tabs1 #tempbox input[name="taste2name"]').val('');
							$('.order#order #tabs1 #tempbox input[name="taste2"]').val('');
							$('.order#order #tabs1 #tempbox input[name="taste1price"]').val('');
							$('.order#order #tabs1 #tempbox input[name="taste1number"]').val('');
							$('.order#order #tabs1 #tempbox input[name="taste1money"]').val('0');
							$('.order#order #tabs1 #tempbox input[name="background"]').val('');
							$('.order#order #tabs1 #editview').val('');
							$('.order#order #MemberBill #billfun #billfun1 input[type="button"]').prop('disabled',false);
							$('.order#order #MemberBill #billfun #billfun1 input[type="button"]').css({'color':'#ffffff'});
							$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(2)').prop('disabled',false);
							$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(2)').css({'color':'#ffffff'});
							$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(4)').prop('disabled',true);
							$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(4)').css({'color':'#a8a8a8'});
							$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(7)').prop('disabled',true);
							$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(7)').css({'color':'#a8a8a8'});
							$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(8)').prop('disabled',true);
							$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(8)').css({'color':'#a8a8a8'});
							$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(10)').prop('disabled',false);
							$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(10)').css({'color':'#000000'});
							$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(11)').prop('disabled',false);
							$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(11)').css({'color':'#000000'});
							if($('.order#order .initsetting #opentemp').val()=='1'){
								$('.order#order #billfun #billfun1 button:eq(4)').prop('disabled',false);
							}
							else{
								$('.order#order #billfun #billfun1 button:eq(4)').prop('disabled',true);
							}
							$('.order#order #billfun #billfun2 button:eq(5)').prop('disabled',true);
							$('.order#order #tabs1 #editview').val('');
							$('.order#order .parameters #typeno').val('');
							$('.order#order .parameters #type').val('');
							$('.order#order .parameters #no').val('');
							$('.order#order .parameters #name').val('');
							$('.order#order .parameters #msize').val('');
							$('.order#order .parameters input[id^="mname"]').val('');
							$('.order#order .parameters input[id^="money"]').val('');
							$('.order#order .parameters #taste1').val('');
							$('.order#order .parameters #taste1name').val('');
							$('.order#order .parameters #taste1money').val('');
							$('.order#order #menubox #itemfun .startchangetaste').val('0');
							$('.order#order #menubox #itemfun .itemfun').trigger( "click" );
							$('.order#order #billfun #billfun1 button:eq(1)').prop('disabled',false);
							if($('.order#order .initsetting #weborder').val()=='1'){
								$('.order#order #billfun #billfun1 button:eq(5)').prop('disabled',false);
							}
							else{
								$('.order#order #billfun #billfun1 button:eq(5)').prop('disabled',true);
							}
							if($('.order#order .companydata #ispad').val()=='submachine'){
								//$('.order#order #billfun #billfun2 button:eq(3)').prop('disabled',true);
							}
							else{
								$.ajax({
									url:'./lib/js/checkopen.ajax.php',
									async:false,
									data:'html',
									success:function(d){
										if(d=='error'){
											$('.order#order #billfun #billfun2 button:eq(0)').prop('disabled',false);
											$('.order#order #billfun #billfun2 button:eq(1)').prop('disabled',true);
										}
										else{
											$('.order#order #billfun #billfun2 button:eq(0)').prop('disabled',true);
											$('.order#order #billfun #billfun2 button:eq(1)').prop('disabled',false);
										}
									},
									error:function(e){
										//console.log(e);
									}
								});
								$('.order#order #billfun #billfun2 button:eq(3)').prop('disabled',false);
							}
							$('.order#order #billfun #billfun2 button:eq(4)').prop('disabled',false);
							$('.order#order #billfun #billfun2 button:eq(6)').prop('disabled',false);
							$('.order#order #billfun #billfun2 button:eq(7)').prop('disabled',false);
							$('.order#order #billfun #billfun3button').prop('disabled',false);
							$('.order#order #billfun #billfun1button').trigger('click');
							if($('.order#order .initsetting #menutype').val()==3){
								$('.order#order #menubox #itemtype').css({'display':''});
								$('.order#order #menubox #items').css({'display':'none'});
							}
							else{
							}
							if($('.order#order #tabs4 #listform .label').length>0){
								$('.order#order #tabs4 #listform .label:eq('+($('.order#order #tabs4 #listform .label').length-1)+')').trigger('click');
							}
							else{
							}
						}
						else{
							$('.order#order #'+tabs+' #listform .label:eq('+i+') input[id="checkbox[]"]').prop('checked',false);
						}
					}
					else if(($('.order#order #'+tabs+' #listform .label.check').length==0&&$('.order#order #'+tabs+' #listform .label.focus input[name="templistitem[]"]').length>0)||$('.order#order #'+tabs+' #listform .label.check input[name="templistitem[]"]').length>0){
						reason.dialog('open');
					}
					else{
						var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
						$('.order#order #tabs1 #tempbox input[name="target"]').val('0');
						$('.order#order #tabs1 #tempbox input[name="linenumber"]').val('');
						$('.order#order #tabs1 #tempbox input[name="typeno"]').val('');
						$('.order#order #tabs1 #tempbox input[name="type"]').val('');
						$('.order#order #tabs1 #tempbox input[name="no"]').val('');
						$('.order#order #tabs1 #tempbox input[name="personcount"]').val('0');
						$('.order#order #tabs1 #tempbox input[name="needcharge"]').val('1');
						$('.order#order #tabs1 #tempbox input[name="dis1"]').val('');
						$('.order#order #tabs1 #tempbox input[name="dis2"]').val('');
						$('.order#order #tabs1 #tempbox input[name="dis3"]').val('');
						$('.order#order #tabs1 #tempbox input[name="dis4"]').val('');
						$('.order#order #tabs1 #tempbox input[name="name"]').val('');
						$('.order#order #tabs1 #tempbox input[name="name2"]').val('');
						$('.order#order #tabs1 #tempbox input[name="isgroup"]').val('0');
						$('.order#order #tabs1 #tempbox input[name="childtype"]').val('');
						$('.order#order #tabs1 #tempbox input[name="mname1"]').val('');
						$('.order#order #tabs1 #tempbox input[name="mname2"]').val('');
						$('.order#order #tabs1 #tempbox input[name="insaleinv"]').val('');
						$('.order#order #tabs1 #tempbox input[name="unitprice"]').val('');
						$('.order#order #tabs1 #tempbox input[name="money"]').val('');
						$('.order#order #tabs1 #tempbox input[name="discount"]').val('0');
						$('.order#order #tabs1 #tempbox input[name="discontent"]').val('');
						$('.order#order #tabs1 #tempbox input[name="number"]').val('');
						$('.order#order #tabs1 #tempbox input[name="subtotal"]').val('');
						$('.order#order #tabs1 #tempbox input[name="taste1"]').val('');
						$('.order#order #tabs1 #tempbox input[name="taste1name"]').val('');
						$('.order#order #tabs1 #tempbox input[name="taste2name"]').val('');
						$('.order#order #tabs1 #tempbox input[name="taste1price"]').val('');
						$('.order#order #tabs1 #tempbox input[name="taste1number"]').val('');
						$('.order#order #tabs1 #tempbox input[name="taste1money"]').val('0');
						$('.order#order #tabs1 #tempbox input[name="taste2"]').val('');
						$('.order#order #tabs1 #editview').val('');
						$('.order#order .parameters #typeno').val('');
						$('.order#order .parameters #type').val('');
						$('.order#order .parameters #no').val('');
						$('.order#order .parameters #name').val('');
						$('.order#order .parameters #msize').val('');
						$('.order#order .parameters input[id^="mname"]').val('');
						$('.order#order .parameters input[id^="money"]').val('');
						$('.order#order .parameters #taste1').val('');
						$('.order#order .parameters #taste1name').val('');
						$('.order#order .parameters #taste1money').val('');
						$('.order#order #menubox #itemfun .startchangetaste').val('0');
						$('.order#order #menubox #itemfun .itemfun').trigger( "click" );
						if($('.order#order #'+tabs+' #listform .label.check').length>0){
							var deltarget='check';
						}
						else{
							var deltarget='focus';
						}
						if(deltarget=='check'){
							var minticket=$('.order#order #'+tabs+' #listform .label').index($('.order#order #'+tabs+' #listform .label.check'));
							var ticketlength=parseInt($('.order#order #'+tabs+' #listform .label').length)-1;
							while($('.order#order #'+tabs+' #listform .label.check').length>0){
								var i=$('.order#order #'+tabs+' #listform .label').index($('.order#order #'+tabs+' #listform .label.check'));
								$('.order#order #banner #detail #viewtotal').val(Number($('.order#order #banner #detail #viewtotal').val())-Number($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="subtotal[]"]').val()));
								$('.order#order #banner #detail #viewnumber').val(Number($('.order#order #banner #detail #viewnumber').val())-Number($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="number[]"]').val()));
								if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
									$('.order#order #banner #detail #viewtotal').val( roundfun($('.order#order #banner #detail #viewtotal').val(),precision));
									$('.order#order #banner #detail #viewnumber').val( roundfun($('.order#order #banner #detail #viewnumber').val(),precision));
								}
								else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
									$('.order#order #banner #detail #viewtotal').val( ceilfun($('.order#order #banner #detail #viewtotal').val(),precision));
									$('.order#order #banner #detail #viewnumber').val( ceilfun($('.order#order #banner #detail #viewnumber').val(),precision));
								}
								else{//無條件捨去
									$('.order#order #banner #detail #viewtotal').val( floorfun($('.order#order #banner #detail #viewtotal').val(),precision));
									$('.order#order #banner #detail #viewnumber').val( floorfun($('.order#order #banner #detail #viewnumber').val(),precision));
								}
								$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="total"]').val($('.order#order #banner #detail #viewtotal').val());
								$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="totalnumber"]').val($('.order#order #banner #detail #viewnumber').val());

								$('.setperson #view input[name="persons'+$('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val(parseInt($('.setperson #view input[name="persons'+$('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val())-parseInt($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="number[]"]').val()));
								$('.setperson #buttons #submit').trigger('click');
								//
								//添加刪除理由
								//
								if($('.order#order #tabs4 #listform .label:eq('+i+') input[name="personcount[]"]').length>0){
									$('.setperson #view input[name="persons'+$('.order#order #tabs4 #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val(parseInt($('.setperson #view input[name="persons'+$('.order#order #tabs4 #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val())+parseInt($('.order#order #tabs4 #listform .label:eq('+i+') input[name="number[]"]').val()));
									$('.setperson #buttons #submit').trigger('click');
								}
								else{
								}
								if($('.order#order .initsetting #secview').val()=='1'){
									$.ajax({
										url:'../secview/voiditem.ajax.php',
										method:'post',
										async: false,
										data:{'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'linenumber':$('.order#order #tabs4 #listform .label:eq('+i+') input[name="linenumber[]"]').val()},
										dataType:'html',
										success:function(d){
											if(d.length>20){
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													data:{'html':'voiditem.ajax.php '+d},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else{
											}
											//console.log(d);
											//$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
										},
										error:function(e){
											//console.log(e);
										}
									});
								}
								else{
								}
								if($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="templistitem[]"]').length>0){
									//ajax傳送data還缺少'刪除理由'的變數//
									$.ajax({
										url:'./lib/js/voiditem.ajax.php',
										method:'post',
										async: false,
										data:{'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'linenumber':$('.order#order #tabs4 #listform .label:eq('+i+') input[name="linenumber[]"]').val(),'machine':$('.order#order .companydata #terminalnumber').val()},
										dataType:'html',
										success:function(d){
											if(d.length>20){
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													data:{'html':'voiditem.ajax.php '+d},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else{
											}
											$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
										},
										error:function(e){
											//console.log(e);
										}
									});
								}
								else{
									$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
								}
							}
							if($('.order#order #'+tabs+' #listform .label').length>0){
								if(minticket==0){
									$('.order#order #'+tabs+' #listform .label:eq(0)').trigger('click');
								}
								else{
									$('.order#order #'+tabs+' #listform .label:eq('+(parseInt(minticket)-1)+')').trigger('click');
								}
							}
							else{
							}
						}
						else{
							var minticket=$('.order#order #'+tabs+' #listform .label').index($('.order#order #'+tabs+' #listform .label.focus'));
							//console.log(minticket);
							var ticketlength=parseInt($('.order#order #'+tabs+' #listform .label').length)-1;
							//console.log(ticketlength);
							while($('.order#order #'+tabs+' #listform .label.focus').length>0){
								var i=$('.order#order #'+tabs+' #listform .label').index($('.order#order #'+tabs+' #listform .label.focus'));
								$('.order#order #banner #detail #viewtotal').val(Number($('.order#order #banner #detail #viewtotal').val())-Number($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="subtotal[]"]').val()));
								$('.order#order #banner #detail #viewnumber').val(Number($('.order#order #banner #detail #viewnumber').val())-Number($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="number[]"]').val()));
								if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
									$('.order#order #banner #detail #viewtotal').val( roundfun($('.order#order #banner #detail #viewtotal').val(),precision));
									$('.order#order #banner #detail #viewnumber').val( roundfun($('.order#order #banner #detail #viewnumber').val(),precision));
								}
								else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
									$('.order#order #banner #detail #viewtotal').val( ceilfun($('.order#order #banner #detail #viewtotal').val(),precision));
									$('.order#order #banner #detail #viewnumber').val( ceilfun($('.order#order #banner #detail #viewnumber').val(),precision));
								}
								else{//無條件捨去
									$('.order#order #banner #detail #viewtotal').val( floorfun($('.order#order #banner #detail #viewtotal').val(),precision));
									$('.order#order #banner #detail #viewnumber').val( floorfun($('.order#order #banner #detail #viewnumber').val(),precision));
								}
								$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="total"]').val($('.order#order #banner #detail #viewtotal').val());
								$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="totalnumber"]').val($('.order#order #banner #detail #viewnumber').val());

								$('.setperson #view input[name="persons'+$('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val(parseInt($('.setperson #view input[name="persons'+$('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val())-parseInt($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="number[]"]').val()));
								$('.setperson #buttons #submit').trigger('click');
								//
								//添加刪除理由
								//
								if($('.order#order #tabs4 #listform .label:eq('+i+') input[name="personcount[]"]').length>0){
									$('.setperson #view input[name="persons'+$('.order#order #tabs4 #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val(parseInt($('.setperson #view input[name="persons'+$('.order#order #tabs4 #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val())+parseInt($('.order#order #tabs4 #listform .label:eq('+i+') input[name="number[]"]').val()));
									$('.setperson #buttons #submit').trigger('click');
								}
								else{
								}
								if($('.order#order .initsetting #secview').val()=='1'){
									$.ajax({
										url:'../secview/voiditem.ajax.php',
										method:'post',
										async: false,
										data:{'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'linenumber':$('.order#order #tabs4 #listform .label:eq('+i+') input[name="linenumber[]"]').val()},
										dataType:'html',
										success:function(d){
											if(d.length>20){
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													data:{'html':'voiditem.ajax.php '+d},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else{
											}
											//console.log(d);
											//$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
										},
										error:function(e){
											//console.log(e);
										}
									});
								}
								else{
								}
								if($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="templistitem[]"]').length>0){
									//ajax傳送data還缺少'刪除理由'的變數//
									$.ajax({
										url:'./lib/js/voiditem.ajax.php',
										method:'post',
										async: false,
										data:{'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'linenumber':$('.order#order #tabs4 #listform .label:eq('+i+') input[name="linenumber[]"]').val(),'machine':$('.order#order .companydata #terminalnumber').val()},
										dataType:'html',
										success:function(d){
											if(d.length>20){
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													data:{'html':'voiditem.ajax.php '+d},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else{
											}
											$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
										},
										error:function(e){
											//console.log(e);
										}
									});
								}
								else{
									$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
								}
							}
							if($('.order#order #'+tabs+' #listform .label').length>0){
								if(minticket==0){
									$('.order#order #'+tabs+' #listform .label:eq(0)').trigger('click');
								}
								else{
									$('.order#order #'+tabs+' #listform .label:eq('+(parseInt(minticket)-1)+')').trigger('click');
								}
							}
							else{
							}
						}
						/*for(var i=($('.order#order #'+tabs+' #listform .label').length-1);i>=0;i--){
							if($('.order#order #'+tabs+' #listform .label:eq('+i+') input[id="checkbox[]"]').prop('checked')){
								$('.order#order #banner #detail #viewtotal').val(Number($('.order#order #banner #detail #viewtotal').val())-Number($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="subtotal[]"]').val()));
								$('.order#order #banner #detail #viewnumber').val(Number($('.order#order #banner #detail #viewnumber').val())-Number($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="number[]"]').val()));
								$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="total"]').val($('.order#order #banner #detail #viewtotal').val());
								$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="totalnumber"]').val($('.order#order #banner #detail #viewnumber').val());

								$('.setperson #view input[name="persons'+$('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val(parseInt($('.setperson #view input[name="persons'+$('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val())-parseInt($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="number[]"]').val()));
								$('.setperson #buttons #submit').trigger('click');
								//
								//添加刪除理由
								//
								if($('.order#order #tabs4 #listform .label:eq('+i+') input[name="personcount[]"]').length>0){
									$('.setperson #view input[name="persons'+$('.order#order #tabs4 #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val(parseInt($('.setperson #view input[name="persons'+$('.order#order #tabs4 #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val())+parseInt($('.order#order #tabs4 #listform .label:eq('+i+') input[name="number[]"]').val()));
									$('.setperson #buttons #submit').trigger('click');
								}
								else{
								}
								if($('.order#order .initsetting #secview').val()=='1'){
									$.ajax({
										url:'../secview/voiditem.ajax.php',
										method:'post',
										async: false,
										data:{'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'linenumber':$('.order#order #tabs4 #listform .label:eq('+i+') input[name="linenumber[]"]').val()},
										dataType:'html',
										success:function(d){
											if(d.length>20){
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													data:{'html':'voiditem.ajax.php '+d},
													dataType:'html',
													success:function(d){
														//console.log(d);
													},
													error:function(e){
														//console.log(e);
													}
												});
											}
											else{
											}
											//console.log(d);
											//$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
										},
										error:function(e){
											//console.log(e);
										}
									});
								}
								else{
								}
								if($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="templistitem[]"]').length>0){
									//ajax傳送data還缺少'刪除理由'的變數//
									$.ajax({
										url:'./lib/js/voiditem.ajax.php',
										method:'post',
										async: false,
										data:{'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'linenumber':$('.order#order #tabs4 #listform .label:eq('+i+') input[name="linenumber[]"]').val()},
										dataType:'html',
										success:function(d){
											if(d.length>20){
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													data:{'html':'voiditem.ajax.php '+d},
													dataType:'html',
													success:function(d){
														//console.log(d);
													},
													error:function(e){
														//console.log(e);
													}
												});
											}
											else{
											}
											$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
										},
										error:function(e){
											//console.log(e);
										}
									});
								}
								else{
									$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
								}
							}
							else{
							}
						}*/
						$('.order#order #numbox input[type="button"]:eq(14)').prop('disabled',true);
						$('.order#order #numbox input[type="button"]:eq(14)').css({'color':'#a8a8a8'});
						if($('.order#order #MemberBill #tabs4 #listform input[name="templistitem[]"]').length!=$('.order#order #MemberBill #tabs4 #listform .label').length){
						}
						else{
							if($('.order#order .initsetting #controltable').val()==1){
								$.ajax({
									url:'./lib/js/change.button4.php',
									method:'post',
									data:{'type':'b'},
									dataType:'json',
									success:function(d){
										//console.log(d);
										if($('.order#order #billfun #billfun1 button:eq(4) #name1').length>0){
											$('.order#order #billfun #billfun1 button:eq(4) #name1').html(d[0]);
										}
										else{
										}
										if($('.order#order #billfun #billfun1 button:eq(4) #name2').length>0){
											$('.order#order #billfun #billfun1 button:eq(4) #name2').html(d[0]);
										}
										else{
										}
										if($('.order#order .initsetting #controltable').val()=='1'&&$('.order#order .initsetting #opentemp').val()=='0'){
											$('.order#order #billfun #billfun1 button:eq(4)').prop('disabled',false);
										}
										else{
										}
										$('.order#order #billfun #billfun1 button:eq(4)').val(d[2]);
									},
									error:function(e){
										//console.log(e);
									}
								});
							}
							else{
							}
						}
					}
				}
				break;
			case 2://'開錢櫃'按鈕
				$.ajax({
					url:'./lib/js/create.cmdtxt.php',
					method:'post',
					async: false,
					data:{'cmd':$('.order#order #tabs4 #listform input[name="machinetype"]').val()+'-cashdrawer'},
					dataType:'html',
					success:function(d){
						//console.log(d);
					},
					error:function(e){
						//console.log(e);
					}
				});
				/*錢都錄借接*/
				if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
					/*start tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						async:false,
						data:{'html':'start posdvr-sendmessage','file':'posdvr'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){console.log(e);}
					});
					if(typeof api_sendmessage_posdvr!=="undefined"&&typeof api_sendmessage_posdvr==="function"){
						api_sendmessage_posdvr('cashdrawer');
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'success','file':'posdvr'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							async:false,
							data:{'html':'error sendmessage is not function','file':'posdvr'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					/*end tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						async:false,
						data:{'html':'end posdvr-sendmessage','file':'posdvr'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				//2017/12/29var mywin=window.open('cashdrawer://','','width=1px,height=1px');
				//2017/12/29mywin.document.title='cashdrawer';
				break;
			case 3://'結帳'按鈕
				$.ajax({
					url:'./lib/js/checkopen.ajax.php',
					async:false,
					dataType:'html',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'checkopen.ajax.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						console.log(d);
						if(d=='success'){
							if($('.order#order #'+tabs+' .listcontent .label').length<=0){
							}
							else{
								var precision=$('.order#order .initsetting #accuracy').val();//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
								$('.result input[name="sendtype"]').val('result');
								if($('.order#order .initsetting #openpay').val()=='1'){
									$('.result .numbox .otherpay').prop('disabled',false);
								}
								else{
									$('.result .numbox .otherpay').prop('disabled',true);
								}
								if($('.order#order .initsetting #cashbut').val()=='1'){
									$('.result .numbox .cashbut').prop('disabled',false);
								}
								else{
									$('.result .numbox .cashbut').prop('disabled',true);
								}
								$('.result .numbox .moneybut').prop('disabled',false);
								$('.result #funbox #loopbut #name1').html($('.order#order .initsetting #listprintname1').val());
								$('.result #funbox #loopbut #name2').html($('.order#order .initsetting #listprintname2').val());
								$('.result #viewwindow .sendviewwindow input[name="looptype"]').val($('.order#order .initsetting #looptype').val());
								if($('.order#order .initsetting #openchar').val()=='0'){
									$('.result #funbox .chargebut').prop('disabled',true);
									$('.result #funbox .chargebut #name1').html('不收服務費');
									$('.result #funbox #charno').html($('.order#order .initsetting #charge').val());
								}
								else{
									$('.result #funbox .chargebut').prop('disabled',false);
									if($('.order#order .initsetting #charge').val()=='1'){
										$('.result #funbox .chargebut #name1').html('收服務費');
										$('.result #funbox #charno').val($('.order#order .initsetting #charge').val());
									}
									else{
										$('.result #funbox .chargebut #name1').html('不收服務費');
										$('.result #funbox #charno').val($('.order#order .initsetting #charge').val());
									}
								}
								//$('.result .numbox .ban #name1').html('輸入統編');
								$('.result input[name="view"]').val('');
								$('.result input[name="view"]').css({'background-color':'#FFFFFF'});
								$('.result #viewwindow input[name="tempban"]').css({'background-color':'#EFEBDE'});
								$('.result #viewwindow input[name="tempban"]').prop('readonly',true);
								$('.result #viewwindow input[name="tempban"]').val('');
								$.ajax({
									url:'../secview/writeban.ajax.php',
									method:'post',
									data:{'tempban':'','machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val()}
								});
								$('.result #viewwindow input[name="tempcontainer"]').css({'background-color':'#EFEBDE'});
								$('.result #viewwindow input[name="tempcontainer"]').prop('readonly',true);
								$('.result #viewwindow input[name="tempcontainer"]').val('');
								if($('.result #viewwindow input[name="treetel"]').length>0&&$('.result #viewwindow input[name="treetel"]').val()!=''){
									$('.result #viewwindow input[name="treetel"]').css({'background-color':'#EFEBDE'});
									$('.result #viewwindow input[name="treetel"]').prop('readonly',true);
									$('.result #viewwindow input[name="treetel"]').val('');
									$('.result #funbox .pointtree #name2').html('');
									$('.result #funbox .pointtree #name3').html('');
									$.ajax({
										url:'../secview/writepoint.ajax.php',
										method:'post',
										data:{'tel':'','point':'0','machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val()}
									});
								}
								else{
								}
								$('.result .target').val('view');
								$('.result #viewwindow #total').html('0');
								$('.result #viewwindow #temptotal').val('0');
								$('.result #viewwindow #itemdis').html('0');
								$('.result #viewwindow #tempdis').val('0');
								$('.result #viewwindow #memberdis').html('0');
								$('.result #viewwindow #listdis1').html('0');
								$('.result #viewwindow #listdis2').html('0');
								$('.result #viewwindow #charge').html('0');
								$('.result #viewwindow #coupon1').html('0');
								$('.result #viewwindow #coupon2').html('0');
								$('.result #viewwindow #should').html('0');
								$('.result #viewwindow #cashcomm').html('0');
								$('.result #viewwindow #already').html('0');
								$('.result #viewwindow #cashmoney').html('0');
								$('.result #viewwindow #cash').html('0');
								$('.result #viewwindow #other').html('0');
								$('.result #viewwindow #otherfix').html('0');
								$('.result #viewwindow #change').html('0');
								if(($('.order#order #banner #detail #invnum').length>0&&$('.order#order #banner #detail #invnum').val()=='0')||($('.order#order #banner #detail #oinv').length>0&&$('.order#order #banner #detail #oinv').val()=='ERROR')){
									var con=confirm('目前發票數量不足，是否繼續結帳？');
									if(con==true){
										$('.result #funbox .invbut').prop('disabled',true);
										$('.result #funbox .invbut #name1').html('不開立發票');
										$('.result #funbox .invno').val('0');
										if($('.order#order .initsetting #comfloor').val()=='1'){
											var total=0;
											$.each($('.order#order #'+tabs+' #listform .label'),function(index,value){
												total=Number(total)+(Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="money[]"]').val())*Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="number[]"]').val()));
											});
											if(Number(total)<Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())){
												$('.result #viewwindow input[name="floorspan"]').val((Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())-Number(total)));
											}
											else{
												$('.result #viewwindow input[name="floorspan"]').val('0');
											}
										}
										else{
											if(Number($('.order#order #banner #detail #viewtotal').val())<Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())){
												$('.result #viewwindow input[name="floorspan"]').val((Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())-Number($('.order#order #banner #detail #viewtotal').val())));
											}
											else{
												$('.result #viewwindow input[name="floorspan"]').val('0');
											}
										}
										if(Number($('.result #viewwindow input[name="floorspan"]').val())>0){
											var t=confirm('不足低銷，將以低消計算('+$('.result .frontunit').val()+$('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val()+$('.result .unit').val()+')');
											if(t==true){
												/*var total=0;
												var dis=0;
												$.each($('.order#order #'+tabs+' #listform .label'),function(index,value){
													total=Number(total)+(Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="money[]"]').val())*Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="number[]"]').val()));
													dis=Number(dis)+Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="discount[]"]').val());
												});*/
												$('.result #viewwindow #total').html($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val());
												$('.result #viewwindow #itemdis').html('0');
												if($('.order#order .initsetting #autodis').val()=='1'){//開啟自動優惠
													$.ajax({
														url:'./lib/js/compdis.ajax.php',
														method:'post',
														async: false,
														data:$('.order#order #tabs4 #listform').serialize(),
														dataType:'html',
														success:function(d){
															if(d.length>20){
																$.ajax({
																	url:'./lib/js/print.php',
																	method:'post',
																	data:{'html':'compdis.ajax.php '+d},
																	dataType:'html',
																	success:function(d){/*console.log(d);*/},
																	error:function(e){/*console.log(e);*/}
																});
															}
															else{
															}
															var temp=d.split(';');
															if($.isNumeric(temp[0])){
																$('.result #viewwindow #autodis').html(temp[0]);
																$('.result #viewwindow input[name="autodiscontent"]').val(temp[1]);
																$('.result #viewwindow input[name="autodispremoney"]').val(temp[2]);
															}
															else{
																$('.result #viewwindow #autodis').html('0');
																$('.result #viewwindow input[name="autodiscontent"]').val('');
																$('.result #viewwindow input[name="autodispremoney"]').val('0');
															}
															console.log(d);
														},
														error:function(e){
															console.log(e)
														}
													});
												}
												else{
													$('.result #viewwindow #autodis').html('0');
													$('.result #viewwindow input[name="autodiscontent"]').val('');
													$('.result #viewwindow input[name="autodispremoney"]').val('0');
												}
												//$('.result #viewwindow #memberdis').html((Number($('.result #viewwindow #total').html())-Number($('.result #viewwindow #itemdis').html()))*%+NUMBER);//設定檔內設定
												$('.result #viewwindow #memberdis').html(0);
												/*設定檔內設定*/
												if($('.order#order .initsetting #openchar').val()=='1'){//開啟服務費
													if($('.order#order .initsetting #chargeeq').val()=='1'){//依照折扣前價格
														$('.result #viewwindow #charge').html(Number($('.result #viewwindow #total').html())*(Number($('.order#order .initsetting #chargenumber').val())/100));
													}
													else{//依照折扣後價格
														$('.result #viewwindow #charge').html((Number($('.result #viewwindow #total').html())-Number($('.result #viewwindow #itemdis').html())-Number($('.result #viewwindow #memberdis').html())-Number($('.result #viewwindow #listdis1').html())-Number($('.result #viewwindow #listdis2').html()))*(Number($('.order#order .initsetting #chargenumber').val())/100));
														//console.log($('.result #viewwindow #charge').html());
													}
													var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
													/*設定檔內可設定使用何種進位*/
													if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
														$('.result #viewwindow #charge').html( roundfun($('.result #viewwindow #charge').html(),precision));
													}
													else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
														$('.result #viewwindow #charge').html( ceilfun($('.result #viewwindow #charge').html(),precision));
													}
													else{//無條件捨去
														$('.result #viewwindow #charge').html( floorfun($('.result #viewwindow #charge').html(),precision));
													}
													$('.order#order #tabs4 #listform input[name="charge"]').val($('.result #viewwindow #charge').html());
												}
												else{//關閉服務費
												}
												$('.result #viewwindow #should').html(Number($('.result #viewwindow #total').html())-Number($('.result #viewwindow #itemdis').html())-Number($('.result #viewwindow #memberdis').html())-Number($('.result #viewwindow #listdis1').html())-Number($('.result #viewwindow #listdis2').html())+Number($('.result #viewwindow #charge').html())-Number($('.result #viewwindow #coupon1').html())-Number($('.result #viewwindow #coupon2').html())-Number($('.result #viewwindow #autodis').html()));
												$('.result #viewwindow #listtotal').html(Number($('.result #viewwindow #total').html())-Number($('.result #viewwindow #itemdis').html())-Number($('.result #viewwindow #autodis').html()));
												var precision=$('.order#order .initsetting #accuracy').val();//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
												/*設定檔內可設定使用何種進位*/
												if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
													$('.result #viewwindow #should').html( roundfun($('.result #viewwindow #should').html(),precision));
													$('.result #viewwindow #listtotal').html( roundfun($('.result #viewwindow #listtotal').html(),precision));
												}
												else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
													$('.result #viewwindow #should').html( ceilfun($('.result #viewwindow #should').html(),precision));
													$('.result #viewwindow #listtotal').html( ceilfun($('.result #viewwindow #listtotal').html(),precision));
												}
												else{//無條件捨去
													$('.result #viewwindow #should').html( floorfun($('.result #viewwindow #should').html(),precision));
													$('.result #viewwindow #listtotal').html( floorfun($('.result #viewwindow #listtotal').html(),precision));
												}
												if($('.order#order #tabs4 #listform input[name="memno"]').val()==''){
												}
												else{
													if($('.order#order .initsetting #member').val()=='1'){
														$.ajax({
															url:'./lib/js/getmemdis.ajax.php',
															method:'post',
															async: false,
															data:{'memno':$('.order#order #tabs4 #listform input[name="memno"]').val()},
															dataType:'html',
															success:function(d){
																if(d.length>20){
																	$.ajax({
																		url:'./lib/js/print.php',
																		method:'post',
																		data:{'html':'getmemdis.ajax.php '+d},
																		dataType:'html',
																		success:function(d){/*console.log(d);*/},
																		error:function(e){/*console.log(e);*/}
																	});
																}
																else{
																}
																$('.result #viewwindow #listdis1').html(Number($('.result #viewwindow #should').html())*(100-Number(d))/100);
																var precision=parseInt($('.order#order .initsetting #accuracy').val())+2;//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
																/*設定檔內可設定使用何種進位*/
																if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
																	$('.result #viewwindow #listdis1').html(roundfun($('.result #viewwindow #listdis1').html(),precision));
																}
																else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
																	$('.result #viewwindow #listdis1').html( ceilfun($('.result #viewwindow #listdis1').html(),precision));
																}
																else{//無條件捨去
																	$('.result #viewwindow #listdis1').html( floorfun($('.result #viewwindow #listdis1').html(),precision));
																}
																$('.result #viewwindow #should').html(Number($('.result #viewwindow #should').html())-Number($('.result #viewwindow #listdis1').html()));
																console.log(d);
															},
															error:function(e){
																console.log(e);
															}
														});
													}
													else{
													}
												}
												$('.result #viewwindow #notyet').html($('.result #viewwindow #should').html());
												$('.result #paywindow #paycontent').html('');
												$('.result #viewwindow #already').html('0');
												$('.result #viewwindow #cashmoney').html('0');
												$('.result #viewwindow #cash').html('0');
												$('.result #viewwindow #other').html('0');
												$('.result #viewwindow #otherfix').html('0');
												$('.result #viewwindow input[name="already"]').val('0');
												result.dialog('open');
											}
											else{
											}
										}
										else{
											var total=0;
											var dis=0;
											var temptotal=0;//加總需計算服務費之產品總金額
											var tempdis=0;//加總需計算服務費之產品總折扣
											$.each($('.order#order #'+tabs+' #listform .label'),function(index,value){
												total=Number(total)+(Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="money[]"]').val())*Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="number[]"]').val()));
												dis=Number(dis)+Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="discount[]"]').val());
												if($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="needcharge[]"]').val()=='1'){
													temptotal=Number(temptotal)+(Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="money[]"]').val())*Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="number[]"]').val()));
													tempdis=Number(tempdis)+Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="discount[]"]').val());
												}
												else{
												}
											});
											$('.result #viewwindow #total').html(total);
											$('.result #viewwindow #temptotal').val(temptotal);
											$('.result #viewwindow #itemdis').html(dis);
											$('.result #viewwindow #tempdis').val(tempdis);
											if($('.order#order .initsetting #autodis').val()=='1'){//開啟自動優惠
												$.ajax({
													url:'./lib/js/compdis.ajax.php',
													method:'post',
													async: false,
													data:$('.order#order #tabs4 #listform').serialize(),
													dataType:'html',
													success:function(d){
														if(d.length>20){
															$.ajax({
																url:'./lib/js/print.php',
																method:'post',
																data:{'html':'compdis.ajax.php '+d},
																dataType:'html',
																success:function(d){/*console.log(d);*/},
																error:function(e){/*console.log(e);*/}
															});
														}
														else{
														}
														var temp=d.split(';');
														if($.isNumeric(temp[0])){
															$('.result #viewwindow #autodis').html(temp[0]);
															$('.result #viewwindow input[name="autodiscontent"]').val(temp[1]);
															$('.result #viewwindow input[name="autodispremoney"]').val(temp[2]);
														}
														else{
															$('.result #viewwindow #autodis').html('0');
															$('.result #viewwindow input[name="autodiscontent"]').val('');
															$('.result #viewwindow input[name="autodispremoney"]').val('0');
														}
														console.log(d);
													},
													error:function(e){
														console.log(e)
													}
												});
											}
											else{
												$('.result #viewwindow #autodis').html('0');
												$('.result #viewwindow input[name="autodiscontent"]').val('');
												$('.result #viewwindow input[name="autodispremoney"]').val('0');
											}
											//$('.result #viewwindow #memberdis').html((Number($('.result #viewwindow #total').html())-Number($('.result #viewwindow #itemdis').html()))*%+NUMBER);//設定檔內設定
											$('.result #viewwindow #memberdis').html(0);
											/*設定檔內設定*/
											if($('.order#order .initsetting #openchar').val()=='1'){//開啟服務費
												if($('.order#order .initsetting #chargeeq').val()=='1'){//依照折扣前價格
													$('.result #viewwindow #charge').html((Number($('.result #viewwindow #temptotal').val())+Number($('.result #viewwindow input[name="floorspan"]').val()))*(Number($('.order#order .initsetting #chargenumber').val())/100));
												}
												else{//依照折扣後價格
													$('.result #viewwindow #charge').html((Number($('.result #viewwindow #temptotal').val())+Number($('.result #viewwindow input[name="floorspan"]').val())-Number($('.result #viewwindow #tempdis').val())-Number($('.result #viewwindow #memberdis').html())-Number($('.result #viewwindow #listdis1').html())-Number($('.result #viewwindow #listdis2').html()))*(Number($('.order#order .initsetting #chargenumber').val())/100));
												}
												var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
												/*設定檔內可設定使用何種進位*/
												if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
													$('.result #viewwindow #charge').html( roundfun($('.result #viewwindow #charge').html(),precision));
												}
												else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
													$('.result #viewwindow #charge').html( ceilfun($('.result #viewwindow #charge').html(),precision));
												}
												else{//無條件捨去
													$('.result #viewwindow #charge').html( floorfun($('.result #viewwindow #charge').html(),precision));
												}
												$('.order#order #tabs4 #listform input[name="charge"]').val($('.result #viewwindow #charge').html());
											}
											else{//關閉服務費
											}
											$('.result #viewwindow #should').html(Number($('.result #viewwindow #total').html())-Number($('.result #viewwindow #itemdis').html())-Number($('.result #viewwindow #memberdis').html())-Number($('.result #viewwindow #listdis1').html())-Number($('.result #viewwindow #listdis2').html())+Number($('.result #viewwindow #charge').html())-Number($('.result #viewwindow #coupon1').html())-Number($('.result #viewwindow #coupon2').html())-Number($('.result #viewwindow #autodis').html()));
											$('.result #viewwindow #listtotal').html(Number($('.result #viewwindow #total').html())-Number($('.result #viewwindow #itemdis').html())-Number($('.result #viewwindow #autodis').html()));
											var precision=$('.order#order .initsetting #accuracy').val();//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
											/*設定檔內可設定使用何種進位*/
											if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
												$('.result #viewwindow #should').html( roundfun($('.result #viewwindow #should').html(),precision));
												$('.result #viewwindow #listtotal').html( roundfun($('.result #viewwindow #listtotal').html(),precision));
											}
											else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
												$('.result #viewwindow #should').html( ceilfun($('.result #viewwindow #should').html(),precision));
												$('.result #viewwindow #listtotal').html( ceilfun($('.result #viewwindow #listtotal').html(),precision));
											}
											else{//無條件捨去
												$('.result #viewwindow #should').html( floorfun($('.result #viewwindow #should').html(),precision));
												$('.result #viewwindow #listtotal').html( floorfun($('.result #viewwindow #listtotal').html(),precision));
											}
											if($('.order#order #tabs4 #listform input[name="memno"]').val()==''){
											}
											else{
												if($('.order#order .initsetting #member').val()=='1'){
													$.ajax({
														url:'./lib/js/getmemdis.ajax.php',
														method:'post',
														async: false,
														data:{'memno':$('.order#order #tabs4 #listform input[name="memno"]').val()},
														dataType:'html',
														success:function(d){
															if(d.length>20){
																$.ajax({
																	url:'./lib/js/print.php',
																	method:'post',
																	data:{'html':'getmemdis.ajax.php '+d},
																	dataType:'html',
																	success:function(d){/*console.log(d);*/},
																	error:function(e){/*console.log(e);*/}
																});
															}
															else{
															}
															console.log(d);
															$('.result #viewwindow #listdis1').html(Number($('.result #viewwindow #should').html())*(100-Number(d))/100);
															var precision=parseInt($('.order#order .initsetting #accuracy').val())+2;//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
															/*設定檔內可設定使用何種進位*/
															if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
																$('.result #viewwindow #listdis1').html( roundfun($('.result #viewwindow #listdis1').html(),precision));
															}
															else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
																$('.result #viewwindow #listdis1').html( ceilfun($('.result #viewwindow #listdis1').html(),precision));
															}
															else{//無條件捨去
																$('.result #viewwindow #listdis1').html( floorfun($('.result #viewwindow #listdis1').html(),precision));
															}
															$('.result #viewwindow #should').html(Number($('.result #viewwindow #should').html())-Number($('.result #viewwindow #listdis1').html()));
														},
														error:function(e){
															console.log(e);
														}
													});
												}
												else{
												}
											}
											$('.result #viewwindow #notyet').html($('.result #viewwindow #should').html());
											$('.result #paywindow #paycontent').html('');
											$('.result #viewwindow #already').html('0');
											$('.result #viewwindow #cashmoney').html('0');
											$('.result #viewwindow #cash').html('0');
											$('.result #viewwindow #other').html('0');
											$('.result #viewwindow #otherfix').html('0');
											$('.result #viewwindow input[name="already"]').val('0');
											result.dialog('open');
										}
									}
									else{
									}
								}
								else{
									$('.result .numbox .ban').prop('disabled',false);
									$('.result .numbox .carrier').prop('disabled',false);
									$('.result .numbox .carrier2').prop('disabled',false);
									$('.result .numbox .donate').prop('disabled',false);
									$('.result #funbox .invbut').prop('disabled',false);
									$('.result #funbox .invbut #name1').html('開立發票');
									$('.result #funbox .invno').val('1');
									if($('.order#order .initsetting #comfloor').val()=='1'){
										var total=0;
										$.each($('.order#order #'+tabs+' #listform .label'),function(index,value){
											total=Number(total)+(Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="money[]"]').val())*Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="number[]"]').val()));
										});
										if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
											total=roundfun(total,precision);
										}
										else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
											total=ceilfun($('.spend #charge').html(),precision);
										}
										else{//無條件捨去
											total=floorfun($('.spend #charge').html(),precision);
										}
										if(Number(total)<Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())){
											$('.result #viewwindow input[name="floorspan"]').val((Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())-Number(total)));
										}
										else{
											$('.result #viewwindow input[name="floorspan"]').val('0');
										}
										if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
											$('.result #viewwindow input[name="floorspan"]').val(roundfun($('.result #viewwindow input[name="floorspan"]').val(),precision));
										}
										else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
											$('.result #viewwindow input[name="floorspan"]').val(ceilfun($('.result #viewwindow input[name="floorspan"]').val(),precision));
										}
										else{//無條件捨去
											$('.result #viewwindow input[name="floorspan"]').val(floorfun($('.result #viewwindow input[name="floorspan"]').val(),precision));
										}
									}
									else{
										if(Number($('.order#order #banner #detail #viewtotal').val())<Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())){
											$('.result #viewwindow input[name="floorspan"]').val((Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())-Number($('.order#order #banner #detail #viewtotal').val())));
										}
										else{
											$('.result #viewwindow input[name="floorspan"]').val('0');
										}
										if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
											$('.result #viewwindow input[name="floorspan"]').val(roundfun($('.result #viewwindow input[name="floorspan"]').val(),precision));
										}
										else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
											$('.result #viewwindow input[name="floorspan"]').val(ceilfun($('.result #viewwindow input[name="floorspan"]').val(),precision));
										}
										else{//無條件捨去
											$('.result #viewwindow input[name="floorspan"]').val(floorfun($('.result #viewwindow input[name="floorspan"]').val(),precision));
										}
									}
									if(Number($('.result #viewwindow input[name="floorspan"]').val())>0){
										var t=confirm('不足低銷，將以低消計算('+$('.result .frontunit').val()+$('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val()+$('.result .unit').val()+')');
										if(t==true){
											/*var total=0;
											var dis=0;
											$.each($('.order#order #'+tabs+' #listform .label'),function(index,value){
												total=Number(total)+(Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="money[]"]').val())*Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="number[]"]').val()));
												dis=Number(dis)+Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="discount[]"]').val());
											});*/
											$('.result #viewwindow #total').html($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val());
											$('.result #viewwindow #temptotal').val($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val());
											$('.result #viewwindow #itemdis').html('0');
											$('.result #viewwindow #tempdis').val('0');
											if($('.order#order .initsetting #autodis').val()=='1'){//開啟自動優惠
												$.ajax({
													url:'./lib/js/compdis.ajax.php',
													method:'post',
													async: false,
													data:$('.order#order #tabs4 #listform').serialize(),
													dataType:'html',
													success:function(d){
														if(d.length>20){
															$.ajax({
																url:'./lib/js/print.php',
																method:'post',
																data:{'html':'compdis.ajax.php '+d},
																dataType:'html',
																success:function(d){/*console.log(d);*/},
																error:function(e){/*console.log(e);*/}
															});
														}
														else{
														}
														var temp=d.split(';');
														if($.isNumeric(temp[0])){
															$('.result #viewwindow #autodis').html(temp[0]);
															$('.result #viewwindow input[name="autodiscontent"]').val(temp[1]);
															$('.result #viewwindow input[name="autodispremoney"]').val(temp[2]);
														}
														else{
															$('.result #viewwindow #autodis').html('0');
															$('.result #viewwindow input[name="autodiscontent"]').val('');
															$('.result #viewwindow input[name="autodispremoney"]').val('0');
														}
														console.log(d);
													},
													error:function(e){
														console.log(e)
													}
												});
											}
											else{
												$('.result #viewwindow #autodis').html('0');
												$('.result #viewwindow input[name="autodiscontent"]').val('');
												$('.result #viewwindow input[name="autodispremoney"]').val('0');
											}
											//$('.result #viewwindow #memberdis').html((Number($('.result #viewwindow #total').html())-Number($('.result #viewwindow #itemdis').html()))*%+NUMBER);//設定檔內設定
											$('.result #viewwindow #memberdis').html(0);
											/*設定檔內設定*/
											if($('.order#order .initsetting #openchar').val()=='1'){//開啟服務費
												if($('.order#order .initsetting #chargeeq').val()=='1'){//依照折扣前價格
													$('.result #viewwindow #charge').html(Number($('.result #viewwindow #temptotal').val())*(Number($('.order#order .initsetting #chargenumber').val())/100));
												}
												else{//依照折扣後價格
													$('.result #viewwindow #charge').html((Number($('.result #viewwindow #temptotal').val())-Number($('.result #viewwindow #tempdis').val())-Number($('.result #viewwindow #memberdis').html())-Number($('.result #viewwindow #listdis1').html())-Number($('.result #viewwindow #listdis2').html()))*(Number($('.order#order .initsetting #chargenumber').val())/100));
													//console.log($('.result #viewwindow #charge').html());
												}
												var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
												/*設定檔內可設定使用何種進位*/
												if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
													$('.result #viewwindow #charge').html( roundfun($('.result #viewwindow #charge').html(),precision));
												}
												else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
													$('.result #viewwindow #charge').html( ceilfun($('.result #viewwindow #charge').html(),precision));
												}
												else{//無條件捨去
													$('.result #viewwindow #charge').html( floorfun($('.result #viewwindow #charge').html(),precision));
												}
												$('.order#order #tabs4 #listform input[name="charge"]').val($('.result #viewwindow #charge').html());
											}
											else{//關閉服務費
											}
											$('.result #viewwindow #should').html(Number($('.result #viewwindow #total').html())-Number($('.result #viewwindow #itemdis').html())-Number($('.result #viewwindow #memberdis').html())-Number($('.result #viewwindow #listdis1').html())-Number($('.result #viewwindow #listdis2').html())+Number($('.result #viewwindow #charge').html())-Number($('.result #viewwindow #coupon1').html())-Number($('.result #viewwindow #coupon2').html())-Number($('.result #viewwindow #autodis').html()));
											$('.result #viewwindow #listtotal').html(Number($('.result #viewwindow #total').html())-Number($('.result #viewwindow #itemdis').html())-Number($('.result #viewwindow #autodis').html()));
											var precision=$('.order#order .initsetting #accuracy').val();//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
											/*設定檔內可設定使用何種進位*/
											if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
												$('.result #viewwindow #should').html( roundfun($('.result #viewwindow #should').html(),precision));
												$('.result #viewwindow #listtotal').html( roundfun($('.result #viewwindow #listtotal').html(),precision));
											}
											else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
												$('.result #viewwindow #should').html( ceilfun($('.result #viewwindow #should').html(),precision));
												$('.result #viewwindow #listtotal').html( ceilfun($('.result #viewwindow #listtotal').html(),precision));
											}
											else{//無條件捨去
												$('.result #viewwindow #should').html( floorfun($('.result #viewwindow #should').html(),precision));
												$('.result #viewwindow #listtotal').html( floorfun($('.result #viewwindow #listtotal').html(),precision));
											}
											if($('.order#order #tabs4 #listform input[name="memno"]').val()==''){
											}
											else{
												if($('.order#order .initsetting #member').val()=='1'){
													$.ajax({
														url:'./lib/js/getmemdis.ajax.php',
														method:'post',
														async: false,
														data:{'memno':$('.order#order #tabs4 #listform input[name="memno"]').val()},
														dataType:'html',
														success:function(d){
															if(d.length>20){
																$.ajax({
																	url:'./lib/js/print.php',
																	method:'post',
																	data:{'html':'getmemdis.ajax.php '+d},
																	dataType:'html',
																	success:function(d){/*console.log(d);*/},
																	error:function(e){/*console.log(e);*/}
																});
															}
															else{
															}
															$('.result #viewwindow #listdis1').html(Number($('.result #viewwindow #should').html())*(100-Number(d))/100);
															var precision=parseInt($('.order#order .initsetting #accuracy').val())+2;//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
															/*設定檔內可設定使用何種進位*/
															if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
																$('.result #viewwindow #listdis1').html( roundfun($('.result #viewwindow #listdis1').html(),precision));
															}
															else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
																$('.result #viewwindow #listdis1').html( ceilfun($('.result #viewwindow #listdis1').html(),precision));
															}
															else{//無條件捨去
																$('.result #viewwindow #listdis1').html( floorfun($('.result #viewwindow #listdis1').html(),precision));
															}
															$('.result #viewwindow #should').html(Number($('.result #viewwindow #should').html())-Number($('.result #viewwindow #listdis1').html()));
															console.log(d);
														},
														error:function(e){
															console.log(e);
														}
													});
												}
												else{
												}
											}
											$('.result #viewwindow #notyet').html($('.result #viewwindow #should').html());
											$('.result #paywindow #paycontent').html('');
											$('.result #viewwindow #already').html('0');
											$('.result #viewwindow #cashmoney').html('0');
											$('.result #viewwindow #cash').html('0');
											$('.result #viewwindow #other').html('0');
											$('.result #viewwindow #otherfix').html('0');
											$('.result #viewwindow input[name="already"]').val('0');
											result.dialog('open');
										}
										else{
										}
									}
									else{
										var total=0;
										var dis=0;
										var temptotal=0;
										var tempdis=0;
										$.each($('.order#order #'+tabs+' #listform .label'),function(index,value){
											total=Number(total)+(Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="money[]"]').val())*Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="number[]"]').val()));
											dis=Number(dis)+Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="discount[]"]').val());
											if($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="needcharge[]"]').val()=='1'){
												temptotal=Number(temptotal)+(Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="money[]"]').val())*Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="number[]"]').val()));
												tempdis=Number(tempdis)+Number($('.order#order #'+tabs+' #listform .label:eq('+index+') input[name="discount[]"]').val());
											}
											else{
											}
										});
										if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
											total=roundfun(total,precision);
										}
										else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
											total=ceilfun($('.spend #charge').html(),precision);
										}
										else{//無條件捨去
											total=floorfun($('.spend #charge').html(),precision);
										}
										$('.result #viewwindow #total').html(total);
										$('.result #viewwindow #temptotal').val(temptotal);
										$('.result #viewwindow #itemdis').html(dis);
										$('.result #viewwindow #tempdis').val(tempdis);
										if($('.order#order .initsetting #autodis').val()=='1'){//開啟自動優惠
											$.ajax({
												url:'./lib/js/compdis.ajax.php',
												method:'post',
												async: false,
												data:$('.order#order #tabs4 #listform').serialize(),
												dataType:'html',
												success:function(d){
													if(d.length>20){
														$.ajax({
															url:'./lib/js/print.php',
															method:'post',
															data:{'html':'compdis.ajax.php '+d},
															dataType:'html',
															success:function(d){/*console.log(d);*/},
															error:function(e){/*console.log(e);*/}
														});
													}
													else{
													}
													//console.log(d);
													var temp=d.split(';');
													if($.isNumeric(temp[0])){
														$('.result #viewwindow #autodis').html(temp[0]);
														$('.result #viewwindow input[name="autodiscontent"]').val(temp[1]);
														$('.result #viewwindow input[name="autodispremoney"]').val(temp[2]);
													}
													else{
														$('.result #viewwindow #autodis').html('0');
														$('.result #viewwindow input[name="autodiscontent"]').val('');
														$('.result #viewwindow input[name="autodispremoney"]').val('0');
													}
													console.log(d);
												},
												error:function(e){
													console.log(e)
												}
											});
										}
										else{
											$('.result #viewwindow #autodis').html('0');
											$('.result #viewwindow input[name="autodiscontent"]').val('');
											$('.result #viewwindow input[name="autodispremoney"]').val('0');
										}
										//$('.result #viewwindow #memberdis').html((Number($('.result #viewwindow #total').html())-Number($('.result #viewwindow #itemdis').html()))*%+NUMBER);//設定檔內設定
										$('.result #viewwindow #memberdis').html(0);
										/*設定檔內設定*/
										if($('.order#order .initsetting #openchar').val()=='1'){//開啟服務費
											if($('.order#order .initsetting #chargeeq').val()=='1'){//依照折扣前價格
												$('.result #viewwindow #charge').html((Number($('.result #viewwindow #temptotal').val())+Number($('.result #viewwindow input[name="floorspan"]').val()))*(Number($('.order#order .initsetting #chargenumber').val())/100));
											}
											else{//依照折扣後價格
												$('.result #viewwindow #charge').html((Number($('.result #viewwindow #temptotal').val())+Number($('.result #viewwindow input[name="floorspan"]').val())-Number($('.result #viewwindow #tempdis').val())-Number($('.result #viewwindow #memberdis').html())-Number($('.result #viewwindow #listdis1').html())-Number($('.result #viewwindow #listdis2').html()))*(Number($('.order#order .initsetting #chargenumber').val())/100));
											}
											var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
											/*設定檔內可設定使用何種進位*/
											if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
												$('.result #viewwindow #charge').html( roundfun($('.result #viewwindow #charge').html(),precision));
											}
											else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
												$('.result #viewwindow #charge').html( ceilfun($('.result #viewwindow #charge').html(),precision));
											}
											else{//無條件捨去
												$('.result #viewwindow #charge').html( floorfun($('.result #viewwindow #charge').html(),precision));
											}
											$('.order#order #tabs4 #listform input[name="charge"]').val($('.result #viewwindow #charge').html());
										}
										else{//關閉服務費
										}
										$('.result #viewwindow #should').html(Number($('.result #viewwindow #total').html())-Number($('.result #viewwindow #itemdis').html())-Number($('.result #viewwindow #memberdis').html())-Number($('.result #viewwindow #listdis1').html())-Number($('.result #viewwindow #listdis2').html())+Number($('.result #viewwindow #charge').html())-Number($('.result #viewwindow #coupon1').html())-Number($('.result #viewwindow #coupon2').html())-Number($('.result #viewwindow #autodis').html()));
										$('.result #viewwindow #listtotal').html(Number($('.result #viewwindow #total').html())-Number($('.result #viewwindow #itemdis').html())-Number($('.result #viewwindow #autodis').html()));
										var precision=$('.order#order .initsetting #accuracy').val();//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
										/*設定檔內可設定使用何種進位*/
										if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
											$('.result #viewwindow #should').html( roundfun($('.result #viewwindow #should').html(),precision));
											$('.result #viewwindow #listtotal').html( roundfun($('.result #viewwindow #listtotal').html(),precision));
										}
										else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
											$('.result #viewwindow #should').html( ceilfun($('.result #viewwindow #should').html(),precision));
											$('.result #viewwindow #listtotal').html( ceilfun($('.result #viewwindow #listtotal').html(),precision));
										}
										else{//無條件捨去
											$('.result #viewwindow #should').html( floorfun($('.result #viewwindow #should').html(),precision));
											$('.result #viewwindow #listtotal').html( floorfun($('.result #viewwindow #listtotal').html(),precision));
										}
										if($('.order#order #tabs4 #listform input[name="memno"]').val()==''){
										}
										else{
											if($('.order#order .initsetting #member').val()=='1'){
												$.ajax({
													url:'./lib/js/getmemdis.ajax.php',
													method:'post',
													async: false,
													data:{'memno':$('.order#order #tabs4 #listform input[name="memno"]').val()},
													dataType:'html',
													success:function(d){
														if(d.length>20){
															$.ajax({
																url:'./lib/js/print.php',
																method:'post',
																data:{'html':'getmemdis.ajax.php '+d},
																dataType:'html',
																success:function(d){/*console.log(d);*/},
																error:function(e){/*console.log(e);*/}
															});
														}
														else{
														}
														$('.result #viewwindow #listdis1').html(Number($('.result #viewwindow #should').html())*(100-Number(d))/100);
														var precision=parseInt($('.order#order .initsetting #accuracy').val())+2;//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
														/*設定檔內可設定使用何種進位*/
														if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
															$('.result #viewwindow #listdis1').html( roundfun($('.result #viewwindow #listdis1').html(),precision));
														}
														else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
															$('.result #viewwindow #listdis1').html( ceilfun($('.result #viewwindow #listdis1').html(),precision));
														}
														else{//無條件捨去
															$('.result #viewwindow #listdis1').html( floorfun($('.result #viewwindow #listdis1').html(),precision));
														}
														$('.result #viewwindow #should').html(Number($('.result #viewwindow #should').html())-Number($('.result #viewwindow #listdis1').html()));
														console.log(d);
													},
													error:function(e){
														console.log(e);
													}
												});
											}
											else{
											}
										}
										$('.result #viewwindow #notyet').html($('.result #viewwindow #should').html());
										$('.result #paywindow #paycontent').html('');
										$('.result #viewwindow #already').html('0');
										$('.result #viewwindow #cashmoney').html('0');
										$('.result #viewwindow #cash').html('0');
										$('.result #viewwindow #other').html('0');
										$('.result #viewwindow #otherfix').html('0');
										$('.result #viewwindow input[name="already"]').val('0');
										result.dialog('open');
									}
								}
								if($('.order#order .initsetting #pointtree').val()=='1'&&$('.order#order #content #member #membutton #tel').html()!=''){//集點樹－將點餐畫面中的會員電話，自動帶入查詢集點樹會員
									$('.result input[name="view"]').val($('.order#order #content #member #membutton div:eq(1)').html());
									$('.result #funbox .pointtree').click();
								}
								else{
								}
							}
						}
						else{
							alert('目前尚未開班，請確認是否開班或重啟系統。');
						}
					},
					error:function(e){
						//console.log(e);
					}
				});
				break;
			case 4://'暫結出單'按鈕
				$.ajax({
					url:'./lib/js/checkopen.ajax.php',
					async:false,
					dataType:'html',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'temp checkopen.ajax.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						//console.log(d);
						if(d=='success'){
							$('.order#order #tabs4 #listform input[name="invsalemoney"]').val($('.order#order #banner #detail .viewtotal').val());
							for(var i=0;i<$('.order#order #tabs4 #listform input[name="insaleinv[]"]').length;i++){
								if($('.order#order #tabs4 #listform input[name="insaleinv[]"]:eq('+i+')').val()=='0'){
									$('.order#order #tabs4 #listform input[name="invsalemoney"]').val(Number($('.order#order #tabs4 #listform input[name="invsalemoney"]').val())-Number($('.order#order #tabs4 #listform input[name="money[]"]:eq('+i+')').val()));
								}
								else{
								}
							}
							//console.log($('.order#order #tabs4 #listform input[name="invsalemoney"]').val());
							if($('.order#order #MemberBill #tabs4 #listform .label').length==0){
								if($('.order#order .initsetting #controltable').val()=='1'&&$('.order#order #tabs4 #listform input[name="consecnumber"]').val()!=''){
									emptyitemsvoidlist.dialog('open');
								}
								else{
									var nowbizdate=$('.order#order #tabs4 #listform input[name="bizdate"]').val();
									$.ajax({
										url:'./lib/js/create.voidtempdb.php',
										method:'post',
										async: false,
										data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tablenumber':$('.order#order #tabs4 #listform input[name="tablenumber"]').val(),'machine':$('.order#order .companydata #terminalnumber').val()},
										dataType:'html',
										success:function(d){
											if(d.length>20){
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													data:{'html':'temp create.voidtempdb.php '+d},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else{
											}
											//console.log(d);
										},
										error:function(e){
											//console.log(e);
										}
									});
									if($('.order#order .initsetting #secview').val()=='1'){
										$.ajax({
											url:'../secview/cleartemp.ajax.php',
											async: false,
											dataType:'html',
											success:function(d){
												if(d.length>20){
													$.ajax({
														url:'./lib/js/print.php',
														method:'post',
														data:{'html':'temp cleartemp.ajax.php '+d},
														dataType:'html',
														success:function(d){/*console.log(d);*/},
														error:function(e){/*console.log(e);*/}
													});
												}
												else{
												}
												//console.log(d);
											},
											error:function(e){
												//console.log(e);
											}
										});
									}
									else{
									}
									$.ajax({
										url:'./lib/js/create.cmdtxt.php',
										method:'post',
										async: false,
										data:{'cmd':nowbizdate.substr(0,6)+'-change'},
										dataType:'html',
										success:function(d){
											//console.log(d);
										},
										error:function(e){
											//console.log(e);
										}
									});
									if($('.order#order .initsetting #controltable').val()=='1'){
										$.ajax({
											url:'./lib/js/changetabini.ajax.php',
											method:'post',
											async:false,
											data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'tabnum':$('.order#order #tabs4 #listform input[name="tablenumber"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'listtype':$('.order#order #tabs4 #listform input[name="listtype"]').val()},
											dataType:'html',
											success:function(d){
												console.log(d);
											},
											error:function(e){
												//console.log(e);
											}
										});

										inittable.dialog('open');
										ClearWindow('','');
									}
									else{
										ClearWindow('','');
									}
									$('.order#order #billfun1 button:eq(4)').prop('disabled',false);
									if($('.order#order .initsetting #controltable').val()=='1'){
										var buttype='b';
									}
									else{
										var buttype='a';
									}
									$.ajax({
										url:'./lib/js/change.button4.php',
										method:'post',
										data:{'type':buttype},
										dataType:'json',
										success:function(d){
											if($('.order#order #billfun #billfun1 button:eq(4) #name1').length>0){
												$('.order#order #billfun #billfun1 button:eq(4) #name1').html(d[0]);
											}
											else{
											}
											if($('.order#order #billfun #billfun1 button:eq(4) #name2').length>0){
												$('.order#order #billfun #billfun1 button:eq(4) #name2').html(d[1]);
											}
											else{
											}
											if($('.order#order .initsetting #controltable').val()=='1'&&$('.order#order .initsetting #opentemp').val()=='0'){
												if(buttype=='a'){
													$('.order#order #billfun #billfun1 button:eq(4)').prop('disabled',true);
												}
												else{
													$('.order#order #billfun #billfun1 button:eq(4)').prop('disabled',false);
												}
											}
											else{
											}
											$('.order#order #billfun #billfun1 button:eq(4)').val(d[2]);
										},
										error:function(e){
											console.log(e);
										}
									});
								}
							}
							/*else if($('.order#order #billfun1 button:eq(4)').val()=='回到桌控'){
								//alert('1');
								if($('.order#order .companydata #submachine').length>0){
									location.href='./control.php?submachine&usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
								}
								else{
									location.href='./control.php?usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
								}
							}*/
							else{
								if(($('.order#order #tabs4 #listform input[name="listtype"]').val()==3||$('.order#order #tabs4 #listform input[name="listtype"]').val()==4)&&$('.order#order .initsetting #reserve').val()==1){//開啟電子發票且暫結可以開發票
									var total=0,subtotal=0,qty=0,temptotal=0,tempdis=0;
									$.each($('.order#order #tabs4 #listform .label'),function(index,value){
										total=Number(total)+(Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="money[]"]').val())*Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="number[]"]').val()));
										subtotal=Number(subtotal)+(Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="subtotal[]"]').val()));
										qty=Number(qty)+(Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="qty[]"]').val()));
										if($('.order#order #tabs4 #listform .label:eq('+index+') input[name="needcharge[]"]').val()=='1'){
											temptotal=Number(temptotal)+(Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="money[]"]').val())*Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="number[]"]').val()));
											tempdis=Number(tempdis)+Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="discount[]"]').val());
										}
										else{
										}
									});
									if($('.order#order #tabs4 #listform input[name="charge"]').length>0&&Number($('.order#order #tabs4 #listform input[name="charge"]').val())==''){
										if($('.order#order .initsetting #openchar').val()=='1'&&$('.order#order .initsetting #charge').val()=='1'){
											if($('.order#order .initsetting #chargeeq').val()=='2'){//服務費以折扣後之價格計算
												$('.order#order #tabs4 #listform input[name="charge"]').val((Number(temptotal)-Number(tempdis))*Number($('.order#order .initsetting #chargenumber').val())/100);
											}
											else{//服務費以原價格計算
												$('.order#order #tabs4 #listform input[name="charge"]').val(Number(temptotal)*Number($('.order#order .initsetting #chargenumber').val())/100);
											}
											var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
											//設定檔內可設定使用何種進位
											if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
												$('.order#order #tabs4 #listform input[name="charge"]').val( roundfun($('.order#order #tabs4 #listform input[name="charge"]').val(),precision));
											}
											else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
												$('.order#order #tabs4 #listform input[name="charge"]').val( ceilfun($('.order#order #tabs4 #listform input[name="charge"]').val(),precision));
											}
											else{//無條件捨去
												$('.order#order #tabs4 #listform input[name="charge"]').val( floorfun($('.order#order #tabs4 #listform input[name="charge"]').val(),precision));
											}
										}
										else{
										}
									}
									else{
									}
									var autodis=0;
									if($('.order#order .initsetting #autodis').val()=='1'){//開啟自動優惠
										$.ajax({
											url:'./lib/js/compdis.ajax.php',
											method:'post',
											async: false,
											data:$('.order#order #tabs4 #listform').serialize(),
											dataType:'html',
											success:function(d){
												if(d.length>20){
													$.ajax({
														url:'./lib/js/print.php',
														method:'post',
														data:{'html':'temp compdis.ajax.php '+d},
														dataType:'html',
														success:function(d){/*console.log(d);*/},
														error:function(e){/*console.log(e);*/}
													});
												}
												else{
												}
												//console.log(d);
												var temp=d.split(';');
												autodis=temp[0];
											},
											error:function(e){
												//console.log(e)
											}
										});
									}
									else{
									}
									var d=new Date(),newd=new Date();
									newd.setDate(newd.getDate()+28);
									var thtml="<table style='widht:100%;height:calc(75% - 1px);margin:0 1px 1px 1px;'><tr><td>金額</td><td>"+(Number(subtotal)-Number(autodis)+Number($('.order#order #tabs4 #listform input[name="charge"]').val()))+"</td></tr><tr><td>日期</td><td>";
									thtml=thtml+"<select style='width:150px;' name='date'><option value='0' ";
									if($('.order#order #banner #type input[name="reservedatetime"]').length>0&&$.trim($('.order#order #banner #type input[name="reservedatetime"]').val()).length>0){
										var temp=$('.order#order #banner #type input[name="reservedatetime"]').val().toString().split(";");
										var seltag=temp[1];
										var selyy=temp[0].substr(0,4),selmm=temp[0].substr(4,2),seldd=temp[0].substr(6,2),selhour=temp[0].substr(8,2),selmin=temp[0].substr(10,2);
									}
									else{
										var seltag='',selyy='',selmm='',seldd='',selhour='',selmin='';
										thtml=thtml+"selected";
									}
									thtml=thtml+">選擇日期</option>";
									var tempd=new Date(d);
									var wd=tempd.getDay();
									var dd=tempd.getDate();
									if(dd.toString().length<2){
										dd="0"+dd;
									}
									else{
									}
									var mm=tempd.getMonth()+1;
									if(mm.toString().length<2){
										mm="0"+mm;
									}
									else{
									}
									var yy=tempd.getFullYear();
									var newdd=newd.getDate();
									if(newdd.toString().length<2){
										newdd="0"+newdd;
									}
									else{
									}
									var newmm=newd.getMonth()+1;
									if(newmm.toString().length<2){
										newmm="0"+newmm;
									}
									else{
									}
									var newyy=newd.getFullYear();
									var newdatetime=(newyy+'/'+newmm+'/'+newdd);
									do{
										thtml=thtml+"<option value='"+yy+mm+dd+"' ";
										if((yy+mm+dd)==(selyy+selmm+seldd)){
											thtml=thtml+"selected";
										}
										else{
										}
										thtml=thtml+">"+mm+'/'+dd;
										if(wd==0){
											thtml=thtml+'(日)';
										}
										else if(wd==1){
											thtml=thtml+'(一)';
										}
										else if(wd==2){
											thtml=thtml+'(二)';
										}
										else if(wd==3){
											thtml=thtml+'(三)';
										}
										else if(wd==4){
											thtml=thtml+'(四)';
										}
										else if(wd==5){
											thtml=thtml+'(五)';
										}
										else{
											thtml=thtml+'(六)';
										}
										thtml=thtml+"</option>";
										tempd.setDate(tempd.getDate()+1);
										yy=tempd.getFullYear();
										mm=tempd.getMonth()+1;
										if(mm.toString().length<2){
											mm="0"+mm;
										}
										else{
										}
										dd=tempd.getDate();
										if(dd.toString().length<2){
											dd="0"+dd;
										}
										else{
										}
										wd=tempd.getDay();
									}while((yy+'/'+mm+'/'+dd)!=newdatetime);
									thtml=thtml+"</select>";
									thtml=thtml+"</td></tr><tr><td>時間</td><td><select style='width: 80px;' name='hour'>";
									for(var hour=8;hour<25;hour++){
										thtml=thtml+"<option value='";
										if(hour.toString().length<2){
											thtml=thtml+"0"+hour.toString()+"' ";
											if(("0"+hour.toString())==selhour.toString()){
												thtml=thtml+"selected";
											}
											else{
											}
											thtml=thtml+">0"+hour.toString();
										}
										else{
											if(hour==24){
												hour="00";
											}
											else{
											}
											thtml=thtml+hour.toString()+"' ";
											if(hour.toString()==selhour.toString()){
												thtml=thtml+"selected";
											}
											else{
											}
											thtml=thtml+">"+hour.toString();
											if(hour=="00"){
												hour=24;
											}
											else{
											}
										}
										thtml=thtml+"</option>";
									}
									thtml=thtml+"</select>：<select style='width: 80px;' name='min'>";
									for(var min=0;min<12;min++){
										thtml=thtml+"<option value='";
										if((min*5).toString().length<2){
											thtml=thtml+"0"+(min*5).toString()+"' ";
											if(("0"+(min*5).toString())==selmin.toString()){
												thtml=thtml+"selected";
											}
											else{
											}
											thtml=thtml+">"+"0"+(min*5).toString();
										}
										else{
											thtml=thtml+(min*5).toString()+"' ";
											if((min*5).toString()==selmin.toString()){
												thtml=thtml+"selected";
											}
											else{
											}
											thtml=thtml+">"+(min*5).toString();
										}
										thtml=thtml+"</option>";
									}
									thtml=thtml+"</select></td></tr><tr><td>貼紙</td><td><label><input type='checkbox' style='zoom:1.5;' name='printtag' ";
									if(seltag==''||seltag=='0'){
									}
									else{
										thtml=thtml+"checked";
									}
									thtml=thtml+">出貼紙</label></td></tr></table>";
									$('.temptoinv').html(thtml);
									$('.temptoinv').append("<button id='reserve' style='height:calc(25% - 1px);margin:1px 1px 0 1px;' value='開立預約單'>開立預約單</button>");
									$('.temptoinv').append("<button id='continue' style='height:calc(25% - 1px);margin:1px 1px 0 1px;' value='暫結出單'>暫結出單</button>");
									$('.temptoinv').append("<button id='cancel' style='height:calc(25% - 1px);margin:1px 1px 0 1px;' value='取消'>取消</button>");
									temptoinv.dialog('option','height',500);
									temptoinv.dialog('open');
								}
								else{
									if($('.order#order .initsetting #secview').val()=='1'){
										$.ajax({
											url:'../secview/cleartemp.ajax.php',
											async: false,
											dataType:'html',
											success:function(d){
												if(d.length>20){
													$.ajax({
														url:'./lib/js/print.php',
														method:'post',
														data:{'html':'temp cleartemp.ajax.php '+d},
														dataType:'html',
														success:function(d){/*console.log(d);*/},
														error:function(e){/*console.log(e);*/}
													});
												}
												else{
												}
												//console.log(d);
											},
											error:function(e){
												//console.log(e);
											}
										});
									}
									else{
									}
									var total=0;
									var subtotal=0;
									var qty=0;
									var temptotal=0;
									var tempdis=0;
									$.each($('.order#order #tabs4 #listform .label'),function(index,value){
										total=Number(total)+(Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="money[]"]').val())*Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="number[]"]').val()));
										subtotal=Number(subtotal)+(Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="subtotal[]"]').val()));
										qty=Number(qty)+(Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="qty[]"]').val()));
										if($('.order#order #tabs4 #listform .label:eq('+index+') input[name="needcharge[]"]').val()=='1'){
											temptotal=Number(temptotal)+(Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="money[]"]').val())*Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="number[]"]').val()));
											tempdis=Number(tempdis)+Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="discount[]"]').val());
										}
										else{
										}
									});
									if($('.order#order #tabs4 #listform input[name="charge"]').length>0&&Number($('.order#order #tabs4 #listform input[name="charge"]').val())==''){
										if($('.order#order .initsetting #openchar').val()=='1'&&$('.order#order .initsetting #charge').val()=='1'){
											if($('.order#order .initsetting #chargeeq').val()=='2'){//服務費以折扣後之價格計算
												$('.order#order #tabs4 #listform input[name="charge"]').val((Number(temptotal)-Number(tempdis))*Number($('.order#order .initsetting #chargenumber').val())/100);
											}
											else{//服務費以原價格計算
												$('.order#order #tabs4 #listform input[name="charge"]').val(Number(temptotal)*Number($('.order#order .initsetting #chargenumber').val())/100);
											}
											var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
											/*設定檔內可設定使用何種進位*/
											if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
												$('.order#order #tabs4 #listform input[name="charge"]').val( roundfun($('.order#order #tabs4 #listform input[name="charge"]').val(),precision));
											}
											else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
												$('.order#order #tabs4 #listform input[name="charge"]').val( ceilfun($('.order#order #tabs4 #listform input[name="charge"]').val(),precision));
											}
											else{//無條件捨去
												$('.order#order #tabs4 #listform input[name="charge"]').val( floorfun($('.order#order #tabs4 #listform input[name="charge"]').val(),precision));
											}
										}
										else{
										}
									}
									else{
									}
									var consecnumber='';
									if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
										var posdvrfile='';
									}
									else{
									}
									$('.order#order #billfun1 button:eq(4)').prop('disabled',true);
									$.ajax({
										url:'./lib/js/create.tempdb.php',
										method:'post',
										async: false,
										data:$("#tabs4 #listform").serialize(),
										dataType:'html',
										success:function(d){
											if(d.length>20){
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													data:{'html':'temp create.tempdb.php '+d},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else{
											}
											var tempd=d.split('-');
											consecnumber=tempd[1];
											if($('.order#order #tabs4 #listform input[name="consecnumber"]').val()==''){
												$('.order#order #tabs4 #listform input[name="saleno"]').val(tempd[0]);
												$('.order#order #tabs4 #listform input[name="consecnumber"]').val(tempd[1]);
											}
											else{
											}
											if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
												posdvrfile=tempd[2];
											}
											else{
											}
											//console.log(d);
										},
										error:function(e){
											//console.log(e);
										}
									});
									/*錢都錄借接*/
									if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
										/*start tag*/
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											async:false,
											data:{'html':'start posdvr-sendmessage','file':'posdvr'},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){console.log(e);}
										});
										if(typeof api_sendmessage_posdvr!=="undefined"&&typeof api_sendmessage_posdvr==="function"){
											api_sendmessage_posdvr(posdvrfile);
											$.ajax({
												url:'./lib/js/print.php',
												method:'post',
												data:{'html':'success','file':'posdvr'},
												dataType:'html',
												success:function(d){/*console.log(d);*/},
												error:function(e){/*console.log(e);*/}
											});
										}
										else{
											$.ajax({
												url:'./lib/js/print.php',
												method:'post',
												async:false,
												data:{'html':'error sendmessage is not function','file':'posdvr'},
												dataType:'html',
												success:function(d){/*console.log(d);*/},
												error:function(e){/*console.log(e);*/}
											});
										}
										/*end tag*/
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											async:false,
											data:{'html':'end posdvr-sendmessage','file':'posdvr'},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									if($('.order#order #tabs4 #listform input[name="listtype"]').val()=='1'){//只適用內用使用，出"兌換卷"
										$.ajax({
											url:'./lib/js/create.ticket.php',
											method:'post',
											async:false,
											data:$("#tabs4 #listform").serialize(),
											dataType:'html',
											success:function(d){
												if(d.length>20){
													$.ajax({
														url:'./lib/js/print.php',
														method:'post',
														data:{'html':'temp create.ticket.php '+d},
														dataType:'html',
														success:function(d){/*console.log(d);*/},
														error:function(e){/*console.log(e);*/}
													});
												}
												else{
												}
												//consecnumber=d;
											},
											error:function(e){
												console.log(e);
											}
										});
									}
									else{
									}
									if($('.order#order .initsetting #autodis').val()=='1'){//開啟自動優惠
										$.ajax({
											url:'./lib/js/compdis.ajax.php',
											method:'post',
											async: false,
											data:$('.order#order #tabs4 #listform').serialize(),
											dataType:'html',
											success:function(d){
												//console.log(d);
												if(d.length>20){
													$.ajax({
														url:'./lib/js/print.php',
														method:'post',
														data:{'html':'temp compdis.ajax.php '+d},
														dataType:'html',
														success:function(d){/*console.log(d);*/},
														error:function(e){/*console.log(e);*/}
													});
												}
												else{
												}
												var temp=d.split(';');
												if($.isNumeric(temp[0])){
													$.ajax({
														url:'./lib/js/wttempdis.ajax.php',
														method:'post',
														async: false,
														data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':consecnumber,'autodis':temp[0],'autodiscontent':temp[1],'autodispermoney':temp[2]},
														dataType:'html',
														success:function(d){
															if(d.length>20){
																$.ajax({
																	url:'./lib/js/print.php',
																	method:'post',
																	data:{'html':'temp wttempdis.ajax.php '+d},
																	dataType:'html',
																	success:function(d){/*console.log(d);*/},
																	error:function(e){/*console.log(e);*/}
																});
															}
															else{
															}
															//console.log(d);
														},
														error:function(e){
															//console.log(e);
														}
													});
													//$('.result #viewwindow #autodis').html(temp[0]);
													//$('.result #viewwindow input[name="autodiscontent"]').val(temp[1]);
													//$('.result #viewwindow input[name="autodispremoney"]').val(temp[2]);
												}
												else{
													//console.log('fail');
												}
												//console.log(d);
											},
											error:function(e){
												//console.log(e)
											}
										});
									}
									else{
									}
									if($('.order#order #tabs4 #listform input[name="consecnumber"]').val()==''){
									}
									else{
										$.ajax({
											url:'./lib/js/create.voidlist.php',
											method:'post',
											async: false,
											data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tablenumber':$('.order#order #tabs4 #listform input[name="tablenumber"]').val(),'machine':$('.order#order .companydata #terminalnumber').val()},
											dataType:'html',
											success:function(d){
												if(d.length>20){
													$.ajax({
														url:'./lib/js/print.php',
														method:'post',
														data:{'html':'temp create.voidlist.php '+d},
														dataType:'html',
														success:function(d){/*console.log(d);*/},
														error:function(e){/*console.log(e);*/}
													});
												}
												else{
												}
												//console.log(d);
											},
											error:function(e){
												//console.log(e);
											}
										});
									}
									$.ajax({
										url:'./lib/js/create.list.php',
										method:'post',
										async: false,
										data:$("#tabs4 #listform").serialize(),
										dataType:'html',
										success:function(d){
											if(d.length>20){
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													data:{'html':'temp create.list.php '+d},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else{
											}
											//console.log(d);
										},
										error:function(e){
											//console.log(e);
										}
									});
									if($('.order#order #tabs4 #listform input[name="consecnumber"]').val()==''){
									}
									else{
										$.ajax({
											url:'./lib/js/create.voidkitchen.php',
											method:'post',
											async: false,
											data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tablenumber':$('.order#order #tabs4 #listform input[name="tablenumber"]').val(),'machine':$('.order#order .companydata #terminalnumber').val()},
											dataType:'html',
											success:function(d){
												if(d.length>20){
													$.ajax({
														url:'./lib/js/print.php',
														method:'post',
														data:{'html':'temp create.voidkitchen.php '+d},
														dataType:'html',
														success:function(d){/*console.log(d);*/},
														error:function(e){/*console.log(e);*/}
													});
												}
												else{
												}
												//console.log(d);
											},
											error:function(e){
												//console.log(e);
											}
										});
									}
									$.ajax({
										url:'./lib/js/create.kitchen.php',
										method:'post',
										async: false,
										data:$("#tabs4 #listform").serialize(),
										dataType:'html',
										success:function(d){
											if(d.length>20){
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													data:{'html':'temp create.kitchen.php '+d},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else{
											}
											//console.log(d);
										},
										error:function(e){
											//console.log(e);
										}
									});
									$.ajax({
										url:'./lib/js/create.tag.php',
										method:'post',
										async: false,
										data:$("#tabs4 #listform").serialize(),
										dataType:'html',
										success:function(d){
											if(d.length>20){
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													data:{'html':'temp create.tag.php '+d},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else{
											}
											//console.log(d);
										},
										error:function(e){
											//console.log(e);
										}
									});
									if($('.order#order #tabs4 #listform input[name="consecnumber"]').val()==''){
									}
									else{
										$.ajax({
											url:'./lib/js/create.voidtempdb.php',
											method:'post',
											async: false,
											data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tablenumber':$('.order#order #tabs4 #listform input[name="tablenumber"]').val(),'machine':$('.order#order .companydata #terminalnumber').val()},
											dataType:'html',
											success:function(d){
												if(d.length>20){
													$.ajax({
														url:'./lib/js/print.php',
														method:'post',
														data:{'html':'temp create.voidtempdb.php '+d},
														dataType:'html',
														success:function(d){/*console.log(d);*/},
														error:function(e){/*console.log(e);*/}
													});
												}
												else{
												}
												//console.log(d);
											},
											error:function(e){
												//console.log(e);
											}
										});
									}
									$.ajax({
										url:'./lib/js/create.cmdtxt.php',
										method:'post',
										async: false,
										data:{'cmd':'report'},
										dataType:'html',
										success:function(d){
											//console.log(d);
										},
										error:function(e){
											//console.log(e);
										}
									});
									if($('.order#order .initsetting #controltable').val()=='1'){
										/*if($('.order#order .companydata #submachine').length>0){
											location.href='./control.php?submachine='+$('.order#order #tabs4 #listform input[name="machinetype"]').val()+'&usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
										}
										else{
											if($('.order#order #tabs4 #listform input[name="machinetype"]').val()=='m1'){
												location.href='./control.php?usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
											}
											else{
												location.href='./control.php?machine='+$('.order#order #tabs4 #listform input[name="machinetype"]').val()+'&usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
											}
										}*/
										inittable.dialog('open');
										ClearWindow('','');
									}
									else{
										if($('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val().length>0){
											//location.href='./order.php?usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
											ClearWindow('','');
										}
										else{
											//location.href='./order.php';
											ClearWindow('','');
										}
									}
									$('.order#order #billfun1 button:eq(4)').prop('disabled',false);
									if($('.order#order .initsetting #controltable').val()=='1'){
										var buttype='b';
									}
									else{
										var buttype='a';
									}
									$.ajax({
										url:'./lib/js/change.button4.php',
										method:'post',
										data:{'type':buttype},
										dataType:'json',
										success:function(d){
											if($('.order#order #billfun #billfun1 button:eq(4) #name1').length>0){
												$('.order#order #billfun #billfun1 button:eq(4) #name1').html(d[0]);
											}
											else{
											}
											if($('.order#order #billfun #billfun1 button:eq(4) #name2').length>0){
												$('.order#order #billfun #billfun1 button:eq(4) #name2').html(d[1]);
											}
											else{
											}
											if($('.order#order .initsetting #controltable').val()=='1'&&$('.order#order .initsetting #opentemp').val()=='0'){
												if(buttype=='a'){
													$('.order#order #billfun #billfun1 button:eq(4)').prop('disabled',true);
												}
												else{
													$('.order#order #billfun #billfun1 button:eq(4)').prop('disabled',false);
												}
											}
											else{
											}
											$('.order#order #billfun #billfun1 button:eq(4)').val(d[2]);
										},
										error:function(e){
											console.log(e);
										}
									});
								}
							}
						}
						else{
							alert('目前尚未開班，請確認是否開班或重啟系統。');
						}
					},
					error:function(e){
						//console.log(e);
					}
				});
				$.ajax({
					url:'./lib/js/check.booking.php',
					method:'post',
					async:false,
					dataType:'html',
					success:function(d){
						if(d=='success'){
							if($('.order#order #content #MemberBill #list #funbox #point').css('background-color')=='red'){
							}
							else{
								$('.order#order #content #MemberBill #list #funbox #point').css({'background-color':'red','z-index':'3'});
							}
						}
						else{
							$('.order#order #content #MemberBill #list #funbox #point').css({'background-color':'','z-index':''});
						}
						//console.log(d);
					},
					error:function(e){
						console.log(e);
					}
				});
				break;
			case 6://'現金結帳'按鈕
				if($('.order#order #'+tabs+' .listcontent .label').length<=0){
				}
				else{
					if(($('.order#order #banner #detail #invnum').length>0&&$('.order#order #banner #detail #invnum').val()=='0')||($('.order#order #banner #detail #oinv').length>0&&$('.order#order #banner #detail #oinv').val()=='ERROR')){
						alert('目前發票數量不足，若仍要結帳請使用結帳按鈕。');
					}
					else{
						$('.order#order #billfun1 button:eq(3)').trigger('click');
						while(!result.dialog('isOpen')){
							console.log('1');
							sleep(100);
						}
						$('.result .numbox .moneybut').trigger('click');
						while(parseFloat($('.result #viewwindow #notyet').html())>0){
							console.log('2');
							sleep(100);
						}
						if($('.result #viewwindow #checkfun #submit').prop('disabled')){
						}
						else{
							console.log('submit');
							$('.result #viewwindow #checkfun #submit').trigger('click');
						}
					}
				}
				break;
			default:
				break;
		}
	});
	$('.order#order #billfun #billfun2').on('click','button:eq(5)',function(){//'套餐確認'按鈕
		var sum=0;
		$('.order#order #itemtype .type .number').each(function(){
			sum+=Number($(this).val());
		});
		if(($('.order#order #tabs5 .listcontent .label').length-$('.order#order #tabs5 .listcontent .label input[value="－"]').length)<=sum){
			alert('請確認已完成完整套餐。');
		}
		else{
			var total=0;
			var qty=0;
			if($('.order#order #tabs4 .listcontent input[name="linenumber[]"]').length==0){
				var linenumber=1;
				//$('.order#order #tabs1 #tempbox input[name="linenumber"]').val(1);
			}
			else{
				var linenumber=parseInt($('.order#order #tabs4 .listcontent input[name="linenumber[]"]:eq('+($('.order#order #tabs4 .listcontent input[name="linenumber[]"]').length-1)+')').val())+2;
				//$('.order#order #tabs1 #tempbox input[name="linenumber"]').val(parseInt($('.order#order #tabs4 .listcontent input[name="linenumber[]"]:eq('+($('.order#order #tabs4 .listcontent input[name="linenumber[]"]').length-1)+')').val())+2);
			}
			for(var i=0;i<$('.order#order #tabs5 #listform .label').length;i++){
				if(i>0){
					var targetindex=$('.order#order #tabs4 .listcontent .label').length;
					if(targetindex==0){
						ordernumber=1;
					}
					else{
						ordernumber=Number($('.order#order #tabs4 .listcontent .label:eq('+(targetindex-1)+') div:eq(1)').html())+1;
					}
					$('.order#order #tabs4 .listcontent').append("<div class='label focus' style='width:100%;border-top:1px solid #dfdfdf;'><input type='hidden' name='linenumber[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="linenumber[]"]').val()+"'><input type='hidden' name='order[]' value='－'><input type='hidden' name='typeno[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="typeno[]"]').val()+"'><input type='hidden' name='type[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="type[]"]').val()+"'><input type='hidden' name='no[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="no[]"]').val()+"'><input type='hidden' name='personcount[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="personcount[]"]').val()+"'><input type='hidden' name='needcharge[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="needcharge[]"]').val()+"'><input type='hidden' name='dis1[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="dis1[]"]').val()+"'><input type='hidden' name='dis2[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="dis2[]"]').val()+"'><input type='hidden' name='dis3[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="dis3[]"]').val()+"'><input type='hidden' name='dis4[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="dis4[]"]').val()+"'><input type='hidden' name='name[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="name[]"]').val()+"'><input type='hidden' name='name2[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="name2[]"]').val()+"'><input type='hidden' name='isgroup[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="isgroup[]"]').val()+"'><input type='hidden' name='childtype[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="childtype[]"]').val()+"'><input type='hidden' name='mname1[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="mname1[]"]').val()+"'><input type='hidden' name='mname2[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="mname2[]"]').val()+"'><input type='hidden' name='insaleinv[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="insaleinv[]"]').val()+"'><input type='hidden' name='unitprice[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="unitprice[]"]').val()+"'><input type='hidden' name='money[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="money[]"]').val()+"'><input type='hidden' name='discount[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="discount[]"]').val()+"'><input type='hidden' name='discontent[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="discontent[]"]').val()+"'><input type='hidden' name='number[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="number[]"]').val()+"'><input type='hidden' name='subtotal[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="subtotal[]"]').val()+"'><input type='hidden' name='taste1[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="taste1[]"]').val()+"'><input type='hidden' name='taste1name[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="taste1name[]"]').val()+"'><input type='hidden' name='taste1price[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="taste1price[]"]').val()+"'><input type='hidden' name='taste1number[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="taste1number[]"]').val()+"'><input type='hidden' name='taste1money[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="taste1money[]"]').val()+"'><div style='width:3%;padding:3px 0;'><input type='checkbox' id='checkbox[]'></div><div style='width:10%;padding:3px 0 3px 3px;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;'>"+ordernumber+"</div><div style='width:calc(57%);padding:3px 0;' id='view'>"+$('.order#order #tabs5 .listcontent .label:eq('+i+') #view').html()+"</div><div style='width:10%;text-align:right;padding:3px 0;' id='unitprice'>"+$('.order#order #tabs5 .listcontent .label:eq('+i+') #unitprice').html()+"</div><div style='width:10%;text-align:center;padding:3px 0;' id='number'>"+$('.order#order #tabs5 .listcontent .label:eq('+i+') #number').html()+"</div><div style='width:10%;text-align:right;padding:3px 0;' id='subtotal'>"+$('.order#order #tabs5 .listcontent .label:eq('+i+') #subtotal').html()+"</div></div>");
					linenumber+=2;
					$('.order#order #tabs1 #tempbox input[name="linenumber"]').val(linenumber);
					$('.order#order #tabs1 #tempbox input[name="typeno"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="typeno[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="no"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="no[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="personcount"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="personcount[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="needcharge"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="needcharge[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="dis1"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="dis1[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="dis2"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="dis2[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="dis3"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="dis3[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="dis4"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="dis4[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="number"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="number[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="mname1"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="mname1[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="unitprice"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="unitprice[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="taste1"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="taste1[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="taste1number"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="taste1number[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="taste1money"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="taste1money[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="subtotal"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="subtotal[]"]').val());
				}
				else{
					var targetindex=$('.order#order #tabs4 .listcontent .label').length;
					if(targetindex==0){
						ordernumber=1;
					}
					else{
						ordernumber=Number($('.order#order #tabs4 .listcontent .label:eq('+(targetindex-1)+') div:eq(1)').html())+1;
					}
					$('.order#order #tabs4 .listcontent').append("<div class='label focus' style='width:100%;border-top:1px solid #dfdfdf;'><input type='hidden' name='linenumber[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="linenumber[]"]').val()+"'><input type='hidden' name='order[]' value='"+ordernumber+"'><input type='hidden' name='typeno[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="typeno[]"]').val()+"'><input type='hidden' name='type[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="type[]"]').val()+"'><input type='hidden' name='no[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="no[]"]').val()+"'><input type='hidden' name='personcount[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="personcount[]"]').val()+"'><input type='hidden' name='needcharge[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="needcharge[]"]').val()+"'><input type='hidden' name='dis1[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="dis1[]"]').val()+"'><input type='hidden' name='dis2[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="dis2[]"]').val()+"'><input type='hidden' name='dis3[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="dis3[]"]').val()+"'><input type='hidden' name='dis4[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="dis4[]"]').val()+"'><input type='hidden' name='name[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="name[]"]').val()+"'><input type='hidden' name='name2[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="name2[]"]').val()+"'><input type='hidden' name='isgroup[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="isgroup[]"]').val()+"'><input type='hidden' name='childtype[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="childtype[]"]').val()+"'><input type='hidden' name='mname1[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="mname1[]"]').val()+"'><input type='hidden' name='mname2[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="mname2[]"]').val()+"'><input type='hidden' name='insaleinv[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="insaleinv[]"]').val()+"'><input type='hidden' name='unitprice[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="unitprice[]"]').val()+"'><input type='hidden' name='money[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="money[]"]').val()+"'><input type='hidden' name='discount[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="discount[]"]').val()+"'><input type='hidden' name='discontent[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="discontent[]"]').val()+"'><input type='hidden' name='number[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="number[]"]').val()+"'><input type='hidden' name='subtotal[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="subtotal[]"]').val()+"'><input type='hidden' name='taste1[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="taste1[]"]').val()+"'><input type='hidden' name='taste1name[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="taste1name[]"]').val()+"'><input type='hidden' name='taste1price[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="taste1price[]"]').val()+"'><input type='hidden' name='taste1number[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="taste1number[]"]').val()+"'><input type='hidden' name='taste1money[]' value='"+$('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="taste1money[]"]').val()+"'><div style='width:3%;padding:3px 0;'><input type='checkbox' id='checkbox[]'></div><div style='width:10%;padding:3px 0 3px 3px;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;'>"+ordernumber+"</div><div style='width:calc(57%);padding:3px 0;' id='view'>"+$('.order#order #tabs5 .listcontent .label:eq('+i+') #view').html()+"</div><div style='width:10%;text-align:right;padding:3px 0;' id='unitprice'>"+$('.order#order #tabs5 .listcontent .label:eq('+i+') #unitprice').html()+"</div><div style='width:10%;text-align:center;padding:3px 0;' id='number'>"+$('.order#order #tabs5 .listcontent .label:eq('+i+') #number').html()+"</div><div style='width:10%;text-align:right;padding:3px 0;' id='subtotal'>"+$('.order#order #tabs5 .listcontent .label:eq('+i+') #subtotal').html()+"</div></div>");
					$('.order#order #tabs1 #tempbox input[name="linenumber"]').val(linenumber);
					$('.order#order #tabs1 #tempbox input[name="typeno"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="typeno[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="no"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="no[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="personcount"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="personcount[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="needcharge"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="needcharge[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="dis1"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="dis1[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="dis2"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="dis2[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="dis3"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="dis3[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="dis4"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="dis4[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="number"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="number[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="mname1"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="mname1[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="unitprice"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="unitprice[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="taste1"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="taste1[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="taste1number"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="taste1number[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="taste1money"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="taste1money[]"]').val());
					$('.order#order #tabs1 #tempbox input[name="subtotal"]').val($('.order#order #tabs5 .listcontent .label:eq('+i+') input[name="subtotal[]"]').val());
				}
			}
			sumsubtotal();
			$('.order#order #MemberBill #billfun #billfun1 input[type="button"]').prop('disabled',false);
			$('.order#order #MemberBill #billfun #billfun1 input[type="button"]').css({'color':'#ffffff'});
			$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(2)').prop('disabled',false);
			$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(2)').css({'color':'#ffffff'});
			$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(4)').prop('disabled',true);
			$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(4)').css({'color':'#a8a8a8'});
			$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(7)').prop('disabled',true);
			$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(7)').css({'color':'#a8a8a8'});
			$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(8)').prop('disabled',true);
			$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(8)').css({'color':'#a8a8a8'});
			$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(10)').prop('disabled',false);
			$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(10)').css({'color':'#000000'});
			$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(11)').prop('disabled',false);
			$('.order#order #MemberBill #billfun #billfun1 input[type="button"]:eq(11)').css({'color':'#000000'});
			if($('.order#order .initsetting #opentemp').val()=='1'){
				$('.order#order #billfun #billfun1 button:eq(4)').prop('disabled',false);
			}
			else{
				$('.order#order #billfun #billfun1 button:eq(4)').prop('disabled',true);
			}
			$('.order#order #billfun #billfun2 button:eq(5)').prop('disabled',true);
			//$('.order#order #billfun #billfun2 button:eq(5)').val('套餐修改');
			$('.order#order #MemberBill #list #tabs4button').prop('disabled',false);
			$('.order#order #MemberBill #list #tabs5button').prop('disabled',true);
			$('.order#order #MemberBill #list #tabs4button').trigger('click');
			/*$.ajax({
				url:'./lib/js/getsetname.ajax.php',
				method:'post',
				data:{'type':'set'},
				dataType:'json',
				success:function(d){
					$('.order#order #billfun #billfun2 button:eq(5) div#name1').html(d['button1']);
					$('.order#order #billfun #billfun2 button:eq(5) div#name2').html(d['button2']);
				},
				error:function(e){
					//console.log(e);
				}
			});*/
			if($('.order#order #tabs4 #listform input[name="machinetype"]').val()!='m1'||$('.order#order .initsetting #salecash').val()=='0'){
				$('.order#order #billfun #billfun1 button:eq(6)').prop('disabled',true);
			}
			else{
				$('.order#order #billfun #billfun1 button:eq(6)').prop('disabled',false);
			}
			if($('.order#order #tabs4 #listform input[name="machinetype"]').val()!='m1'){
				$('.order#order #billfun #billfun1 button:eq(3)').prop('disabled',true);
			}
			else{
				$('.order#order #billfun #billfun1 button:eq(3)').prop('disabled',false);
			}
			$('.order#order #tabs5 #listform .listcontent').html('');
			initmenu($('.order#order .initsetting #menutyperow').val(),$('.order#order .initsetting #menutypecol').val(),$('.order#order .initsetting #menurow').val(),$('.order#order .initsetting #menucol').val());
			$('.order#order #tabs1 #tempbox input[name="target"]').val('');
			$('.order#order #tabs1 #tempbox input[name="linenumber"]').val('');
			$('.order#order #tabs1 #tempbox input[name="typeno"]').val('');
			$('.order#order #tabs1 #tempbox input[name="type"]').val('');
			$('.order#order #tabs1 #tempbox input[name="no"]').val('');
			$('.order#order #tabs1 #tempbox input[name="personcount"]').val('0');
			$('.order#order #tabs1 #tempbox input[name="needcharge"]').val('1');
			$('.order#order #tabs1 #tempbox input[name="dis1"]').val('');
			$('.order#order #tabs1 #tempbox input[name="dis2"]').val('');
			$('.order#order #tabs1 #tempbox input[name="dis3"]').val('');
			$('.order#order #tabs1 #tempbox input[name="dis4"]').val('');
			$('.order#order #tabs1 #tempbox input[name="name"]').val('');
			$('.order#order #tabs1 #tempbox input[name="name2"]').val('');
			$('.order#order #tabs1 #tempbox input[name="isgroup"]').val('0');
			$('.order#order #tabs1 #tempbox input[name="childtype"]').val('');
			$('.order#order #tabs1 #tempbox input[name="mname1"]').val('');
			$('.order#order #tabs1 #tempbox input[name="mname2"]').val('');
			$('.order#order #tabs1 #tempbox input[name="insaleinv"]').val('');
			$('.order#order #tabs1 #tempbox input[name="unitprice"]').val('');
			$('.order#order #tabs1 #tempbox input[name="money"]').val('');
			$('.order#order #tabs1 #tempbox input[name="discount"]').val('0');
			$('.order#order #tabs1 #tempbox input[name="discontent"]').val('');
			$('.order#order #tabs1 #tempbox input[name="number"]').val('');
			$('.order#order #tabs1 #tempbox input[name="subtotal"]').val('');
			$('.order#order #tabs1 #tempbox input[name="taste1"]').val('');
			$('.order#order #tabs1 #tempbox input[name="taste1name"]').val('');
			$('.order#order #tabs1 #tempbox input[name="taste2name"]').val('');
			$('.order#order #tabs1 #tempbox input[name="taste1price"]').val('');
			$('.order#order #tabs1 #tempbox input[name="taste1number"]').val('');
			$('.order#order #tabs1 #tempbox input[name="taste1money"]').val('0');
			$('.order#order #tabs1 #tempbox input[name="taste2"]').val('');
			$('.order#order #tabs1 #editview').val('');
			$('.order#order .parameters #typeno').val('');
			$('.order#order .parameters #type').val('');
			$('.order#order .parameters #no').val('');
			$('.order#order .parameters #name').val('');
			$('.order#order .parameters #msize').val('');
			$('.order#order .parameters input[id^="mname"]').val('');
			$('.order#order .parameters input[id^="money"]').val('');
			$('.order#order .parameters #taste1').val('');
			$('.order#order .parameters #taste1name').val('');
			$('.order#order .parameters #taste1money').val('');
			$('.order#order #menubox #itemfun .startchangetaste').val('0');
			$('.order#order #menubox #itemfun .itemfun').trigger( "click" );
			$('.order#order #billfun #billfun1 button:eq(1)').prop('disabled',false);
			if($('.order#order .initsetting #weborder').val()=='1'){
				$('.order#order #billfun #billfun1 button:eq(5)').prop('disabled',false);
			}
			else{
				$('.order#order #billfun #billfun1 button:eq(5)').prop('disabled',true);
			}
			if($('.order#order .companydata #ispad').val()=='submachine'){
				//$('.order#order #billfun #billfun2 button:eq(3)').prop('disabled',true);
			}
			else{
				$.ajax({
					url:'./lib/js/checkopen.ajax.php',
					async:false,
					data:'html',
					success:function(d){
						if(d=='error'){
							$('.order#order #billfun #billfun2 button:eq(0)').prop('disabled',false);
							$('.order#order #billfun #billfun2 button:eq(1)').prop('disabled',true);
						}
						else{
							$('.order#order #billfun #billfun2 button:eq(0)').prop('disabled',true);
							$('.order#order #billfun #billfun2 button:eq(1)').prop('disabled',false);
						}
					},
					error:function(e){
						//console.log(e);
					}
				});
				//$('.order#order #billfun #billfun2 button:eq(2)').prop('disabled',false);
				$('.order#order #billfun #billfun2 button:eq(3)').prop('disabled',false);
			}
			$('.order#order #billfun #billfun2 button:eq(4)').prop('disabled',false);
			$('.order#order #billfun #billfun2 button:eq(6)').prop('disabled',false);
			$('.order#order #billfun #billfun2 button:eq(7)').prop('disabled',false);
			$('.order#order #billfun #billfun3button').prop('disabled',false);
			$('.order#order #billfun #billfun1button').trigger('click');
			$('.order#order #tabs4 .listcontentbox').scrollTop($('.order#order #tabs4 .listcontent').height());
			if($('.order#order .initsetting #menutype').val()==3){
				$('.order#order #menubox #itemtype').css({'display':''});
					$('.order#order #menubox #items').css({'display':'none'});
			}
			else{
			}
		}
		if(typeof $('.order#order #content #funbox .quickorder').val()==="undefined"){
		}
		else{
			$('.order#order #content #funbox .quickorder').focus();
		}
	});
	$('.order#order #billfun #billfun3').on('click','.logout',function(){//'切換人員'按鈕
		if($('.order#order .initsetting #secview').val()=='1'){
			$.ajax({
				url:'../secview/cleartemp.ajax.php',
				async: false,
				dataType:'html',
				success:function(d){
					//console.log(d);
				},
				error:function(e){
					//console.log(e);
				}
			});
		}
		else{
		}
		if($('.order#order .companydata #submachine').length>0){
			location.href='./?submachine='+$('.order#order #tabs4 .listcontentbox #listform input[name="machinetype"]').val();
		}
		else{
			location.href='./?machine='+$('.order#order #tabs4 .listcontentbox #listform input[name="machinetype"]').val();
		}
	});
	function initmenu(row,col,itemrow,itemcol){
		$.ajax({
			url:'./lib/js/initmenu.ajax.php',
			method:'post',
			data:{'company':$('.order#order .companydata #company').val()},
			dataType:'json',
			success:function(menu){
				if($('.order#order .initsetting #menutype').val()=='1'){
					$('.order#order #menubox #items').html('');
					for(var i=0;i<itemrow*itemcol;i++){
						if(i<menu.length){
							var thtml="<div class='item' style='width:calc(100% / "+itemcol+" - 2px);height:calc(100% / "+itemrow+" - 2px);'><button value='"+menu[i]['name1']+"' style='background-color:"+menu[i]['bgcolor']+";'><div id='name1' style='float:left;width:100%;font-size:"+menu[i]['size1']+"px;color:"+menu[i]['color1']+";";
							if(menu[i]['bold1']=='1'){
								thtml=thtml+"font-weight:bold;";
							}
							else{
								thtml=thtml+"font-weight:normal;";
							}
							thtml=thtml+"'>"+menu[i]['name1']+"</div><div id='name2' style='float:left;width:100%;font-size:"+menu[i]['size2']+"px;color:"+menu[i]['color2']+";";
							if(menu[i]['bold2']=='1'){
								thtml=thtml+"font-weight:bold;";
							}
							else{
								thtml=thtml+"font-weight:normal;";
							}
							thtml=thtml+"'>"+menu[i]['name2']+"</div></button><input type='hidden' name='no' value='"+menu[i]['no']+"'><input type='hidden' name='typeno' value='"+menu[i]['typeno']+"'></div>";
							$('.order#order #menubox #items').append(thtml);
						}
						else{
							$('.order#order #menubox #items').append("<div class='item' style='width:calc(100% / "+itemcol+" - 2px);height:calc(100% / "+itemrow+" - 2px);'><input type='button' value='' disabled><input type='hidden' name='front'></div>");
						}
					}
				}
				else{
					$('.order#order #menubox #itemtype').html('');
					for(var i=0;i<row*col;i++){
						if(i<menu.length){
							var thtml="<div class='type' style='width:calc(100% / "+col+" - 2px);height:calc(100% / "+row+" - 2px);'><button class='typebut' value='"+menu[i]['name1']+"' style='background-color:"+menu[i]['bgcolor']+";'><div id='name1' style='float:left;width:100%;font-size:"+menu[i]['size1']+"px;color:"+menu[i]['color1']+";";
							if(menu[i]['bold1']=='1'){
								thtml=thtml+"font-weight:bold;";
							}
							else{
								thtml=thtml+"font-weight:normal;";
							}
							thtml=thtml+"'>"+menu[i]['name1']+"</div><div id='name2' style='float:left;width:100%;font-size:"+menu[i]['size2']+"px;color:"+menu[i]['color2']+";";
							if(menu[i]['bold2']=='1'){
								thtml=thtml+"font-weight:bold;";
							}
							else{
								thtml=thtml+"font-weight:normal;";
							}
							thtml=thtml+"'>"+menu[i]['name2']+"</div></button><input type='hidden' class='front' value='"+menu[i]['front']+"'></div>";
							$('.order#order #menubox #itemtype').append(thtml);
						}
						else{
							$('.order#order #menubox #itemtype').append("<div class='type' style='width:calc(100% / "+col+" - 2px);height:calc(100% / "+row+" - 2px);'><input type='button' value='' disabled><input type='hidden' name='front'></div>");
						}
					}
					$('.order#order #menubox #items').html('');
					for(var i=0;i<itemrow*itemcol;i++){
						$('.order#order #menubox #items').append("<div class='item' style='width:calc(100% / "+itemcol+" - 2px);height:calc(100% / "+itemrow+" - 2px);'><button value='' id='empty' disabled><div id='name1'></div><div id='name2'></div></button></div>");
					}
				}
			},
			error:function(e){
				//console.log(e);
			}
		});
	};
	$('.result .numbox').on('click','.ban',function(){//'統編'按鈕
		if(typeof $('.result #viewwindow input[name="tempcontainer"]')=="undefined"||$('.result #viewwindow input[name="tempcontainer"]').val()==''){
			$('.result #viewwindow input[name="tempban"]').val($('.result input[name="view"]').val());
			if($('.order#order .initsetting #secview').val()=='1'){
				$.ajax({
					url:'../secview/writeban.ajax.php',
					method:'post',
					data:{'tempban':$('.result #viewwindow input[name="tempban"]').val(),'machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val()},
					dataType:'html',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'ban writeban.ajax.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						//console.log(d);
					},
					error:function(e){
						//console.log(e);
					}
				});
			}
			else{
			}
		}
		else{
		}
		$('.result input[name="view"]').val('');
		$('.result #paywindow .paywaybox input[name="checkbox"]').prop('checked',false);//重設'付款方式'的勾選選項
	});
	/*$(document).on('click','.result #funbox .vehicle',function(){//'電子載具'按鈕
		if($('.result #funbox .vehicle').val()=='電子載具'){
			$('.result #funbox .vehicle').val('取消輸入載具');
			$('.result .target').val('vehicle');
			if($('.result #funbox .ban').val()=='取消輸入統編'){
				$('.result #funbox .ban').val('統編');
				$('.result #viewwindow input[name="ban"]').css({'background-color':'#EFEBDE'});
				$('.result #viewwindow input[name="ban"]').prop('readonly',true);
				//if($('.result #viewwindow input[name="ban"]').val().length>0){	
				//}
				//else{
				//	$('.result #viewwindow input[name="ban"]').val($('.result #viewwindow input[name="temp"]').val());
				//}/
				//$('.result #viewwindow input[name="temp"]').val($('.result #viewwindow input[name="'+$('.result .target').val()+'"]').val());
			}
			else{
				//$('.result #viewwindow input[name="temp"]').val($('.result #viewwindow input[name="'+$('.result .target').val()+'"]').val());
				$('.result input[name="view"]').css({'background-color':'#EFEBDE'});
			}
			$('.result #viewwindow input[name="'+$('.result .target').val()+'"]').css({'background-color':'#FFFFFF'});
			$('.result #viewwindow input[name="'+$('.result .target').val()+'"]').prop('readonly',false);
			$('.result #viewwindow input[name="'+$('.result .target').val()+'"]').focus();
			$('.result #viewwindow input[name="'+$('.result .target').val()+'"]').attr('placeholder','請掃描載具');
		}
		else{
			$('.result #funbox .vehicle').val('電子載具');
			$('.result input[name="view"]').css({'background-color':'#FFFFFF'});
			$('.result #viewwindow input[name="'+$('.result .target').val()+'"]').css({'background-color':'#EFEBDE'});
			$('.result #viewwindow input[name="'+$('.result .target').val()+'"]').prop('readonly',true);
			$('.result #viewwindow input[name="'+$('.result .target').val()+'"]').attr('placeholder','');
			//if($('.result #viewwindow input[name="'+$('.result .target').val()+'"]').val().length>0){	
			//}
			//else{
			//	$('.result #viewwindow input[name="'+$('.result .target').val()+'"]').val($('.result #viewwindow input[name="temp"]').val());
			//}
			//$('.result #viewwindow input[name="temp"]').val('');
			$('.result .target').val('view');
		}
		$('.result #paywindow .payway input[name="checkbox"]').prop('checked',false);//重設'付款方式'的勾選選項
	});*/
	$('.result #funbox').on('click','#loopbut',function(){//出單方式－切換循環按鈕
		$.ajax({
			url:'./lib/js/chaloopbut.ajax.php',
			method:'post',
			data:{'looptype':$('.result #viewwindow .sendviewwindow input[name="looptype"]').val()},
			dataType:'json',
			success:function(value){
				$('.result #funbox #loopbut').html("<div id='name1'>"+value[0]+"</div><div id='name2'>"+value[1]+"</div>");
				$('.result #viewwindow .sendviewwindow input[name="looptype"]').val(value[2]);
			},
			error:function(e){
				//console.log(e);
			}
		});
		/*if($('.result #funbox input[name="looptype"]').val()=='4'){
			$('.result #funbox #loopbut').val('出單');
			$('.result #funbox input[name="looptype"]').val('1');
		}
		else{
			$('.result #funbox input[name="looptype"]').val(Number($('.result #funbox input[name="looptype"]').val())+1);
			switch($('.result #funbox input[name="looptype"]').val()){
				case '2':
					$('.result #funbox #loopbut').val('不出單');
					break;
				case '3':
					$('.result #funbox #loopbut').val('只出總單');
					break;
				case '4':
					$('.result #funbox #loopbut').val('只出標籤');
					break;
			}
		}*/
	});
	$('.result #funbox').on('click','.chargebut',function(){
		if($('.result #funbox .chargebut #name1').html()=='不收服務費'){
			$('.result #funbox .chargebut #name1').html('收服務費');
			$('.result #funbox #charno').val('1');
			if($('.order#order .initsetting #openchar').val()=='1'){//開啟服務費
				if(Number($('.result #viewwindow #total').html())<Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())){
					if($('.order#order .initsetting #chargeeq').val()=='1'){//依照折扣前價格
						$('.result #viewwindow #charge').html(Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())*(Number($('.order#order .initsetting #chargenumber').val())/100));
					}
					else{//依照折扣後價格
						$('.result #viewwindow #charge').html((Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())-Number($('.result #viewwindow #itemdis').html())-Number($('.result #viewwindow #memberdis').html())-Number($('.result #viewwindow #listdis').html()))*(Number($('.order#order .initsetting #chargenumber').val())/100));
					}
				}
				else{
					if($('.order#order .initsetting #chargeeq').val()=='1'){//依照折扣前價格
						$('.result #viewwindow #charge').html(Number($('.result #viewwindow .sendviewwindow #temptotal').val())*(Number($('.order#order .initsetting #chargenumber').val())/100));
					}
					else{//依照折扣後價格
						$('.result #viewwindow #charge').html((Number($('.result #viewwindow .sendviewwindow #temptotal').val())-Number($('.result #viewwindow .sendviewwindow #tempdis').val())-Number($('.result #viewwindow #memberdis').html())-Number($('.result #viewwindow #listdis1').html())-Number($('.result #viewwindow #listdis2').html()))*(Number($('.order#order .initsetting #chargenumber').val())/100));
					}
				}
				var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
				/*設定檔內可設定使用何種進位*/
				if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
					$('.result #viewwindow #charge').html( roundfun($('.result #viewwindow #charge').html(),precision));
				}
				else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
					$('.result #viewwindow #charge').html( ceilfun($('.result #viewwindow #charge').html(),precision));
				}
				else{//無條件捨去
					$('.result #viewwindow #charge').html( floorfun($('.result #viewwindow #charge').html(),precision));
				}
				$('.order#order #tabs4 #listform input[name="charge"]').val($('.result #viewwindow #charge').html());
			}
			else{//關閉服務費
			}
		}
		else{
			$('.result #viewwindow #charge').html('0');
			$('.order#order #tabs4 #listform input[name="charge"]').val('0');
			$('.result #funbox .chargebut #name1').html('不收服務費');
			$('.result #funbox #charno').val('0');
			/*設定檔內設定*/
			/*if(){//有服務費
				if(){//依照折扣前價格
					$('.result #viewwindow #charge').html(Number(total)*_discount);
				}
				else{//依照折扣後價格
					$('.result #viewwindow #charge').html((Number(total)-Number(dis)-Number($('.result #viewwindow #listdis').html()))*_discount);
				}
			}
			else{//無服務費
			}*/
		}
		$('.result #paywindow #paycontent').html('');
		computershould();
		computerchange();
	});
	$('.result #funbox').on('click','.invbut',function(){
		if($('.result #funbox .invbut #name1').html()=='不開立發票'){
			$('.result #funbox .invbut #name1').html('開立發票');
			$('.result #funbox .invno').val('1');
		}
		else{
			$('.result #funbox .invbut #name1').html('不開立發票');
			$('.result #funbox .invno').val('0');
		}
	});
	$('.result .numbox').on('click','input',function(){//結帳畫面左方數字按鈕
		var index=$('.result .numbox input').index(this);
		if($('.result input[name="'+$('.result .target').val()+'"]').val()==''&&$('.result .numbox input:eq('+index+')').val()=='.'){
			$('.result input[name="'+$('.result .target').val()+'"]').val('0.');
		}
		else{
			if($('.result .target').val()=='ban'){
				if($('.result input[name="'+$('.result .target').val()+'"]').val().length>=8){
				}
				else{
					$('.result input[name="'+$('.result .target').val()+'"]').val($('.result input[name="'+$('.result .target').val()+'"]').val()+$('.result .numbox input:eq('+index+')').val());
				}
			}
			else{
				$('.result input[name="'+$('.result .target').val()+'"]').val($('.result input[name="'+$('.result .target').val()+'"]').val()+$('.result .numbox input:eq('+index+')').val());
			}
		}
		$('.result #paywindow .payway input[name="checkbox"]').prop('checked',false);//重設'付款方式'的勾選選項
	});

	$('.result .numbox').on('click','.clear',function(){
		if($('.result #paywindow .paywaybox input[name="checkbox"]:checked').length>0){//清除已勾選之結帳方式明細
			for(var i=($('.result #paywindow .paywaybox').length-1);i>=0;i--){
				if($('.result #paywindow .paywaybox:eq('+i+') input[name="checkbox"]').prop('checked')){
					$('.result #paywindow .paywaybox:eq('+i+')').remove();
				}
				else{
				}
			}
			computerchange();
		}
		else{
			$('.result input[name="'+$('.result .target').val()+'"]').val('');
		}
	});
	$('.result #funbox').on('click','button[class^="listdisbut"]',function(){//預設5個帳單折扣按鈕，可由設定檔定義
		var disindex=$('.result #funbox button[class^="listdisbut"]').index(this);
		$('.result #viewwindow #listdis1').html(discount(Number($('.result #funbox .listdis'+(Number(disindex)+1)).val())));
		var precision=parseInt($('.order#order .initsetting #accuracy').val())+2;//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
		/*設定檔內可設定使用何種進位*/
		if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
			$('.result #viewwindow #listdis1').html( roundfun($('.result #viewwindow #listdis1').html(),precision));
		}
		else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
			$('.result #viewwindow #listdis1').html( ceilfun($('.result #viewwindow #listdis1').html(),precision));
		}
		else{//無條件捨去
			$('.result #viewwindow #listdis1').html( floorfun($('.result #viewwindow #listdis1').html(),precision));
		}
		$('.result #paywindow #paycontent').html('');
		if($('.result #funbox #charno').val()=='1'){//開啟服務費
			if($('.order#order .initsetting #chargeeq').val()=='1'){//依照折扣前價格
				$('.result #viewwindow #charge').html(Number($('.result #viewwindow #temptotal').val())*(Number($('.order#order .initsetting #chargenumber').val())/100));
			}
			else{//依照折扣後價格
				$('.result #viewwindow #charge').html((Number($('.result #viewwindow #temptotal').val())-Number($('.result #viewwindow #tempdis').val())-Number($('.result #viewwindow #memberdis').html())-Number($('.result #viewwindow #listdis1').html())-Number($('.result #viewwindow #listdis2').html()))*(Number($('.order#order .initsetting #chargenumber').val())/100));
				//console.log($('.result #viewwindow #charge').html());
			}
			var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
			/*設定檔內可設定使用何種進位*/
			if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
				$('.result #viewwindow #charge').html( roundfun($('.result #viewwindow #charge').html(),precision));
			}
			else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
				$('.result #viewwindow #charge').html( ceilfun($('.result #viewwindow #charge').html(),precision));
			}
			else{//無條件捨去
				$('.result #viewwindow #charge').html( floorfun($('.result #viewwindow #charge').html(),precision));
			}
			$('.order#order #tabs4 #listform input[name="charge"]').val($('.result #viewwindow #charge').html());
		}
		else{//關閉服務費
		}
		computershould();
		//2018/2/2$('.result #paywindow .paywaybox input[name="checkbox"]').prop('checked',false);//重設'付款方式'的勾選選項
	});
	$('.result #funbox').on('click','#listdisbutA',function(){//帳單折扣按鈕
		var disindex=$('.result #funbox button[class^="listdisbut"]').index(this);
		if($('.result input[name="view"]').val().length>0){
			if(parseInt($('.result input[name="view"]').val())>100){
				$('.result #viewwindow #listdis1').html(discount(Number(100)));
			}
			else{
				$('.result #viewwindow #listdis1').html(discount(Number($('.result input[name="view"]').val())));
			}
			computershould('listdis1');
			$('.result input[name="view"]').val('');
			$('.result #paywindow #paycontent').html('');
			/*if($('.result #funbox #charno').val()=='1'){//開啟服務費
				if($('.order#order .initsetting #chargeeq').val()=='1'){//依照折扣前價格
					$('.result #viewwindow #charge').html(Number($('.result #viewwindow #temptotal').val())*(Number($('.order#order .initsetting #chargenumber').val())/100));
				}
				else{//依照折扣後價格
					$('.result #viewwindow #charge').html((Number($('.result #viewwindow #temptotal').val())-Number($('.result #viewwindow #tempdis').val())-Number($('.result #viewwindow #memberdis').html())-Number($('.result #viewwindow #listdis1').html())-Number($('.result #viewwindow #listdis2').html()))*(Number($('.order#order .initsetting #chargenumber').val())/100));
					//console.log($('.result #viewwindow #charge').html());
				}
				var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
				//設定檔內可設定使用何種進位
				if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
					$('.result #viewwindow #charge').html( roundfun($('.result #viewwindow #charge').html(),precision));
				}
				else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
					$('.result #viewwindow #charge').html( ceilfun($('.result #viewwindow #charge').html(),precision));
				}
				else{//無條件捨去
					$('.result #viewwindow #charge').html( floorfun($('.result #viewwindow #charge').html(),precision));
				}
				$('.order#order #tabs4 #listform input[name="charge"]').val($('.result #viewwindow #charge').html());
			}
			else{//關閉服務費
			}*/
			computershould();
		}
		else{
			$('.result #paywindow .paywaybox input[name="checkbox"]').prop('checked',false);//重設'付款方式'的勾選選項
		}
		//2018/2/2$('.result #paywindow .payway input[name="checkbox"]').prop('checked',false);//重設'付款方式'的勾選選項
	});
	$('.result #funbox').on('click','#listdisbutB',function(){
		if($('.result input[name="view"]').val().length>0){
			$('.result #viewwindow #listdis2').html($('.result input[name="view"]').val());
			computershould('listdis2');
			$('.result input[name="view"]').val('');
			$('.result #paywindow #paycontent').html('');
			/*if($('.order#order .initsetting #openchar').val()=='1'){//開啟服務費
				if($('.order#order .initsetting #chargeeq').val()=='1'){//依照折扣前價格
					$('.result #viewwindow #charge').html(Number($('.result #viewwindow #temptotal').val())*(Number($('.order#order .initsetting #chargenumber').val())/100));
				}
				else{//依照折扣後價格
					$('.result #viewwindow #charge').html((Number($('.result #viewwindow #temptotal').val())-Number($('.result #viewwindow #tempdis').val())-Number($('.result #viewwindow #memberdis').html())-Number($('.result #viewwindow #listdis1').html())-Number($('.result #viewwindow #listdis2').html()))*(Number($('.order#order .initsetting #chargenumber').val())/100));
					//console.log($('.result #viewwindow #charge').html());
				}
				var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
				//設定檔內可設定使用何種進位
				if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
					$('.result #viewwindow #charge').html( roundfun($('.result #viewwindow #charge').html(),precision));
				}
				else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
					$('.result #viewwindow #charge').html( ceilfun($('.result #viewwindow #charge').html(),precision));
				}
				else{//無條件捨去
					$('.result #viewwindow #charge').html( floorfun($('.result #viewwindow #charge').html(),precision));
				}
				$('.order#order #tabs4 #listform input[name="charge"]').val($('.result #viewwindow #charge').html());
			}
			else{//關閉服務費
			}*/
			//computershould();
		}
		else{
			$('.result #paywindow .paywaybox input[name="checkbox"]').prop('checked',false);//重設'付款方式'的勾選選項
		}
		//2018/2/2$('.result #paywindow .payway input[name="checkbox"]').prop('checked',false);//重設'付款方式'的勾選選項
	});
	function discount(disn){//計算帳單折扣金額，精準度可由設定檔設定
		var temp;
		var precision=parseInt($('.order#order .initsetting #accuracy').val())+2;//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
		if($('.order#order .initsetting #accuracyseq').val()=='1'){//帳單折扣以照單品與會員折扣後之價格(設定檔內設定)
			if($('.order#order .initsetting #member').val()=='1'){//如有開啟會員折扣
				temp=Number((Number($('.result #viewwindow #listtotal').html())-Number($('.result #viewwindow #memberdis').html()))*(100-Number(disn)))/100;
			}
			else{//若沒有則以帳單折扣以照原始價格
				temp=Number((Number($('.result #viewwindow #listtotal').html()))*(100-Number(disn)))/100;
			}
		}
		else{//帳單折扣以照原始價格
			temp=Number((Number($('.result #viewwindow #total').html())*(100-Number(disn))))/100;
		}
		/*設定檔內可設定使用何種進位*/
		if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
			return roundfun(temp ,precision);
		}
		else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
			return ceilfun(temp ,precision);
		}
		else{//無條件捨去
			return floorfun(temp ,precision);
		}
	};
	function computershould(idvalue){//計算應付金額
		var precision=$('.order#order .initsetting #accuracy').val();
		if(Number($('.result #viewwindow #total').html())<Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())){
			var temp=Number(Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())-Number($('.result #viewwindow #itemdis').html())-Number($('.result #viewwindow #memberdis').html())-Number($('.result #viewwindow #listdis1').html())-Number($('.result #viewwindow #listdis2').html())+Number($('.result #viewwindow #charge').html())-Number($('.result #viewwindow #coupon1').html())-Number($('.result #viewwindow #coupon2').html()));
		}
		else{
			var temp=Number(Number($('.result #viewwindow #listtotal').html())-Number($('.result #viewwindow #memberdis').html())-Number($('.result #viewwindow #listdis1').html())-Number($('.result #viewwindow #listdis2').html())+Number($('.result #viewwindow #charge').html())-Number($('.result #viewwindow #coupon1').html())-Number($('.result #viewwindow #coupon2').html()));
		}

		if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
			$('.result #viewwindow #should').html( roundfun(temp,precision));
		}
		else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
			$('.result #viewwindow #should').html( ceilfun(temp,precision));
		}
		else{//無條件捨去
			$('.result #viewwindow #should').html( floorfun(temp,precision));
		}
		
		if(Number($('.result #viewwindow #should').html())<=0){
			$('.result #viewwindow #'+idvalue).html(Number($('.result #viewwindow #should').html())+Number($('.result #viewwindow #'+idvalue).html()));
			if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
				$('.result #viewwindow #'+idvalue).html( roundfun($('.result #viewwindow #'+idvalue).html(),precision));
			}
			else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
				$('.result #viewwindow #'+idvalue).html( ceilfun($('.result #viewwindow #'+idvalue).html(),precision));
			}
			else{//無條件捨去
				$('.result #viewwindow #'+idvalue).html( floorfun($('.result #viewwindow #'+idvalue).html(),precision));
			}
			$('.result #viewwindow #should').html('0');
		}
		else{
		}
		computerchange();
	};
	function computerchange(){//計算找零金額
		var precision=$('.order#order .initsetting #accuracy').val();
		computeralready();
		/*if(Number($('.result #viewwindow #total').html())<Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())){
			var temp=Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val());
		}
		else{*/
			var temp=Number($('.result #viewwindow #should').html())+Number($('.result #viewwindow #cashcomm').html());//應收金額(應收+手續費)
		//}
		//計算未收金額
		if(temp-Number($('.result #viewwindow #already').html())<=0){
			$('.result #viewwindow #notyet').html('0');
		}
		else{
			$('.result #viewwindow #notyet').html(temp-Number($('.result #viewwindow #already').html()));
		}
		if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
			$('.result #viewwindow #notyet').html( roundfun($('.result #viewwindow #notyet').html(),precision));
		}
		else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
			$('.result #viewwindow #notyet').html( ceilfun($('.result #viewwindow #notyet').html(),precision));
		}
		else{//無條件捨去
			$('.result #viewwindow #notyet').html( floorfun($('.result #viewwindow #notyet').html(),precision));
		}
		//計算找零金
		if(Number($('.result #viewwindow #otherfix').html())==0){//無不找零支付方式
			if(Number($('.result #viewwindow #already').html())-temp<=0){
				$('.result #viewwindow #change').html('0');
			}
			else{
				$('.result #viewwindow #change').html(Number($('.result #viewwindow #already').html())-temp);
			}
		}
		else{//有利用到不找零支付方式
			if(Number($('.result #viewwindow #otherfix').html())<=Number(temp)){//不找零支付方式所支付之金額不大於應收金額，因此還需要找零
				if(Number($('.result #viewwindow #already').html())-temp<=0){
					$('.result #viewwindow #change').html('0');
				}
				else{
					$('.result #viewwindow #change').html(Number($('.result #viewwindow #already').html())-temp);
				}
			}
			else{
				$('.result #viewwindow #change').html(Number($('.result #viewwindow #already').html())-Number($('.result #viewwindow #otherfix').html()));
			}
		}
		if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
			$('.result #viewwindow #change').html( roundfun($('.result #viewwindow #change').html(),precision));
		}
		else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
			$('.result #viewwindow #change').html( ceilfun($('.result #viewwindow #change').html(),precision));
		}
		else{//無條件捨去
			$('.result #viewwindow #change').html( floorfun($('.result #viewwindow #change').html(),precision));
		}
	};
	function computeralready(){//計算已付金額
		var pay=0;
		var money=0;
		var cash=0;
		var commission=0;
		var other=0;
		var otherfix=0;
		var tempstring={};
		var otherstring='';
		var precision=$('.order#order .initsetting #accuracy').val();
		for(var i=0;i<$('.result #paywindow .paymoney').length;i++){//計算已付現金
			if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
				pay=roundfun(Number(pay)+Number($('.result #paywindow .paymoney:eq('+i+')').html()),precision);
				money=roundfun(Number(money)+Number($('.result #paywindow .paymoney:eq('+i+')').html()),precision);
			}
			else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
				pay=ceilfun(Number(pay)+Number($('.result #paywindow .paymoney:eq('+i+')').html()),precision);
				money=ceilfun(Number(money)+Number($('.result #paywindow .paymoney:eq('+i+')').html()),precision);
			}
			else{//無條件捨去
				pay=floorfun(Number(pay)+Number($('.result #paywindow .paymoney:eq('+i+')').html()),precision);
				money=floorfun(Number(money)+Number($('.result #paywindow .paymoney:eq('+i+')').html()),precision);
			}
		}
		for(var i=0;i<$('.result #paywindow .paycash').length;i++){//計算已付信用卡與信用卡手續費
			if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
				pay=roundfun(Number(pay)+Number($('.result #paywindow .paycash:eq('+i+')').html()),precision);
				cash=roundfun(Number(cash)+Number($('.result #paywindow .paycash:eq('+i+')').html()),precision);
				commission=roundfun(Number(commission)+Number($('.result #paywindow .commission:eq('+i+')').val()),precision);
			}
			else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
				pay=ceilfun(Number(pay)+Number($('.result #paywindow .paycash:eq('+i+')').html()),precision);
				cash=ceilfun(Number(cash)+Number($('.result #paywindow .paycash:eq('+i+')').html()),precision);
				commission=ceilfun(Number(commission)+Number($('.result #paywindow .commission:eq('+i+')').val()),precision);
			}
			else{//無條件捨去
				pay=floorfun(Number(pay)+Number($('.result #paywindow .paycash:eq('+i+')').html()),precision);
				cash=floorfun(Number(cash)+Number($('.result #paywindow .paycash:eq('+i+')').html()),precision);
				commission=floorfun(Number(commission)+Number($('.result #paywindow .commission:eq('+i+')').val()),precision);
			}
		}
		for(var i=0;i<$('.result #paywindow .otherpay').length;i++){//計算已付其他付款
			if($('.result #paywindow .otherpay:eq('+i+') input[name="type"]').val()=='1'){
				if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
					pay=roundfun(Number(pay)+Number($('.result #paywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
					other=roundfun(Number(other)+Number($('.result #paywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
				}
				else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
					pay=ceilfun(Number(pay)+Number($('.result #paywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
					other=ceilfun(Number(other)+Number($('.result #paywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
				}
				else{//無條件捨去
					pay=floorfun(Number(pay)+Number($('.result #paywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
					other=floorfun(Number(other)+Number($('.result #paywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
				}
			}
			else{
				if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
					pay=roundfun(Number(pay)+Number($('.result #paywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
					otherfix=roundfun(Number(otherfix)+Number($('.result #paywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
				}
				else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
					pay=ceilfun(Number(pay)+Number($('.result #paywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
					otherfix=ceilfun(Number(otherfix)+Number($('.result #paywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
				}
				else{//無條件捨去
					pay=floorfun(Number(pay)+Number($('.result #paywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
					otherfix=floorfun(Number(otherfix)+Number($('.result #paywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
				}
			}
			if(typeof tempstring[$('.result #paywindow .otherpay:eq('+i+')').attr('id')]!=='undefined'){
				if(tempstring[$('.result #paywindow .otherpay:eq('+i+')').attr('id')].match("=")){
					var ttempstringa=tempstring[$('.result #paywindow .otherpay:eq('+i+')').attr('id')].split("=");
					tempstring[$('.result #paywindow .otherpay:eq('+i+')').attr('id')]=Number(ttempstringa[1])+Number($('.result #paywindow .otherpay:eq('+i+') input[name="viewmoney"]').val());
				}
				else{
					tempstring[$('.result #paywindow .otherpay:eq('+i+')').attr('id')]=Number(tempstring[$('.result #paywindow .otherpay:eq('+i+')').attr('id')])+Number($('.result #paywindow .otherpay:eq('+i+') input[name="viewmoney"]').val());
				}
			}
			else{
				tempstring[$('.result #paywindow .otherpay:eq('+i+')').attr('id')]=Number($('.result #paywindow .otherpay:eq('+i+') input[name="viewmoney"]').val());
			}
			if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
				tempstring[$('.result #paywindow .otherpay:eq('+i+')').attr('id')]=$('.result #paywindow .otherpay:eq('+i+') input[name="initview"]').val()+'='+roundfun(tempstring[$('.result #paywindow .otherpay:eq('+i+')').attr('id')],precision);
			}
			else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
				tempstring[$('.result #paywindow .otherpay:eq('+i+')').attr('id')]=$('.result #paywindow .otherpay:eq('+i+') input[name="initview"]').val()+'='+ceilfun(tempstring[$('.result #paywindow .otherpay:eq('+i+')').attr('id')],precision);
			}
			else{//無條件捨去
				tempstring[$('.result #paywindow .otherpay:eq('+i+')').attr('id')]=$('.result #paywindow .otherpay:eq('+i+') input[name="initview"]').val()+'='+floorfun(tempstring[$('.result #paywindow .otherpay:eq('+i+')').attr('id')],precision);
			}
		}
		$.each(tempstring,function(i,value){
			if(otherstring==''){
				otherstring=otherstring+i+':'+value;
			}
			else{
				otherstring=otherstring+','+i+':'+value;
			}
		});
		/*for(var i=1;i<=10;i++){
			if(typeof tempstring['TA'+i]!=='undefined'){
				if(otherstring==''){
					otherstring=otherstring+'TA'+i+':'+tempstring['TA'+i];
				}
				else{
					otherstring=otherstring+',TA'+i+':'+tempstring['TA'+i];
				}
			}
			else{
			}
		}*/
		if(typeof tempstring['NONTAX']!=='undefined'){
			if(otherstring==''){
				otherstring=otherstring+'NONTAX:'+tempstring['NONTAX'];
			}
			else{
				otherstring=otherstring+',NONTAX:'+tempstring['NONTAX'];
			}
		}
		else{
		}
		//console.log(otherstring);
		$('.result #viewwindow #cashcomm').html(commission);
		$('.result #viewwindow #already').html(pay);
		$('.result #viewwindow #cash').html(cash);
		$('.result #viewwindow #other').html(other);
		$('.result #viewwindow input[name="otherstring"]').val(otherstring);
		$('.result #viewwindow #otherfix').html(otherfix);
		if(Number(money)>=(Number($('.result #viewwindow #should').html())+Number($('.result #viewwindow #cashcomm').html())-Number($('.result #viewwindow #cash').html())-Number($('.result #viewwindow #other').html())-Number($('.result #viewwindow #otherfix').html()))){
			$('.result #viewwindow #cashmoney').html((Number($('.result #viewwindow #should').html())+Number($('.result #viewwindow #cashcomm').html())-Number($('.result #viewwindow #cash').html())-Number($('.result #viewwindow #other').html())-Number($('.result #viewwindow #otherfix').html())));
			//$('.result #viewwindow #cashmoney').html('0');
			if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
				$('.result #viewwindow #cashmoney').html(roundfun($('.result #viewwindow #cashmoney').html(),precision));
			}
			else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
				$('.result #viewwindow #cashmoney').html(ceilfun($('.result #viewwindow #cashmoney').html(),precision));
			}
			else{//無條件捨去
				$('.result #viewwindow #cashmoney').html(floorfun($('.result #viewwindow #cashmoney').html(),precision));
			}
		}
		else{
			$('.result #viewwindow #cashmoney').html(money);
		}
		if(Number($('.result #viewwindow #cashmoney').html())<0){
			$('.result #viewwindow #cashmoney').html('0');
		}
		else{
		}
	};
	$('.result .numbox').on('click','.moneybut',function(){//結帳畫面'現金'結帳方式按鈕
		var content='';
		if($('.result input[name="view"]').val().length>0){
			/*content="<div class='paywaybox' style='width:calc(100% - 20px);overflow:hidden;'><div style='width:20px;height:19px;float:left;'><input type='checkbox' name='checkbox'></div><div class='payway' style='overflow:hidden;'><div style='width:calc(50% - 10px);float:left;text-align:left;'><span id='name1'>"+$('.result #funbox .moneybut #name1').html()+"</span>";
			if($('.result #funbox .moneybut #name2').length>0)content=content+"<span id='name2'>/"+$('.result #funbox .moneybut #name2').html()+"</span>";
			content=content+"</div><div style='width:calc(50% - 10px);float:left;text-align:right;'>"+$('.result .frontunit').val()+"<span class='paymoney'>"+$('.result input[name="view"]').val()+"</span>"+$('.result .unit').val()+"</div></div></div>";
			$('.result #paywindow #paycontent').append(content);
			$('.result input[name="view"]').val('');*/
			
			if((Number($('.result #viewwindow #should').html())+Number($('.result #viewwindow #cashcomm').html())-Number($('.result #viewwindow #already').html()))<=0){
				//console.log('1');
			}
			else{
				//console.log('2');
				content="<div class='paywaybox' style='width:calc(100% - 20px);overflow:hidden;'><div style='width:20px;height:19px;float:left;'><input type='checkbox' name='checkbox'></div><div class='payway' style='overflow:hidden;'><div style='width:calc(50% - 10px);float:left;text-align:left;'><span id='name1'>"+$('.result .numbox .moneybut #name1').html()+"</span>";
				if($('.result .numbox .moneybut #name2').length>0)content=content+"<span id='name2'>/"+$('.result .numbox .moneybut #name2').html()+"</span>";
				content=content+"</div>";
				/*if(Number($('.result input[name="view"]').val())>=(Number($('.result #viewwindow #should').html())-Number($('.result #viewwindow #already').html()))){
					content=content+"<div style='width:calc(50% - 10px);float:left;text-align:right;'>"+$('.result .frontunit').val()+"<span class='paymoney'>"+(Number($('.result #viewwindow #should').html())-Number($('.result #viewwindow #already').html()))+"</span>"+$('.result .unit').val()+"</div></div></div>";
				}
				else{*/
					content=content+"<div style='width:calc(50% - 10px);float:left;text-align:right;'>"+$('.result .frontunit').val()+"<span class='paymoney'>"+$('.result input[name="view"]').val()+"</span>"+$('.result .unit').val()+"</div></div></div>";
				//}

				$('.result #paywindow #paycontent').append(content);
			}
			$('.result input[name="view"]').val('');
			
		}
		else if((Number($('.result #viewwindow #should').html())+Number($('.result #viewwindow #cashcomm').html())-Number($('.result #viewwindow #already').html()))>0){
			var precision=$('.order#order .initsetting #accuracy').val();
			content="<div class='paywaybox' style='width:calc(100% - 20px);overflow:hidden;'><div style='width:20px;height:19px;float:left;'><input type='checkbox' name='checkbox'></div><div class='payway' style='overflow:hidden;'><div style='width:calc(50% - 10px);float:left;text-align:left;'><span id='name1'>"+$('.result .numbox .moneybut #name1').html()+"</span>";
			if($('.result .numbox .moneybut #name2').length>0)content=content+"<span id='name2'>/"+$('.result .numbox .moneybut #name2').html()+"</span>";
			content=content+"</div><div style='width:calc(50% - 10px);float:left;text-align:right;'>"+$('.result .frontunit').val()+"<span class='paymoney'>";

			if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
				var temp=roundfun((Number($('.result #viewwindow #should').html())+Number($('.result #viewwindow #cashcomm').html())-Number($('.result #viewwindow #already').html())),precision);
			}
			else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
				var temp=ceilfun((Number($('.result #viewwindow #should').html())+Number($('.result #viewwindow #cashcomm').html())-Number($('.result #viewwindow #already').html())),precision);
			}
			else{//無條件捨去
				var temp=floorfun((Number($('.result #viewwindow #should').html())+Number($('.result #viewwindow #cashcomm').html())-Number($('.result #viewwindow #already').html())),precision);
			}
			
			content=content+temp+"</span>"+$('.result .unit').val()+"</div></div></div>";
			$('.result #paywindow #paycontent').append(content);
		}
		else{
		}
		computerchange();
	});
	$('.result .numbox').on('click','.cashbut',function(){//結帳畫面'信用卡'結帳方式按鈕
		var content='';
		var inputmoney=0;
		var commission=0;
		var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)

		if($('.result input[name="view"]').val().length>0){
			if((Number($('.result #viewwindow #should').html())+Number($('.result #viewwindow #cashcomm').html())-Number($('.result #viewwindow #already').html()))<=0){
			}
			else{
				if(Number($('.result input[name="view"]').val())>=(Number($('.result #viewwindow #should').html())+Number($('.result #viewwindow #cashcomm').html())-Number($('.result #viewwindow #already').html()))){
					inputmoney=Number($('.result #viewwindow #should').html())+Number($('.result #viewwindow #cashcomm').html())-Number($('.result #viewwindow #already').html());
				}
				else{
					inputmoney=$('.result input[name="view"]').val();
				}
			}
			$('.result input[name="view"]').val('');
		}
		else if((Number($('.result #viewwindow #should').html())+Number($('.result #viewwindow #cashcomm').html())-Number($('.result #viewwindow #already').html()))>0){
			inputmoney=Number($('.result #viewwindow #should').html())+Number($('.result #viewwindow #cashcomm').html())-Number($('.result #viewwindow #already').html());
			if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
				inputmoney=roundfun(inputmoney,precision);
			}
			else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
				inputmoney=ceilfun(inputmoney,precision);
			}
			else{//無條件捨去
				inputmoney=floorfun(inputmoney,precision);
			}
		}
		else{
		}

		commission=(Number(inputmoney)*$('.order#order .initsetting #cashcomm').val())/100;
		if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
			commission= roundfun(commission,precision);
		}
		else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
			commission= ceilfun(commission,precision);
		}
		else{//無條件捨去
			commission= floorfun(commission,precision);
		}

		if(Number(inputmoney)==0){
		}
		else{
			content="<div class='paywaybox' style='width:calc(100% - 20px);overflow:hidden;'><div style='width:20px;height:19px;float:left;'><input type='checkbox' name='checkbox'></div><div class='payway' style='overflow:hidden;'><div style='width:calc(50% - 10px);float:left;text-align:left;'><span id='name1'>"+$('.result .numbox .cashbut #name1').html()+"</span>";
			if($('.result .numbox .cashbut #name2').length>0)content=content+"<span id='name2'>/"+$('.result .numbox .cashbut #name2').html()+"</span>";
			content=content+"</div>";
			content=content+"<div style='width:calc(50% - 10px);float:left;text-align:right;'>"+$('.result .frontunit').val()+"<span class='paycash'>"+(Number(inputmoney)+Number(commission))+"</span>"+$('.result .unit').val()+"<input type='hidden' id='inputmoney' value='"+inputmoney+"'><input type='hidden' class='commission' value='"+commission+"'></div></div></div>";
			$('.result #paywindow #paycontent').append(content);
		}

		computerchange();
	});
	$('.result #paywindow').on('click','.payway',function(){//結帳畫面之結帳方式明細模擬labal點選
		var index=$('.result #paywindow .payway').index(this);
		$('.result #paywindow .paywaybox').removeClass('focus');
		if($('.result #paywindow .paywaybox:eq('+index+') input[name="checkbox"]').prop('checked')){
			$('.result #paywindow .paywaybox:eq('+index+') input[name="checkbox"]').prop('checked',false);
		}
		else{
			$('.result #paywindow .paywaybox:eq('+index+') input[name="checkbox"]').prop('checked',true);
		}
		if($('.result #paywindow .paywaybox:eq('+index+') .focus').length>0){
		}
		else{
			$('.result #paywindow .paywaybox:eq('+index+')').addClass('focus');
		}
	});
	$('.result #checkfun').on('click','#notsale',function(){//結帳畫面暫出結帳明細
		$('.result #viewwindow input[name="listtotal"]').val($('.result #viewwindow #total').html());
		$('.result #viewwindow input[name="itemdis"]').val($('.result #viewwindow #itemdis').html());
		$('.result #viewwindow input[name="memberdis"]').val($('.result #viewwindow #memberdis').html());
		$('.result #viewwindow input[name="listdis1"]').val($('.result #viewwindow #listdis1').html());
		$('.result #viewwindow input[name="listdis2"]').val($('.result #viewwindow #listdis2').html());
		$('.order#order #tabs4 #listform input[name="charge"]').val($('.result #viewwindow #charge').html());
		$('.result #viewwindow input[name="coupon1"]').val($('.result #viewwindow #coupon1').html());
		$('.result #viewwindow input[name="coupon2"]').val($('.result #viewwindow #coupon2').html());
		$('.result #viewwindow input[name="should"]').val($('.result #viewwindow #should').html());
		$('.result #viewwindow input[name="cashcomm"]').val($('.result #viewwindow #cashcomm').html());
		$('.result #viewwindow input[name="already"]').val($('.result #viewwindow #already').html());
		$('.result #viewwindow input[name="cashmoney"]').val($('.result #viewwindow #cashmoney').html());
		$('.result #viewwindow input[name="cash"]').val($('.result #viewwindow #cash').html());
		$('.result #viewwindow input[name="other"]').val($('.result #viewwindow #other').html());
		$('.result #viewwindow input[name="otherfix"]').val($('.result #viewwindow #otherfix').html());
		$('.result #viewwindow input[name="change"]').val($('.result #viewwindow #change').html());
		$('.result #viewwindow input[name="autodis"]').val($('.result #viewwindow #autodis').html());
		$('.order#order #tabs4 #listform input[name="tempbuytype"]').val('1');
		$('.order#order #tabs4 #listform input[name="printclientlist"]').val('1');
		if(typeof $('.result #viewwindow input[name="sendtype"]')=="undefuned"||$('.result #viewwindow input[name="sendtype"]').val()=='result'){
			var array1=$("#tabs4 #listform , .result #viewwindow .sendviewwindow").serialize();
			array1=array1+'&printtempclient';
			//console.log(array1);
		}
		else{
			var array1=$(".result #viewwindow .sendviewwindow").serialize();
			array1=array1+'&charge='+$('.result #viewwindow #charge').html()+'&machinetype='+$('.order#order #tabs4 #listform input[name="machinetype"]').val()+'&bizdate='+$('.viewtemp #date').html()+'&consecnumber='+$('.viewtemp #listno input[name="consecnumber"]').val()+'&printtempclient';
			//console.log(array1);
		}
		array1=array1+'&notconsecnumber';
		if($('.order#order #tabs4 #listform input[name="consecnumber"]').val()==''||$('.result input[name="sendtype"]').val()=='buytemp'||$('.result #viewwindow input[name="sendtype"]').val()=='tempsale'){
		}
		else{
			$.ajax({
				url:'./lib/js/create.voidlist.php',
				method:'post',
				async: false,
				data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tablenumber':$('.order#order #tabs4 #listform input[name="tablenumber"]').val(),'machine':$('.order#order .companydata #terminalnumber').val()},
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'sale create.voidlist.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
				},
				error:function(e){
					//console.log(e);
				}
			});
		}
		if($('.result input[name="sendtype"]').val()=='buytemp'||$('.result #viewwindow input[name="sendtype"]').val()=='tempsale'){
			consecnumber=$('.viewtemp #listno input[name="consecnumber"]').val();
		}
		else{
			$.ajax({
				url:'./lib/js/create.list.php',
				method:'post',
				async: false,
				data:array1,
				dataType:'html',
				success:function(d){
					if(d.length>10){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'sale create.list.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log('明細單'+d);
					consecnumber=d;
				},
				error:function(e){
					//console.log(e);
				}
			});
		}
		$.ajax({
			url:'./lib/js/gettempdata.ajax.php',
			dataType:'html',
			success:function(d){
				var temp=d.split(',');
				$('.order#order #tabs4 #listform input[name="tempbuytype"]').val(temp[0]);
				$('.order#order #tabs4 #listform input[name="printclientlist"]').val(temp[1]);
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.result #checkfun').on('click','#submit',function(){//結帳畫面確認按鈕
		if((typeof $('.result input[name="sendtype"]')=="undefined"||$('.result input[name="sendtype"]').val()=='result'||$('.result input[name="sendtype"]').val()=='buytemp')&&Number($('.result #viewwindow #notyet').html())>0){
			if($('.sysmeg #name1.syshint2').length>0){
				$('.sysmeg #name1.syshint2').css({'display':''});
			}
			else{
			}
			if($('.sysmeg #name2.syshint2').length>0){
				$('.sysmeg #name2.syshint2').css({'display':''});
			}
			else{
			}
			sysmeg.dialog('open');
		}
		else if($('.order#order #banner #detail #oinv').length>0&&$('.order#order #banner #detail #oinv').val()=='ERROR'){
		}
		else{
			var gotin=1;
			if($('.order#order .initsetting #pointtree').val()=='1'&&$('.result .sendviewwindow input[name="otherstring"]').val().match("pointtree")){
				var tempors=$('.result .sendviewwindow input[name="otherstring"]').val().split("pointtree-value:");
				var tempors=tempors[1].split("=");
				if(Number(tempors[0])>0&&(!$.isNumeric($('.result #funbox .pointtree #name2').html())||$('.result #funbox .pointtree #name3').html()=="")){
					gotin=0;
				}
				else{
				}
			}
			/*else{
			}*/
			if($('.order#order #tabs4 #listform input[name="listtype"]').val()=='1'&&(Number($('.setperson #view input[name="personfloor1"]').val())>0||Number($('.setperson #view input[name="personfloor2"]').val())>0||Number($('.setperson #view input[name="personfloor3"]').val())>0)&&parseInt($('.order#order #MemberBill #tabs1 #persons').val())==0){
				//personhint.dialog('open');
				alert('請填入用餐人數');
			}
			else if($('.order#order .initsetting #pointtree').val()=='1'&&gotin==0){
				alert('請輸入集點樹會員');
			}
			else{
				/*發票金額，改成帳單折扣與其他付款即時變動*/
				$('.order#order #tabs4 #listform input[name="invsalemoney"]').val($('.result #viewwindow #should').html());

				$('.result #viewwindow input[name="listtotal"]').val($('.result #viewwindow #total').html());
				$('.result #viewwindow input[name="itemdis"]').val($('.result #viewwindow #itemdis').html());
				$('.result #viewwindow input[name="memberdis"]').val($('.result #viewwindow #memberdis').html());
				$('.result #viewwindow input[name="listdis1"]').val($('.result #viewwindow #listdis1').html());
				$('.result #viewwindow input[name="listdis2"]').val($('.result #viewwindow #listdis2').html());
				$('.order#order #tabs4 #listform input[name="charge"]').val($('.result #viewwindow #charge').html());
				$('.result #viewwindow input[name="coupon1"]').val($('.result #viewwindow #coupon1').html());
				$('.result #viewwindow input[name="coupon2"]').val($('.result #viewwindow #coupon2').html());
				$('.result #viewwindow input[name="should"]').val($('.result #viewwindow #should').html());
				$('.result #viewwindow input[name="cashcomm"]').val($('.result #viewwindow #cashcomm').html());
				$('.result #viewwindow input[name="already"]').val($('.result #viewwindow #already').html());
				$('.result #viewwindow input[name="cashmoney"]').val($('.result #viewwindow #cashmoney').html());
				$('.result #viewwindow input[name="cash"]').val($('.result #viewwindow #cash').html());
				$('.result #viewwindow input[name="other"]').val($('.result #viewwindow #other').html());
				$('.result #viewwindow input[name="otherfix"]').val($('.result #viewwindow #otherfix').html());
				$('.result #viewwindow input[name="change"]').val($('.result #viewwindow #change').html());
				$('.result #viewwindow input[name="autodis"]').val($('.result #viewwindow #autodis').html());
				$('.order#order #tabs4 #listform input[name="tempbuytype"]').val('1');
				
				var istrue=1;
				if($('.result #viewwindow input[name="tempban"]').val().length>0){
					if(parseInt($('.result #viewwindow input[name="tempban"]').val())==0){
					}
					else if($('.result #viewwindow input[name="tempban"]').val().length!=8){
						if($('.sysmeg #name1.syshint4').length>0){
							$('.sysmeg #name1.syshint4').css({'display':''});
						}
						else{
						}
						if($('.sysmeg #name2.syshint4').length>0){
							$('.sysmeg #name2.syshint4').css({'display':''});
						}
						else{
						}
						sysmeg.dialog('open');
						istrue=0;
					}
					else{
						var ban=$('.result #viewwindow input[name="tempban"]').val();
						var value=0;
						var t=[1,2,1,2,1,2,4,1];
						var temp=0;
						for(var i=0;i<8;i++){
							temp=parseInt(ban.substr(i,1))*t[i];
							//console.log('temp='+ban.substr(i,1)+'*'+t[i]+'='+temp);
							if(parseInt(temp)>=10){
								//console.log('value='+value+'+'+temp.toString().substr(0,1)+'+'+temp.toString().substr(1,1)+'='+(parseInt(value)+parseInt(temp.toString().substr(0,1))+parseInt(temp.toString().substr(1,1))));
								value=parseInt(value)+parseInt(temp.toString().substr(0,1))+parseInt(temp.toString().substr(1,1));
							}
							else{
								//console.log('value='+value+'+'+temp+'='+(parseInt(value)+parseInt(temp)));
								value=parseInt(value)+parseInt(temp);
							}
						}
						if(value%10==0){
						}
						else if(parseInt(ban.substr(6,1))==7&&(value+1)%10==0){
						}
						else{
							if($('.sysmeg #name1.syshint4').length>0){
								$('.sysmeg #name1.syshint4').css({'display':''});
							}
							else{
							}
							if($('.sysmeg #name2.syshint4').length>0){
								$('.sysmeg #name2.syshint4').css({'display':''});
							}
							else{
							}
							sysmeg.dialog('open');
							istrue=0;
						}
					}
				}
				else{
				}
				if(istrue==0){//由於統編格示錯誤，不做處理
				}
				else{
					if($('.result #paywindow .paywaybox .paycash').length>0&&$('.order#order .initsetting #creditcode').val()=='1'){//使用信用卡付款
						$('.keybord input[name="type"]').val('creditcard');
						//console.log($('.keybord input[name="type"]').val());
						keybord.dialog('option','title','輸入卡號');
						keybord.dialog('open');
					}
					else{//無使用信用卡付款
						var nowbizdate=$('.order#order #tabs4 #listform input[name="bizdate"]').val();
						if(typeof $('.result #viewwindow input[name="sendtype"]')=="undefuned"||$('.result #viewwindow input[name="sendtype"]').val()=='result'){
							var array1=$("#tabs4 #listform , .result #viewwindow .sendviewwindow").serialize();
							//console.log(array1);
						}
						else{
							var array1=$(".result #viewwindow .sendviewwindow").serialize();
							array1=array1+'&charge='+$('.result #viewwindow #charge').html()+'&machinetype='+$('.order#order #tabs4 #listform input[name="machinetype"]').val()+'&bizdate='+$('.viewtemp #date').html()+'&consecnumber='+$('.viewtemp #listno input[name="consecnumber"]').val();
							//console.log(array1);
						}
						var invnumber='';
						var consecnumber='';
						if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
							var posdvrfile='';
						}
						else{
						}
						$('.result #checkfun #submit').prop('disabled',true);
						$.ajax({//寫入暫存資料表
							url:'./lib/js/create.tempdb.php',
							method:'post',
							async:false,
							data:array1,
							dataType:'html',
							success:function(d){
								//console.log(d);
								if(d.length>20){
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										data:{'html':'sale create.tempdb.php '+d},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
								}
								else{
								}
								var tempd=d.split('-');
								consecnumber=tempd[1];
								if($('.order#order #tabs4 #listform input[name="consecnumber"]').val()==''){
									$('.order#order #tabs4 #listform input[name="saleno"]').val(tempd[0]);
									$('.order#order #tabs4 #listform input[name="consecnumber"]').val(tempd[1]);
									array1=$("#tabs4 #listform , .result #viewwindow .sendviewwindow").serialize();
								}
								else{
								}
								if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
									posdvrfile=tempd[2];
								}
								else{
								}
							},
							error:function(e){
								console.log(e);
							}
						});
						/*錢都錄借接*/
						if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
							/*start tag*/
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'start posdvr-sendmessage','file':'posdvr'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){console.log(e);}
							});
							if(typeof api_sendmessage_posdvr!=="undefined"&&typeof api_sendmessage_posdvr==="function"){
								api_sendmessage_posdvr(posdvrfile);
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'success','file':'posdvr'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'error sendmessage is not function','file':'posdvr'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							/*end tag*/
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'end posdvr-sendmessage','file':'posdvr'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}

						if($('.order#order #tabs4 #listform input[name="consecnumber"]').val()==''||$('.result input[name="sendtype"]').val()=='buytemp'||$('.result #viewwindow input[name="sendtype"]').val()=='tempsale'){
						}
						else{
							$.ajax({
								url:'./lib/js/create.voidlist.php',
								method:'post',
								async: false,
								data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tablenumber':$('.order#order #tabs4 #listform input[name="tablenumber"]').val(),'machine':$('.order#order .companydata #terminalnumber').val()},
								dataType:'html',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'sale create.voidlist.php '+d},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									//console.log(d);
								},
								error:function(e){
									//console.log(e);
								}
							});
						}
						if($('.result input[name="sendtype"]').val()=='buytemp'||$('.result #viewwindow input[name="sendtype"]').val()=='tempsale'){
							consecnumber=$('.viewtemp #listno input[name="consecnumber"]').val();
						}
						else{
							$.ajax({
								url:'./lib/js/create.list.php',
								method:'post',
								async: false,
								data:array1,
								dataType:'html',
								success:function(d){
									if(d.length>10){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'sale create.list.php '+d},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									console.log('明細單'+d);
									consecnumber=d;
								},
								error:function(e){
									console.log(e);
								}
							});
						}
						
						if($('.order#order #tabs4 #listform input[name="consecnumber"]').val()==''||$('.result input[name="sendtype"]').val()=='buytemp'||$('.result #viewwindow input[name="sendtype"]').val()=='tempsale'){
						}
						else{
							$.ajax({
								url:'./lib/js/create.voidkitchen.php',
								method:'post',
								async: false,
								data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tablenumber':$('.order#order #tabs4 #listform input[name="tablenumber"]').val(),'machine':$('.order#order .companydata #terminalnumber').val()},
								dataType:'html',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'sale create.voidkitchen.php '+d},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									//console.log(d);
								},
								error:function(e){
									//console.log(e);
								}
							});
						}
						if(($('.result input[name="sendtype"]').val()=='result'&&!$('.result #funbox .invbut').prop('disabled'))&&(typeof $('.result #funbox .invno').val()=="undefined"||$('.result #funbox .invno').val()=='1')&&$('.order#order .initsetting #useinv').val()=='1'&&Number($('.order#order #tabs4 #listform input[name="invsalemoney"]').val())>0){//啟用發票&&開立發票
							$.ajax({
								url:'./lib/js/open.inv.php',
								method:'post',
								async:false,
								data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tempban':$('.result #viewwindow input[name="tempban"]').val(),'tempcontainer':$('.result #viewwindow input[name="tempcontainer"]').val(),'invlist':$('.order#order #tabs4 #listform input[name="invlist"]').val()},
								dataType:'html',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'sale open.inv.php '+d},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									//console.log('發票'+d);
									invnumber=d;
								},
								error:function(e){
									//console.log(e);
								}
							});
						}
						else if(($('.result input[name="sendtype"]').val()=='tempsale'&&!$('.result #funbox .invbut').prop('disabled'))&&(typeof $('.result #funbox .invno').val()=="undefined"||$('.result #funbox .invno').val()=='1')&&$('.order#order .initsetting #useinv').val()=='1'&&Number($('.order#order #tabs4 #listform input[name="invsalemoney"]').val())>0){//啟用發票&&開立發票
							$.ajax({
								url:'./lib/js/open.inv.php',
								method:'post',
								async:false,
								data:{'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'tempban':$('.result #viewwindow input[name="tempban"]').val(),'tempcontainer':$('.result #viewwindow input[name="tempcontainer"]').val(),'invlist':$('.order#order #tabs4 #listform input[name="invlist"]').val()},
								dataType:'html',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'sale open.inv.php '+d},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									//console.log('發票'+d);
									invnumber=d;
								},
								error:function(e){
									//console.log(e);
								}
							});
						}
						else if(typeof $('.result input[name="sendtype"]')!="undefined"&&($('.result input[name="sendtype"]').val()=='buytemp'||$('.result #viewwindow input[name="sendtype"]').val()=='tempsale')&&invnumber==''){
							invnumber=$('.viewtemp #salelist #salecontent .listitems#focus div:eq(3)').html();
						}
						if(($('.result input[name="sendtype"]').val()=='result'&&!$('.result #funbox .invbut').prop('disabled'))&&(typeof $('.result #funbox .invno').val()=="undefined"||$('.result #funbox .invno').val()=='1')&&$('.order#order .initsetting #useoinv').val()=='1'&&Number($('.order#order #tabs4 #listform input[name="invsalemoney"]').val())>0){//啟用傳統發票&&開立傳統發票
							$.ajax({
								url:'./lib/js/open.oinv.php',
								method:'post',
								async:false,
								data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tempban':$('.result #viewwindow input[name="tempban"]').val(),'tempcontainer':$('.result #viewwindow input[name="tempcontainer"]').val(),'invlist':$('.order#order #tabs4 #listform input[name="invlist"]').val()},
								dataType:'html',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'sale open.oinv.php '+d},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									console.log('發票'+d);
									invnumber=d;
								},
								error:function(e){
									//console.log(e);
								}
							});
						}
						else if(($('.result input[name="sendtype"]').val()=='tempsale'&&!$('.result #funbox .invbut').prop('disabled'))&&(typeof $('.result #funbox .invno').val()=="undefined"||$('.result #funbox .invno').val()=='1')&&$('.order#order .initsetting #useoinv').val()=='1'&&Number($('.order#order #tabs4 #listform input[name="invsalemoney"]').val())>0){//啟用傳統發票&&開立傳統發票
							$.ajax({
								url:'./lib/js/open.oinv.php',
								method:'post',
								async:false,
								data:{'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'tempban':$('.result #viewwindow input[name="tempban"]').val(),'tempcontainer':$('.result #viewwindow input[name="tempcontainer"]').val(),'invlist':$('.order#order #tabs4 #listform input[name="invlist"]').val()},
								dataType:'html',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'sale open.oinv.php '+d},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									//console.log('發票'+d);
									invnumber=d;
								},
								error:function(e){
									//console.log(e);
								}
							});
						}
						else if(typeof $('.result input[name="sendtype"]')!="undefined"&&($('.result input[name="sendtype"]').val()=='buytemp'||$('.result #viewwindow input[name="sendtype"]').val()=='tempsale')&&invnumber==''){
							invnumber=$('.viewtemp #salelist #salecontent .listitems#focus div:eq(3)').html();
						}
						else{
						}
						if(typeof $('.result input[name="sendtype"]')!="undefined"&&$('.result input[name="sendtype"]').val()=='tempsale'){//暫結需開發票之情況
						}
						else{
							if(typeof $('.result input[name="sendtype"]')!="undefined"&&$('.result input[name="sendtype"]').val()=='buytemp'){
								$.ajax({
									url:'./lib/js/temptodb.ajax.php',
									method:'post',
									async:false,
									data:{'bizdate':$('.viewtemp #date').html(),'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'numbertag':consecnumber},
									dataType:'html',
									success:function(d){
										if(d.length>20){
											$.ajax({
												url:'./lib/js/print.php',
												method:'post',
												data:{'html':'sale temptodb.ajax.php '+d},
												dataType:'html',
												success:function(d){/*console.log(d);*/},
												error:function(e){/*console.log(e);*/}
											});
										}
										else{
										}
										//console.log(d);
										//console.log('轉移正式'+consecnumber);
									},
									error:function(e){
										//console.log(e);
									}
								});
							}
							else{
								$.ajax({
									url:'./lib/js/temptodb.ajax.php',
									method:'post',
									async:false,
									data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'numbertag':consecnumber},
									dataType:'html',
									success:function(d){
										if(d.length>20){
											$.ajax({
												url:'./lib/js/print.php',
												method:'post',
												data:{'html':'sale temptodb.ajax.php '+d},
												dataType:'html',
												success:function(d){/*console.log(d);*/},
												error:function(e){/*console.log(e);*/}
											});
										}
										else{
										}
										//console.log(d);
										//console.log('轉移正式'+consecnumber);
									},
									error:function(e){
										//console.log(e);
									}
								});
							}
						}
						if(typeof $('.result input[name="sendtype"]')!="undefined"&&($('.result input[name="sendtype"]').val()=='buytemp'||$('.result #viewwindow input[name="sendtype"]').val()=='tempsale')){
						}
						else{
							$.ajax({//產生工作單
								url:'./lib/js/create.kitchen.php',
								method:'post',
								async:false,
								data:array1,
								dataType:'html',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'sale create.kitchen.php '+d},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									//console.log('工作單'+d);
								},
								error:function(e){
									//console.log(e);
								}
							});
						}
						if(typeof $('.result input[name="sendtype"]')!="undefined"&&($('.result input[name="sendtype"]').val()=='buytemp'||$('.result #viewwindow input[name="sendtype"]').val()=='tempsale')){
						}
						else{
							$.ajax({//產生貼紙
								url:'./lib/js/create.tag.php',
								method:'post',
								async:false,
								data:array1,
								dataType:'html',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'sale create.tag.php '+d},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									//console.log('貼紙'+d);
								},
								error:function(e){
									//console.log(e);
								}
							});
						}
						if($('.order#order .initsetting #secview').val()=='1'){
							$.ajax({
								url:'../secview/cleartemp.ajax.php',
								async: false,
								dataType:'html',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'sale cleartemp.ajax.php '+d},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									//console.log(d);
								},
								error:function(e){
									//console.log(e);
								}
							});
						}
						else{
						}
						$.ajax({
							url:'./lib/js/create.cmdtxt.php',
							method:'post',
							async: false,
							data:{'cmd':$('.order#order #tabs4 #listform input[name="machinetype"]').val()+'-cashdrawer'},
							dataType:'html',
							success:function(d){
								//console.log(d);
							},
							error:function(e){
								//console.log(e);
							}
						});
						/*錢都錄借接*///2018/10/25由於上方已有相同function，分不清哪一個要保留，因此將此區塊註解
						/*if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
							//start tag
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'start posdvr-sendmessage','file':'posdvr'},
								dataType:'html',
								success:function(d){
									//console.log(d);
								},
								error:function(e){console.log(e);}
							});
							if(typeof api_sendmessage_posdvr!=="undefined"&&typeof api_sendmessage_posdvr==="function"){
								api_sendmessage_posdvr(posdvrfile);
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'success','file':'posdvr'},
									dataType:'html',
									success:function(d){
										//console.log(d);
									},
									error:function(e){
										//console.log(e);
									}
								});
							}
							else{
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'error sendmessage is not function','file':'posdvr'},
									dataType:'html',
									success:function(d){
										//console.log(d);
									},
									error:function(e){
										//console.log(e);
									}
								});
							}
							//end tag
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'end posdvr-sendmessage','file':'posdvr'},
								dataType:'html',
								success:function(d){
									//console.log(d);
								},
								error:function(e){
									//console.log(e);
								}
							});
						}
						else{
						}*/
						//2017/12/29var mywin=window.open('cashdrawer://','','width=1px,height=1px');
						//2017/12/29mywin.document.title='cashdrawer';

						/*集點樹贈點流程*/
						if(typeof $('.result input[name="sendtype"]')!="undefined"&&$('.result input[name="sendtype"]').val()=='tempsale'){//暫結需開發票之情況
						}
						else{
							var ptpoint=0;//兌換點數
							var ptpmoney=0;//兌換點數折扣金額
							var ptmoney=parseFloat($('.result #viewwindow #cash').html())+parseFloat($('.result #viewwindow #cashmoney').html());//集點金額:現金+信用卡金額
							if(typeof $('.result .sendviewwindow input[name="otherstring"]').val()!=="undefined"&&$('.result .sendviewwindow input[name="otherstring"]').val().length>0){
								var tempotherstring=$('.result .sendviewwindow input[name="otherstring"]').val().split(",");
								$.each(tempotherstring,function(v,i){
									var t1=i.split(":");
									var t1name=t1[0].split("-");
									var t1point=t1[1].split("=");
									if(t1name[0]=='pointtree'){
										ptpoint=t1point[0];
										ptppoint=t1point[1];
										return false;
									}
									else{
									}
								});
								if($('.result #viewwindow input[name="treetel"]').val().length>0&&Number(ptpoint)>0){
									/*start tag*/
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										data:{'html':'start point-tree-exchange redeem','file':'point-tree'},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
									if(typeof api_exchange_pointtree!=="undefined"&&typeof api_exchange_pointtree==="function"){
										if(typeof $('.result input[name="sendtype"]')!="undefined"&&$('.result input[name="sendtype"]').val()=='buytemp'){
											var exchangeres=api_exchange_pointtree($('.viewtemp #date').html(),consecnumber,$('.result #viewwindow input[name="treetoken"]').val(),$('.result #viewwindow input[name="treetel"]').val(),ptpoint);
										}
										else{
											var exchangeres=api_exchange_pointtree($('.order#order #tabs4 #listform input[name="bizdate"]').val(),consecnumber,$('.result #viewwindow input[name="treetoken"]').val(),$('.result #viewwindow input[name="treetel"]').val(),ptpoint);
										}
										console.log(exchangeres);
										if(exchangeres==''){
											$.ajax({
												url:'./lib/api/print.ticket.php',
												method:'post',
												async:false,
												data:{'type':'pointtree','message':'point-tree-exchange getrandom 意外錯誤'},
												dataType:'html',
												success:function(d){
													console.log(d);
												},
												error:function(e){
													console.log(e);
												}
											});
											$.ajax({
												url:'./lib/js/print.php',
												method:'post',
												async:false,
												data:{'html':'point-tree-exchange getrandom 意外錯誤','file':'point-tree'},
												dataType:'html',
												success:function(d){/*console.log(d);*/},
												error:function(e){/*console.log(e);*/}
											});
										}
										else if(typeof exchangeres['data']!=="undefined"){//success
											/*$.ajax({
												url:'./lib/api/print.ticket.php',
												method:'post',
												async:false,
												data:{'type':'pointtree','tel':$('.result #viewwindow input[name="treetel"]').val(),'user_balance':exchangeres['data']['user_balance']},
												dataType:'html',
												success:function(d){
													console.log(d);
												},
												error:function(e){
													console.log(e);
												}
											});*/
											$.ajax({
												url:'./lib/js/print.php',
												method:'post',
												async:false,
												data:{'html':'pass point-tree-exchange redeem -PHP_EOL-pos_token_tx_id:'+exchangeres['data']['pos_token_tx_id'],'file':'point-tree'},
												dataType:'html',
												success:function(d){/*console.log(d);*/},
												error:function(e){/*console.log(e);*/}
											});
										}
										else{
											var message=JSON.parse(exchangeres['responseText']);
											if(exchangeres['status']==='timeout'){
												$.ajax({
													url:'./lib/api/print.ticket.php',
													method:'post',
													async:false,
													data:{'type':'pointtree','message':'point-tree-exchange redeem timeout'},
													dataType:'html',
													success:function(d){
														console.log(d);
													},
													error:function(e){
														console.log(e);
													}
												});
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													async:false,
													data:{'html':'point-tree-exchange redeem timeout','file':'point-tree'},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else if(exchangeres['status']=='400'||exchangeres['status']=='406'){
												$.ajax({
													url:'./lib/api/print.ticket.php',
													method:'post',
													async:false,
													data:{'type':'pointtree','status':exchangeres['status'],'code':message['errors'][0]['code'],'message':message['errors'][0]['message']},
													dataType:'html',
													success:function(d){
														console.log(d);
													},
													error:function(e){
														console.log(e);
													}
												});
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													async:false,
													data:{'html':'point-tree-exchange redeem error -PHP_EOL-status:'+exchangeres['status']+'-PHP_EOL-code:'+message['errors'][0]['code']+'-PHP_EOL-message:'+message['errors'][0]['message'],'file':'point-tree'},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else{
												$.ajax({
													url:'./lib/api/print.ticket.php',
													method:'post',
													async:false,
													data:{'type':'pointtree','message':'point-tree-exchange redeem 意外錯誤'},
													dataType:'html',
													success:function(d){
														console.log(d);
													},
													error:function(e){
														console.log(e);
													}
												});
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													async:false,
													data:{'html':'point-tree-exchange redeem 意外錯誤','file':'point-tree'},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
										}
									}
									else{
										$.ajax({
											url:'./lib/api/print.ticket.php',
											method:'post',
											async:false,
											data:{'type':'pointtree','message':'api exchange pointtree is not function'},
											dataType:'html',
											success:function(d){
												console.log(d);
											},
											error:function(e){
												console.log(e);
											}
										});
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											async:false,
											data:{'html':'api exchange pointtree is not function','file':'point-tree'},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									/*end tag*/
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										data:{'html':'end point-tree-exchange redeem','file':'point-tree'},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
								}
								else{
								}
							}
							else{
							}
							if($('.order#order .initsetting #pointtree').length>0&&$('.order#order .initsetting #pointtree').val()=='1'){
								if($('.result #viewwindow input[name="treetel"]').val().length>0&&Number(ptmoney)>0){
									/*start tag*/
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										data:{'html':'start point-tree-gift transfer','file':'point-tree'},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
									if(typeof api_gift_pointtree!=="undefined"&&typeof api_gift_pointtree==="function"){
										if(typeof $('.result input[name="sendtype"]')!="undefined"&&$('.result input[name="sendtype"]').val()=='buytemp'){
											var giftres=api_gift_pointtree($('.viewtemp #date').html(),consecnumber,$('.result #viewwindow input[name="treetoken"]').val(),$('.result #viewwindow input[name="treetel"]').val(),ptmoney);
										}
										else{
											var giftres=api_gift_pointtree($('.order#order #tabs4 #listform input[name="bizdate"]').val(),consecnumber,$('.result #viewwindow input[name="treetoken"]').val(),$('.result #viewwindow input[name="treetel"]').val(),ptmoney);
										}
										//console.log(giftres);
										if(giftres==''){
											$.ajax({
												url:'./lib/api/print.ticket.php',
												method:'post',
												async:false,
												data:{'type':'pointtree','message':'point-tree-gift getrandom 意外錯誤'},
												dataType:'html',
												success:function(d){
													console.log(d);
												},
												error:function(e){
													console.log(e);
												}
											});
											$.ajax({
												url:'./lib/js/print.php',
												method:'post',
												async:false,
												data:{'html':'point-tree-gift getrandom 意外錯誤','file':'point-tree'},
												dataType:'html',
												success:function(d){/*console.log(d);*/},
												error:function(e){/*console.log(e);*/}
											});
										}
										else if(typeof giftres['data']!=="undefined"){//success
											$.ajax({
												url:'./lib/api/print.ticket.php',
												method:'post',
												async:false,
												data:{'type':'pointtree','tel':$('.result #viewwindow input[name="treetel"]').val(),/*'give_balance':giftres['data']['give_balance'],*/'user_balance':giftres['data']['user_balance']},
												dataType:'html',
												success:function(d){
													console.log(d);
												},
												error:function(e){
													console.log(e);
												}
											});
											$.ajax({
												url:'./lib/js/print.php',
												method:'post',
												async:false,
												data:{'html':'pass point-tree-gift transfer -PHP_EOL-pos_token_tx_id:'+giftres['data']['pos_token_tx_id']+'-PHP_EOL-store_balance:'+giftres['data']['store_balance']+'-PHP_EOL-user_balance:'+giftres['data']['user_balance'],'file':'point-tree'},
												dataType:'html',
												success:function(d){/*console.log(d);*/},
												error:function(e){/*console.log(e);*/}
											});
										}
										else{
											var message=JSON.parse(giftres['responseText']);
											if(giftres['status']==='timeout'){
												$.ajax({
													url:'./lib/api/print.ticket.php',
													method:'post',
													async:false,
													data:{'type':'pointtree','message':'point-tree-gift transfer timeout'},
													dataType:'html',
													success:function(d){
														console.log(d);
													},
													error:function(e){
														console.log(e);
													}
												});
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													async:false,
													data:{'html':'point-tree-gift transfer timeout','file':'point-tree'},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else if(giftres['status']=='400'||giftres['status']=='406'){
												$.ajax({
													url:'./lib/api/print.ticket.php',
													method:'post',
													async:false,
													data:{'type':'pointtree','status':giftres['status'],'code':message['errors'][0]['code'],'message':message['errors'][0]['message']},
													dataType:'html',
													success:function(d){
														console.log(d);
													},
													error:function(e){
														console.log(e);
													}
												});
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													async:false,
													data:{'html':'point-tree-gift transfer error -PHP_EOL-status:'+giftres['status']+'-PHP_EOL-code:'+message['errors'][0]['code']+'-PHP_EOL-message:'+message['errors'][0]['message'],'file':'point-tree'},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else{
												$.ajax({
													url:'./lib/api/print.ticket.php',
													method:'post',
													async:false,
													data:{'type':'pointtree','message':'point-tree-gift transfer 意外錯誤'},
													dataType:'html',
													success:function(d){
														console.log(d);
													},
													error:function(e){
														console.log(e);
													}
												});
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													async:false,
													data:{'html':'point-tree-gift transfer 意外錯誤','file':'point-tree'},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
										}
									}
									else{
										$.ajax({
											url:'./lib/api/print.ticket.php',
											method:'post',
											async:false,
											data:{'type':'pointtree','message':'api gift pointtree is not function'},
											dataType:'html',
											success:function(d){
												console.log(d);
											},
											error:function(e){
												console.log(e);
											}
										});
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											async:false,
											data:{'html':'api gift pointtree is not function','file':'point-tree'},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									/*end tag*/
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										data:{'html':'end point-tree-gift transfer','file':'point-tree'},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
								}
								else{
								}
							}
							else{
							}
						}
						
						if($('.order#order .initsetting #changehint').val()=='1'){//找零提示視窗
							result.dialog('close');
							$('.changehint .inv').val(invnumber);
							$('.changehint .should').val($('.result #viewwindow #should').html());
							$('.changehint .already').val($('.result #viewwindow #already').html());
							$('.changehint .change').val($('.result #viewwindow #change').html());
							change.dialog('open');
						}
						else{
							if(viewtemp.dialog('isOpen')){//暫結開立發票
								alert('發票開立完成。');
								ClearWindow('','');
								result.dialog('close');
								viewtemp.dialog('close');
								$('.order#order #list #funbox #view').trigger('click');
								$.ajax({
									url:'./lib/js/check.booking.php',
									method:'post',
									async:false,
									dataType:'html',
									success:function(d){
										if(d=='success'){
											if($('.order#order #content #MemberBill #list #funbox #point').css('background-color')=='red'){
											}
											else{
												$('.order#order #content #MemberBill #list #funbox #point').css({'background-color':'red','z-index':'3'});
											}
										}
										else{
											$('.order#order #content #MemberBill #list #funbox #point').css({'background-color':'','z-index':''});
										}
										//console.log(d);
									},
									error:function(e){
										console.log(e);
									}
								});
							}
							else{
								window.setTimeout(function(){
									if($('.order#order .initsetting #controltable').val()=='1'){
										/*if($('.order#order .companydata #submachine').length>0){
											location.href='./control.php?submachine&usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
										}
										else{
											if($('.order#order #tabs4 #listform input[name="machinetype"]').val()=='m1'){
												location.href='./control.php?usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
											}
											else{
												location.href='./control.php?machine='+$('.order#order #tabs4 #listform input[name="machinetype"]').val()+'&usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
											}
										}*/
										result.dialog('close');
										inittable.dialog('open');
										ClearWindow('','');
									}
									else{
										//if($('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val().length>0){
											//location.href='./order.php?usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
											result.dialog('close');
											ClearWindow('','');
										/*}
										else{
											location.href='./order.php';
										}*/
									}},500);
							}
						}
					}
				}
			}
		}
	});
	$('.result #checkfun').on('click','#cancel',function(){//結帳畫面取消按鈕
		$('.result #viewwindow #total').html('0');
		$('.result #viewwindow #temptotal').val('0');
		$('.result #viewwindow #itemdis').html('0');
		$('.result #viewwindow #tempdis').val('0');
		$('.result #viewwindow #memberdis').html('0');
		$('.result #viewwindow #listdis1').html('0');
		$('.result #viewwindow #listdis2').html('0');
		$('.result #viewwindow #charge').html('0');
		$('.result #viewwindow #coupon1').html('0');
		$('.result #viewwindow #coupon2').html('0');
		$('.result #viewwindow #should').html('0');
		$('.result #viewwindow #already').html('0');
		$('.result #viewwindow #cashmoney').html('0');
		$('.result #viewwindow #cash').html('0');
		$('.result #viewwindow #other').html('0');
		$('.result #viewwindow input[name="otherstring"]').val('');
		$('.result #viewwindow #otherfix').html('0');
		$('.result #viewwindow #notyet').html('0');
		$('.result #viewwindow #change').html('0');
		$('.result #viewwindow #autodis').html('0');
		/*if($('.order#order #MemberBill #tabs4 #listform .listcontent')){
		}
		else{
		}*/
		$.ajax({
			url:'../secview/writepoint.ajax.php',
			method:'post',
			data:{'tel':'','point':'0','machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val()}
		});
		result.dialog('close');
		if($('.result input[name="sendtype"]').val()=='tempsale'){
		}
		else if($('.result input[name="sendtype"]').val()=='buytemp'){
			$('.temptoinv').append("<button id='delplus' value='修改帳單'>修改帳單</button>");
			$('.temptoinv').append("<button id='buylist' value='結帳'>結帳</button>");
			$('.temptoinv').append("<button id='cancel' value='取消'>取消</button>");
			temptoinv.dialog('open');
		}
		else{
		}
	});
	$('.itemdis .numbox').on('click','input',function(){
		var index=$('.itemdis .numbox input').index(this);
		if($('.itemdis input[name="view"]').val()==''&&$('.itemdis .numbox input:eq('+index+')').val()=='.'){
			$('.itemdis input[name="view"]').val('0.');
		}
		else{
			$('.itemdis input[name="view"]').val($('.itemdis input[name="view"]').val()+$('.itemdis .numbox input:eq('+index+')').val());
		}
	});
	$('.setchange .numbox').on('click','input',function(){
		var index=$('.setchange .numbox input').index(this);
		if($('.setchange input[name="view"]').val()==''&&$('.setchange .numbox input:eq('+index+')').val()=='.'){
			$('.setchange input[name="view"]').val('0.');
		}
		else if($('.setchange input[name="view"]').val()=='0'){
			$('.setchange input[name="view"]').val($('.setchange .numbox input:eq('+index+')').val());
		}
		else{
			$('.setchange input[name="view"]').val($('.setchange input[name="view"]').val()+$('.setchange .numbox input:eq('+index+')').val());
		}
	});
	$('.setchange .numbox').on('click','button',function(){
		$('.setchange input[name="view"]').val('0');
	});
	$('.itemdis .numbox').on('click','button',function(){
		$('.itemdis input[name="view"]').val('');
	});
	$('.itemdis #funbox').on('click','#free',function(){//免費招待(單位:數量)
		if($('.itemdis input[name="view"]').val().length>0){
			$('.itemdis #viewwindow #dis2').html(Number($('.itemdis input[name="view"]').val())*(Number($('.itemdis #viewwindow #unitprice').html())+Number($('.itemdis #viewwindow #tastemoney').html())));
			$('.itemdis #viewwindow #total').html(Number($('.itemdis #viewwindow #subtotal').html())-Number($('.itemdis #viewwindow #dis1').html())-Number($('.itemdis #viewwindow #dis2').html()));
			if(Number($('.itemdis #viewwindow #total').html())<=0){
				$('.itemdis #viewwindow #dis2').html(Number($('.itemdis #viewwindow #total').html())+Number($('.itemdis #viewwindow #dis2').html()));
				$('.itemdis #viewwindow #total').html('0');
			}
			else{
			}
			$('.itemdis input[name="view"]').val('');
			$('.itemdis #viewwindow #disbut').val('free');
		}
		/*else if($('.itemdis input[name="view"]').val()==''){//全部免費招待
			$('.itemdis #viewwindow #dis2').html(Number($('.itemdis #viewwindow #number').html())*(Number($('.itemdis #viewwindow #unitprice').html())+Number($('.itemdis #viewwindow #tastemoney').html())));
			$('.itemdis #viewwindow #total').html(Number($('.itemdis #viewwindow #subtotal').html())-Number($('.itemdis #viewwindow #dis1').html())-Number($('.itemdis #viewwindow #dis2').html()));
			if(Number($('.itemdis #viewwindow #total').html())<=0){
				$('.itemdis #viewwindow #dis2').html(Number($('.itemdis #viewwindow #total').html())+Number($('.itemdis #viewwindow #dis2').html()));
				$('.itemdis #viewwindow #total').html('0');
			}
			else{
			}
			$('.itemdis input[name="view"]').val('');
			$('.itemdis #viewwindow #disbut').val('free');
		}*/
		else{
		}
	});
	$('.itemdis #funbox').on('click','#dis1',function(){//單品折扣(單位:折)
		if($('.itemdis input[name="view"]').val().length>0){
			$('.itemdis #viewwindow #dis2').html(discount2(Number($('.itemdis input[name="view"]').val())));
			computeritemsubtotal('dis2');
			$('.itemdis input[name="view"]').val('');
			$('.itemdis #viewwindow #disbut').val('dis1');
		}
		else{
		}
	});
	$('.itemdis #funbox').on('click','#dis2',function(){//單品折讓(單位:元)
		if($('.itemdis input[name="view"]').val().length>0){
			$('.itemdis #viewwindow #dis2').html($('.itemdis input[name="view"]').val());
			computeritemsubtotal('dis2');
			$('.itemdis input[name="view"]').val('');
			$('.itemdis #viewwindow #disbut').val('dis2');
		}
		else{
		}
	});
	$('.itemdis #funbox').on('click','#sdis1',function(){//單一價
		$('.itemdis input[name="view"]').val('');
		if($('.order#order .initsetting #itemaccuracyseq').val()=='1'){
			if((Number($('.itemdis #viewwindow #unitprice').html())+Number($('.itemdis #viewwindow #tastemoney').html()))<Number($('.order#order .initsetting #singledis').val())){
				alert('錯誤操作。');
			}
			else{
				$('.itemdis #viewwindow #dis2').html(((Number($('.itemdis #viewwindow #unitprice').html())+Number($('.itemdis #viewwindow #tastemoney').html()))-Number($('.order#order .initsetting #singledis').val()))*Number($('.itemdis #viewwindow #number').html()));
				$('.itemdis #viewwindow #total').html(Number($('.order#order .initsetting #singledis').val())*Number($('.itemdis #viewwindow #number').html()));
				$('.itemdis #viewwindow #disbut').val('sdis1');
			}
		}
		else{
			if(Number($('.itemdis #viewwindow #unitprice').html())<Number($('.order#order .initsetting #singledis').val())){
				alert('錯誤操作。');
			}
			else{
				$('.itemdis #viewwindow #dis2').html((Number($('.itemdis #viewwindow #unitprice').html())-Number($('.order#order .initsetting #singledis').val()))*Number($('.itemdis #viewwindow #number').html()));
				$('.itemdis #viewwindow #total').html((Number($('.order#order .initsetting #singledis').val())+Number($('.itemdis #viewwindow #tastemoney').html()))*Number($('.itemdis #viewwindow #number').html()));
				$('.itemdis #viewwindow #disbut').val('sdis1');
			}
		}
	});
	$('.itemdis #funbox').on('click','#qdis1',function(){//快速折扣
		if($('.order#order .initsetting #dis1number').length>0){
			$('.itemdis #viewwindow #dis2').html(discount2(Number($('.order#order .initsetting #dis1number').val())));
			computeritemsubtotal('dis2');
			//$('.itemdis input[name="view"]').val('');
			$('.itemdis #viewwindow #disbut').val('dis1');
		}
		else{
		}
	});
	$('.itemdis #funbox').on('click','#qdis2',function(){//快速折讓
		if($('.order#order .initsetting #dis2number').length>0){
			$('.itemdis #viewwindow #dis2').html($('.order#order .initsetting #dis2number').val());
			computeritemsubtotal('dis2');
			//$('.itemdis input[name="view"]').val('');
			$('.itemdis #viewwindow #disbut').val('dis2');
		}
		else{
		}
	});
	function discount2(disn){
		var temp;
		var precision=parseInt($('.order#order .initsetting #accuracy').val())+2;
		if($('.order#order .initsetting #itemaccuracyseq').val()=='1'){//以加料後的價格(設定檔內設定)
			temp=(Number((Number($('.itemdis #viewwindow #unitprice').html())+Number($('.itemdis #viewwindow #tastemoney').html()))*Number($('.itemdis #viewwindow #number').html()))*(100-disn))/100;
		}
		else{//以原始價格
			temp=Number((Number($('.itemdis #viewwindow #unitprice').html())*Number($('.itemdis #viewwindow #number').html()))*(100-disn))/100;
		}
		/*設定檔內可設定使用何種進位*/
		if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
			return roundfun(temp ,precision);
		}
		else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
			return ceilfun(temp ,precision);
		}
		else{//無條件捨去
			return floorfun(temp ,precision);
		}
	};
	function computeritemsubtotal(idvalue){
		var precision=$('.order#order .initsetting #accuracy').val();
		var temp=Number(Number($('.itemdis #viewwindow #subtotal').html())-Number($('.itemdis #viewwindow #dis1').html())-Number($('.itemdis #viewwindow #dis2').html()));
		//console.log(temp);
		if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
			$('.itemdis #viewwindow #total').html( roundfun(temp ,precision));
		}
		else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
			$('.itemdis #viewwindow #total').html( ceilfun(temp ,precision));
		}
		else{//無條件捨去
			$('.itemdis #viewwindow #total').html( floorfun(temp ,precision));
		}
		if(Number($('.itemdis #viewwindow #total').html())<=0){
			$('.itemdis #viewwindow #'+idvalue).html(Number($('.itemdis #viewwindow #total').html())+Number($('.itemdis #viewwindow #'+idvalue).html()));
			$('.itemdis #viewwindow #total').html('0');
		}
		else{
		}
		//console.log($('.order#order .initsetting #accuracytype').val());
		//console.log($('.itemdis #viewwindow #total').html());
	}
	$('.itemdis #checkfun').on('click','#submit',function(){
		$('.order#order #tabs1 #tempbox input[name="discount"]').val(Number($('.itemdis #viewwindow #dis1').html())+Number($('.itemdis #viewwindow #dis2').html()));
		$('.order#order #tabs1 #tempbox input[name="discontent"]').val($('.itemdis #viewwindow #disbut').val());
		$('.order#order #tabs1 #tempbox input[name="subtotal"]').val($('.itemdis #viewwindow #total').html());
		$('.order#order #editview').trigger('change');
		updateview();
		sumsubtotal();
		itemdis.dialog('close');
	});
	$('.itemdis #checkfun').on('click','#cancel',function(){
		itemdis.dialog('close');
	});
	$('.changehint').on('click','#reload',function(){
		/*if($('.order#order .initsetting #controltable').val()=='1'){
			if($('.order#order .companydata #submachine').length>0){
				location.href='./control.php?submachine&usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
			}
			else{
				if($('.order#order #tabs4 #listform input[name="machinetype"]').val()=='m1'){
					location.href='./control.php?usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
				}
				else{
					location.href='./control.php?machine='+$('.order#order #tabs4 #listform input[name="machinetype"]').val()+'&usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
				}
			}
		}
		else{
			change.dialog('close');
			if(viewtemp.dialog('isOpen')){
				viewtemp.dialog('close');
				$('.order#order #list #funbox #view').trigger('click');
			}
			else{
			}
		}*/
		change.dialog('close');
		if(viewtemp.dialog('isOpen')){
			viewtemp.dialog('close');
			$('.order#order #list #funbox #view').trigger('click');
		}
		else{
		}
	});
	$('.exitsys').on('click','.no',function(){
		exitsys.dialog('close');
	});
	$('.exitsys').on('click','.yes',function(){
		if($('.order#order .initsetting #secview').val()=='1'){
			$.ajax({
				url:'../secview/cleartemp.ajax.php',
				async: false,
				dataType:'html',
				success:function(d){
					//console.log(d);
				},
				error:function(e){
					//console.log(e);
				}
			});
		}
		else{
		}
		/*if($('.order#order .companydata #ispad').val()=='submachine'){//2018/2/7
			//var mywin=window.open('exit://','','width=1px,height=1px');
		}
		else{//2018/2/7
			if($('.order#order #tabs4 #listform input[name="machinetype"]').val()!='m1'){
				//var mywin=window.open('exit://','','width=1px,height=1px');
			}
			else{*/
				$.ajax({
					url:'./lib/js/create.cmdtxt.php',
					method:'post',
					async: false,
					data:{'cmd':$('.order#order #tabs4 #listform input[name="machinetype"]').val()+'-exit'},
					dataType:'html',
					success:function(d){
						//console.log(d);
					},
					error:function(e){
						//console.log(e);
					}
				});
			/*}
		}*/
		//2017/12/29document.title='點餐畫面－關閉程式';
		//2017/12/29var mywin=window.open('exit://','','width=1px,height=1px');
	});
	$('.sysmeg4').on('click','.closesysmeg',function(){
		$('.order#order #billfun #billfun2 .close').prop('disabled',false);
		sysmeg4.dialog('close');
		if($('.order#order .initsetting #controltable').val()=='1'){
			$('.funbox #close').prop('disabled',false);
			$('.funbox #salelist').prop('disabled',false);
			$('.funbox #voidsale').prop('disabled',false);
			if($('.order#order .initsetting #kvm').val()=='1'){
				$('.funbox #kvm').prop('disabled',false);
			}
			else{
			}
			if($('.order#order .initsetting #moneycost').val()=='1'){
				$('.funbox #AE').prop('disabled',false);
			}
			else{
			}
			if($('.order#order .initsetting #openpunch').val()=='1'){
				$('.funbox #punch').prop('disabled',false);
				$('.funbox #editpunch').prop('disabled',false);
			}
			else{
			}
			if($('.order#order .initsetting #historypaper').val()=='1'){
				$('.funbox #historypaper').prop('disabled',false);
			}
			else{
			}
			if($('.order#order .initsetting #openindex').val()=='1'){
				$('.funbox #logout').prop('disabled',false);
			}
			else{
			}
			$('.funbox #updatemenu').prop('disabled',false);
			$('.funbox #return').prop('disabled',false);
		}
		else{
		}
	});
	$('.sysmeg4').on('click','.check',function(){
		$.ajax({
			url:'./lib/js/close.ajax.php',
			method:'post',
			async: false,
			data:{'usercode':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'username':$('.order#order #tabs4 #listform input[name="username"]').val(),'machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val()},
			dataType:'html',
			success:function(d){
				if(d.length>20){
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'close.ajax.php '+d},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				if(d=='error'){
					//console.log(d);
				}
				else{
					$.ajax({
						url:'./lib/js/change.class.php',
						method:'post',
						async: false,
						data:{'type':'isopen'},
						dataType:'html',
						success:function(d){
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'change.class.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							//console.log(d);
							$('.order#order #MemberBill #billfun #billfun1button').prop('disabled',true);
							//$billfun.tabs('disable','#billfun1');
							$('.order#order #billfun #billfun2 .outmoney').prop('disabled',true);
							$('.order#order #billfun #billfun2 .open').prop('disabled',false);
							$('.order#order #MemberBill #billfun #billfun2button').trigger('click');
							sysmeg4.dialog('close');
							if($('.order#order .initsetting #controltable').val()=='1'){
								$('.inittable .funcmap #tablesplit').prop('disabled',true);
								$('.inittable .funcmap #combine').prop('disabled',true);
								$('.inittable .funcmap #tablecombine').prop('disabled',true);
								$('.inittable .funcmap #changetable').prop('disabled',true);
								$('.funbox #open').prop('disabled',false);
								$('.funbox #return').prop('disabled',false);
								funbox.dialog('close');
							}
							else{
							}
							$.ajax({
								url:'./lib/js/shift.paper.php',
								method:'post',
								async: false,
								data:{'zcounter':d},
								dataType:'html',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'shift.paper.php '+d},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									//console.log(d);
									$.ajax({
										url:'./lib/js/create.cmdtxt.php',
										method:'post',
										async: false,
										data:{'cmd':'upload'},
										dataType:'html',
										success:function(d){
											//console.log(d);
										},
										error:function(e){
											//console.log(e);
										}
									});
									//2017/12/29var mywin=window.open('cashdrawer://upload','','width=1px,height=1px');
									//2017/12/29mywin.document.title='cashdrawer';
								},
								error:function(e){
									//console.log(e);
								}
							});
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.sysmeg5').on('click','.closesysmeg',function(){
		$('.order#order #billfun #billfun2 .close').prop('disabled',false);
		sysmeg5.dialog('close');
		if($('.order#order .initsetting #controltable').val()=='1'){
			$('.funbox #close').prop('disabled',false);
			$('.funbox #salelist').prop('disabled',false);
			$('.funbox #voidsale').prop('disabled',false);
			if($('.order#order .initsetting #kvm').val()=='1'){
				$('.funbox #kvm').prop('disabled',false);
			}
			else{
			}
			if($('.order#order .initsetting #moneycost').val()=='1'){
				$('.funbox #AE').prop('disabled',false);
			}
			else{
			}
			if($('.order#order .initsetting #openpunch').val()=='1'){
				$('.funbox #punch').prop('disabled',false);
				$('.funbox #editpunch').prop('disabled',false);
			}
			else{
			}
			if($('.order#order .initsetting #historypaper').val()=='1'){
				$('.funbox #historypaper').prop('disabled',false);
			}
			else{
			}
			if($('.order#order .initsetting #openindex').val()=='1'){
				$('.funbox #logout').prop('disabled',false);
			}
			else{
			}
			$('.funbox #updatemenu').prop('disabled',false);
			$('.funbox #return').prop('disabled',false);
		}
		else{
		}
	});
	$('.sysmeg5').on('click','.check',function(){
		$.ajax({
			url:'./lib/js/close.ajax.php',
			method:'post',
			async: false,
			data:{'usercode':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'username':$('.order#order #tabs4 #listform input[name="username"]').val(),'machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val()},
			dataType:'html',
			success:function(d){
				if(d.length>20){
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'close.ajax.php '+d},
						dataType:'html',
						success:function(d){
							//console.log(d);
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
				else{
				}
				if(d=='error'){
					//console.log(d);
				}
				else{
					$.ajax({
						url:'./lib/js/change.class.php',
						method:'post',
						async: false,
						data:{'type':'isopen'},
						dataType:'html',
						success:function(d){
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'change.class.php '+d},
									dataType:'html',
									success:function(d){
										//console.log(d);
									},
									error:function(e){
										//console.log(e);
									}
								});
							}
							else{
							}
							//console.log(d);
							$('.order#order #MemberBill #billfun #billfun1button').prop('disabled',true);
							//$billfun.tabs('disable','#billfun1');
							$('.order#order #billfun #billfun2 .outmoney').prop('disabled',true);
							$('.order#order #billfun #billfun2 #salevoid').prop('disabled',true);
							$('.order#order #billfun #billfun2 .open').prop('disabled',false);
							$('.order#order #MemberBill #billfun #billfun2button').trigger('click');
							sysmeg5.dialog('close');
							if($('.order#order .initsetting #controltable').val()=='1'){
								$('.inittable .funcmap #tablesplit').prop('disabled',true);
								$('.inittable .funcmap #combine').prop('disabled',true);
								$('.inittable .funcmap #tablecombine').prop('disabled',true);
								$('.inittable .funcmap #changetable').prop('disabled',true);
								$('.funbox #open').prop('disabled',false);
								$('.funbox #return').prop('disabled',false);
								funbox.dialog('close');
							}
							else{
							}
							
							$.ajax({
								url:'./lib/js/shift.paper.php',
								method:'post',
								async: false,
								data:{'zcounter':d},
								dataType:'html',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'shift.paper.php '+d},
											dataType:'html',
											success:function(d){
												//console.log(d);
											},
											error:function(e){
												//console.log(e);
											}
										});
									}
									else{
									}
									console.log(d);
									$.ajax({
										url:'./lib/js/create.cmdtxt.php',
										method:'post',
										async: false,
										data:{'cmd':'upload'},
										dataType:'html',
										success:function(d){
											//console.log(d);
										},
										error:function(e){
											//console.log(e);
										}
									});
									//2017/12/29var mywin=window.open('cashdrawer://upload','','width=1px,height=1px');
									//2017/12/29mywin.document.title='cashdrawer';
								},
								error:function(e){
									//console.log(e);
								}
							});
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.order#order #billfun #billfun2').on('click','.open',function(){
		$('.order#order #billfun #billfun2 .open').prop('disabled',true);
		$.ajax({
			url:'./lib/js/open.ajax.php',
			method:'post',
			async: false,
			data:{'usercode':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'username':$('.order#order #tabs4 #listform input[name="username"]').val(),'machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val()},
			dataType:'html',
			success:function(d){
				//console.log(d);
				if(d.length>20){
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'open.ajax.php '+d},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				if(d=='error'){
					//console.log(d);
				}
				else{
					var bizdate=d.split('-');
					$('.order#order #tabs4 #listform input[name="bizdate"]').val(bizdate[1]);
					$('.order#order #billfun #billfun2 .outmoney').prop('disabled',false);
					$('.order#order #billfun #billfun2 #salevoid').prop('disabled',false);
					$('#outmoney #picbizdate').val(bizdate[1].substr(0,4)+'-'+bizdate[1].substr(4,2)+'-'+bizdate[1].substr(6,2));
					$('#outmoney #picbizdate').trigger('change');
					$('.spend #nowbizdate').val(bizdate[1]);
					$('.spend #nowzcounter').val(bizdate[2]);
					$.ajax({
						url:'./lib/js/change.class.php',
						method:'post',
						async: false,
						data:{'type':'isclose'},
						dataType:'html',
						success:function(d){
							var tempdata=d.split('-');
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'change.class.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							//console.log(d);
							$.ajax({
								url:'./lib/js/create.cmdtxt.php',
								method:'post',
								async: false,
								data:{'cmd':'upload'},
								dataType:'html',
								success:function(d){
									//console.log(d);
								},
								error:function(e){
									//console.log(e);
								}
							});
							//2017/12/29var mywin=window.open('cashdrawer://upload','','width=1px,height=1px');
							//2017/12/29mywin.document.title='cashdrawer';
							$('.order#order #billfun #billfun2 .close').prop('disabled',false);
							if($('.order#order .initsetting #controltable').val()=='1'){
								$('.control#control #bizdate').val(tempdata[0]);
								$('.control#control #zcounter').val(tempdata[1]);
								$('.inittable .funcmap #tablesplit').prop('disabled',false);
								$('.inittable .funcmap #combine').prop('disabled',false);
								$('.inittable .funcmap #tablecombine').prop('disabled',false);
								$('.inittable .funcmap #changetable').prop('disabled',false);
								var temptitle=inittable.dialog('option','title');
								var temptitle1=temptitle.split(':');
								var temptitle2=temptitle1[1].split('；');
								var temptitle3=temptitle1[2].split('；');
								inittable.dialog('option','title',temptitle1[0]+':'+$('.control#control #bizdate').val()+'；'+temptitle2[1]+':'+$('.control#control #zcounter').val()+'；'+temptitle3[1]);
								$('.funbox #close').prop('disabled',false);
								$('.funbox #salelist').prop('disabled',false);
								$('.funbox #voidsale').prop('disabled',false);
								if($('.order#order .initsetting #kvm').val()=='1'){
									$('.funbox #kvm').prop('disabled',false);
								}
								else{
								}
								$('.funbox #return').prop('disabled',false);
								if($('.order#order .initsetting #moneycost').val()=='1'){
									$('.funbox #AE').prop('disabled',false);
								}
								else{
								}
								if($('.order#order .initsetting #openpunch').val()=='1'){
									$('.funbox #punch').prop('disabled',false);
									$('.funbox #editpunch').prop('disabled',false);
								}
								else{
								}
								if($('.order#order .initsetting #historypaper').val()=='1'){
									$('.funbox #historypaper').prop('disabled',false);
								}
								else{
								}
								if($('.order#order .initsetting #openindex').val()=='1'){
									$('.funbox #logout').prop('disabled',false);
								}
								else{
								}
								$('.funbox #updatemenu').prop('disabled',false);
							}
							else{
							}
							setchange.dialog('open');
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.order#order #billfun #billfun2').on('click','.close',function(){
		$('.order#order #billfun #billfun2 .close').prop('disabled',true);
		$.ajax({
			url:'./lib/js/gettemplist.ajax.php',
			async:false,
			dataType:'html',
			success:function(d){
				if(d.length>20){
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'gettemplist.ajax.php '+d},
						dataType:'html',
						success:function(d){
							//console.log(d);
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
				else{
				}
				//console.log(d);
				if(d=='close'){
					sysmeg5.dialog('open');
					/*$.ajax({
						url:'./lib/js/close.ajax.php',
						method:'post',
						async: false,
						data:{'usercode':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'username':$('.order#order #tabs4 #listform input[name="username"]').val(),'machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val()},
						dataType:'html',
						success:function(d){
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'close.ajax.php '+d},
									dataType:'html',
									success:function(d){
										//console.log(d);
									},
									error:function(e){
										//console.log(e);
									}
								});
							}
							else{
							}
							if(d=='error'){
								//console.log(d);
							}
							else{
								$.ajax({
									url:'./lib/js/change.class.php',
									method:'post',
									async: false,
									data:{'type':'isopen'},
									dataType:'html',
									success:function(d){
										if(d.length>20){
											$.ajax({
												url:'./lib/js/print.php',
												method:'post',
												data:{'html':'change.class.php '+d},
												dataType:'html',
												success:function(d){
													//console.log(d);
												},
												error:function(e){
													//console.log(e);
												}
											});
										}
										else{
										}
										//console.log(d);
										$('.order#order #MemberBill #billfun #billfun1button').prop('disabled',true);
										//$billfun.tabs('disable','#billfun1');
										$('.order#order #billfun #billfun2 .outmoney').prop('disabled',true);
										$('.order#order #billfun #billfun2 #salevoid').prop('disabled',true);
										$('.order#order #billfun #billfun2 .open').prop('disabled',false);
										$.ajax({
											url:'./lib/js/shift.paper.php',
											method:'post',
											async: false,
											data:{'zcounter':d},
											dataType:'html',
											success:function(d){
												if(d.length>20){
													$.ajax({
														url:'./lib/js/print.php',
														method:'post',
														data:{'html':'shift.paper.php '+d},
														dataType:'html',
														success:function(d){
															//console.log(d);
														},
														error:function(e){
															//console.log(e);
														}
													});
												}
												else{
												}
												console.log(d);
												$.ajax({
													url:'./lib/js/create.cmdtxt.php',
													method:'post',
													async: false,
													data:{'cmd':'upload'},
													dataType:'html',
													success:function(d){
														//console.log(d);
													},
													error:function(e){
														//console.log(e);
													}
												});
												//2017/12/29var mywin=window.open('cashdrawer://upload','','width=1px,height=1px');
												//2017/12/29mywin.document.title='cashdrawer';
											},
											error:function(e){
												//console.log(e);
											}
										});
									},
									error:function(e){
										//console.log(e);
									}
								});
							}
						},
						error:function(e){
							//console.log(e);
						}
					});*/
				}
				else{
					sysmeg4.dialog('open');
				}
			},
			error:function(e){
				//console.log(e);
			}
		});
		
	});
	$('.order#order #billfun #billfun2').on('click','.outmoney',function(){
		$('.order#order #billfun #billfun2 .outmoney').prop('disabled',true);
		$.ajax({
			url:'./lib/js/checkopen.ajax.php',
			async:false,
			dataType:'html',
			success:function(d){
				if(d.length>20){
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'checkopen.ajax.php '+d},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				//console.log(d);
				if(d=='success'){
					outmoney.dialog('open');
					if($('#outmoney #moneytype').val()==''){
						selecttype.dialog('open');
					}
					else{
					}
				}
				else{
					alert('目前尚未開班，請確認是否開班或重啟系統。');
				}
			},
			error:function(e){
				//console.log(e);
			}
		});
		$('.order#order #billfun #billfun2 .outmoney').prop('disabled',false);
	});
	$('.order#order #billfun #billfun2').on('click','#exit',function(){
		exitsys.dialog('open');
	});
	$('.setchange').on('click','#settingchange',function(){
		setchange.dialog('close');
	});
	$('.order#order #banner #detail').on('click','#oinv',function(){
		if($(this).val()=='ERROR'){
			$.ajax({
				url:'./lib/js/getnowoinv.ajax.php',
				async:false,
				dataType:'html',
				success:function(d){
					$('.oinv #view input[name="en"]').val(d.substr(0,2));
					$('.oinv #view input[name="num"]').val(d.substr(2,8));
					oinv.dialog('open');
				},
				error:function(e){
					console.log(e);
				}
			});
		}
		else{
			$('.oinv #view input[name="en"]').val($('.order#order #banner #detail #oinv').val().substr(0,2));
			$('.oinv #view input[name="num"]').val($('.order#order #banner #detail #oinv').val().substr(2,8));
			oinv.dialog('open');
		}
	});
	$('.oinv #buttons').on('click','.input',function(){
		if($('.oinv #buttons input[name="tag"]').val()=='num'&&$('.oinv #view input[name="'+$('.oinv #buttons input[name="tag"]').val()+'"]').val().length<8){
			$('.oinv #view input[name="'+$('.oinv #buttons input[name="tag"]').val()+'"]').val($('.oinv #view input[name="'+$('.oinv #buttons input[name="tag"]').val()+'"]').val()+$(this).val());
		}
		else if($('.oinv #buttons input[name="tag"]').val()=='en'&&$('.oinv #view input[name="'+$('.oinv #buttons input[name="tag"]').val()+'"]').val().length<2){
			$('.oinv #view input[name="'+$('.oinv #buttons input[name="tag"]').val()+'"]').val($('.oinv #view input[name="'+$('.oinv #buttons input[name="tag"]').val()+'"]').val()+$(this).val());
		}
		else{
		}
	});
	$('.oinv #buttons').on('click','#back',function(){
		if($('.oinv #view input[name="'+$('.oinv #buttons input[name="tag"]').val()+'"]').val().length>1){
			$('.oinv #view input[name="'+$('.oinv #buttons input[name="tag"]').val()+'"]').val($('.oinv #view input[name="'+$('.oinv #buttons input[name="tag"]').val()+'"]').val().substr(0,($('.oinv #view input[name="'+$('.oinv #buttons input[name="tag"]').val()+'"]').val().length-1)));
		}
		else if($('.oinv #view input[name="'+$('.oinv #buttons input[name="tag"]').val()+'"]').val().length==1){
			$('.oinv #view input[name="'+$('.oinv #buttons input[name="tag"]').val()+'"]').val('');
		}
		else{
		}
	});
	$('.oinv #buttons').on('click','#ac',function(){
		$('.oinv #view input[name="'+$('.oinv #buttons input[name="tag"]').val()+'"]').val('');
	});
	$('.oinv #buttons').on('click','.pre',function(){
		if($('.oinv #buttons .input:eq(0)').val()=='Y'){
			$('.oinv #buttons .input:eq(0)').val('M');
			$('.oinv #buttons .input:eq(1)').val('N');
			$('.oinv #buttons .input:eq(2)').val('O');
			$('.oinv #buttons .input:eq(3)').val('P');
			$('.oinv #buttons .input:eq(4)').val('Q');
			$('.oinv #buttons .input:eq(5)').val('R');
			$('.oinv #buttons .input:eq(6)').val('S');
			$('.oinv #buttons .input:eq(7)').val('T');
			$('.oinv #buttons .input:eq(8)').val('U');
			$('.oinv #buttons .input:eq(9)').val('V');
			$('.oinv #buttons .input:eq(10)').val('W');
			$('.oinv #buttons .input:eq(11)').val('X');
			$('.oinv #buttons .input:eq(2)').prop('disabled',false);
			$('.oinv #buttons .input:eq(3)').prop('disabled',false);
			$('.oinv #buttons .input:eq(4)').prop('disabled',false);
			$('.oinv #buttons .input:eq(5)').prop('disabled',false);
			$('.oinv #buttons .input:eq(6)').prop('disabled',false);
			$('.oinv #buttons .input:eq(7)').prop('disabled',false);
			$('.oinv #buttons .input:eq(8)').prop('disabled',false);
			$('.oinv #buttons .input:eq(9)').prop('disabled',false);
			$('.oinv #buttons .input:eq(10)').prop('disabled',false);
			$('.oinv #buttons .input:eq(11)').prop('disabled',false);
			$('.oinv #buttons .next').prop('disabled',false);
		}
		else if($('.oinv #buttons .input:eq(0)').val()=='M'){
			$('.oinv #buttons .input:eq(0)').val('A');
			$('.oinv #buttons .input:eq(1)').val('B');
			$('.oinv #buttons .input:eq(2)').val('C');
			$('.oinv #buttons .input:eq(3)').val('D');
			$('.oinv #buttons .input:eq(4)').val('E');
			$('.oinv #buttons .input:eq(5)').val('F');
			$('.oinv #buttons .input:eq(6)').val('G');
			$('.oinv #buttons .input:eq(7)').val('H');
			$('.oinv #buttons .input:eq(8)').val('I');
			$('.oinv #buttons .input:eq(9)').val('J');
			$('.oinv #buttons .input:eq(10)').val('K');
			$('.oinv #buttons .input:eq(11)').val('L');
			$('.oinv #buttons .pre').prop('disabled',true);
		}
		else{
		}
	});
	$('.oinv #buttons').on('click','.next',function(){
		if($('.oinv #buttons .input:eq(0)').val()=='A'){
			$('.oinv #buttons .input:eq(0)').val('M');
			$('.oinv #buttons .input:eq(1)').val('N');
			$('.oinv #buttons .input:eq(2)').val('O');
			$('.oinv #buttons .input:eq(3)').val('P');
			$('.oinv #buttons .input:eq(4)').val('Q');
			$('.oinv #buttons .input:eq(5)').val('R');
			$('.oinv #buttons .input:eq(6)').val('S');
			$('.oinv #buttons .input:eq(7)').val('T');
			$('.oinv #buttons .input:eq(8)').val('U');
			$('.oinv #buttons .input:eq(9)').val('V');
			$('.oinv #buttons .input:eq(10)').val('W');
			$('.oinv #buttons .input:eq(11)').val('X');
			$('.oinv #buttons .pre').prop('disabled',false);
		}
		else if($('.oinv #buttons .input:eq(0)').val()=='M'){
			$('.oinv #buttons .input:eq(0)').val('Y');
			$('.oinv #buttons .input:eq(1)').val('Z');
			$('.oinv #buttons .input:eq(2)').val('');
			$('.oinv #buttons .input:eq(3)').val('');
			$('.oinv #buttons .input:eq(4)').val('');
			$('.oinv #buttons .input:eq(5)').val('');
			$('.oinv #buttons .input:eq(6)').val('');
			$('.oinv #buttons .input:eq(7)').val('');
			$('.oinv #buttons .input:eq(8)').val('');
			$('.oinv #buttons .input:eq(9)').val('');
			$('.oinv #buttons .input:eq(10)').val('');
			$('.oinv #buttons .input:eq(11)').val('');
			$('.oinv #buttons .input:eq(2)').prop('disabled',true);
			$('.oinv #buttons .input:eq(3)').prop('disabled',true);
			$('.oinv #buttons .input:eq(4)').prop('disabled',true);
			$('.oinv #buttons .input:eq(5)').prop('disabled',true);
			$('.oinv #buttons .input:eq(6)').prop('disabled',true);
			$('.oinv #buttons .input:eq(7)').prop('disabled',true);
			$('.oinv #buttons .input:eq(8)').prop('disabled',true);
			$('.oinv #buttons .input:eq(9)').prop('disabled',true);
			$('.oinv #buttons .input:eq(10)').prop('disabled',true);
			$('.oinv #buttons .input:eq(11)').prop('disabled',true);
			$('.oinv #buttons .next').prop('disabled',true);
		}
		else{
		}
	});
	$('.oinv #view').on('click','input',function(){
		if($('.oinv #buttons input[name="tag"]').val()==$(this).prop('name')){
		}
		else{
			$('.oinv #buttons input[name="tag"]').val($(this).prop('name'));
			$('.oinv #view input').css({'background-color':'#eeeeee'});
			$('.oinv #view input[name="'+$('.oinv #buttons input[name="tag"]').val()+'"]').css({'background-color':'#ffffff'});
			if($('.oinv #buttons input[name="tag"]').val()=='num'){
				$('.oinv #buttons .input:eq(0)').val('7');
				$('.oinv #buttons .input:eq(1)').val('8');
				$('.oinv #buttons .input:eq(2)').val('9');
				$('.oinv #buttons .input:eq(3)').val('4');
				$('.oinv #buttons .input:eq(4)').val('5');
				$('.oinv #buttons .input:eq(5)').val('6');
				$('.oinv #buttons .input:eq(6)').val('1');
				$('.oinv #buttons .input:eq(7)').val('2');
				$('.oinv #buttons .input:eq(8)').val('3');
				$('.oinv #buttons .input:eq(9)').val('0');
				$('.oinv #buttons .input:eq(10)').val('');
				$('.oinv #buttons .input:eq(11)').val('');
				$('.oinv #buttons .input:eq(2)').prop('disabled',false);
				$('.oinv #buttons .input:eq(3)').prop('disabled',false);
				$('.oinv #buttons .input:eq(4)').prop('disabled',false);
				$('.oinv #buttons .input:eq(5)').prop('disabled',false);
				$('.oinv #buttons .input:eq(6)').prop('disabled',false);
				$('.oinv #buttons .input:eq(7)').prop('disabled',false);
				$('.oinv #buttons .input:eq(8)').prop('disabled',false);
				$('.oinv #buttons .input:eq(9)').prop('disabled',false);
				$('.oinv #buttons .input:eq(10)').prop('disabled',true);
				$('.oinv #buttons .input:eq(11)').prop('disabled',true);
				$('.oinv #buttons .pre').prop('disabled',true);
				$('.oinv #buttons .next').prop('disabled',true);
			}
			else{
				$('.oinv #buttons .input:eq(0)').val('A');
				$('.oinv #buttons .input:eq(1)').val('B');
				$('.oinv #buttons .input:eq(2)').val('C');
				$('.oinv #buttons .input:eq(3)').val('D');
				$('.oinv #buttons .input:eq(4)').val('E');
				$('.oinv #buttons .input:eq(5)').val('F');
				$('.oinv #buttons .input:eq(6)').val('G');
				$('.oinv #buttons .input:eq(7)').val('H');
				$('.oinv #buttons .input:eq(8)').val('I');
				$('.oinv #buttons .input:eq(9)').val('J');
				$('.oinv #buttons .input:eq(10)').val('K');
				$('.oinv #buttons .input:eq(10)').prop('disabled',false);
				$('.oinv #buttons .input:eq(11)').val('L');
				$('.oinv #buttons .input:eq(11)').prop('disabled',false);
				$('.oinv #buttons .next').prop('disabled',false);
			}
		}
	});
	$('.oinv #buttons').on('click','#submit',function(){
		if($('.oinv #view input[name="en"]').val().length<2||$('.oinv #view input[name="num"]').val().length<8){
		}
		else{
			$.ajax({
				url:'./lib/js/setoinv.ajax.php',
				method:'post',
				data:{'en':$('.oinv #view input[name="en"]').val(),'num':$('.oinv #view input[name="num"]').val()},
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'setoinv.ajax.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//location.reload();
					//console.log(d);
					if(d.length>0){
						$('.order#order #banner #detail #oinv').val(d);
						oinv.dialog('close');
					}
					else{
						//console.log(d);
					}
				},
				error:function(e){
					//console.log(e);
				}
			});
		}
	});
	$('.oinv #buttons').on('click','#cancel',function(){
		oinv.dialog('close');
	});
	$('.order#order #billfun #billfun3').on('click','#cancelinv',function(){
		cancelinv.dialog('open');
	});
	$('.cancelinv #buttons').on('click','.input',function(){
		if($('.cancelinv #buttons input[name="tag"]').val()=='num'&&$('.cancelinv #view input[name="'+$('.cancelinv #buttons input[name="tag"]').val()+'"]').val().length<8){
			$('.cancelinv #view input[name="'+$('.cancelinv #buttons input[name="tag"]').val()+'"]').val($('.cancelinv #view input[name="'+$('.cancelinv #buttons input[name="tag"]').val()+'"]').val()+$(this).val());
		}
		else if($('.cancelinv #buttons input[name="tag"]').val()=='en'&&$('.cancelinv #view input[name="'+$('.cancelinv #buttons input[name="tag"]').val()+'"]').val().length<2){
			$('.cancelinv #view input[name="'+$('.cancelinv #buttons input[name="tag"]').val()+'"]').val($('.cancelinv #view input[name="'+$('.cancelinv #buttons input[name="tag"]').val()+'"]').val()+$(this).val());
		}
		else{
		}
	});
	$('.cancelinv #buttons').on('click','#back',function(){
		if($('.cancelinv #view input[name="'+$('.cancelinv #buttons input[name="tag"]').val()+'"]').val().length>1){
			$('.cancelinv #view input[name="'+$('.cancelinv #buttons input[name="tag"]').val()+'"]').val($('.cancelinv #view input[name="'+$('.cancelinv #buttons input[name="tag"]').val()+'"]').val().substr(0,($('.cancelinv #view input[name="'+$('.cancelinv #buttons input[name="tag"]').val()+'"]').val().length-1)));
		}
		else if($('.cancelinv #view input[name="'+$('.cancelinv #buttons input[name="tag"]').val()+'"]').val().length==1){
			$('.cancelinv #view input[name="'+$('.cancelinv #buttons input[name="tag"]').val()+'"]').val('');
		}
		else{
		}
	});
	$('.cancelinv #buttons').on('click','#ac',function(){
		$('.cancelinv #view input[name="'+$('.cancelinv #buttons input[name="tag"]').val()+'"]').val('');
	});
	$('.cancelinv #buttons').on('click','.pre',function(){
		if($('.cancelinv #buttons .input:eq(0)').val()=='Y'){
			$('.cancelinv #buttons .input:eq(0)').val('M');
			$('.cancelinv #buttons .input:eq(1)').val('N');
			$('.cancelinv #buttons .input:eq(2)').val('O');
			$('.cancelinv #buttons .input:eq(3)').val('P');
			$('.cancelinv #buttons .input:eq(4)').val('Q');
			$('.cancelinv #buttons .input:eq(5)').val('R');
			$('.cancelinv #buttons .input:eq(6)').val('S');
			$('.cancelinv #buttons .input:eq(7)').val('T');
			$('.cancelinv #buttons .input:eq(8)').val('U');
			$('.cancelinv #buttons .input:eq(9)').val('V');
			$('.cancelinv #buttons .input:eq(10)').val('W');
			$('.cancelinv #buttons .input:eq(11)').val('X');
			$('.cancelinv #buttons .input:eq(2)').prop('disabled',false);
			$('.cancelinv #buttons .input:eq(3)').prop('disabled',false);
			$('.cancelinv #buttons .input:eq(4)').prop('disabled',false);
			$('.cancelinv #buttons .input:eq(5)').prop('disabled',false);
			$('.cancelinv #buttons .input:eq(6)').prop('disabled',false);
			$('.cancelinv #buttons .input:eq(7)').prop('disabled',false);
			$('.cancelinv #buttons .input:eq(8)').prop('disabled',false);
			$('.cancelinv #buttons .input:eq(9)').prop('disabled',false);
			$('.cancelinv #buttons .input:eq(10)').prop('disabled',false);
			$('.cancelinv #buttons .input:eq(11)').prop('disabled',false);
			$('.cancelinv #buttons .next').prop('disabled',false);
		}
		else if($('.cancelinv #buttons .input:eq(0)').val()=='M'){
			$('.cancelinv #buttons .input:eq(0)').val('A');
			$('.cancelinv #buttons .input:eq(1)').val('B');
			$('.cancelinv #buttons .input:eq(2)').val('C');
			$('.cancelinv #buttons .input:eq(3)').val('D');
			$('.cancelinv #buttons .input:eq(4)').val('E');
			$('.cancelinv #buttons .input:eq(5)').val('F');
			$('.cancelinv #buttons .input:eq(6)').val('G');
			$('.cancelinv #buttons .input:eq(7)').val('H');
			$('.cancelinv #buttons .input:eq(8)').val('I');
			$('.cancelinv #buttons .input:eq(9)').val('J');
			$('.cancelinv #buttons .input:eq(10)').val('K');
			$('.cancelinv #buttons .input:eq(11)').val('L');
			$('.cancelinv #buttons .pre').prop('disabled',true);
		}
		else{
		}
	});
	$('.cancelinv #buttons').on('click','.next',function(){
		if($('.cancelinv #buttons .input:eq(0)').val()=='A'){
			$('.cancelinv #buttons .input:eq(0)').val('M');
			$('.cancelinv #buttons .input:eq(1)').val('N');
			$('.cancelinv #buttons .input:eq(2)').val('O');
			$('.cancelinv #buttons .input:eq(3)').val('P');
			$('.cancelinv #buttons .input:eq(4)').val('Q');
			$('.cancelinv #buttons .input:eq(5)').val('R');
			$('.cancelinv #buttons .input:eq(6)').val('S');
			$('.cancelinv #buttons .input:eq(7)').val('T');
			$('.cancelinv #buttons .input:eq(8)').val('U');
			$('.cancelinv #buttons .input:eq(9)').val('V');
			$('.cancelinv #buttons .input:eq(10)').val('W');
			$('.cancelinv #buttons .input:eq(11)').val('X');
			$('.cancelinv #buttons .pre').prop('disabled',false);
		}
		else if($('.cancelinv #buttons .input:eq(0)').val()=='M'){
			$('.cancelinv #buttons .input:eq(0)').val('Y');
			$('.cancelinv #buttons .input:eq(1)').val('Z');
			$('.cancelinv #buttons .input:eq(2)').val('');
			$('.cancelinv #buttons .input:eq(3)').val('');
			$('.cancelinv #buttons .input:eq(4)').val('');
			$('.cancelinv #buttons .input:eq(5)').val('');
			$('.cancelinv #buttons .input:eq(6)').val('');
			$('.cancelinv #buttons .input:eq(7)').val('');
			$('.cancelinv #buttons .input:eq(8)').val('');
			$('.cancelinv #buttons .input:eq(9)').val('');
			$('.cancelinv #buttons .input:eq(10)').val('');
			$('.cancelinv #buttons .input:eq(11)').val('');
			$('.cancelinv #buttons .input:eq(2)').prop('disabled',true);
			$('.cancelinv #buttons .input:eq(3)').prop('disabled',true);
			$('.cancelinv #buttons .input:eq(4)').prop('disabled',true);
			$('.cancelinv #buttons .input:eq(5)').prop('disabled',true);
			$('.cancelinv #buttons .input:eq(6)').prop('disabled',true);
			$('.cancelinv #buttons .input:eq(7)').prop('disabled',true);
			$('.cancelinv #buttons .input:eq(8)').prop('disabled',true);
			$('.cancelinv #buttons .input:eq(9)').prop('disabled',true);
			$('.cancelinv #buttons .input:eq(10)').prop('disabled',true);
			$('.cancelinv #buttons .input:eq(11)').prop('disabled',true);
			$('.cancelinv #buttons .next').prop('disabled',true);
		}
		else{
		}
	});
	$('.cancelinv #view').on('click','input',function(){
		if($('.cancelinv #buttons input[name="tag"]').val()==$(this).prop('name')){
		}
		else{
			$('.cancelinv #buttons input[name="tag"]').val($(this).prop('name'));
			$('.cancelinv #view input').css({'background-color':'#eeeeee'});
			$('.cancelinv #view input[name="'+$('.cancelinv #buttons input[name="tag"]').val()+'"]').css({'background-color':'#ffffff'});
			if($('.cancelinv #buttons input[name="tag"]').val()=='num'){
				$('.cancelinv #buttons .input:eq(0)').val('7');
				$('.cancelinv #buttons .input:eq(1)').val('8');
				$('.cancelinv #buttons .input:eq(2)').val('9');
				$('.cancelinv #buttons .input:eq(3)').val('4');
				$('.cancelinv #buttons .input:eq(4)').val('5');
				$('.cancelinv #buttons .input:eq(5)').val('6');
				$('.cancelinv #buttons .input:eq(6)').val('1');
				$('.cancelinv #buttons .input:eq(7)').val('2');
				$('.cancelinv #buttons .input:eq(8)').val('3');
				$('.cancelinv #buttons .input:eq(9)').val('0');
				$('.cancelinv #buttons .input:eq(10)').val('');
				$('.cancelinv #buttons .input:eq(11)').val('');
				$('.cancelinv #buttons .input:eq(2)').prop('disabled',false);
				$('.cancelinv #buttons .input:eq(3)').prop('disabled',false);
				$('.cancelinv #buttons .input:eq(4)').prop('disabled',false);
				$('.cancelinv #buttons .input:eq(5)').prop('disabled',false);
				$('.cancelinv #buttons .input:eq(6)').prop('disabled',false);
				$('.cancelinv #buttons .input:eq(7)').prop('disabled',false);
				$('.cancelinv #buttons .input:eq(8)').prop('disabled',false);
				$('.cancelinv #buttons .input:eq(9)').prop('disabled',false);
				$('.cancelinv #buttons .input:eq(10)').prop('disabled',true);
				$('.cancelinv #buttons .input:eq(11)').prop('disabled',true);
				$('.cancelinv #buttons .pre').prop('disabled',true);
				$('.cancelinv #buttons .next').prop('disabled',true);
			}
			else{
				$('.cancelinv #buttons .input:eq(0)').val('A');
				$('.cancelinv #buttons .input:eq(1)').val('B');
				$('.cancelinv #buttons .input:eq(2)').val('C');
				$('.cancelinv #buttons .input:eq(3)').val('D');
				$('.cancelinv #buttons .input:eq(4)').val('E');
				$('.cancelinv #buttons .input:eq(5)').val('F');
				$('.cancelinv #buttons .input:eq(6)').val('G');
				$('.cancelinv #buttons .input:eq(7)').val('H');
				$('.cancelinv #buttons .input:eq(8)').val('I');
				$('.cancelinv #buttons .input:eq(9)').val('J');
				$('.cancelinv #buttons .input:eq(10)').val('K');
				$('.cancelinv #buttons .input:eq(10)').prop('disabled',false);
				$('.cancelinv #buttons .input:eq(11)').val('L');
				$('.cancelinv #buttons .input:eq(11)').prop('disabled',false);
				$('.cancelinv #buttons .next').prop('disabled',false);
			}
		}
	});
	$('.cancelinv #buttons').on('click','#submit',function(){
		if($('.cancelinv #view input[name="en"]').val().length<2||$('.cancelinv #view input[name="num"]').val().length<8){
		}
		else{
			$.ajax({
				url:'./lib/js/cancelinv.ajax.php',
				method:'post',
				data:{'en':$('.cancelinv #view input[name="en"]').val(),'num':$('.cancelinv #view input[name="num"]').val(),'invtype':$('.cancelinv #view input[name="invtype"]').val()},
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'cancelinv.ajax.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//location.reload();
					//console.log(d);
					if(d.length>0){
						$('.order#order #banner #detail #oinv').val(d);
						oinv.dialog('close');
					}
					else{
					}
				},
				error:function(e){
					//console.log(e);
				}
			});
		}
	});
	$('.cancelinv #buttons').on('click','#cancel',function(){
		cancelinv.dialog('close');
	});
	$('.order#order #billfun #billfun2').on('click','#salelist',function(){
		salelist.dialog('open');
		$.ajax({
			url:'./lib/js/getsalelist.ajax.php',
			method:'post',
			data:{'sale':'sale'},
			dataType:'html',
			success:function(d){
				$('.salelist #salelist #salecontent').html(d);
				$('.salelist #rightnow #ttmoney').html($('.salelist #salelist input[name="ttmoney"]').val());
				$('.salelist #rightnow #ttcount').html($('.salelist #salelist input[name="ttcount"]').val());
				$('.salelist #rightnow #voidmoney').html($('.salelist #salelist input[name="voidmoney"]').val());
				$('.salelist #rightnow #voidcount').html($('.salelist #salelist input[name="voidcount"]').val());
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.salelist #salelist #salecontent').on('click','.listitems',function(){
		var index=$('.salelist #salelist #salecontent .listitems').index(this);
		$('.salelist #salelist #salecontent .listitems').prop('id','');
		$('.salelist #salelist #salecontent .listitems:eq('+index+')').prop('id','focus');
		$('.salelist #listno').html($('.salelist #salelist #salecontent .listitems:eq('+index+') div:eq(1)').html()+"("+$('.salelist #salelist #salecontent .listitems:eq('+index+') div:eq(1) input[name="consecnumber"]').val()+")");
		$('.salelist #date').html($('.salelist #salelist #salecontent .listitems:eq('+index+') div:eq(0)').html());
		$('.salelist #credate').val($('.salelist #salelist #salecontent .listitems:eq('+index+') div:eq(6)').html().substr(0,8));
		if($('.order#order #MemberBill #billfun #citybox #billfun2 .open').prop('disabled')){//開班狀態
			if($('.salelist #salelist #salecontent .listitems:eq('+index+') div:eq(7)').html()=='Y'){
				$('.salelist #reorder').prop('disabled',true);
				$('.salelist #editpay').prop('disabled',true);
				$('.salelist #reinv').prop('disabled',true);
				$('.salelist #rekvm').prop('disabled',true);
			}
			else{
				$('.salelist #reorder').prop('disabled',false);
				$('.salelist #editpay').prop('disabled',false);
				if($.trim($('.salelist #salecontent .listitems:eq('+index+') div:eq(3)').html()).length!=10||$('.order#order .initsetting #useinv').val()=='0'){
					$('.salelist #reinv').prop('disabled',true);
				}
				else{
					$('.salelist #reinv').prop('disabled',false);
				}
				$('.salelist #rekvm').prop('disabled',false);
			}
		}
		else{//未開班狀態
			$('.salelist #reorder').prop('disabled',true);
			$('.salelist #editpay').prop('disabled',true);
			$('.salelist #reinv').prop('disabled',true);
			$('.salelist #rekvm').prop('disabled',true);
		}
		$.ajax({
			url:'./lib/js/getsaledetail.ajax.php',
			method:'post',
			data:{'company':$('.order#order .companydata #company').val(),'bizdate':$('.salelist #salelist #salecontent .listitems:eq('+index+') div:eq(0)').html(),'no':$('.salelist #salelist #salecontent .listitems:eq('+index+') div:eq(1) input[name="consecnumber"]').val(),'createdatetime':$('.salelist #salelist #salecontent .listitems:eq('+index+') div:eq(5)').html()},
			dataType:'html',
			success:function(d){
				//console.log(d);
				$('.salelist #list #listcontent').html(d);
				if($('.salelist #salelist #salecontent .listitems:eq('+index+') div:eq(7)').html()=="Y"){
					$('.salelist #fun #tag').prop('disabled',true);
					$('.salelist #fun #forall').prop('disabled',true);
					$('.salelist #fun #kitchen').prop('disabled',true);
					$('.salelist #fun #changecheck').prop('disabled',true);
				}
				else{
					$('.salelist #fun #tag').prop('disabled',false);
					$('.salelist #fun #forall').prop('disabled',false);
					$('.salelist #fun #kitchen').prop('disabled',false);
					$('.salelist #fun #changecheck').prop('disabled',false);
				}
				$('.salelist #fun button#list').prop('disabled',false);
				//$('.salelist #fun #kitchen').prop('disabled',false);
				
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.salelist').on('click','#reinv',function(){
		if($.trim($('.salelist #salelist #salecontent .listitems#focus div:eq(3)').html())==''){
		}
		else{
			$('.verpsw input[name="type"]').val('reinv');
			verpsw.dialog('open');
			/*$.ajax({
				url:'./lib/js/reinv.ajax.php',
				method:'post',
				async:false,
				data:{'invno',$.trim($('.salelist #salelist #salecontent .listitems#focus div:eq(2)').html())},
				dataType:'html',
				success:function(d){
				},
				error:function(e){
					//console.log(e);
				}
			});*/
		}
	});
	$('.verpsw').on('click','#cancel',function(){
		verpsw.dialog('close');
	});
	$('.verpsw').on('click','#send',function(){
		if((($('.verpsw input[name="type"]').val()=='reinv'||$('.verpsw input[name="type"]').val()=='editlist'||$('.verpsw input[name="type"]').val()=='void'||$('.verpsw input[name="type"]').val()=='viewvoid'||$('.verpsw input[name="type"]').val()=='viewvoidbyemptylist')&&typeof $('.order#order .companydata #voidpw').val()!=="undefined"&&$('.order#order .companydata #voidpw').val()=='')||(($('.verpsw input[name="type"]').val()=='paper'||$('.verpsw input[name="type"]').val()=='viewpaper')&&typeof $('.order#order .companydata #paperpw').val()!=="undefined"&&$('.order#order .companydata #paperpw').val()=='')||($('.verpsw input[name="type"]').val()=='editpunch'&&typeof $('.order#order .companydata #punchpw').val()!=="undefined"&&$('.order#order .companydata #punchpw').val()=='')){
			$('.verpsw input[name="verpsw"]').val('');
			alert('目前登入帳號，無使用此功能之權限。');
		}
		else if(($('.verpsw input[name="type"]').val()=='reinv'||$('.verpsw input[name="type"]').val()=='editlist'||$('.verpsw input[name="type"]').val()=='void'||$('.verpsw input[name="type"]').val()=='viewvoid'||$('.verpsw input[name="type"]').val()=='viewvoidbyemptylist')&&typeof $('.order#order .companydata #voidpw').val()!=="undefined"&&$('.order#order .companydata #voidpw').val()==$('.verpsw input[name="verpsw"]').val()){
			if($('.verpsw input[name="type"]').val()=='reinv'){//補印發票
				$.ajax({
					url:'./lib/js/reinv.ajax.php',
					method:'post',
					async:false,
					data:{'bizdate':$('.salelist #salelist #salecontent .listitems#focus div:eq(0)').html(),'invno':$.trim($('.salelist #salelist #salecontent .listitems#focus div:eq(3)').html())},
					dataType:'html',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'creditcard reinv.ajax.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						if(d=='success'){
							alert('發票補印完成。');
							verpsw.dialog('close');
						}
						else if(d=='dataempty'){
							alert('查無資料，請確認輸入正確。');
						}
						else if(d=='dbempty'){
							alert('資料庫錯誤。');
						}
						else{
							alert(d);
						}
					},
					error:function(e){
						//console.log(e);
					}
				});
			}
			else if($('.verpsw input[name="type"]').val()=='editlist'){//修改帳單
				var voidbizdate=$('.salelist #date').html();
				var voidconsecnumber=$('.salelist #listno input[name="consecnumber"]').val();
				$.ajax({
					url:'./lib/js/checkopen.ajax.php',
					async:false,
					dataType:'html',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'creditcard checkopen.ajax.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						//console.log(d);
						if(d=='success'){
							var nowbizdate=$('.salelist #date').html();
							if($('.salelist #date').html()!=''){
								var listtype='';
								var tabnum='';
								var consecnumber='';
								if($.trim($('.salelist #salelist #salecontent .listitems#focus div:eq(3)').html()).length!=0){//檢查是否開立發票
									//console.log('void inv');
									var hint=confirm('該帳單已開發票，如要修改請確認發票正本已收回。');
									if(hint==true){
										$.ajax({//作廢帳單
											url:'./lib/js/salevoid.ajax.php',
											method:'post',
											data:{'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'bizdate':$('.salelist #date').html(),'createdatetime':$('.salelist #credate').val(),'consecnumber':$('.salelist #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'remarks':'editsale'},
											dataType:'html',
											success:function(d){
												if(d.length>20){
													$.ajax({
														url:'./lib/js/print.php',
														method:'post',
														data:{'html':'creditcard salevoid.ajax.php '+d},
														dataType:'html',
														success:function(d){/*console.log(d);*/},
														error:function(e){/*console.log(e);*/}
													});
												}
												else{
												}
												if(d.substr(0,7)=='success'){
													$.ajax({//作廢發票
														url:'./lib/js/deleteinv.ajax.php',
														method:'post',
														data:{'bizdate':$('.salelist #date').html(),'number':$('.salelist #salelist #salecontent .listitems#focus div:eq(3)').html()},
														dataType:'html',
														success:function(d){
															if(d.length>20){
																$.ajax({
																	url:'./lib/js/print.php',
																	method:'post',
																	data:{'html':'creditcard deleteinv.ajax.php '+d},
																	dataType:'html',
																	success:function(d){/*console.log(d);*/},
																	error:function(e){/*console.log(e);*/}
																});
															}
															else{
															}
															//console.log(d);
															//2017/12/29var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
															//2017/12/29mywin.document.title='cashdrawer';
														},
														error:function(e){
															//console.log(e);
														}
													});
												}
												else{
													//console.log(d);
												}
												$.ajax({//利用暫結加點功能將產品撈出(資料從正式表格複製一份至暫存表格)
													url:'./lib/js/copysale.ajax.php',
													method:'post',
													data:{'bizdate':$('.salelist #date').html(),'createdatetime':$('.salelist #credate').val(),'consecnumber':$('.salelist #listno input[name="consecnumber"]').val(),'code':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'name':$('.order#order #tabs4 #listform input[name="username"]').val()},
													dataType:'html',
													success:function(d){
														if(d.length>20){
															$.ajax({
																url:'./lib/js/print.php',
																method:'post',
																data:{'html':'creditcard copysale.ajax.php '+d},
																dataType:'html',
																success:function(d){/*console.log(d);*/},
																error:function(e){/*console.log(e);*/}
															});
														}
														else{
														}
														var t=d.split('-');
														//console.log(t);
														listtype=t[t.length-3];
														bizdate=t[t.length-2];
														consecnumber=t[t.length-1];
														//console.log(d);

														temporder(bizdate,consecnumber,$('.order#order #tabs4 #listform input[name="machinetype"]').val(),$('.order#order .companydata #company').val(),$('.order#order #tabs4 #listform input[name="usercode"]').val(),$('.order#order #tabs4 #listform input[name="username"]').val());
														//location.href='./order.php?usercode='+$('.order#order #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #tabs4 #listform input[name="username"]').val()+'&listtype='+listtype+'&tabnum&bizdate='+bizdate+'&consecnumber='+consecnumber;
														verpsw.dialog('close');
														$('.salelist #editpay').prop('disabled',true);
														$('.salelist #reorder').prop('disabled',true);
														$('.salelist #reinv').prop('disabled',true);
														$('.salelist #rekvm').prop('disabled',true);
														$('.salelist #salelist #salecontent .listitems').prop('id','');
														$('.salelist #listno').html('');
														$('.salelist #list #listcontent').html('');
														$('.salelist #date').html('');
														$('.salelist #credate').html('');
														$('.salelist #fun button#forall').prop('disabled',true);
														$('.salelist #fun button#list').prop('disabled',true);
														$('.salelist #fun button#tag').prop('disabled',true);
														$('.salelist #fun button#kitchen').prop('disabled',true);
														$('.salelist #fun button#changecheck').prop('disabled',true);
														salelist.dialog('close');
														if(!$('.order#order #billfun #billfun1button').prop('disabled')){
															$('.order#order #billfun #billfun1button').trigger('click');
														}
														else{
														}
													},
													error:function(e){
														//console.log(e);
													}
												});
											},
											error:function(e){
												//console.log(e);
											}
										});
									}
									else{
									}
								}
								else{
									$.ajax({//作廢帳單
										url:'./lib/js/salevoid.ajax.php',
										method:'post',
										data:{'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'bizdate':$('.salelist #date').html(),'createdatetime':$('.salelist #credate').val(),'consecnumber':$('.salelist #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'remarks':'editsale'},
										dataType:'html',
										success:function(d){
											if(d.length>20){
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													data:{'html':'creditcard salevoid.ajax.php '+d},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else{
											}
											/*if(d.substr(0,7)=='success'){
												$.ajax({//作廢發票
													url:'./lib/js/deleteinv.ajax.php',
													method:'post',
													data:{'bizdate':$('.salelist #date').html(),'number':$('.salelist #salelist #salecontent .listitems#focus div:eq(2)').html()},
													dataType:'html',
													success:function(d){
														if(d.length>20){
															$.ajax({
																url:'./lib/js/print.php',
																method:'post',
																data:{'html':'creditcard deleteinv.ajax.php '+d},
																dataType:'html',
																success:function(d){
																	//console.log(d);
																},
																error:function(e){
																	//console.log(e);
																}
															});
														}
														else{
														}
														//console.log(d);
														//2017/12/29var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
														//2017/12/29mywin.document.title='cashdrawer';
													},
													error:function(e){
														//console.log(e);
													}
												});
											}
											else{
												//console.log(d);
											}*/
											$.ajax({//利用暫結加點功能將產品撈出(資料從正式表格複製一份至暫存表格)
												url:'./lib/js/copysale.ajax.php',
												method:'post',
												data:{'bizdate':$('.salelist #date').html(),'createdatetime':$('.salelist #credate').val(),'consecnumber':$('.salelist #listno input[name="consecnumber"]').val(),'code':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'name':$('.order#order #tabs4 #listform input[name="username"]').val()},
												dataType:'html',
												success:function(d){
													if(d.length>20){
														$.ajax({
															url:'./lib/js/print.php',
															method:'post',
															data:{'html':'creditcard copysale.ajax.php '+d},
															dataType:'html',
															success:function(d){/*console.log(d);*/},
															error:function(e){/*console.log(e);*/}
														});
													}
													else{
													}
													var t=d.split('-');
													//console.log(t);
													listtype=t[t.length-3];
													bizdate=t[t.length-2];
													consecnumber=t[t.length-1];
													//console.log(d);

													temporder(bizdate,consecnumber,$('.order#order #tabs4 #listform input[name="machinetype"]').val(),$('.order#order .companydata #company').val(),$('.order#order #tabs4 #listform input[name="usercode"]').val(),$('.order#order #tabs4 #listform input[name="username"]').val());
													//location.href='./order.php?usercode='+$('.order#order #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #tabs4 #listform input[name="username"]').val()+'&listtype='+listtype+'&tabnum&bizdate='+bizdate+'&consecnumber='+consecnumber;
													verpsw.dialog('close');
													$('.salelist #editpay').prop('disabled',true);
													$('.salelist #reorder').prop('disabled',true);
													$('.salelist #reinv').prop('disabled',true);
													$('.salelist #rekvm').prop('disabled',true);
													$('.salelist #salelist #salecontent .listitems').prop('id','');
													$('.salelist #listno').html('');
													$('.salelist #list #listcontent').html('');
													$('.salelist #date').html('');
													$('.salelist #credate').html('');
													$('.salelist #fun button#forall').prop('disabled',true);
													$('.salelist #fun button#list').prop('disabled',true);
													$('.salelist #fun button#tag').prop('disabled',true);
													$('.salelist #fun button#kitchen').prop('disabled',true);
													$('.salelist #fun button#changecheck').prop('disabled',true);
													salelist.dialog('close');
													if(!$('.order#order #billfun #billfun1button').prop('disabled')){
														$('.order#order #billfun #billfun1button').trigger('click');
													}
													else{
													}
												},
												error:function(e){
													//console.log(e);
												}
											});
										},
										error:function(e){
											//console.log(e);
										}
									});
								}
							}
							else{
							}
							$.ajax({
								url:'./lib/js/create.cmdtxt.php',
								method:'post',
								async: false,
								data:{'cmd':nowbizdate.substr(0,6)+'-change'},
								dataType:'html',
								success:function(d){
									//console.log(d);
								},
								error:function(e){
									//console.log(e);
								}
							});
						}
						else{
							alert('目前尚未開班，請確認是否開班或重啟系統。');
						}
					},
					error:function(e){
						//console.log(e);
					}
				});
				/*集點樹收點流程*/
				if($('.order#order .initsetting #pointtree').length>0&&$('.order#order .initsetting #pointtree').val()=='1'){
					/*start tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'start point-tree-void transfer','file':'point-tree'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
					if(typeof api_void_pointtree!=="undefined"&&typeof api_void_pointtree==="function"){
						var voidres=api_void_pointtree(voidbizdate,voidconsecnumber);
						if(voidres==''){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'point-tree-void voidpoint 意外錯誤','file':'point-tree'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else if(typeof voidres['data']!=="undefined"){//success
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'pass point-tree-void transfer -PHP_EOL-pos_token_tx_id:'+voidres['data']['pos_token_tx_id']+'-PHP_EOL-store_balance:'+voidres['data']['store_balance']+'-PHP_EOL-user_balance:'+voidres['data']['user_balance'],'file':'point-tree'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
							var message=JSON.parse(voidres['responseText']);
							if(voidres['status']==='timeout'){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'point-tree-void transfer timeout','file':'point-tree'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else if(voidres['status']=='400'||voidres['status']=='406'){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'point-tree-void transfer error -PHP_EOL-status:'+voidres['status']+'-PHP_EOL-code:'+message['errors'][0]['code']+'-PHP_EOL-message:'+message['errors'][0]['message'],'file':'point-tree'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'point-tree-void transfer 意外錯誤','file':'point-tree'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
						}
					}
					else{
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							async:false,
							data:{'html':'api void pointtree is not function','file':'point-tree'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					/*end tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'end point-tree-void transfer','file':'point-tree'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
			}
			else if($('.verpsw input[name="type"]').val()=='void'){//作廢帳單
				var nowbizdate=$('.salevoid #date').html();
				var voidbizdate=$('.salevoid #date').html();
				var voidconsecnumber=$('.salevoid #listno input[name="consecnumber"]').val();
				if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
					var posdvrfile='';
				}
				else{
				}
				$.ajax({
					url:'./lib/js/salevoid.ajax.php',
					method:'post',
					data:{'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'bizdate':$('.salevoid #date').html(),'createdatetime':$('.salevoid #credate').val(),'consecnumber':$('.salevoid #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val()},
					dataType:'html',
					success:function(d){
						console.log(d);
						var temp=d.split('-');
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'creditcard salevoid.ajax.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						if(temp[0]=='success'){
							//console.log($('.salevoid #list #listcontent input[name="invnumber"]').val());
							$.ajax({
								url:'./lib/js/deleteinv.ajax.php',
								method:'post',
								data:{'bizdate':$('.salevoid #date').html(),'number':$('.salevoid #list input[name="invnumber"]').val()},
								dataType:'html',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'creditcard deleteinv.ajax.php '+d},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									//console.log(d);
									//2017/12/4var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
									//2017/12/4mywin.document.title='cashdrawer';
								},
								error:function(e){
									//console.log(e);
								}
							});
							$('.order#order #billfun #billfun2 #salevoid').trigger('click');
							$('.salevoid #listno').html('');
							$('.salevoid #list #listcontent').html('');
							$('.salevoid #date').html('');
							$('.salevoid #credate').html('');
							if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
								var posdvrfile=temp[1];
							}
							else{
							}
						}
						else{
							//console.log(d);
						}
						verpsw.dialog('close');
					},
					error:function(e){
						//console.log(e);
					}
				});
				$.ajax({
					url:'./lib/js/create.cmdtxt.php',
					method:'post',
					async: false,
					data:{'cmd':nowbizdate.substr(0,6)+'-change'},
					dataType:'html',
					success:function(d){
						//console.log(d);
					},
					error:function(e){
						//console.log(e);
					}
				});
				/*錢都錄借接*/
				if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
					/*start tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						async:false,
						data:{'html':'start posdvr-sendmessage','file':'posdvr'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){console.log(e);}
					});
					if(typeof api_sendmessage_posdvr!=="undefined"&&typeof api_sendmessage_posdvr==="function"){
						api_sendmessage_posdvr(posdvrfile);
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'success','file':'posdvr'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							async:false,
							data:{'html':'error sendmessage is not function','file':'posdvr'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					/*end tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						async:false,
						data:{'html':'end posdvr-sendmessage','file':'posdvr'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				/*集點樹收點流程*/
				if($('.order#order .initsetting #pointtree').length>0&&$('.order#order .initsetting #pointtree').val()=='1'){
					/*start tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'start point-tree-void transfer','file':'point-tree'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
					if(typeof api_void_pointtree!=="undefined"&&typeof api_void_pointtree==="function"){
						var voidres=api_void_pointtree(voidbizdate,voidconsecnumber);
						if(voidres==''){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'point-tree-void voidpoint 意外錯誤','file':'point-tree'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else if(typeof voidres['data']!=="undefined"){//success
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'pass point-tree-void transfer -PHP_EOL-pos_token_tx_id:'+voidres['data']['pos_token_tx_id']+'-PHP_EOL-store_balance:'+voidres['data']['store_balance']+'-PHP_EOL-user_balance:'+voidres['data']['user_balance'],'file':'point-tree'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
							var message=JSON.parse(voidres['responseText']);
							if(voidres['status']==='timeout'){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'point-tree-void transfer timeout','file':'point-tree'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else if(voidres['status']=='400'||voidres['status']=='406'){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'point-tree-void transfer error -PHP_EOL-status:'+voidres['status']+'-PHP_EOL-code:'+message['errors'][0]['code']+'-PHP_EOL-message:'+message['errors'][0]['message'],'file':'point-tree'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'point-tree-void transfer 意外錯誤','file':'point-tree'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
						}
					}
					else{
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							async:false,
							data:{'html':'api void pointtree is not function','file':'point-tree'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					/*end tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'end point-tree-void transfer','file':'point-tree'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
			}
			else if($('.verpsw input[name="type"]').val()=='viewvoid'){//暫結作廢
				if($.trim($('.viewtemp #salelist #salecontent .listitems#focus div:eq(3)').html()).length!=0){//檢查是否已開立發票
					var hint=confirm('請確認發票正本已收回。');
					if(hint==true){
						var nowbizdate=$('.viewtemp #date').html();
						if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
							var posdvrfile='';
						}
						else{
						}
						$.ajax({
							url:'./lib/js/viewvoid.ajax.php',
							method:'post',
							data:{'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val()},
							dataType:'html',
							success:function(d){
								var tempres=d.split('-');
								if(d.length>20){
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										data:{'html':'viewtemp-viewvoid viewvoid.ajax.php '+d},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
								}
								else{
								}
								if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
									var posdvrfile=tempres[1];
								}
								else{
								}
								//console.log(d);
								if(tempres[0]=='success'){
									$.ajax({//作廢發票
										url:'./lib/js/deleteinv.ajax.php',
										method:'post',
										data:{'bizdate':$('.viewtemp #date').html(),'number':$('.viewtemp #salelist #salecontent .listitems#focus div:eq(3)').html()},
										dataType:'html',
										success:function(d){
											if(d.length>20){
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													data:{'html':'viewtemp-viewvoid deleteinv.ajax.php '+d},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else{
											}
											//console.log(d);
											$('.viewtemp #salelist #salecontent .listitems').prop('id','');
											$('.viewtemp #listno').html('');
											$('.viewtemp #list #listcontent').html('');
											$('.viewtemp #date').html('');
											$('.viewtemp #credate').html('');
											$('.viewtemp #otherfun button#plus').prop('disabled',true);
											$('.viewtemp #otherfun button#openinv').prop('disabled',true);
											$('.viewtemp #viewvoid').prop('disabled',true);
											$('.viewtemp #fun button#forall').prop('disabled',true);
											$('.viewtemp #fun button#list').prop('disabled',true);
											$('.viewtemp #fun button#tag').prop('disabled',true);
											$('.viewtemp #fun button#kitchen').prop('disabled',true);
											$('.viewtemp #fun button#changecheck').prop('disabled',true);
											verpsw.dialog('close');
											$('.order#order #MemberBill #list #funbox #view').trigger('click');
											//2017/12/29var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
											//2017/12/29mywin.document.title='cashdrawer';
										},
										error:function(e){
											//console.log(e);
										}
									});
								}
								else{
									//console.log(d);
								}
							},
							error:function(e){
								//console.log(e);
							}
						});
						/*錢都錄借接*/
						if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
							/*start tag*/
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'start posdvr-sendmessage','file':'posdvr'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){console.log(e);}
							});
							if(typeof api_sendmessage_posdvr!=="undefined"&&typeof api_sendmessage_posdvr==="function"){
								api_sendmessage_posdvr(posdvrfile);
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'success','file':'posdvr'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'error sendmessage is not function','file':'posdvr'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							/*end tag*/
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'end posdvr-sendmessage','file':'posdvr'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						$.ajax({
							url:'./lib/js/create.cmdtxt.php',
							method:'post',
							async: false,
							data:{'cmd':nowbizdate.substr(0,6)+'-change'},
							dataType:'html',
							success:function(d){
								//console.log(d);
							},
							error:function(e){
								//console.log(e);
							}
						});
					}
					else{
					}
				}
				else{
					var nowbizdate=$('.viewtemp #date').html();
					if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
						var posdvrfile='';
					}
					else{
					}
					$.ajax({
						url:'./lib/js/viewvoid.ajax.php',
						method:'post',
						data:{'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val()},
						dataType:'html',
						success:function(d){
							var tempres=d.split('-');
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'viewtemp-viewvoid viewvoid.ajax.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
								var posdvrfile=tempres[1];
							}
							else{
							}
							console.log(d);
							$('.viewtemp #salelist #salecontent .listitems').prop('id','');
							$('.viewtemp #listno').html('');
							$('.viewtemp #list #listcontent').html('');
							$('.viewtemp #date').html('');
							$('.viewtemp #credate').html('');
							$('.viewtemp #otherfun button#plus').prop('disabled',true);
							$('.viewtemp #otherfun button#openinv').prop('disabled',true);
							$('.viewtemp #viewvoid').prop('disabled',true);
							$('.viewtemp #fun button#forall').prop('disabled',true);
							$('.viewtemp #fun button#list').prop('disabled',true);
							$('.viewtemp #fun button#tag').prop('disabled',true);
							$('.viewtemp #fun button#kitchen').prop('disabled',true);
							$('.viewtemp #fun button#changecheck').prop('disabled',true);
							verpsw.dialog('close');
							$('.order#order #MemberBill #list #funbox #view').trigger('click');
						},
						error:function(e){
							//console.log(e);
						}
					});
					/*錢都錄借接*/
					if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
						/*start tag*/
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							async:false,
							data:{'html':'start posdvr-sendmessage','file':'posdvr'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){console.log(e);}
						});
						if(typeof api_sendmessage_posdvr!=="undefined"&&typeof api_sendmessage_posdvr==="function"){
							api_sendmessage_posdvr(posdvrfile);
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'success','file':'posdvr'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'error sendmessage is not function','file':'posdvr'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						/*end tag*/
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							async:false,
							data:{'html':'end posdvr-sendmessage','file':'posdvr'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					$.ajax({
						url:'./lib/js/create.cmdtxt.php',
						method:'post',
						async: false,
						data:{'cmd':nowbizdate.substr(0,6)+'-change'},
						dataType:'html',
						success:function(d){
							//console.log(d);
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
			}
			else if($('.verpsw input[name="type"]').val()=='viewvoidbyemptylist'){//全部刪除後刪單
				var nowbizdate=$('.order#order #tabs4 #listform input[name="bizdate"]').val();
				if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
					var posdvrfile='';
				}
				else{
				}
				$.ajax({
					url:'./lib/js/create.voidtempdb.php',
					method:'post',
					async: false,
					data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tablenumber':$('.order#order #tabs4 #listform input[name="tablenumber"]').val(),'machine':$('.order#order .companydata #terminalnumber').val()},
					dataType:'html',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'void emptyitemsvoidlist create.voidtempdb.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						//console.log(d);
					},
					error:function(e){
						//console.log(e);
					}
				});
				if($('.order#order .initsetting #secview').val()=='1'){
					$.ajax({
						url:'../secview/cleartemp.ajax.php',
						async: false,
						dataType:'html',
						success:function(d){
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'temp cleartemp.ajax.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							//console.log(d);
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
				else{
				}
				$.ajax({
					url:'./lib/js/viewvoid.ajax.php',
					method:'post',
					data:{'terminalnumber':$('.order#order #tabs4 #listform input[name="machinetype"]').val(),'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val()},
					dataType:'html',
					success:function(d){
						var tempres=d.split('-');
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'view-void-by-empty-list viewvoid.ajax.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
							var posdvrfile=tempres[1];
						}
						else{
						}
						//console.log(d);
						verpsw.dialog('close');
						emptyitemsvoidlist.dialog('close');
						if($('.order#order .initsetting #controltable').val()=='1'){
							inittable.dialog('open');
							ClearWindow('','');
						}
						else{
							ClearWindow('','');
						}
					},
					error:function(e){
						//console.log(e);
					}
				});
				/*錢都錄借接*/
				if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
					/*start tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						async:false,
						data:{'html':'start posdvr-sendmessage','file':'posdvr'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){console.log(e);}
					});
					if(typeof api_sendmessage_posdvr!=="undefined"&&typeof api_sendmessage_posdvr==="function"){
						api_sendmessage_posdvr(posdvrfile);
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'success','file':'posdvr'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							async:false,
							data:{'html':'error sendmessage is not function','file':'posdvr'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					/*end tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						async:false,
						data:{'html':'end posdvr-sendmessage','file':'posdvr'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				$.ajax({
					url:'./lib/js/create.cmdtxt.php',
					method:'post',
					async: false,
					data:{'cmd':nowbizdate.substr(0,6)+'-change'},
					dataType:'html',
					success:function(d){
						//console.log(d);
					},
					error:function(e){
						//console.log(e);
					}
				});
			}
			else{
			}
		}
		else if(($('.verpsw input[name="type"]').val()=='paper'||$('.verpsw input[name="type"]').val()=='viewpaper')&&typeof $('.order#order .companydata #paperpw').val()!=="undefined"&&$('.order#order .companydata #paperpw').val()==$('.verpsw input[name="verpsw"]').val()){
			if($('.verpsw input[name="type"]').val()=='paper'){//列印報表
				if($('.historypaper select[name="paperlist"] option:selected').val()=='paper1'){
					$.ajax({
						url:'./lib/js/shift.paper.php',
						method:'post',
						async:false,
						data:{'papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
						dataType:'html',
						success:function(d){
							console.log(d);
						},
						error:function(e){
							console.log(e);
						}
					});
					verpsw.dialog('close');
				}
				else if($('.historypaper select[name="paperlist"] option:selected').val()=='paper2'){
					$.ajax({
						url:'./lib/js/hispaper2.php',
						method:'post',
						async:false,
						data:{'papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
						dataType:'html',
						success:function(d){
							console.log(d);
						},
						error:function(e){
							console.log(e);
						}
					});
					verpsw.dialog('close');
				}
				else if($('.historypaper select[name="paperlist"] option:selected').val()=='paper3'){
					$.ajax({
						url:'./lib/js/hispaper3.php',
						method:'post',
						async:false,
						data:{'papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
						dataType:'html',
						success:function(d){
							console.log(d);
						},
						error:function(e){
							console.log(e);
						}
					});
					verpsw.dialog('close');
				}
				else if($('.historypaper select[name="paperlist"] option:selected').val()=='paper4'){
					$.ajax({
						url:'./lib/js/hispaper4.php',
						method:'post',
						async:false,
						data:{'papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
						dataType:'html',
						success:function(d){
							console.log(d);
						},
						error:function(e){
							console.log(e);
						}
					});
					verpsw.dialog('close');
				}
				else{
				}
			}
			else if($('.verpsw input[name="type"]').val()=='viewpaper'){//瀏覽報表
				if($('.historypaper select[name="paperlist"] option:selected').val()=='paper1'){
					$.ajax({
						url:'./lib/js/shift.paper.php',
						method:'post',
						async:false,
						data:{'type':'view','papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
						dataType:'html',
						success:function(d){
							$('.viewpaper').html(d);
							viewpaper.dialog('open');
						},
						error:function(e){
							console.log(e);
						}
					});
					verpsw.dialog('close');
				}
				else if($('.historypaper select[name="paperlist"] option:selected').val()=='paper2'){
					$.ajax({
						url:'./lib/js/hispaper2.php',
						method:'post',
						async:false,
						data:{'type':'view','papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
						dataType:'html',
						success:function(d){
							$('.viewpaper').html(d);
							viewpaper.dialog('open');
						},
						error:function(e){
							console.log(e);
						}
					});
					verpsw.dialog('close');
				}
				else if($('.historypaper select[name="paperlist"] option:selected').val()=='paper3'){
					$.ajax({
						url:'./lib/js/hispaper3.php',
						method:'post',
						async:false,
						data:{'type':'view','papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
						dataType:'html',
						success:function(d){
							$('.viewpaper').html(d);
							viewpaper.dialog('open');
							console.log(d);
						},
						error:function(e){
							console.log(e);
						}
					});
					verpsw.dialog('close');
				}
				else if($('.historypaper select[name="paperlist"] option:selected').val()=='paper4'){
					$.ajax({
						url:'./lib/js/hispaper4.php',
						method:'post',
						async:false,
						data:{'type':'view','papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
						dataType:'html',
						success:function(d){
							$('.viewpaper').html(d);
							viewpaper.dialog('open');
							console.log(d);
						},
						error:function(e){
							console.log(e);
						}
					});
					verpsw.dialog('close');
				}
				else{
				}
			}
			else{
			}
		}
		else if($('.verpsw input[name="type"]').val()=='editpunch'&&typeof $('.order#order .companydata #punchpw').val()!=="undefined"&&$('.order#order .companydata #punchpw').val()==$('.verpsw input[name="verpsw"]').val()){
			if($('.verpsw input[name="type"]').val()=='editpunch'){//修改打卡紀錄
				verpsw.dialog('close');
				editpunch.dialog('open');
			}
			else{
			}
		}
		else if(((($('.verpsw input[name="type"]').val()=='reinv'||$('.verpsw input[name="type"]').val()=='editlist'||$('.verpsw input[name="type"]').val()=='void'||$('.verpsw input[name="type"]').val()=='viewvoid'||$('.verpsw input[name="type"]').val()=='viewvoidbyemptylist')&&typeof $('.order#order .companydata #voidpw').val()==="undefined")||(($('.verpsw input[name="type"]').val()=='paper'||$('.verpsw input[name="type"]').val()=='viewpaper')&&typeof $('.order#order .companydata #paperpw').val()==="undefined")||($('.verpsw input[name="type"]').val()=='editpunch'&&typeof $('.order#order .companydata #punchpw').val()==="undefined"))&&$('.verpsw input[name="verpsw"]').val()==$('.order#order .initsetting #voidpsw').val()){
			if($('.verpsw input[name="type"]').val()=='reinv'){//補印發票
				$.ajax({
					url:'./lib/js/reinv.ajax.php',
					method:'post',
					async:false,
					data:{'bizdate':$('.salelist #salelist #salecontent .listitems#focus div:eq(0)').html(),'invno':$.trim($('.salelist #salelist #salecontent .listitems#focus div:eq(3)').html())},
					dataType:'html',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'creditcard reinv.ajax.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						if(d=='success'){
							alert('發票補印完成。');
							verpsw.dialog('close');
						}
						else if(d=='dataempty'){
							alert('查無資料，請確認輸入正確。');
						}
						else if(d=='dbempty'){
							alert('資料庫錯誤。');
						}
						else{
							alert(d);
						}
					},
					error:function(e){
						//console.log(e);
					}
				});
			}
			else if($('.verpsw input[name="type"]').val()=='editlist'){//修改帳單
				var voidbizdate=$('.salelist #date').html();
				var voidconsecnumber=$('.salelist #listno input[name="consecnumber"]').val();
				$.ajax({
					url:'./lib/js/checkopen.ajax.php',
					async:false,
					dataType:'html',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'creditcard checkopen.ajax.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						//console.log(d);
						if(d=='success'){
							var nowbizdate=$('.salelist #date').html();
							if($('.salelist #date').html()!=''){
								var listtype='';
								var tabnum='';
								var consecnumber='';
								if($.trim($('.salelist #salelist #salecontent .listitems#focus div:eq(3)').html()).length!=0){//檢查是否開立發票
									//console.log('void inv');
									var hint=confirm('該帳單已開發票，如要修改請確認發票正本已收回。');
									if(hint==true){
										$.ajax({//作廢帳單
											url:'./lib/js/salevoid.ajax.php',
											method:'post',
											data:{'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'bizdate':$('.salelist #date').html(),'createdatetime':$('.salelist #credate').val(),'consecnumber':$('.salelist #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'remarks':'editsale'},
											dataType:'html',
											success:function(d){
												if(d.length>20){
													$.ajax({
														url:'./lib/js/print.php',
														method:'post',
														data:{'html':'creditcard salevoid.ajax.php '+d},
														dataType:'html',
														success:function(d){/*console.log(d);*/},
														error:function(e){/*console.log(e);*/}
													});
												}
												else{
												}
												if(d.substr(0,7)=='success'){
													$.ajax({//作廢發票
														url:'./lib/js/deleteinv.ajax.php',
														method:'post',
														data:{'bizdate':$('.salelist #date').html(),'number':$('.salelist #salelist #salecontent .listitems#focus div:eq(3)').html()},
														dataType:'html',
														success:function(d){
															if(d.length>20){
																$.ajax({
																	url:'./lib/js/print.php',
																	method:'post',
																	data:{'html':'creditcard deleteinv.ajax.php '+d},
																	dataType:'html',
																	success:function(d){/*console.log(d);*/},
																	error:function(e){/*console.log(e);*/}
																});
															}
															else{
															}
															//console.log(d);
															//2017/12/29var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
															//2017/12/29mywin.document.title='cashdrawer';
														},
														error:function(e){
															//console.log(e);
														}
													});
												}
												else{
													//console.log(d);
												}
												$.ajax({//利用暫結加點功能將產品撈出(資料從正式表格複製一份至暫存表格)
													url:'./lib/js/copysale.ajax.php',
													method:'post',
													data:{'bizdate':$('.salelist #date').html(),'createdatetime':$('.salelist #credate').val(),'consecnumber':$('.salelist #listno input[name="consecnumber"]').val(),'code':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'name':$('.order#order #tabs4 #listform input[name="username"]').val()},
													dataType:'html',
													success:function(d){
														if(d.length>20){
															$.ajax({
																url:'./lib/js/print.php',
																method:'post',
																data:{'html':'creditcard copysale.ajax.php '+d},
																dataType:'html',
																success:function(d){/*console.log(d);*/},
																error:function(e){/*console.log(e);*/}
															});
														}
														else{
														}
														var t=d.split('-');
														//console.log(t);
														listtype=t[t.length-3];
														bizdate=t[t.length-2];
														consecnumber=t[t.length-1];
														//console.log(d);

														temporder(bizdate,consecnumber,$('.order#order #tabs4 #listform input[name="machinetype"]').val(),$('.order#order .companydata #company').val(),$('.order#order #tabs4 #listform input[name="usercode"]').val(),$('.order#order #tabs4 #listform input[name="username"]').val());
														//location.href='./order.php?usercode='+$('.order#order #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #tabs4 #listform input[name="username"]').val()+'&listtype='+listtype+'&tabnum&bizdate='+bizdate+'&consecnumber='+consecnumber;
														verpsw.dialog('close');
														$('.salelist #editpay').prop('disabled',true);
														$('.salelist #reorder').prop('disabled',true);
														$('.salelist #reinv').prop('disabled',true);
														$('.salelist #rekvm').prop('disabled',true);
														$('.salelist #salelist #salecontent .listitems').prop('id','');
														$('.salelist #listno').html('');
														$('.salelist #list #listcontent').html('');
														$('.salelist #date').html('');
														$('.salelist #credate').html('');
														$('.salelist #fun button#forall').prop('disabled',true);
														$('.salelist #fun button#list').prop('disabled',true);
														$('.salelist #fun button#tag').prop('disabled',true);
														$('.salelist #fun button#kitchen').prop('disabled',true);
														$('.salelist #fun button#changecheck').prop('disabled',true);
														salelist.dialog('close');
														if(!$('.order#order #billfun #billfun1button').prop('disabled')){
															$('.order#order #billfun #billfun1button').trigger('click');
														}
														else{
														}
													},
													error:function(e){
														//console.log(e);
													}
												});
											},
											error:function(e){
												//console.log(e);
											}
										});
									}
									else{
									}
								}
								else{
									$.ajax({//作廢帳單
										url:'./lib/js/salevoid.ajax.php',
										method:'post',
										data:{'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'bizdate':$('.salelist #date').html(),'createdatetime':$('.salelist #credate').val(),'consecnumber':$('.salelist #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'remarks':'editsale'},
										dataType:'html',
										success:function(d){
											if(d.length>20){
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													data:{'html':'creditcard salevoid.ajax.php '+d},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else{
											}
											/*if(d.substr(0,7)=='success'){
												$.ajax({//作廢發票
													url:'./lib/js/deleteinv.ajax.php',
													method:'post',
													data:{'bizdate':$('.salelist #date').html(),'number':$('.salelist #salelist #salecontent .listitems#focus div:eq(2)').html()},
													dataType:'html',
													success:function(d){
														if(d.length>20){
															$.ajax({
																url:'./lib/js/print.php',
																method:'post',
																data:{'html':'creditcard deleteinv.ajax.php '+d},
																dataType:'html',
																success:function(d){
																	//console.log(d);
																},
																error:function(e){
																	//console.log(e);
																}
															});
														}
														else{
														}
														//console.log(d);
														//2017/12/29var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
														//2017/12/29mywin.document.title='cashdrawer';
													},
													error:function(e){
														//console.log(e);
													}
												});
											}
											else{
												//console.log(d);
											}*/
											$.ajax({//利用暫結加點功能將產品撈出(資料從正式表格複製一份至暫存表格)
												url:'./lib/js/copysale.ajax.php',
												method:'post',
												data:{'bizdate':$('.salelist #date').html(),'createdatetime':$('.salelist #credate').val(),'consecnumber':$('.salelist #listno input[name="consecnumber"]').val(),'code':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'name':$('.order#order #tabs4 #listform input[name="username"]').val()},
												dataType:'html',
												success:function(d){
													if(d.length>20){
														$.ajax({
															url:'./lib/js/print.php',
															method:'post',
															data:{'html':'creditcard copysale.ajax.php '+d},
															dataType:'html',
															success:function(d){/*console.log(d);*/},
															error:function(e){/*console.log(e);*/}
														});
													}
													else{
													}
													var t=d.split('-');
													//console.log(t);
													listtype=t[t.length-3];
													bizdate=t[t.length-2];
													consecnumber=t[t.length-1];
													//console.log(d);

													temporder(bizdate,consecnumber,$('.order#order #tabs4 #listform input[name="machinetype"]').val(),$('.order#order .companydata #company').val(),$('.order#order #tabs4 #listform input[name="usercode"]').val(),$('.order#order #tabs4 #listform input[name="username"]').val());
													//location.href='./order.php?usercode='+$('.order#order #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #tabs4 #listform input[name="username"]').val()+'&listtype='+listtype+'&tabnum&bizdate='+bizdate+'&consecnumber='+consecnumber;
													verpsw.dialog('close');
													$('.salelist #editpay').prop('disabled',true);
													$('.salelist #reorder').prop('disabled',true);
													$('.salelist #reinv').prop('disabled',true);
													$('.salelist #rekvm').prop('disabled',true);
													$('.salelist #salelist #salecontent .listitems').prop('id','');
													$('.salelist #listno').html('');
													$('.salelist #list #listcontent').html('');
													$('.salelist #date').html('');
													$('.salelist #credate').html('');
													$('.salelist #fun button#forall').prop('disabled',true);
													$('.salelist #fun button#list').prop('disabled',true);
													$('.salelist #fun button#tag').prop('disabled',true);
													$('.salelist #fun button#kitchen').prop('disabled',true);
													$('.salelist #fun button#changecheck').prop('disabled',true);
													salelist.dialog('close');
													if(!$('.order#order #billfun #billfun1button').prop('disabled')){
														$('.order#order #billfun #billfun1button').trigger('click');
													}
													else{
													}
												},
												error:function(e){
													//console.log(e);
												}
											});
										},
										error:function(e){
											//console.log(e);
										}
									});
								}
							}
							else{
							}
							$.ajax({
								url:'./lib/js/create.cmdtxt.php',
								method:'post',
								async: false,
								data:{'cmd':nowbizdate.substr(0,6)+'-change'},
								dataType:'html',
								success:function(d){
									//console.log(d);
								},
								error:function(e){
									//console.log(e);
								}
							});
						}
						else{
							alert('目前尚未開班，請確認是否開班或重啟系統。');
						}
					},
					error:function(e){
						//console.log(e);
					}
				});
				/*集點樹收點流程*/
				if($('.order#order .initsetting #pointtree').length>0&&$('.order#order .initsetting #pointtree').val()=='1'){
					/*start tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'start point-tree-void transfer','file':'point-tree'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
					if(typeof api_void_pointtree!=="undefined"&&typeof api_void_pointtree==="function"){
						var voidres=api_void_pointtree(voidbizdate,voidconsecnumber);
						if(voidres==''){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'point-tree-void voidpoint 意外錯誤','file':'point-tree'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else if(typeof voidres['data']!=="undefined"){//success
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'pass point-tree-void transfer -PHP_EOL-pos_token_tx_id:'+voidres['data']['pos_token_tx_id']+'-PHP_EOL-store_balance:'+voidres['data']['store_balance']+'-PHP_EOL-user_balance:'+voidres['data']['user_balance'],'file':'point-tree'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
							var message=JSON.parse(voidres['responseText']);
							if(voidres['status']==='timeout'){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'point-tree-void transfer timeout','file':'point-tree'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else if(voidres['status']=='400'||voidres['status']=='406'){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'point-tree-void transfer error -PHP_EOL-status:'+voidres['status']+'-PHP_EOL-code:'+message['errors'][0]['code']+'-PHP_EOL-message:'+message['errors'][0]['message'],'file':'point-tree'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'point-tree-void transfer 意外錯誤','file':'point-tree'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
						}
					}
					else{
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							async:false,
							data:{'html':'api void pointtree is not function','file':'point-tree'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					/*end tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'end point-tree-void transfer','file':'point-tree'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
			}
			else if($('.verpsw input[name="type"]').val()=='void'){//作廢帳單
				var nowbizdate=$('.salevoid #date').html();
				var voidbizdate=$('.salevoid #date').html();
				var voidconsecnumber=$('.salevoid #listno input[name="consecnumber"]').val();
				if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
					var posdvrfile='';
				}
				else{
				}
				$.ajax({
					url:'./lib/js/salevoid.ajax.php',
					method:'post',
					data:{'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'bizdate':$('.salevoid #date').html(),'createdatetime':$('.salevoid #credate').val(),'consecnumber':$('.salevoid #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val()},
					dataType:'html',
					success:function(d){
						console.log(d);
						var temp=d.split('-');
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'creditcard salevoid.ajax.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						if(temp[0]=='success'){
							//console.log($('.salevoid #list #listcontent input[name="invnumber"]').val());
							$.ajax({
								url:'./lib/js/deleteinv.ajax.php',
								method:'post',
								data:{'bizdate':$('.salevoid #date').html(),'number':$('.salevoid #list input[name="invnumber"]').val()},
								dataType:'html',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'creditcard deleteinv.ajax.php '+d},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									//console.log(d);
									//2017/12/4var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
									//2017/12/4mywin.document.title='cashdrawer';
								},
								error:function(e){
									//console.log(e);
								}
							});
							$('.order#order #billfun #billfun2 #salevoid').trigger('click');
							$('.salevoid #listno').html('');
							$('.salevoid #list #listcontent').html('');
							$('.salevoid #date').html('');
							$('.salevoid #credate').html('');
							if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
								var posdvrfile=temp[1];
							}
							else{
							}
						}
						else{
							//console.log(d);
						}
						verpsw.dialog('close');
					},
					error:function(e){
						//console.log(e);
					}
				});
				$.ajax({
					url:'./lib/js/create.cmdtxt.php',
					method:'post',
					async: false,
					data:{'cmd':nowbizdate.substr(0,6)+'-change'},
					dataType:'html',
					success:function(d){
						//console.log(d);
					},
					error:function(e){
						//console.log(e);
					}
				});
				/*錢都錄借接*/
				if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
					/*start tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						async:false,
						data:{'html':'start posdvr-sendmessage','file':'posdvr'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){console.log(e);}
					});
					if(typeof api_sendmessage_posdvr!=="undefined"&&typeof api_sendmessage_posdvr==="function"){
						api_sendmessage_posdvr(posdvrfile);
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'success','file':'posdvr'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							async:false,
							data:{'html':'error sendmessage is not function','file':'posdvr'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					/*end tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						async:false,
						data:{'html':'end posdvr-sendmessage','file':'posdvr'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				/*集點樹收點流程*/
				if($('.order#order .initsetting #pointtree').length>0&&$('.order#order .initsetting #pointtree').val()=='1'){
					/*start tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'start point-tree-void transfer','file':'point-tree'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
					if(typeof api_void_pointtree!=="undefined"&&typeof api_void_pointtree==="function"){
						var voidres=api_void_pointtree(voidbizdate,voidconsecnumber);
						if(voidres==''){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'point-tree-void voidpoint 意外錯誤','file':'point-tree'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else if(typeof voidres['data']!=="undefined"){//success
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'pass point-tree-void transfer -PHP_EOL-pos_token_tx_id:'+voidres['data']['pos_token_tx_id']+'-PHP_EOL-store_balance:'+voidres['data']['store_balance']+'-PHP_EOL-user_balance:'+voidres['data']['user_balance'],'file':'point-tree'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
							var message=JSON.parse(voidres['responseText']);
							if(voidres['status']==='timeout'){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'point-tree-void transfer timeout','file':'point-tree'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else if(voidres['status']=='400'||voidres['status']=='406'){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'point-tree-void transfer error -PHP_EOL-status:'+voidres['status']+'-PHP_EOL-code:'+message['errors'][0]['code']+'-PHP_EOL-message:'+message['errors'][0]['message'],'file':'point-tree'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'point-tree-void transfer 意外錯誤','file':'point-tree'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
						}
					}
					else{
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							async:false,
							data:{'html':'api void pointtree is not function','file':'point-tree'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					/*end tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'end point-tree-void transfer','file':'point-tree'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
			}
			else if($('.verpsw input[name="type"]').val()=='viewvoid'){//暫結作廢
				if($.trim($('.viewtemp #salelist #salecontent .listitems#focus div:eq(3)').html()).length!=0){//檢查是否已開立發票
					var hint=confirm('請確認發票正本已收回。');
					if(hint==true){
						var nowbizdate=$('.viewtemp #date').html();
						if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
							var posdvrfile='';
						}
						else{
						}
						$.ajax({
							url:'./lib/js/viewvoid.ajax.php',
							method:'post',
							data:{'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val()},
							dataType:'html',
							success:function(d){
								var tempres=d.split('-');
								if(d.length>20){
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										data:{'html':'viewtemp-viewvoid viewvoid.ajax.php '+d},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
								}
								else{
								}
								if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
									var posdvrfile=tempres[1];
								}
								else{
								}
								//console.log(d);
								if(tempres[0]=='success'){
									$.ajax({//作廢發票
										url:'./lib/js/deleteinv.ajax.php',
										method:'post',
										data:{'bizdate':$('.viewtemp #date').html(),'number':$('.viewtemp #salelist #salecontent .listitems#focus div:eq(3)').html()},
										dataType:'html',
										success:function(d){
											if(d.length>20){
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													data:{'html':'viewtemp-viewvoid deleteinv.ajax.php '+d},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else{
											}
											//console.log(d);
											$('.viewtemp #salelist #salecontent .listitems').prop('id','');
											$('.viewtemp #listno').html('');
											$('.viewtemp #list #listcontent').html('');
											$('.viewtemp #date').html('');
											$('.viewtemp #credate').html('');
											$('.viewtemp #otherfun button#plus').prop('disabled',true);
											$('.viewtemp #otherfun button#openinv').prop('disabled',true);
											$('.viewtemp #viewvoid').prop('disabled',true);
											$('.viewtemp #fun button#forall').prop('disabled',true);
											$('.viewtemp #fun button#list').prop('disabled',true);
											$('.viewtemp #fun button#tag').prop('disabled',true);
											$('.viewtemp #fun button#kitchen').prop('disabled',true);
											$('.viewtemp #fun button#changecheck').prop('disabled',true);
											verpsw.dialog('close');
											$('.order#order #MemberBill #list #funbox #view').trigger('click');
											//2017/12/29var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
											//2017/12/29mywin.document.title='cashdrawer';
										},
										error:function(e){
											//console.log(e);
										}
									});
								}
								else{
									//console.log(d);
								}
							},
							error:function(e){
								//console.log(e);
							}
						});
						/*錢都錄借接*/
						if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
							/*start tag*/
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'start posdvr-sendmessage','file':'posdvr'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){console.log(e);}
							});
							if(typeof api_sendmessage_posdvr!=="undefined"&&typeof api_sendmessage_posdvr==="function"){
								api_sendmessage_posdvr(posdvrfile);
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'success','file':'posdvr'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'error sendmessage is not function','file':'posdvr'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							/*end tag*/
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'end posdvr-sendmessage','file':'posdvr'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						$.ajax({
							url:'./lib/js/create.cmdtxt.php',
							method:'post',
							async: false,
							data:{'cmd':nowbizdate.substr(0,6)+'-change'},
							dataType:'html',
							success:function(d){
								//console.log(d);
							},
							error:function(e){
								//console.log(e);
							}
						});
					}
					else{
					}
				}
				else{
					var nowbizdate=$('.viewtemp #date').html();
					if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
						var posdvrfile='';
					}
					else{
					}
					$.ajax({
						url:'./lib/js/viewvoid.ajax.php',
						method:'post',
						data:{'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val()},
						dataType:'html',
						success:function(d){
							var tempres=d.split('-');
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'viewtemp-viewvoid viewvoid.ajax.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
								var posdvrfile=tempres[1];
							}
							else{
							}
							console.log(d);
							$('.viewtemp #salelist #salecontent .listitems').prop('id','');
							$('.viewtemp #listno').html('');
							$('.viewtemp #list #listcontent').html('');
							$('.viewtemp #date').html('');
							$('.viewtemp #credate').html('');
							$('.viewtemp #otherfun button#plus').prop('disabled',true);
							$('.viewtemp #otherfun button#openinv').prop('disabled',true);
							$('.viewtemp #viewvoid').prop('disabled',true);
							$('.viewtemp #fun button#forall').prop('disabled',true);
							$('.viewtemp #fun button#list').prop('disabled',true);
							$('.viewtemp #fun button#tag').prop('disabled',true);
							$('.viewtemp #fun button#kitchen').prop('disabled',true);
							$('.viewtemp #fun button#changecheck').prop('disabled',true);
							verpsw.dialog('close');
							$('.order#order #MemberBill #list #funbox #view').trigger('click');
						},
						error:function(e){
							//console.log(e);
						}
					});
					/*錢都錄借接*/
					if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
						/*start tag*/
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							async:false,
							data:{'html':'start posdvr-sendmessage','file':'posdvr'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){console.log(e);}
						});
						if(typeof api_sendmessage_posdvr!=="undefined"&&typeof api_sendmessage_posdvr==="function"){
							api_sendmessage_posdvr(posdvrfile);
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'success','file':'posdvr'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'error sendmessage is not function','file':'posdvr'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						/*end tag*/
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							async:false,
							data:{'html':'end posdvr-sendmessage','file':'posdvr'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					$.ajax({
						url:'./lib/js/create.cmdtxt.php',
						method:'post',
						async: false,
						data:{'cmd':nowbizdate.substr(0,6)+'-change'},
						dataType:'html',
						success:function(d){
							//console.log(d);
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
			}
			else if($('.verpsw input[name="type"]').val()=='viewvoidbyemptylist'){//全部刪除後刪單
				var nowbizdate=$('.order#order #tabs4 #listform input[name="bizdate"]').val();
				if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
					var posdvrfile='';
				}
				else{
				}
				$.ajax({
					url:'./lib/js/create.voidtempdb.php',
					method:'post',
					async: false,
					data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tablenumber':$('.order#order #tabs4 #listform input[name="tablenumber"]').val(),'machine':$('.order#order .companydata #terminalnumber').val()},
					dataType:'html',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'void emptyitemsvoidlist create.voidtempdb.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						//console.log(d);
					},
					error:function(e){
						//console.log(e);
					}
				});
				if($('.order#order .initsetting #secview').val()=='1'){
					$.ajax({
						url:'../secview/cleartemp.ajax.php',
						async: false,
						dataType:'html',
						success:function(d){
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'temp cleartemp.ajax.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							//console.log(d);
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
				else{
				}
				$.ajax({
					url:'./lib/js/viewvoid.ajax.php',
					method:'post',
					data:{'terminalnumber':$('.order#order #tabs4 #listform input[name="machinetype"]').val(),'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val()},
					dataType:'html',
					success:function(d){
						var tempres=d.split('-');
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'view-void-by-empty-list viewvoid.ajax.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
							var posdvrfile=tempres[1];
						}
						else{
						}
						//console.log(d);
						verpsw.dialog('close');
						emptyitemsvoidlist.dialog('close');
						if($('.order#order .initsetting #controltable').val()=='1'){
							inittable.dialog('open');
							ClearWindow('','');
						}
						else{
							ClearWindow('','');
						}
					},
					error:function(e){
						//console.log(e);
					}
				});
				/*錢都錄借接*/
				if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
					/*start tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						async:false,
						data:{'html':'start posdvr-sendmessage','file':'posdvr'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){console.log(e);}
					});
					if(typeof api_sendmessage_posdvr!=="undefined"&&typeof api_sendmessage_posdvr==="function"){
						api_sendmessage_posdvr(posdvrfile);
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'success','file':'posdvr'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							async:false,
							data:{'html':'error sendmessage is not function','file':'posdvr'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					/*end tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						async:false,
						data:{'html':'end posdvr-sendmessage','file':'posdvr'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				$.ajax({
					url:'./lib/js/create.cmdtxt.php',
					method:'post',
					async: false,
					data:{'cmd':nowbizdate.substr(0,6)+'-change'},
					dataType:'html',
					success:function(d){
						//console.log(d);
					},
					error:function(e){
						//console.log(e);
					}
				});
			}
			else if($('.verpsw input[name="type"]').val()=='paper'){//列印報表
				if($('.historypaper select[name="paperlist"] option:selected').val()=='paper1'){
					$.ajax({
						url:'./lib/js/shift.paper.php',
						method:'post',
						async:false,
						data:{'papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
						dataType:'html',
						success:function(d){
							console.log(d);
						},
						error:function(e){
							console.log(e);
						}
					});
					verpsw.dialog('close');
				}
				else if($('.historypaper select[name="paperlist"] option:selected').val()=='paper2'){
					$.ajax({
						url:'./lib/js/hispaper2.php',
						method:'post',
						async:false,
						data:{'papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
						dataType:'html',
						success:function(d){
							console.log(d);
						},
						error:function(e){
							console.log(e);
						}
					});
					verpsw.dialog('close');
				}
				else if($('.historypaper select[name="paperlist"] option:selected').val()=='paper3'){
					$.ajax({
						url:'./lib/js/hispaper3.php',
						method:'post',
						async:false,
						data:{'papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
						dataType:'html',
						success:function(d){
							console.log(d);
						},
						error:function(e){
							console.log(e);
						}
					});
					verpsw.dialog('close');
				}
				else if($('.historypaper select[name="paperlist"] option:selected').val()=='paper4'){
					$.ajax({
						url:'./lib/js/hispaper4.php',
						method:'post',
						async:false,
						data:{'papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
						dataType:'html',
						success:function(d){
							console.log(d);
						},
						error:function(e){
							console.log(e);
						}
					});
					verpsw.dialog('close');
				}
				else{
				}
			}
			else if($('.verpsw input[name="type"]').val()=='viewpaper'){//瀏覽報表
				if($('.historypaper select[name="paperlist"] option:selected').val()=='paper1'){
					$.ajax({
						url:'./lib/js/shift.paper.php',
						method:'post',
						async:false,
						data:{'type':'view','papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
						dataType:'html',
						success:function(d){
							$('.viewpaper').html(d);
							viewpaper.dialog('open');
						},
						error:function(e){
							console.log(e);
						}
					});
					verpsw.dialog('close');
				}
				else if($('.historypaper select[name="paperlist"] option:selected').val()=='paper2'){
					$.ajax({
						url:'./lib/js/hispaper2.php',
						method:'post',
						async:false,
						data:{'type':'view','papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
						dataType:'html',
						success:function(d){
							$('.viewpaper').html(d);
							viewpaper.dialog('open');
						},
						error:function(e){
							console.log(e);
						}
					});
					verpsw.dialog('close');
				}
				else if($('.historypaper select[name="paperlist"] option:selected').val()=='paper3'){
					$.ajax({
						url:'./lib/js/hispaper3.php',
						method:'post',
						async:false,
						data:{'type':'view','papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
						dataType:'html',
						success:function(d){
							$('.viewpaper').html(d);
							viewpaper.dialog('open');
							console.log(d);
						},
						error:function(e){
							console.log(e);
						}
					});
					verpsw.dialog('close');
				}
				else if($('.historypaper select[name="paperlist"] option:selected').val()=='paper4'){
					$.ajax({
						url:'./lib/js/hispaper4.php',
						method:'post',
						async:false,
						data:{'type':'view','papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
						dataType:'html',
						success:function(d){
							$('.viewpaper').html(d);
							viewpaper.dialog('open');
							console.log(d);
						},
						error:function(e){
							console.log(e);
						}
					});
					verpsw.dialog('close');
				}
				else{
				}
			}
			else if($('.verpsw input[name="type"]').val()=='editpunch'){//修改打卡紀錄
				verpsw.dialog('close');
				editpunch.dialog('open');
			}
			else{
			}
		}
		else{
			$('.verpsw input[name="verpsw"]').val('');
			alert('密碼錯誤。');
		}
	});
	$('.verpsw #buttons').on('click','.input',function(){
		var index=$('.verpsw #buttons .input').index(this);
		$('.verpsw input[name="verpsw"]').val($('.verpsw input[name="verpsw"]').val()+$('.verpsw #buttons .input:eq('+index+')').val());
	});
	$('.verpsw #buttons').on('click','#change',function(){
		if($('.verpsw #buttons .input:eq(0)').val()=='7'){
			for(var i=0;i<12;i++){
				$('.verpsw #buttons .input:eq('+i+')').val(String.fromCharCode(parseInt(65)+parseInt(i)));
			}
			$('.verpsw #buttons .pre').prop('disabled',false);
			$('.verpsw #buttons .next').prop('disabled',false);
		}
		else{
			$('.verpsw #buttons .input:eq(0)').val('7');
			$('.verpsw #buttons .input:eq(1)').val('8');
			$('.verpsw #buttons .input:eq(2)').val('9');
			$('.verpsw #buttons .input:eq(3)').val('4');
			$('.verpsw #buttons .input:eq(4)').val('5');
			$('.verpsw #buttons .input:eq(5)').val('6');
			$('.verpsw #buttons .input:eq(6)').val('1');
			$('.verpsw #buttons .input:eq(7)').val('2');
			$('.verpsw #buttons .input:eq(8)').val('3');
			$('.verpsw #buttons .input:eq(9)').val('0');
			$('.verpsw #buttons .input:eq(10)').val('');
			$('.verpsw #buttons .input:eq(11)').val('');
			$('.verpsw #buttons .input:eq(0)').prop('disabled',false);
			$('.verpsw #buttons .input:eq(1)').prop('disabled',false);
			$('.verpsw #buttons .input:eq(2)').prop('disabled',false);
			$('.verpsw #buttons .input:eq(3)').prop('disabled',false);
			$('.verpsw #buttons .input:eq(4)').prop('disabled',false);
			$('.verpsw #buttons .input:eq(5)').prop('disabled',false);
			$('.verpsw #buttons .input:eq(6)').prop('disabled',false);
			$('.verpsw #buttons .input:eq(7)').prop('disabled',false);
			$('.verpsw #buttons .input:eq(8)').prop('disabled',false);
			$('.verpsw #buttons .input:eq(9)').prop('disabled',false);
			$('.verpsw #buttons .input:eq(10)').prop('disabled',true);
			$('.verpsw #buttons .input:eq(11)').prop('disabled',true);
			$('.verpsw #buttons .pre').prop('disabled',true);
			$('.verpsw #buttons .next').prop('disabled',true);
		}
	});
	$('.verpsw #buttons').on('click','#next',function(){
		if($('.verpsw #buttons .input:eq(0)').val()=='A'){
			for(var i=0;i<12;i++){
				$('.verpsw #buttons .input:eq('+i+')').val(String.fromCharCode(parseInt(65)+parseInt(i)+parseInt(12)));
				$('.verpsw #buttons .input:eq('+i+')').prop('disabled',false);
			}
		}
		else if($('.verpsw #buttons .input:eq(0)').val()=='M'){
			for(var i=0;i<2;i++){
				$('.verpsw #buttons .input:eq('+i+')').val(String.fromCharCode(parseInt(65)+parseInt(i)+parseInt(24)));
				$('.verpsw #buttons .input:eq('+i+')').prop('disabled',false);
			}
			for(var i=2;i<12;i++){
				$('.verpsw #buttons .input:eq('+i+')').val('');
				$('.verpsw #buttons .input:eq('+i+')').prop('disabled',true);
			}
		}
		else{
			for(var i=0;i<12;i++){
				$('.verpsw #buttons .input:eq('+i+')').val(String.fromCharCode(parseInt(65)+parseInt(i)));
				$('.verpsw #buttons .input:eq('+i+')').prop('disabled',false);
			}
		}
	});
	$('.verpsw #buttons').on('click','#pre',function(){
		if($('.verpsw #buttons .input:eq(0)').val()=='A'){
			for(var i=0;i<2;i++){
				$('.verpsw #buttons .input:eq('+i+')').val(String.fromCharCode(parseInt(65)+parseInt(i)+parseInt(24)));
				$('.verpsw #buttons .input:eq('+i+')').prop('disabled',false);
			}
			for(var i=2;i<12;i++){
				$('.verpsw #buttons .input:eq('+i+')').val('');
				$('.verpsw #buttons .input:eq('+i+')').prop('disabled',true);
			}
		}
		else if($('.verpsw #buttons .input:eq(0)').val()=='M'){
			for(var i=0;i<12;i++){
				$('.verpsw #buttons .input:eq('+i+')').val(String.fromCharCode(parseInt(65)+parseInt(i)));
				$('.verpsw #buttons .input:eq('+i+')').prop('disabled',false);
			}
		}
		else{
			for(var i=0;i<12;i++){
				$('.verpsw #buttons .input:eq('+i+')').val(String.fromCharCode(parseInt(65)+parseInt(i)+parseInt(12)));
				$('.verpsw #buttons .input:eq('+i+')').prop('disabled',false);
			}
		}
	});
	$('.verpsw #buttons').on('click','#ac',function(){
		$('.verpsw input[name="verpsw"]').val('');
	});
	var salelabel='';
	$('.salelist #list #listcontent').on('click','.label',function(){
		var index=$('.salelist #list #listcontent .label').index(this);
		salelabel=index;
		if($('.salelist #list #listcontent .label:eq('+index+')').prop('class')=='label focus'){
			$('.salelist #list #listcontent .label:eq('+index+')').addClass( "check" );
			$('.salelist #list #listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked',true);
		}
		else if($('.salelist #list #listcontent .label:eq('+index+')').prop('class')=='label check focus'||$('.salelist #list #listcontent .label:eq('+index+')').prop('class')=='label focus check'){
			$('.salelist #list #listcontent .label:eq('+index+')').removeClass( "check" );
			$('.salelist #list #listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked',false);
		}
		else{
			$('.salelist #list #listcontent .label').removeClass( "focus" );
			$('.salelist #list #listcontent .label:eq('+index+')').addClass( "focus" );
		}
	});
	$('.salelist #fun').on('click','#changecheck',function(){
		if($('.salelist #list #listcontent .label').length==$('.salelist #list #listcontent .label input[id^="checkbox"]:checked').length||$('.salelist #list #listcontent .label input[id^="checkbox"]:checked').length==0){
			if($('.salelist #list #listcontent .label input[id^="checkbox"]:checked').length>0){
				$('.salelist #list #listcontent .label input[id^="checkbox"]').prop('checked',false);
				$('.salelist #list #listcontent .label').removeClass('check');
			}
			else{
				$('.salelist #list #listcontent .label input[id^="checkbox"]').prop('checked',true);
				$('.salelist #list #listcontent .label').addClass('check');
			}
		}
		else{
			for(var i=0;i<$('.salelist #list #listcontent .label').length;i++){
				if($('.salelist #list #listcontent .label:eq('+i+') input[id^="checkbox"]').prop('checked')){
					$('.salelist #list #listcontent .label:eq('+i+') input[id^="checkbox"]').prop('checked',false);
					$('.salelist #list #listcontent .label').removeClass('check');
				}
				else{
					$('.salelist #list #listcontent .label:eq('+i+') input[id^="checkbox"]').prop('checked',true);
					$('.salelist #list #listcontent .label').addClass('check');
				}
			}
		}
	});
	$('.salelist').on('click','#reorder',function(){
		$('.salelist #reorder').prop('disabled',true);
		if($('.order#order .initsetting #voidsale').val()=='0'){
			var nowbizdate=$('.salelist #date').html();
			$.ajax({
				url:'./lib/js/checkopen.ajax.php',
				async:false,
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'reorder checkopen.ajax.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
					if(d=='success'){
						if($('.salelist #date').html()!=''){
							var listtype='';
							var tabnum='';
							var consecnumber='';
							if($.trim($('.salelist #salelist #salecontent .listitems#focus div:eq(3)').html()).length!=0){//檢查是否開立發票
								//console.log('void inv');
								var hint=confirm('該帳單已開發票，如要修改請確認發票正本已收回。');
								if(hint==true){
									$.ajax({//作廢帳單
										url:'./lib/js/salevoid.ajax.php',
										method:'post',
										data:{'bizdate':$('.salelist #date').html(),'createdatetime':$('.salelist #credate').val(),'consecnumber':$('.salelist #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'remarks':'editsale'},
										dataType:'html',
										success:function(d){
											console.log(d);
											if(d.length>20){
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													data:{'html':'reorder salevoid.ajax.php '+d},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else{
											}
											if(d.substr(0,7)=='success'){
												$.ajax({//作廢發票
													url:'./lib/js/deleteinv.ajax.php',
													method:'post',
													data:{'bizdate':$('.salelist #date').html(),'number':$('.salelist #salelist #salecontent .listitems#focus div:eq(3)').html()},
													dataType:'html',
													success:function(d){
														if(d.length>20){
															$.ajax({
																url:'./lib/js/print.php',
																method:'post',
																data:{'html':'reorder deleteinv.ajax.php '+d},
																dataType:'html',
																success:function(d){/*console.log(d);*/},
																error:function(e){/*console.log(e);*/}
															});
														}
														else{
														}
														//console.log(d);
														//2017/12/29var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
														//2017/12/29mywin.document.title='cashdrawer';
													},
													error:function(e){
														//console.log(e);
													}
												});
											}
											else{
												//console.log(d);
											}
											$.ajax({//利用暫結加點功能將產品撈出(資料從正式表格複製一份至暫存表格)
												url:'./lib/js/copysale.ajax.php',
												method:'post',
												data:{'bizdate':$('.salelist #date').html(),'createdatetime':$('.salelist #credate').val(),'consecnumber':$('.salelist #listno input[name="consecnumber"]').val(),'code':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'name':$('.order#order #tabs4 #listform input[name="username"]').val()},
												dataType:'html',
												success:function(d){
													if(d.length>20){
														$.ajax({
															url:'./lib/js/print.php',
															method:'post',
															data:{'html':'reorder copysale.ajax.php '+d},
															dataType:'html',
															success:function(d){/*console.log(d);*/},
															error:function(e){/*console.log(e);*/}
														});
													}
													else{
													}
													var t=d.split('-');
													//console.log(t);
													listtype=t[t.length-3];
													bizdate=t[t.length-2];
													consecnumber=t[t.length-1];
													//console.log(d);

													temporder(bizdate,consecnumber,$('.order#order #tabs4 #listform input[name="machinetype"]').val(),$('.order#order .companydata #company').val(),$('.order#order #tabs4 #listform input[name="usercode"]').val(),$('.order#order #tabs4 #listform input[name="username"]').val());
													//location.href='./order.php?usercode='+$('.order#order #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #tabs4 #listform input[name="username"]').val()+'&listtype='+listtype+'&tabnum&bizdate='+bizdate+'&consecnumber='+consecnumber;
													$('.salelist #editpay').prop('disabled',true);
													$('.salelist #reorder').prop('disabled',true);
													$('.salelist #reinv').prop('disabled',true);
													$('.salelist #rekvm').prop('disabled',true);
													$('.salelist #salelist #salecontent .listitems').prop('id','');
													$('.salelist #listno').html('');
													$('.salelist #list #listcontent').html('');
													$('.salelist #date').html('');
													$('.salelist #credate').html('');
													$('.salelist #fun button#forall').prop('disabled',true);
													$('.salelist #fun button#list').prop('disabled',true);
													$('.salelist #fun button#tag').prop('disabled',true);
													$('.salelist #fun button#kitchen').prop('disabled',true);
													$('.salelist #fun button#changecheck').prop('disabled',true);
													salelist.dialog('close');
													if(!$('.order#order #billfun #billfun1button').prop('disabled')){
														$('.order#order #billfun #billfun1button').trigger('click');
													}
													else{
													}
												},
												error:function(e){
													//console.log(e);
												}
											});
										},
										error:function(e){
											//console.log(e);
										}
									});
								}
								else{
									$('.salelist #reorder').prop('disabled',false);
								}
							}
							else{
								$.ajax({//作廢帳單
									url:'./lib/js/salevoid.ajax.php',
									method:'post',
									data:{'bizdate':$('.salelist #date').html(),'createdatetime':$('.salelist #credate').val(),'consecnumber':$('.salelist #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'remarks':'editsale'},
									dataType:'html',
									success:function(d){
										if(d.length>20){
											$.ajax({
												url:'./lib/js/print.php',
												method:'post',
												data:{'html':'reorder salevoid.ajax.php '+d},
												dataType:'html',
												success:function(d){/*console.log(d);*/},
												error:function(e){/*console.log(e);*/}
											});
										}
										else{
										}
										if(d.substr(0,7)=='success'){
											$.ajax({//作廢發票
												url:'./lib/js/deleteinv.ajax.php',
												method:'post',
												data:{'bizdate':$('.salelist #date').html(),'number':$('.salelist #salelist #salecontent .listitems#focus div:eq(3)').html()},
												dataType:'html',
												success:function(d){
													if(d.length>20){
														$.ajax({
															url:'./lib/js/print.php',
															method:'post',
															data:{'html':'reorder deleteinv.ajax.php '+d},
															dataType:'html',
															success:function(d){/*console.log(d);*/},
															error:function(e){/*console.log(e);*/}
														});
													}
													else{
													}
													//console.log(d);
													//2017/12/29var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
													//2017/12/29mywin.document.title='cashdrawer';
												},
												error:function(e){
													//console.log(e);
												}
											});
										}
										else{
											//console.log(d);
										}
										$.ajax({//利用暫結加點功能將產品撈出(資料從正式表格複製一份至暫存表格)
											url:'./lib/js/copysale.ajax.php',
											method:'post',
											data:{'bizdate':$('.salelist #date').html(),'createdatetime':$('.salelist #credate').val(),'consecnumber':$('.salelist #listno input[name="consecnumber"]').val(),'code':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'name':$('.order#order #tabs4 #listform input[name="username"]').val()},
											dataType:'html',
											success:function(d){
												if(d.length>20){
													$.ajax({
														url:'./lib/js/print.php',
														method:'post',
														data:{'html':'reorder copysale.ajax.php '+d},
														dataType:'html',
														success:function(d){/*console.log(d);*/},
														error:function(e){/*console.log(e);*/}
													});
												}
												else{
												}
												var t=d.split('-');
												//console.log(t);
												listtype=t[t.length-3];
												bizdate=t[t.length-2];
												consecnumber=t[t.length-1];
												console.log(d);

												temporder(bizdate,consecnumber,$('.order#order #tabs4 #listform input[name="machinetype"]').val(),$('.order#order .companydata #company').val(),$('.order#order #tabs4 #listform input[name="usercode"]').val(),$('.order#order #tabs4 #listform input[name="username"]').val());
												//location.href='./order.php?usercode='+$('.order#order #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #tabs4 #listform input[name="username"]').val()+'&listtype='+listtype+'&tabnum&bizdate='+bizdate+'&consecnumber='+consecnumber;
												$('.salelist #editpay').prop('disabled',true);
												$('.salelist #reorder').prop('disabled',true);
												$('.salelist #reinv').prop('disabled',true);
												$('.salelist #rekvm').prop('disabled',true);
												$('.salelist #salelist #salecontent .listitems').prop('id','');
												$('.salelist #listno').html('');
												$('.salelist #list #listcontent').html('');
												$('.salelist #date').html('');
												$('.salelist #credate').html('');
												$('.salelist #fun button#forall').prop('disabled',true);
												$('.salelist #fun button#list').prop('disabled',true);
												$('.salelist #fun button#tag').prop('disabled',true);
												$('.salelist #fun button#kitchen').prop('disabled',true);
												$('.salelist #fun button#changecheck').prop('disabled',true);
												salelist.dialog('close');
												if(!$('.order#order #billfun #billfun1button').prop('disabled')){
													$('.order#order #billfun #billfun1button').trigger('click');
												}
												else{
												}
											},
											error:function(e){
												//console.log(e);
											}
										});
									},
									error:function(e){
										//console.log(e);
									}
								});
							}
						}
						else{
						}
						$.ajax({
							url:'./lib/js/create.cmdtxt.php',
							method:'post',
							async: false,
							data:{'cmd':nowbizdate.substr(0,6)+'-change'},
							dataType:'html',
							success:function(d){
								//console.log(d);
							},
							error:function(e){
								//console.log(e);
							}
						});
					}
					else{
						alert('目前尚未開班，請確認是否開班或重啟系統。');
					}
				},
				error:function(e){
					//console.log(e);
				}
			});
		}
		else{
			//console.log('1');
			$('.verpsw input[name="type"]').val('editlist');
			verpsw.dialog('open');
			$('.salelist #reorder').prop('disabled',false);
		}
	});
	$('.salelist').on('click','#editpay',function(){
		$('.salelist #editpay').prop('disabled',true);
		$.ajax({
			url:'./lib/js/checkopen.ajax.php',
			async:false,
			dataType:'html',
			success:function(d){
				if(d.length>20){
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'editpay checkopen.ajax.php '+d},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				//console.log(d);
				if(d=='success'){
					$.ajax({
						url:'./lib/js/getpay.ajax.php',
						method:'post',
						async: false,
						data:{'bizdate':$('.salelist #date').html(),'consecnumber':$('.salelist #listno input[name="consecnumber"]').val()},
						dataType:'html',
						success:function(d){
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'editpay getpay.ajax.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							var temp=d.split("-");
							var otherfix=0;
							console.log(d);
							$('.editpay #viewwindow input[name="bizdate"]').val(temp[temp.length-3]);
							$('.editpay #viewwindow input[name="consecnumber"]').val(temp[temp.length-2]);
							$('.editpay #viewwindow input[name="usercode"]').val($('.order#order #tabs4 #listform input[name="usercode"]').val());
							$('.editpay #viewwindow input[name="username"]').val($('.order#order #tabs4 #listform input[name="username"]').val());
							$('.editpay #viewwindow #should').html(temp[0]);
							$('.editpay #viewwindow input[name="should"]').val(temp[0]);
							$('.editpay #viewwindow #cashcomm').html(temp[4]);
							$('.editpay #viewwindow input[name="cashcomm"]').val(temp[4]);
							$('.editpay #viewwindow #already').html(Number(temp[0])+Number(temp[4]));
							$('.editpay #viewwindow input[name="already"]').val(Number(temp[0])+Number(temp[4]));
							$('.editpay #viewwindow #cashmoney').html(temp[1]);
							$('.editpay #viewwindow input[name="cashmoney"]').val(temp[1]);
							$('.editpay #viewwindow #cash').html(temp[2]);
							$('.editpay #viewwindow input[name="cash"]').val(temp[2]);
							for(var i=15;i<(temp.length-5);i++){
								var payname=temp[i].split(":");
								if(payname[1]=='0'){
								}
								else{
									var tempmoney=payname[1].split("=");
									otherfix=Number(otherfix)+Number(tempmoney[1]);
								}
							}
							$('.editpay #viewwindow #other').html(Number(temp[3])-Number(otherfix));
							$('.editpay #viewwindow input[name="other"]').val(temp[3]-Number(otherfix));
							$('.editpay #viewwindow #otherfix').html(Number(otherfix));
							$('.editpay #viewwindow input[name="otherfix"]').val(Number(otherfix));
							$('.editpay #viewwindow #nontax').val(temp[temp.length-5]);
							if(Number(temp[1])>0){
								$('.editpay #viewwindow #editpaywindow #paycontent').append("<div class='paywaybox' style='width:calc(100% - 20px);overflow:hidden;'><div style='width:20px;height:19px;float:left;'><input type='checkbox' name='checkbox'></div><div class='payway' style='overflow:hidden;'><div style='width:calc(50% - 10px);float:left;text-align:left;'><span id='name1'>"+$('.editpay #moneybut').html()+"</span></div><div style='width:calc(50% - 10px);float:left;text-align:right;'>"+$('.result .frontunit').val()+"<span class='paymoney'>"+temp[1]+"</span>"+$('.result .unit').val()+"</div></div></div>");
							}
							else{
							}
							if(Number(temp[2])>0){
								$('.editpay #viewwindow #editpaywindow #paycontent').append("<div class='paywaybox' style='width:calc(100% - 20px);overflow:hidden;'><div style='width:20px;height:19px;float:left;'><input type='checkbox' name='checkbox'></div><div class='payway' style='overflow:hidden;'><div style='width:calc(50% - 10px);float:left;text-align:left;'><span id='name1'>"+$('.editpay #cashbut').html()+"</span></div><div style='width:calc(50% - 10px);float:left;text-align:right;'>"+$('.result .frontunit').val()+"<span class='paycash'>"+temp[2]+"</span>"+$('.result .unit').val()+"<input type='hidden' id='inputmoney' value='"+(Number(temp[2])-Number(temp[4]))+"'><input type='hidden' class='commission' value='"+temp[4]+"'></div></div></div>");
							}
							else{
							}
							if(Number(temp[3])>0){
								for(var i=0;i<10;i++){
									var sptemp=temp[5+Number(i)].split(":");
									if(sptemp[1].match("=")){
										var pointmoney=sptemp[1].split("=");
										$('.editpay #viewwindow #editpaywindow #paycontent').append("<div class='paywaybox' style='width:calc(100% - 20px);overflow:hidden;'><div style='width:20px;height:19px;float:left;'><input type='checkbox' name='checkbox'></div><div class='payway' style='overflow:hidden;'><div style='width:calc(50% - 10px);float:left;text-align:left;'><span id='name1'>"+$('.paywindow #'+sptemp[0]).html()+"</span></div><div style='width:calc(50% - 10px);float:left;text-align:right;'>"+$('.result .frontunit').val()+"<span class='otherpay' id='"+$('.paywindow #'+sptemp[0]+' input[name="location"]').val()+"-"+sptemp[0]+"'>"+pointmoney[1]+"</span>"+$('.result .unit').val()+"</div></div></div>");
										if($('.editpay #viewwindow input[name="otherstring"]').val()==''){
											$('.editpay #viewwindow input[name="otherstring"]').val($('.paywindow #'+sptemp[0]+' input[name="location"]').val()+"-"+sptemp[0]+":"+sptemp[1]);
										}
										else{
											$('.editpay #viewwindow input[name="otherstring"]').val($('.editpay #viewwindow input[name="otherstring"]').val()+","+$('.paywindow #'+sptemp[0]+' input[name="location"]').val()+"-"+sptemp[0]+":"+sptemp[1]);
										}
									}
									else if(Number(sptemp[1])>0){
										$('.editpay #viewwindow #editpaywindow #paycontent').append("<div class='paywaybox' style='width:calc(100% - 20px);overflow:hidden;'><div style='width:20px;height:19px;float:left;'><input type='checkbox' name='checkbox'></div><div class='payway' style='overflow:hidden;'><div style='width:calc(50% - 10px);float:left;text-align:left;'><span id='name1'>"+$('.paywindow #'+sptemp[0]).html()+"</span></div><div style='width:calc(50% - 10px);float:left;text-align:right;'>"+$('.result .frontunit').val()+"<span class='otherpay' id='"+$('.paywindow #'+sptemp[0]+' input[name="location"]').val()+"-"+sptemp[0]+"'>"+sptemp[1]+"</span>"+$('.result .unit').val()+"</div></div></div>");
										if($('.editpay #viewwindow input[name="otherstring"]').val()==''){
											$('.editpay #viewwindow input[name="otherstring"]').val($('.paywindow #'+sptemp[0]+' input[name="location"]').val()+"-"+sptemp[0]+":"+sptemp[1]);
										}
										else{
											$('.editpay #viewwindow input[name="otherstring"]').val($('.editpay #viewwindow input[name="otherstring"]').val()+","+$('.paywindow #'+sptemp[0]+' input[name="location"]').val()+"-"+sptemp[0]+":"+sptemp[1]);
										}
									}
									else{
									}
								}
								for(var i=15;i<(temp.length-5);i++){
									var payname=temp[i].split(":");
									var pointmoney=payname[1].split("=");
									if(payname[1]=='0'){
									}
									else{
										$('.editpay #viewwindow #editpaywindow #paycontent').append("<div class='paywaybox' style='width:calc(100% - 20px);overflow:hidden;'><div style='width:20px;height:19px;float:left;'><input type='checkbox' name='checkbox'></div><div class='payway' style='overflow:hidden;'><div style='width:calc(50% - 10px);float:left;text-align:left;'><span id='name1'>"+$('.paywindow .'+payname[0]).html()+"</span></div><div style='width:calc(50% - 10px);float:left;text-align:right;'>"+$('.result .frontunit').val()+"<span class='otherpay' id='"+$('.paywindow .'+payname[0]+' input[name="location"]').val()+"-value'>"+pointmoney[0]+"<input type='hidden' name='initview' value='"+pointmoney[0]+"'><input type='hidden' name='viewmoney' value='"+pointmoney[1]+"'><input type='hidden' name='inv' value='"+$('.paywindow .'+payname[0]+' input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$('.paywindow .'+payname[0]+' input[name="type"]').val()+"'></span>"+$('.result .unit').val()+"</div></div></div>");
										if($('.editpay #viewwindow input[name="otherstring"]').val()==''){
											$('.editpay #viewwindow input[name="otherstring"]').val(payname[0]+"-value"+":"+pointmoney[0]+"="+pointmoney[1]);
										}
										else{
											$('.editpay #viewwindow input[name="otherstring"]').val($('.editpay #viewwindow input[name="otherstring"]').val()+","+payname[0]+"-value"+":"+pointmoney[0]+"="+pointmoney[1]);
										}
									}
								}
								if(Number(temp[temp.length-5])>0){
									$('.editpay #viewwindow #editpaywindow #paycontent').append("<div class='paywaybox' style='width:calc(100% - 20px);overflow:hidden;'><div style='width:20px;height:19px;float:left;'><input type='checkbox' name='checkbox'></div><div class='payway' style='overflow:hidden;'><div style='width:calc(50% - 10px);float:left;text-align:left;'><span id='name1'>"+$('.paywindow #NONTAX').html()+"</span></div><div style='width:calc(50% - 10px);float:left;text-align:right;'>"+$('.result .frontunit').val()+"<span class='otherpay' id='NONTAX'>"+temp[temp.length-5]+"</span>"+$('.result .unit').val()+"</div></div></div>");
									if($('.editpay #viewwindow input[name="otherstring"]').val()==''){
										$('.editpay #viewwindow input[name="otherstring"]').val("NONTAX:"+temp[temp.length-5]);
									}
									else{
										$('.editpay #viewwindow input[name="otherstring"]').val($('.editpay #viewwindow input[name="otherstring"]').val()+",NONTAX:"+temp[temp.length-5]);
									}
								}
								else{
								}
							}
							else{
							}
							editpay.dialog('open');
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
				else{
					alert('目前尚未開班，請確認是否開班或重啟系統。');
					$('.salelist #editpay').prop('disabled',false);
				}
			},
			error:function(e){
				//console.log(e);
			}
		});
		$('.salelist #editpay').prop('disabled',false);
	});
	$('.salelist #fun').on('click','#forall',function(){
		var index='';
		var qty='';
		var inumber='';
		for(var i=0;i<$('.salelist #list #listcontent .label').length;i++){
			if(index.length==0){
				index=index+$('.salelist #list #listcontent .label:eq('+i+') div:eq(1)').html();
				qty=qty+$('.salelist #list #listcontent .label:eq('+i+') div:eq(4)').html();
				inumber=inumber+$('.salelist #list #listcontent .label:eq('+i+') input[name="inumber"]').val();
			}
			else{
				index=index+','+$('.salelist #list #listcontent .label:eq('+i+') div:eq(1)').html();
				qty=qty+','+$('.salelist #list #listcontent .label:eq('+i+') div:eq(4)').html();
				inumber=inumber+','+$('.salelist #list #listcontent .label:eq('+i+') input[name="inumber"]').val();
			}
		}
		$.ajax({
			url:'./lib/js/reprint.ajax.php',
			method:'post',
			data:{'company':$('.order#order .companydata #company').val(),'type':'all','listtype':$('.salelist input[name="listtype"]').val(),'no':$('.salelist #listno input[name="consecnumber"]').val(),'bizdate':$('.salelist #date').html(),'date':$('.salelist #credate').val(),'index':index,'qty':qty,'inumber':inumber,'machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val(),'username':$('.order#order #tabs4 #listform input[name="username"]').val()},
			dataType:'html',
			success:function(d){
				if(d.length>20){
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'reprint-forall reprint.ajax.php '+d},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				//2017/12/4var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
				//2017/12/4mywin.document.title='cashdrawer';
				//console.log(d);
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.salelist #fun').on('click','#list',function(){
		var index='';
		var qty='';
		$.ajax({
			url:'./lib/js/reprint.ajax.php',
			method:'post',
			data:{'type':'list','no':$('.salelist #listno input[name="consecnumber"]').val(),'bizdate':$('.salelist #date').html(),'date':$('.salelist #credate').val(),'index':index,'qty':qty,'machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val(),'username':$('.order#order #tabs4 #listform input[name="username"]').val()},
			dataType:'html',
			success:function(d){
				if(d.length>20){
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'reprint-list reprint.ajax.php '+d},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				console.log(d);
				//2017/12/4var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
				//2017/12/4mywin.document.title='cashdrawer';
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.salelist #fun').on('click','#tag',function(){
		var index='';
		var qty='';
		for(var i=0;i<$('.salelist #list #listcontent .label').length;i++){
			if($('.salelist #list #listcontent .label:eq('+i+') input[id^="checkbox"]').prop('checked')){
				if(index.length==0){
					index=index+$('.salelist #list #listcontent .label:eq('+i+') input[name="linenumber"]').val()+','+('00'+(Number($('.salelist #list #listcontent .label:eq('+i+') input[name="linenumber"]').val())+1)).substr(3-(Number($('.salelist #list #listcontent .label:eq('+i+') input[name="linenumber"]').val())+1).length);
					qty=qty+$('.salelist #list #listcontent .label:eq('+i+') div:eq(4)').html();
				}
				else{
					index=index+','+$('.salelist #list #listcontent .label:eq('+i+') input[name="linenumber"]').val()+','+('00'+(Number($('.salelist #list #listcontent .label:eq('+i+') input[name="linenumber"]').val())+1)).substr(3-(Number($('.salelist #list #listcontent .label:eq('+i+') input[name="linenumber"]').val())+1).length);
					qty=qty+','+$('.salelist #list #listcontent .label:eq('+i+') div:eq(4)').html();
				}
			}
			else{
			}
		}
		$.ajax({
			url:'./lib/js/reprint.ajax.php',
			method:'post',
			data:{'type':'tag','no':$('.salelist #listno input[name="consecnumber"]').val(),'bizdate':$('.salelist #date').html(),'date':$('.salelist #credate').val(),'index':index,'qty':qty},
			dataType:'html',
			success:function(d){
				if(d.length>20){
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'reprint-tag reprint.ajax.php '+d},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				console.log(d);
				//2017/12/4var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
				//2017/12/4mywin.document.title='cashdrawer';
			},
			error:function(e){
				console.log(e);
			}
		});
	});
	$('.salelist #fun').on('click','#kitchen',function(){
		var inumber='';
		var qty='';
		var index='';
		for(var i=0;i<$('.salelist #list #listcontent .label').length;i++){
			if($('.salelist #list #listcontent .label:eq('+i+') input[id^="checkbox"]').prop('checked')){
				if(inumber.length==0){
					index=index+$('.salelist #list #listcontent .label:eq('+i+') div:eq(1)').html();
					inumber=inumber+$('.salelist #list #listcontent .label:eq('+i+') input[name="inumber"]').val();
					qty=qty+$('.salelist #list #listcontent .label:eq('+i+') div:eq(4)').html();
				}
				else{
					index=index+','+$('.salelist #list #listcontent .label:eq('+i+') div:eq(1)').html();
					inumber=inumber+','+$('.salelist #list #listcontent .label:eq('+i+') input[name="inumber"]').val();
					qty=qty+','+$('.salelist #list #listcontent .label:eq('+i+') div:eq(4)').html();
				}
			}
			else{
			}
		}
		$.ajax({
			url:'./lib/js/reprint.ajax.php',
			method:'post',
			data:{'company':$('.order#order .companydata #company').val(),'type':'kitchen','listtype':$('.salelist input[name="listtype"]').val(),'no':$('.salelist #listno input[name="consecnumber"]').val(),'bizdate':$('.salelist #date').html(),'date':$('.salelist #credate').val(),'inumber':inumber,'qty':qty,'index':index,'username':$('.order#order #tabs4 #listform input[name="username"]').val()},
			dataType:'html',
			success:function(d){
				if(d.length>20){
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'reprint-kitchen reprint.ajax.php '+d},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				//console.log(d);
				//2017/12/4var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
				//2017/12/4mywin.document.title='cashdrawer';
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.salelist #fun').on('click','#prebizdate',function(){
		$.ajax({
			url:'./lib/js/getsalelist.ajax.php',
			method:'post',
			data:{'bizdate':$('.salelist #salelist #salecontent #bizdate').val(),'type':'-','sale':'sale'},
			dataType:'html',
			success:function(d){
				$('.salelist #salelist #salecontent').html(d);
				$('.salelist #listno').html('');
				$('.salelist #list #listcontent').html('');
				$('.salelist #date').html('');
				$('.salelist #credate').html('');
				$('.salelist #fun #tag').prop('disabled',true);
				$('.salelist #fun button#list').prop('disabled',true);
				$('.salelist #fun #kitchen').prop('disabled',true);
				$('.salelist #fun #forall').prop('disabled',true);
				$('.salelist #fun #changecheck').prop('disabled',true);
				$('.salelist #rightnow #ttmoney').html($('.salelist #salelist input[name="ttmoney"]').val());
				$('.salelist #rightnow #ttcount').html($('.salelist #salelist input[name="ttcount"]').val());
				$('.salelist #rightnow #voidmoney').html($('.salelist #salelist input[name="voidmoney"]').val());
				$('.salelist #rightnow #voidcount').html($('.salelist #salelist input[name="voidcount"]').val());
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.salelist #fun').on('click','#nextbizdate',function(){
		$.ajax({
			url:'./lib/js/getsalelist.ajax.php',
			method:'post',
			data:{'bizdate':$('.salelist #salelist #salecontent #bizdate').val(),'type':'+','sale':'sale'},
			dataType:'html',
			success:function(d){
				$('.salelist #salelist #salecontent').html(d);
				$('.salelist #listno').html('');
				$('.salelist #list #listcontent').html('');
				$('.salelist #date').html('');
				$('.salelist #credate').html('');
				$('.salelist #fun #tag').prop('disabled',true);
				$('.salelist #fun button#list').prop('disabled',true);
				$('.salelist #fun #kitchen').prop('disabled',true);
				$('.salelist #fun #forall').prop('disabled',true);
				$('.salelist #fun #changecheck').prop('disabled',true);
				$('.salelist #rightnow #ttmoney').html($('.salelist #salelist input[name="ttmoney"]').val());
				$('.salelist #rightnow #ttcount').html($('.salelist #salelist input[name="ttcount"]').val());
				$('.salelist #rightnow #voidmoney').html($('.salelist #salelist input[name="voidmoney"]').val());
				$('.salelist #rightnow #voidcount').html($('.salelist #salelist input[name="voidcount"]').val());
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.salelist #fun').on('click','#exit',function(){
		$('.salelist #editpay').prop('disabled',true);
		$('.salelist #reorder').prop('disabled',true);
		$('.salelist #reinv').prop('disabled',true);
		$('.salelist #rekvm').prop('disabled',true);
		$('.salelist #salelist #salecontent .listitems').prop('id','');
		$('.salelist #listno').html('');
		$('.salelist #list #listcontent').html('');
		$('.salelist #date').html('');
		$('.salelist #credate').html('');
		$('.salelist #fun button#forall').prop('disabled',true);
		$('.salelist #fun button#list').prop('disabled',true);
		$('.salelist #fun button#tag').prop('disabled',true);
		$('.salelist #fun button#kitchen').prop('disabled',true);
		$('.salelist #fun button#changecheck').prop('disabled',true);
		salelist.dialog('close');
	});
	function editpaycomchange(){//計算找零金額
		editpaycomalready();
		/*if(Number($('.result #viewwindow #total').html())<Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())){
			var temp=Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val());
		}
		else{*/
			var temp=Number($('.editpay #viewwindow #should').html())+Number($('.editpay #viewwindow #cashcomm').html());
		//}
		if(temp-Number($('.editpay #viewwindow #already').html())<=0){
			$('.editpay #viewwindow #notyet').html('0');
		}
		else{
			$('.editpay #viewwindow #notyet').html(temp-Number($('.editpay #viewwindow #already').html()));
		}
		if(Number($('.editpay #viewwindow #already').html())-temp<=0){
			$('.editpay #viewwindow #change').html('0');
		}
		else{
			$('.editpay #viewwindow #change').html(Number($('.editpay #viewwindow #already').html())-temp);
		}
	};
	function editpaycomalready(){//計算已付金額
		var pay=0;
		var money=0;
		var cash=0;
		var commission=0;
		var other=0;
		var otherfix=0;
		var tempstring={};
		var otherstring='';
		var precision=$('.order#order .initsetting #accuracy').val();
		for(var i=0;i<$('.editpay #viewwindow #editpaywindow .paymoney').length;i++){//計算已付現金
			if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
				pay=roundfun(Number(pay)+Number($('.editpay #viewwindow #editpaywindow .paymoney:eq('+i+')').html()),precision);
				money=roundfun(Number(money)+Number($('.editpay #viewwindow #editpaywindow .paymoney:eq('+i+')').html()),precision);
			}
			else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
				pay=ceilfun(Number(pay)+Number($('.editpay #viewwindow #editpaywindow .paymoney:eq('+i+')').html()),precision);
				money=ceilfun(Number(money)+Number($('.editpay #viewwindow #editpaywindow .paymoney:eq('+i+')').html()),precision);
			}
			else{//無條件捨去
				pay=floorfun(Number(pay)+Number($('.editpay #viewwindow #editpaywindow .paymoney:eq('+i+')').html()),precision);
				money=floorfun(Number(money)+Number($('.editpay #viewwindow #editpaywindow .paymoney:eq('+i+')').html()),precision);
			}
		}
		for(var i=0;i<$('.editpay #viewwindow #editpaywindow .paycash').length;i++){//計算已付信用卡與手續費
			if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
				pay=roundfun(Number(pay)+Number($('.editpay #viewwindow #editpaywindow .paycash:eq('+i+')').html()),precision);
				cash=roundfun(Number(cash)+Number($('.editpay #viewwindow #editpaywindow .paycash:eq('+i+')').html()),precision);
				commission=roundfun(Number(commission)+Number($('.editpay #viewwindow #editpaywindow .commission:eq('+i+')').val()),precision);
			}
			else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
				pay=ceilfun(Number(pay)+Number($('.editpay #viewwindow #editpaywindow .paycash:eq('+i+')').html()),precision);
				cash=ceilfun(Number(cash)+Number($('.editpay #viewwindow #editpaywindow .paycash:eq('+i+')').html()),precision);
				commission=ceilfun(Number(commission)+Number($('.editpay #viewwindow #editpaywindow .commission:eq('+i+')').val()),precision);
			}
			else{//無條件捨去
				pay=floorfun(Number(pay)+Number($('.editpay #viewwindow #editpaywindow .paycash:eq('+i+')').html()),precision);
				cash=floorfun(Number(cash)+Number($('.editpay #viewwindow #editpaywindow .paycash:eq('+i+')').html()),precision);
				commission=floorfun(Number(commission)+Number($('.editpay #viewwindow #editpaywindow .commission:eq('+i+')').val()),precision);
			}
		}
		for(var i=0;i<$('.editpay #viewwindow #editpaywindow .otherpay').length;i++){//計算已付其他付款
			if($('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+') input[name="type"]').val()=='1'){//找零
				if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
					pay=pay=roundfun(Number(pay)+Number($('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
					other=pay=roundfun(Number(other)+Number($('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
				}
				else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
					pay=pay=ceilfun(Number(pay)+Number($('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
					other=pay=ceilfun(Number(other)+Number($('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
				}
				else{//無條件捨去
					pay=pay=floorfun(Number(pay)+Number($('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
					other=pay=floorfun(Number(other)+Number($('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
				}
			}
			else{
				if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
					pay=roundfun(Number(pay)+Number($('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
					otherfix=roundfun(Number(otherfix)+Number($('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
				}
				else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
					pay=pay=ceilfun(Number(pay)+Number($('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
					otherfix=pay=ceilfun(Number(otherfix)+Number($('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
				}
				else{//無條件捨去
					pay=pay=floorfun(Number(pay)+Number($('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
					otherfixpay=floorfun(Number(otherfix)+Number($('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()),precision);
				}
			}
			
			if(typeof tempstring[$('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+')').attr('id')]!=='undefined'){
				if(tempstring[$('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+')').attr('id')].match("=")){
					var ttempstringa=tempstring[$('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+')').attr('id')].split("=");
					tempstring[$('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+')').attr('id')]=Number(ttempstringa[1])+Number($('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()());
				}
				else{
					tempstring[$('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+')').attr('id')]=Number(tempstring[$('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+')').attr('id')])+Number($('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+') input[name="viewmoney"]').val()());
				}
			}
			else{
				tempstring[$('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+')').attr('id')]=Number($('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+') input[name="viewmoney"]').val());
			}
			if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
				tempstring[$('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+')').attr('id')]=$('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+') input[name="initview"]').val()+"="+roundfun(tempstring[$('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+')').attr('id')],precision);
			}
			else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
				tempstring[$('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+')').attr('id')]=$('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+') input[name="initview"]').val()+"="+ceilfun(tempstring[$('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+')').attr('id')],precision);
			}
			else{//無條件捨去
				tempstring[$('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+')').attr('id')]=$('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+') input[name="initview"]').val()+"="+floorfun(tempstring[$('.editpay #viewwindow #editpaywindow .otherpay:eq('+i+')').attr('id')],precision);
			}
		}
		$.each(tempstring,function(i,value){
			if(otherstring==''){
				otherstring=otherstring+i+':'+value;
			}
			else{
				otherstring=otherstring+','+i+':'+value;
			}
		});
		/*for(var i=1;i<=10;i++){
			if(typeof tempstring['TA'+i]!=='undefined'){
				if(otherstring==''){
					otherstring=otherstring+'TA'+i+':'+tempstring['TA'+i];
				}
				else{
					otherstring=otherstring+',TA'+i+':'+tempstring['TA'+i];
				}
			}
			else{
			}
		}*/
		if(typeof tempstring['NONTAX']!=='undefined'){
			if(otherstring==''){
				otherstring=otherstring+'NONTAX:'+tempstring['NONTAX'];
			}
			else{
				otherstring=otherstring+',NONTAX:'+tempstring['NONTAX'];
			}
		}
		else{
		}
		//console.log(otherstring);
		$('.editpay #viewwindow #cashcomm').html(commission);
		$('.editpay #viewwindow input[name="cashcomm"]').val(commission);

		$('.editpay #viewwindow #already').html(pay);
		$('.editpay #viewwindow input[name="already"]').val(pay);

		$('.editpay #viewwindow #cash').html(cash);
		$('.editpay #viewwindow input[name="cash"]').val(cash);

		$('.editpay #viewwindow #other').html(other);
		$('.editpay #viewwindow input[name="other"]').val(other);
		$('.editpay #viewwindow input[name="otherstring"]').val(otherstring);
		$('.editpay #viewwindow #otherfix').html(otherfix);
		$('.editpay #viewwindow input[name="otherfix"]').val(otherfix);
		if(Number(money)>=(Number($('.editpay #viewwindow #should').html())+Number($('.editpay #viewwindow #cashcomm').html())-Number($('.editpay #viewwindow #cash').html())-Number($('.editpay #viewwindow #other').html())-Number($('.editpay #viewwindow #otherfix').html()))){
			$('.editpay #viewwindow #cashmoney').html((Number($('.editpay #viewwindow #should').html())+Number($('.editpay #viewwindow #cashcomm').html())-Number($('.editpay #viewwindow #cash').html())-Number($('.editpay #viewwindow #other').html())-Number($('.editpay #viewwindow #otherfix').html())));
			$('.editpay #viewwindow input[name="cashmoney"]').val((Number($('.editpay #viewwindow #should').html())+Number($('.editpay #viewwindow #cashcomm').html())-Number($('.editpay #viewwindow #cash').html())-Number($('.editpay #viewwindow #other').html())-Number($('.editpay #viewwindow #otherfix').html())));
			if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
				$('.editpay #viewwindow #cashmoney').html(roundfun($('.editpay #viewwindow #cashmoney').html(),precision));
				$('.editpay #viewwindow input[name="cashmoney"]').val(roundfun($('.editpay #viewwindow input[name="cashmoney"]').val(),precision));
			}
			else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
				$('.editpay #viewwindow #cashmoney').html(ceilfun($('.editpay #viewwindow #cashmoney').html(),precision));
				$('.editpay #viewwindow input[name="cashmoney"]').val(ceilfun($('.editpay #viewwindow input[name="cashmoney"]').val(),precision));
			}
			else{//無條件捨去
				$('.editpay #viewwindow #cashmoney').html(floorfun($('.editpay #viewwindow #cashmoney').html(),precision));
				$('.editpay #viewwindow input[name="cashmoney"]').val(floorfun($('.editpay #viewwindow input[name="cashmoney"]').val(),precision));
			}
		}
		else{
			$('.editpay #viewwindow #cashmoney').html(money);
			$('.editpay #viewwindow input[name="cashmoney"]').val(money);
		}
	};
	$('.editpay').on('click','#number',function(){
		$('.editpay input[name="view"]').val($('.editpay input[name="view"]').val()+$(this).val());
	});
	$('.editpay').on('click','#clear',function(){
		if($('.editpay #viewwindow #editpaywindow .paywaybox input[name="checkbox"]:checked').length>0){//清除已勾選之結帳方式明細
			for(var i=($('.editpay #viewwindow #editpaywindow .paywaybox').length-1);i>=0;i--){
				if($('.editpay #viewwindow #editpaywindow .paywaybox:eq('+i+') input[name="checkbox"]').prop('checked')){
					$('.editpay #viewwindow #editpaywindow .paywaybox:eq('+i+')').remove();
				}
				else{
				}
			}
			editpaycomchange();
		}
		else{
			$('.editpay input[name="view"]').val('');
		}
	});
	$('.editpay').on('click','#other',function(){
		$('.paywindow input[name="target"]').val('editpay');
		paywindow.dialog('open');
	});
	$('.editpay').on('click','#cashbut',function(){
		var content='';
		var inputmoney=0;
		var commission=0;
		var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)

		if($('.editpay input[name="view"]').val().length>0){
			if((Number($('.editpay #viewwindow #should').html())+Number($('.editpay #viewwindow #cashcomm').html())-Number($('.editpay #viewwindow #already').html()))<=0){
			}
			else{
				if(Number($('.editpay input[name="view"]').val())>=(Number($('.editpay #viewwindow #should').html())+Number($('.editpay #viewwindow #cashcomm').html())-Number($('.editpay #viewwindow #already').html()))){
					inputmoney=Number($('.editpay #viewwindow #should').html())+Number($('.editpay #viewwindow #cashcomm').html())-Number($('.editpay #viewwindow #already').html());
				}
				else{
					inputmoney=$('.editpay input[name="view"]').val();
				}
			}
			$('.editpay input[name="view"]').val('');
		}
		else if((Number($('.editpay #viewwindow #should').html())+Number($('.editpay #viewwindow #cashcomm').html())-Number($('.editpay #viewwindow #already').html()))>0){
			inputmoney=Number($('.editpay #viewwindow #should').html())+Number($('.editpay #viewwindow #cashcomm').html())-Number($('.editpay #viewwindow #already').html());
		}
		else{
		}

		commission=(Number(inputmoney)*$('.order#order .initsetting #cashcomm').val())/100;
		if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
			commission= roundfun(commission ,precision);
		}
		else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
			commission= ceilfun(commission ,precision);
		}
		else{//無條件捨去
			commission= floorfun(commission ,precision);
		}

		if(Number(inputmoney)==0){
		}
		else{
			content="<div class='paywaybox' style='width:calc(100% - 20px);overflow:hidden;'><div style='width:20px;height:19px;float:left;'><input type='checkbox' name='checkbox'></div><div class='payway' style='overflow:hidden;'><div style='width:calc(50% - 10px);float:left;text-align:left;'><span id='name1'>"+$('.editpay #cashbut').html()+"</span>";
			content=content+"</div>";
			content=content+"<div style='width:calc(50% - 10px);float:left;text-align:right;'>"+$('.result .frontunit').val()+"<span class='paycash'>"+(Number(inputmoney)+Number(commission))+"</span>"+$('.result .unit').val()+"<input type='hidden' id='inputmoney' value='"+inputmoney+"'><input type='hidden' class='commission' value='"+commission+"'></div></div></div>";
			$('.editpay #viewwindow #editpaywindow #paycontent').append(content);
		}

		editpaycomchange();
	});
	$('.editpay').on('click','#moneybut',function(){
		var content='';
		if($('.editpay input[name="view"]').val().length>0){
			
			if((Number($('.editpay #viewwindow #should').html())+Number($('.editpay #viewwindow #cashcomm').html())-Number($('.editpay #viewwindow #already').html()))<=0){
			}
			else{
				content="<div class='paywaybox' style='width:calc(100% - 20px);overflow:hidden;'><div style='width:20px;height:19px;float:left;'><input type='checkbox' name='checkbox'></div><div class='payway' style='overflow:hidden;'><div style='width:calc(50% - 10px);float:left;text-align:left;'><span id='name1'>"+$('.editpay #moneybut').html()+"</span>";
				content=content+"</div>";
				content=content+"<div style='width:calc(50% - 10px);float:left;text-align:right;'>"+$('.result .frontunit').val()+"<span class='paymoney'>";
				if((Number($('.editpay #viewwindow #should').html())+Number($('.editpay #viewwindow #cashcomm').html())-Number($('.editpay #viewwindow #already').html()))<=Number($('.editpay input[name="view"]').val())){
					content=content+(Number($('.editpay #viewwindow #should').html())+Number($('.editpay #viewwindow #cashcomm').html())-Number($('.editpay #viewwindow #already').html()));
				}
				else{
					content=content+$('.editpay input[name="view"]').val();
				}
				content=content+"</span>"+$('.result .unit').val()+"</div></div></div>";

				$('.editpay #viewwindow #editpaywindow #paycontent').append(content);
			}
			$('.editpay input[name="view"]').val('');
			
		}
		else if((Number($('.editpay #viewwindow #should').html())+Number($('.editpay #viewwindow #cashcomm').html())-Number($('.editpay #viewwindow #already').html()))>0){
			content="<div class='paywaybox' style='width:calc(100% - 20px);overflow:hidden;'><div style='width:20px;height:19px;float:left;'><input type='checkbox' name='checkbox'></div><div class='payway' style='overflow:hidden;'><div style='width:calc(50% - 10px);float:left;text-align:left;'><span id='name1'>"+$('.editpay #moneybut').html()+"</span>";
			content=content+"</div><div style='width:calc(50% - 10px);float:left;text-align:right;'>"+$('.result .frontunit').val()+"<span class='paymoney'>"+(Number($('.editpay #viewwindow #should').html())+Number($('.editpay #viewwindow #cashcomm').html())-Number($('.editpay #viewwindow #already').html()))+"</span>"+$('.result .unit').val()+"</div></div></div>";
			$('.editpay #viewwindow #editpaywindow #paycontent').append(content);
		}
		else{
		}
		editpaycomchange();
	});
	$('.editpay #viewwindow #editpaywindow').on('click','.payway',function(){//結帳畫面之結帳方式明細模擬labal點選
		var index=$('.editpay #viewwindow #editpaywindow .payway').index(this);
		$('.editpay #viewwindow #editpaywindow .paywaybox').removeClass('focus');
		if($('.editpay #viewwindow #editpaywindow .paywaybox:eq('+index+') input[name="checkbox"]').prop('checked')){
			$('.editpay #viewwindow #editpaywindow .paywaybox:eq('+index+') input[name="checkbox"]').prop('checked',false);
		}
		else{
			$('.editpay #viewwindow #editpaywindow .paywaybox:eq('+index+') input[name="checkbox"]').prop('checked',true);
		}
		if($('.editpay #viewwindow #editpaywindow .paywaybox:eq('+index+') .focus').length>0){
		}
		else{
			$('.editpay #viewwindow #editpaywindow .paywaybox:eq('+index+')').addClass('focus');
		}
	});
	$('.editpay #viewwindow').on('click','#send',function(){
		if($('.editpay #viewwindow #notyet').html()!='0'){
		}
		else{
			var nowbizdate=$('.editpay #viewwindow #editform input[name="bizdate"]').val();
			$.ajax({
				url:'./lib/js/cover.ajax.php',
				method:'post',
				async:false,
				data:$('.editpay #viewwindow #editform').serialize(),
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'editpay-send cover.ajax.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
					$('.editpay #viewwindow #cancel').trigger('click');
					$('.salelist #fun #exit').trigger('click');
					$('.order#order #billfun #billfun2 #salelist').trigger('click');
				},
				error:function(e){
					//console.log(e);
				}
			});
			$.ajax({
				url:'./lib/js/create.cmdtxt.php',
				method:'post',
				async: false,
				data:{'cmd':nowbizdate.substr(0,6)+'-change'},
				dataType:'html',
				success:function(d){
					//console.log(d);
				},
				error:function(e){
					//console.log(e);
				}
			});
		}
	});
	$('.editpay #viewwindow').on('click','#cancel',function(){
		$('.editpay input[name="view"]').val('');
		$('.editpay #viewwindow #should').html('0');
		$('.editpay #viewwindow input[name="should"]').val('0');

		$('.editpay #viewwindow #cashcomm').html('0');
		$('.editpay #viewwindow input[name="cashcomm"]').val('0');

		$('.editpay #viewwindow #already').html('0');
		$('.editpay #viewwindow input[name="already"]').val('0');

		$('.editpay #viewwindow #cashmoney').html('0');
		$('.editpay #viewwindow input[name="cashmoney"]').val('0');

		$('.editpay #viewwindow #cash').html('0');
		$('.editpay #viewwindow input[name="cash"]').val('0');

		$('.editpay #viewwindow #other').html('0');
		$('.editpay #viewwindow input[name="other"]').val('0');
		$('.editpay #viewwindow input[name="otherstring"]').val('0');

		$('.editpay #viewwindow #notyet').html('0');
		$('.editpay #viewwindow #editpaywindow #paycontent').html('');
		editpay.dialog('close');
	});
	$('.order#order #billfun #billfun2').on('click','#salevoid',function(){
		$.ajax({
			url:'./lib/js/checkopen.ajax.php',
			async:false,
			dataType:'html',
			success:function(d){
				if(d.length>20){
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'checkopen.ajax.php '+d},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				//console.log(d);
				if(d=='success'){
					salevoid.dialog('open');
					$.ajax({
						url:'./lib/js/getsalelist.ajax.php',
						dataType:'html',
						success:function(d){
							$('.salevoid #salelist #salecontent').html(d);
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
				else{
					alert('目前尚未開班，請確認是否開班或重啟系統。');
				}
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.salevoid #salelist #salecontent').on('click','.listitems',function(){
		var index=$('.salevoid #salelist #salecontent .listitems').index(this);
		$('.salevoid #salelist #salecontent .listitems').prop('id','');
		$('.salevoid #salelist #salecontent .listitems:eq('+index+')').prop('id','focus');
		$('.salevoid #listno').html($('.salevoid #salelist #salecontent .listitems:eq('+index+') div:eq(1)').html());
		$('.salevoid #date').html($('.salevoid #salelist #salecontent .listitems:eq('+index+') div:eq(0)').html());
		$('.salevoid #credate').val($('.salevoid #salelist #salecontent .listitems:eq('+index+') div:eq(6)').html().substr(0,8));
		$.ajax({
			url:'./lib/js/getsaledetail.ajax.php',
			method:'post',
			data:{'company':$('.order#order .companydata #company').val(),'bizdate':$('.salevoid #salelist #salecontent .listitems:eq('+index+') div:eq(0)').html(),'no':$('.salevoid #salelist #salecontent .listitems:eq('+index+') div:eq(1) input[name="consecnumber"]').val(),'createdatetime':$('.salevoid #salelist #salecontent .listitems:eq('+index+') div:eq(5)').html()},
			dataType:'html',
			success:function(d){
				$('.salevoid #list #listcontent').html(d);
				if($('.order#order .companydata #ispad').val()=='submachine'){
					$('.salevoid #fun #void').prop('disabled',true);
				}
				else{
					$('.salevoid #fun #void').prop('disabled',false);
				}
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.salevoid #fun').on('click','#prebizdate',function(){
		$.ajax({
			url:'./lib/js/getsalelist.ajax.php',
			method:'post',
			data:{'bizdate':$('.salevoid #salelist #salecontent #bizdate').val(),'type':'-'},
			dataType:'html',
			success:function(d){
				$('.salevoid #salelist #salecontent').html(d);
				$('.salevoid #listno').html('');
				$('.salevoid #list #listcontent').html('');
				$('.salevoid #date').html('');
				$('.salevoid #credate').html('');
				$('.salevoid #fun #void').prop('disabled',true);
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.salevoid #fun').on('click','#nextbizdate',function(){
		$.ajax({
			url:'./lib/js/getsalelist.ajax.php',
			method:'post',
			data:{'bizdate':$('.salevoid #salelist #salecontent #bizdate').val(),'type':'+'},
			dataType:'html',
			success:function(d){
				$('.salevoid #salelist #salecontent').html(d);
				$('.salevoid #listno').html('');
				$('.salevoid #list #listcontent').html('');
				$('.salevoid #date').html('');
				$('.salevoid #credate').html('');
				$('.salevoid #fun #void').prop('disabled',true);
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.salevoid #fun').on('click','#void',function(){
		if($('.order#order .initsetting #voidsale').val()=='0'){
			if($.trim($('.salevoid #salelist #salecontent .listitems#focus div:eq(3)').html()).length!=0){//檢查是否已開立發票
				var hint=confirm('請確認發票正本已收回。');
				if(hint==true){
					var nowbizdate=$('.salevoid #date').html();
					var voidbizdate=$('.salevoid #date').html();
					var voidconsecnumber=$('.salevoid #listno input[name="consecnumber"]').val();
					if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
						var posdvrfile='';
					}
					else{
					}
					$.ajax({
						url:'./lib/js/salevoid.ajax.php',
						method:'post',
						async:false,
						data:{'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'bizdate':$('.salevoid #date').html(),'createdatetime':$('.salevoid #credate').val(),'consecnumber':$('.salevoid #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val()},
						dataType:'html',
						success:function(d){
							var temp=d.split('-');
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'salevoid.ajax.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							if(temp[0]=='success'){
								//console.log($('.salevoid #list #listcontent input[name="invnumber"]').val());
								$.ajax({
									url:'./lib/js/deleteinv.ajax.php',
									method:'post',
									async:false,
									data:{'bizdate':$('.salevoid #date').html(),'number':$('.salevoid #list input[name="invnumber"]').val()},
									dataType:'html',
									success:function(d){
										if(d.length>20){
											$.ajax({
												url:'./lib/js/print.php',
												method:'post',
												data:{'html':'deleteinv.ajax.php '+d},
												dataType:'html',
												success:function(d){/*console.log(d);*/},
												error:function(e){/*console.log(e);*/}
											});
										}
										else{
										}
										//console.log(d);
										//2017/12/4var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
										//2017/12/4mywin.document.title='cashdrawer';
									},
									error:function(e){
										//console.log(e);
									}
								});
								$('.order#order #billfun #billfun2 #salevoid').trigger('click');
								$('.salevoid #listno').html('');
								$('.salevoid #list #listcontent').html('');
								$('.salevoid #date').html('');
								$('.salevoid #credate').html('');
								if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
									var posdvrfile=temp[1];
								}
								else{
								}
							}
							else{
								//console.log(d);
							}
						},
						error:function(e){
							//console.log(e);
						}
					});
					$.ajax({
						url:'./lib/js/create.cmdtxt.php',
						method:'post',
						async: false,
						data:{'cmd':nowbizdate.substr(0,6)+'-change'},
						dataType:'html',
						success:function(d){
							//console.log(d);
						},
						error:function(e){
							//console.log(e);
						}
					});
					/*錢都錄借接*/
					if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
						/*start tag*/
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							async:false,
							data:{'html':'start posdvr-sendmessage','file':'posdvr'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){console.log(e);}
						});
						if(typeof api_sendmessage_posdvr!=="undefined"&&typeof api_sendmessage_posdvr==="function"){
							api_sendmessage_posdvr(posdvrfile);
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'success','file':'posdvr'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'error sendmessage is not function','file':'posdvr'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						/*end tag*/
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							async:false,
							data:{'html':'end posdvr-sendmessage','file':'posdvr'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					/*集點樹收點流程*/
					if($('.order#order .initsetting #pointtree').length>0&&$('.order#order .initsetting #pointtree').val()=='1'){
						/*start tag*/
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'start point-tree-void transfer','file':'point-tree'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
						if(typeof api_void_pointtree!=="undefined"&&typeof api_void_pointtree==="function"){
							var voidres=api_void_pointtree(voidbizdate,voidconsecnumber);
							if(voidres==''){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'point-tree-void voidpoint 意外錯誤','file':'point-tree'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else if(typeof voidres['data']!=="undefined"){//success
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'pass point-tree-void transfer -PHP_EOL-pos_token_tx_id:'+voidres['data']['pos_token_tx_id']+'-PHP_EOL-store_balance:'+voidres['data']['store_balance']+'-PHP_EOL-user_balance:'+voidres['data']['user_balance'],'file':'point-tree'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
								var message=JSON.parse(voidres['responseText']);
								if(voidres['status']==='timeout'){
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										async:false,
										data:{'html':'point-tree-void transfer timeout','file':'point-tree'},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
								}
								else if(voidres['status']=='400'||voidres['status']=='406'){
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										async:false,
										data:{'html':'point-tree-void transfer error -PHP_EOL-status:'+voidres['status']+'-PHP_EOL-code:'+message['errors'][0]['code']+'-PHP_EOL-message:'+message['errors'][0]['message'],'file':'point-tree'},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
								}
								else{
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										async:false,
										data:{'html':'point-tree-void transfer 意外錯誤','file':'point-tree'},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
								}
							}
						}
						else{
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'api void pointtree is not function','file':'point-tree'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						/*end tag*/
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'end point-tree-void transfer','file':'point-tree'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
				}
				else{
				}
			}
			else{
				var nowbizdate=$('.salevoid #date').html();
				var voidbizdate=$('.salevoid #date').html();
				var voidconsecnumber=$('.salevoid #listno input[name="consecnumber"]').val();
				if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
					var posdvrfile='';
				}
				else{
				}
				$.ajax({
					url:'./lib/js/salevoid.ajax.php',
					method:'post',
					async:false,
					data:{'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'bizdate':$('.salevoid #date').html(),'createdatetime':$('.salevoid #credate').val(),'consecnumber':$('.salevoid #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val()},
					dataType:'html',
					success:function(d){
						console.log(d);
						var temp=d.split('-');
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'salevoid.ajax.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						if(temp[0]=='success'){
							//console.log($('.salevoid #list #listcontent input[name="invnumber"]').val());
							$.ajax({
								url:'./lib/js/deleteinv.ajax.php',
								method:'post',
								async:false,
								data:{'bizdate':$('.salevoid #date').html(),'number':$('.salevoid #list input[name="invnumber"]').val()},
								dataType:'html',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'deleteinv.ajax.php '+d},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									//console.log(d);
									//2017/12/4var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
									//2017/12/4mywin.document.title='cashdrawer';
								},
								error:function(e){
									//console.log(e);
								}
							});
							$('.order#order #billfun #billfun2 #salevoid').trigger('click');
							$('.salevoid #listno').html('');
							$('.salevoid #list #listcontent').html('');
							$('.salevoid #date').html('');
							$('.salevoid #credate').html('');
							if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
								var posdvrfile=temp[1];
							}
							else{
							}
						}
						else{
							//console.log(d);
						}
					},
					error:function(e){
						//console.log(e);
					}
				});
				$.ajax({
					url:'./lib/js/create.cmdtxt.php',
					method:'post',
					async: false,
					data:{'cmd':nowbizdate.substr(0,6)+'-change'},
					dataType:'html',
					success:function(d){
						//console.log(d);
					},
					error:function(e){
						//console.log(e);
					}
				});
				/*錢都錄借接*/
				if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
					/*start tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						async:false,
						data:{'html':'start posdvr-sendmessage','file':'posdvr'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){console.log(e);}
					});
					if(typeof api_sendmessage_posdvr!=="undefined"&&typeof api_sendmessage_posdvr==="function"){
						api_sendmessage_posdvr(posdvrfile);
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'success','file':'posdvr'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							async:false,
							data:{'html':'error sendmessage is not function','file':'posdvr'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					/*end tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						async:false,
						data:{'html':'end posdvr-sendmessage','file':'posdvr'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				/*集點樹收點流程*/
				if($('.order#order .initsetting #pointtree').length>0&&$('.order#order .initsetting #pointtree').val()=='1'){
					/*start tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'start point-tree-void transfer','file':'point-tree'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
					if(typeof api_void_pointtree!=="undefined"&&typeof api_void_pointtree==="function"){
						var voidres=api_void_pointtree(voidbizdate,voidconsecnumber);
						if(voidres==''){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'point-tree-void voidpoint 意外錯誤','file':'point-tree'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else if(typeof voidres['data']!=="undefined"){//success
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'pass point-tree-void transfer -PHP_EOL-pos_token_tx_id:'+voidres['data']['pos_token_tx_id']+'-PHP_EOL-store_balance:'+voidres['data']['store_balance']+'-PHP_EOL-user_balance:'+voidres['data']['user_balance'],'file':'point-tree'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
							var message=JSON.parse(voidres['responseText']);
							if(voidres['status']==='timeout'){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'point-tree-void transfer timeout','file':'point-tree'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else if(voidres['status']=='400'||voidres['status']=='406'){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'point-tree-void transfer error -PHP_EOL-status:'+voidres['status']+'-PHP_EOL-code:'+message['errors'][0]['code']+'-PHP_EOL-message:'+message['errors'][0]['message'],'file':'point-tree'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'point-tree-void transfer 意外錯誤','file':'point-tree'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
						}
					}
					else{
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							async:false,
							data:{'html':'api void pointtree is not function','file':'point-tree'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					/*end tag*/
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'end point-tree-void transfer','file':'point-tree'},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
			}
		}
		else{
			$('.verpsw input[name="type"]').val('void');
			verpsw.dialog('open');
		}
	});
	$('.salevoid #fun').on('click','#exit',function(){
		$('.salevoid #salelist #salecontent .listitems').prop('id','');
		$('.salevoid #listno').html('');
		$('.salevoid #list #listcontent').html('');
		$('.salevoid #date').html('');
		$('.salevoid #credate').html('');
		salevoid.dialog('close');
	});
	$('.order#order #banner #tablenumber').on('click','.tabnumbox',function(){
		if($('.order#order .initsetting #controltable').val()=='1'){
		}
		else{
			$('.tabinput #view #tabnum').html($('.order#order #banner #tablenumber .tabnumbox').html());
			tabinput.dialog('open');
		}
	});
	$('.tabinput #buttons').on('click','.input',function(){
		var index=$('.tabinput #buttons .input').index(this);
		if($('.tabinput #view #tabnum').html().length>=20){
		}
		else{
			$('.tabinput #view #tabnum').html($('.tabinput #view #tabnum').html()+$('.tabinput #buttons .input:eq('+index+')').val());
		}
	});
	$('.tabinput #buttons').on('click','#change',function(){
		if($('.tabinput #buttons .input:eq(0)').val()=='7'){
			for(var i=0;i<12;i++){
				$('.tabinput #buttons .input:eq('+i+')').val(String.fromCharCode(parseInt(65)+parseInt(i)));
			}
			$('.tabinput #buttons .pre').prop('disabled',false);
			$('.tabinput #buttons .next').prop('disabled',false);
		}
		else{
			$('.tabinput #buttons .input:eq(0)').val('7');
			$('.tabinput #buttons .input:eq(1)').val('8');
			$('.tabinput #buttons .input:eq(2)').val('9');
			$('.tabinput #buttons .input:eq(3)').val('4');
			$('.tabinput #buttons .input:eq(4)').val('5');
			$('.tabinput #buttons .input:eq(5)').val('6');
			$('.tabinput #buttons .input:eq(6)').val('1');
			$('.tabinput #buttons .input:eq(7)').val('2');
			$('.tabinput #buttons .input:eq(8)').val('3');
			$('.tabinput #buttons .input:eq(9)').val('0');
			$('.tabinput #buttons .input:eq(10)').val('.');
			$('.tabinput #buttons .input:eq(11)').val('-');
			$('.tabinput #buttons .input:eq(0)').prop('disabled',false);
			$('.tabinput #buttons .input:eq(1)').prop('disabled',false);
			$('.tabinput #buttons .input:eq(2)').prop('disabled',false);
			$('.tabinput #buttons .input:eq(3)').prop('disabled',false);
			$('.tabinput #buttons .input:eq(4)').prop('disabled',false);
			$('.tabinput #buttons .input:eq(5)').prop('disabled',false);
			$('.tabinput #buttons .input:eq(6)').prop('disabled',false);
			$('.tabinput #buttons .input:eq(7)').prop('disabled',false);
			$('.tabinput #buttons .input:eq(8)').prop('disabled',false);
			$('.tabinput #buttons .input:eq(9)').prop('disabled',false);
			$('.tabinput #buttons .input:eq(10)').prop('disabled',false);
			$('.tabinput #buttons .input:eq(11)').prop('disabled',false);
			$('.tabinput #buttons .pre').prop('disabled',true);
			$('.tabinput #buttons .next').prop('disabled',true);
		}
	});
	$('.tabinput #buttons').on('click','#next',function(){
		if($('.tabinput #buttons .input:eq(0)').val()=='A'){
			for(var i=0;i<12;i++){
				$('.tabinput #buttons .input:eq('+i+')').val(String.fromCharCode(parseInt(65)+parseInt(i)+parseInt(12)));
				$('.tabinput #buttons .input:eq('+i+')').prop('disabled',false);
			}
		}
		else if($('.tabinput #buttons .input:eq(0)').val()=='M'){
			for(var i=0;i<2;i++){
				$('.tabinput #buttons .input:eq('+i+')').val(String.fromCharCode(parseInt(65)+parseInt(i)+parseInt(24)));
				$('.tabinput #buttons .input:eq('+i+')').prop('disabled',false);
			}
			for(var i=2;i<12;i++){
				$('.tabinput #buttons .input:eq('+i+')').val('');
				$('.tabinput #buttons .input:eq('+i+')').prop('disabled',true);
			}
		}
		else{
			for(var i=0;i<12;i++){
				$('.tabinput #buttons .input:eq('+i+')').val(String.fromCharCode(parseInt(65)+parseInt(i)));
				$('.tabinput #buttons .input:eq('+i+')').prop('disabled',false);
			}
		}
	});
	$('.tabinput #buttons').on('click','#pre',function(){
		if($('.tabinput #buttons .input:eq(0)').val()=='A'){
			for(var i=0;i<2;i++){
				$('.tabinput #buttons .input:eq('+i+')').val(String.fromCharCode(parseInt(65)+parseInt(i)+parseInt(24)));
				$('.tabinput #buttons .input:eq('+i+')').prop('disabled',false);
			}
			for(var i=2;i<12;i++){
				$('.tabinput #buttons .input:eq('+i+')').val('');
				$('.tabinput #buttons .input:eq('+i+')').prop('disabled',true);
			}
		}
		else if($('.tabinput #buttons .input:eq(0)').val()=='M'){
			for(var i=0;i<12;i++){
				$('.tabinput #buttons .input:eq('+i+')').val(String.fromCharCode(parseInt(65)+parseInt(i)));
				$('.tabinput #buttons .input:eq('+i+')').prop('disabled',false);
			}
		}
		else{
			for(var i=0;i<12;i++){
				$('.tabinput #buttons .input:eq('+i+')').val(String.fromCharCode(parseInt(65)+parseInt(i)+parseInt(12)));
				$('.tabinput #buttons .input:eq('+i+')').prop('disabled',false);
			}
		}
	});
	$('.tabinput #buttons').on('click','#ac',function(){
		$('.tabinput #view #tabnum').html('');
	});
	$('.tabinput #buttons').on('click','#submit',function(){
		$('.order#order #banner #tablenumber .tabnumbox').html($('.tabinput #view #tabnum').html());
		$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="tablenumber"]').val($('.tabinput #view #tabnum').html());
		$('.tabinput #view #tabnum').html('');
		tabinput.dialog('close');
	});
	$('.tabinput #buttons').on('click','#cancel',function(){
		$('.tabinput #view #tabnum').html('');
		tabinput.dialog('close');
	});
	/**/
	$('.openmoney #buttons').on('click','.input',function(){
		var index=$('.openmoney #buttons .input').index(this);
		if($('.openmoney #view #money').html().length>=20){
		}
		else{
			if($('.openmoney #view #money').html()=='0'){
				$('.openmoney #view #money').html($('.openmoney #buttons .input:eq('+index+')').val());
			}
			else{
				$('.openmoney #view #money').html($('.openmoney #view #money').html()+$('.openmoney #buttons .input:eq('+index+')').val());
			}
		}
	});
	$('.openmoney #buttons').on('click','#ac',function(){
		$('.openmoney #view #money').html('0');
	});
	$('.openmoney #buttons').on('click','#submit',function(){
		diff();
		$('.order#order #tabs1 #tempbox input[name="unitprice"]').val($('.openmoney #view #money').html());
		$('.order#order #tabs1 #tempbox input[name="money"]').val($('.openmoney #view #money').html());
		$('.order#order #tabs1 #tempbox input[name="subtotal"]').val(Number($('.order#order #tabs1 #tempbox input[name="number"]').val())*Number($('.order#order #tabs1 #tempbox input[name="money"]').val()));
		$('.order#order #editview').trigger('change');
		sumsubtotal();
		$('.openmoney #view #money').html('0');
		openmoney.dialog('close');
	});
	$('.openmoney #buttons').on('click','#cancel',function(){
		$('.openmoney #view #money').html('0');
		openmoney.dialog('close');
	});
	/**/
	$('.order#order #MemberBill #list #funbox').on('click','#view',function(){
		viewtemp.dialog('open');
		$.ajax({
			url:'./lib/js/getsalelist.ajax.php',
			method:'post',
			data:{'temp':'temp'},
			dataType:'html',
			success:function(d){
				$('.viewtemp #salelist #salecontent').html(d);
				$('.viewtemp #rightnow #ttmoney').html($('.viewtemp #salelist input[name="ttmoney"]').val());
				$('.viewtemp #rightnow #ttcount').html($('.viewtemp #salelist input[name="ttcount"]').val());
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.funbox').on('click','#view',function(){
		viewtemp.dialog('open');
		$.ajax({
			url:'./lib/js/getsalelist.ajax.php',
			method:'post',
			data:{'temp':'temp'},
			dataType:'html',
			success:function(d){
				$('.viewtemp #salelist #salecontent').html(d);
				$('.viewtemp #rightnow #ttmoney').html($('.viewtemp #salelist input[name="ttmoney"]').val());
				$('.viewtemp #rightnow #ttcount').html($('.viewtemp #salelist input[name="ttcount"]').val());
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.order#order #MemberBill #list #funbox').on('click','#numkeybord',function(){
		keybord.dialog('open');
	});
	$('.keybord').on('click','#cancel',function(){
		keybord.dialog('close');
	});
	$('.keybord').on('click','#send',function(){
		if($('.keybord input[name="num"]').val().length>=0&&$('.keybord input[name="num"]').val().substr(1,1)!="e"){
			if($('.keybord input[name="type"]').val()=='creditcard'){//輸入完信用卡後4碼，再進入結帳流程
				$('.result .sendviewwindow input[name="creditcard"]').val($('.keybord input[name="num"]').val());
				var nowbizdate=$('.order#order #tabs4 #listform input[name="bizdate"]').val();
				if(typeof $('.result #viewwindow input[name="sendtype"]')=="undefuned"||$('.result #viewwindow input[name="sendtype"]').val()=='result'){
					var array1=$("#tabs4 #listform , .result #viewwindow .sendviewwindow").serialize();
					//console.log(array1);
				}
				else{
					var array1=$(".result #viewwindow .sendviewwindow").serialize();
					array1=array1+'&charge='+$('.result #viewwindow #charge').html()+'&machinetype='+$('.order#order #tabs4 #listform input[name="machinetype"]').val()+'&bizdate='+$('.viewtemp #date').html()+'&consecnumber='+$('.viewtemp #listno input[name="consecnumber"]').val();
					//console.log(array1);
				}
				var invnumber='';
				var consecnumber='';
				$('.result #checkfun #submit').prop('disabled',true);
				$.ajax({//寫入暫存資料表
					url:'./lib/js/create.tempdb.php',
					method:'post',
					async:false,
					data:array1,
					dataType:'html',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'creditcard-send create.tempdb.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						//console.log(d);
						if($('.order#order #tabs4 #listform input[name="consecnumber"]').val()==''){
							var tempd=d.split('-');
							$('.order#order #tabs4 #listform input[name="saleno"]').val(tempd[0]);
							$('.order#order #tabs4 #listform input[name="consecnumber"]').val(tempd[1]);
							array1=$("#tabs4 #listform , .result #viewwindow .sendviewwindow").serialize();
						}
						else{
						}
					},
					error:function(e){
						//console.log(e);
					}
				});
				if($('.order#order #tabs4 #listform input[name="consecnumber"]').val()==''||$('.result input[name="sendtype"]').val()=='buytemp'||$('.result #viewwindow input[name="sendtype"]').val()=='tempsale'){
				}
				else{
					$.ajax({
						url:'./lib/js/create.voidlist.php',
						method:'post',
						async: false,
						data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tablenumber':$('.order#order #tabs4 #listform input[name="tablenumber"]').val(),'machine':$('.order#order .companydata #terminalnumber').val()},
						dataType:'html',
						success:function(d){
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'creditcard-send create.voidlist.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							//console.log(d);
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
				if($('.result input[name="sendtype"]').val()=='buytemp'||$('.result #viewwindow input[name="sendtype"]').val()=='tempsale'){
					consecnumber=$('.viewtemp #listno input[name="consecnumber"]').val();
				}
				else{
					$.ajax({
						url:'./lib/js/create.list.php',
						method:'post',
						async: false,
						data:array1,
						dataType:'html',
						success:function(d){
							if(d.length>10){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'creditcard-send create.list.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							//console.log('明細單'+d);
							consecnumber=d;
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
				
				if($('.order#order #tabs4 #listform input[name="consecnumber"]').val()==''||$('.result input[name="sendtype"]').val()=='buytemp'||$('.result #viewwindow input[name="sendtype"]').val()=='tempsale'){
				}
				else{
					$.ajax({
						url:'./lib/js/create.voidkitchen.php',
						method:'post',
						async: false,
						data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tablenumber':$('.order#order #tabs4 #listform input[name="tablenumber"]').val(),'machine':$('.order#order .companydata #terminalnumber').val()},
						dataType:'html',
						success:function(d){
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'creditcard-send create.voidkitchen.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							//console.log(d);
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
				/*$.ajax({//產生產品明細單
					url:'./lib/js/create.list.php',
					method:'post',
					async:false,
					data:array1,
					dataType:'html',
					success:function(d){
						if(d.length>10){//write error log
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':d},
								dataType:'html',
								success:function(d){
									//console.log(d);
								},
								error:function(e){
									//console.log(e);
								}
							});
						}
						else{
						}
						//console.log('明細單'+d);
						consecnumber=d;
					},
					error:function(e){
						//console.log(e);
					}
				});*/
				if(($('.result input[name="sendtype"]').val()=='result'&&!$('.result #funbox .invbut').prop('disabled'))&&(typeof $('.result #funbox .invno').val()=="undefined"||$('.result #funbox .invno').val()=='1')&&$('.order#order .initsetting #useinv').val()=='1'&&Number($('.order#order #tabs4 #listform input[name="invsalemoney"]').val())>0){//啟用發票&&開立發票
					$.ajax({
						url:'./lib/js/open.inv.php',
						method:'post',
						async:false,
						data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tempban':$('.result #viewwindow input[name="tempban"]').val(),'tempcontainer':$('.result #viewwindow input[name="tempcontainer"]').val(),'invlist':$('.order#order #tabs4 #listform input[name="invlist"]').val()},
						dataType:'html',
						success:function(d){
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'creditcard-send open.inv.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							//console.log('發票'+d);
							invnumber=d;
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
				else if(($('.result input[name="sendtype"]').val()=='tempsale'&&!$('.result #funbox .invbut').prop('disabled'))&&(typeof $('.result #funbox .invno').val()=="undefined"||$('.result #funbox .invno').val()=='1')&&$('.order#order .initsetting #useinv').val()=='1'&&Number($('.order#order #tabs4 #listform input[name="invsalemoney"]').val())>0){//啟用發票&&開立發票
					$.ajax({
						url:'./lib/js/open.inv.php',
						method:'post',
						async:false,
						data:{'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'tempban':$('.result #viewwindow input[name="tempban"]').val(),'tempcontainer':$('.result #viewwindow input[name="tempcontainer"]').val(),'invlist':$('.order#order #tabs4 #listform input[name="invlist"]').val()},
						dataType:'html',
						success:function(d){
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'creditcard-send open.inv.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							//console.log('發票'+d);
							invnumber=d;
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
				else if(typeof $('.result input[name="sendtype"]')!="undefined"&&($('.result input[name="sendtype"]').val()=='buytemp'||$('.result #viewwindow input[name="sendtype"]').val()=='tempsale')){
					invnumber=$('.viewtemp #salelist #salecontent .listitems#focus div:eq(3)').html();
				}
				if(($('.result input[name="sendtype"]').val()=='result'&&!$('.result #funbox .invbut').prop('disabled'))&&(typeof $('.result #funbox .invno').val()=="undefined"||$('.result #funbox .invno').val()=='1')&&$('.order#order .initsetting #useoinv').val()=='1'&&Number($('.order#order #tabs4 #listform input[name="invsalemoney"]').val())>0){//啟用傳統發票&&開立傳統發票
					$.ajax({
						url:'./lib/js/open.oinv.php',
						method:'post',
						async:false,
						data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tempban':$('.result #viewwindow input[name="tempban"]').val(),'invlist':$('.order#order #tabs4 #listform input[name="invlist"]').val()},
						dataType:'html',
						success:function(d){
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'creditcard-send open.oinv.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							//console.log('發票'+d);
							invnumber=d;
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
				else if(($('.result input[name="sendtype"]').val()=='tempsale'&&!$('.result #funbox .invbut').prop('disabled'))&&(typeof $('.result #funbox .invno').val()=="undefined"||$('.result #funbox .invno').val()=='1')&&$('.order#order .initsetting #useoinv').val()=='1'&&Number($('.order#order #tabs4 #listform input[name="invsalemoney"]').val())>0){//啟用傳統發票&&開立傳統發票
					$.ajax({
						url:'./lib/js/open.oinv.php',
						method:'post',
						async:false,
						data:{'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'tempban':$('.result #viewwindow input[name="tempban"]').val(),'invlist':$('.order#order #tabs4 #listform input[name="invlist"]').val()},
						dataType:'html',
						success:function(d){
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'creditcard-send open.oinv.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							//console.log('發票'+d);
							invnumber=d;
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
				else if(typeof $('.result input[name="sendtype"]')!="undefined"&&($('.result input[name="sendtype"]').val()=='buytemp'||$('.result #viewwindow input[name="sendtype"]').val()=='tempsale')){
					invnumber=$('.viewtemp #salelist #salecontent .listitems#focus div:eq(3)').html();
				}
				else{
				}
				if(typeof $('.result input[name="sendtype"]')!="undefined"&&$('.result input[name="sendtype"]').val()=='tempsale'){//暫結需開發票之情況
				}
				else{
					if(typeof $('.result input[name="sendtype"]')!="undefined"&&$('.result input[name="sendtype"]').val()=='buytemp'){
						$.ajax({
							url:'./lib/js/temptodb.ajax.php',
							method:'post',
							async:false,
							data:{'bizdate':$('.viewtemp #date').html(),'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'numbertag':consecnumber},
							dataType:'html',
							success:function(d){
								if(d.length>20){
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										data:{'html':'creditcard-send temptodb.ajax.php '+d},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
								}
								else{
								}
								//console.log(d);
								//console.log('轉移正式'+consecnumber);
							},
							error:function(e){
								//console.log(e);
							}
						});
					}
					else{
						$.ajax({
							url:'./lib/js/temptodb.ajax.php',
							method:'post',
							async:false,
							data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'numbertag':consecnumber},
							dataType:'html',
							success:function(d){
								if(d.length>20){
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										data:{'html':'creditcard-send temptodb.ajax.php '+d},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
								}
								else{
								}
								//console.log(d);
								//console.log('轉移正式'+consecnumber);
							},
							error:function(e){
								//console.log(e);
							}
						});
					}
				}
				if(typeof $('.result input[name="sendtype"]')!="undefined"&&($('.result input[name="sendtype"]').val()=='buytemp'||$('.result #viewwindow input[name="sendtype"]').val()=='tempsale')){
				}
				else{
					$.ajax({//產生工作單
						url:'./lib/js/create.kitchen.php',
						method:'post',
						async:false,
						data:array1,
						dataType:'html',
						success:function(d){
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'creditcard-send create.kitchen.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							//console.log('工作單'+d);
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
				if(typeof $('.result input[name="sendtype"]')!="undefined"&&($('.result input[name="sendtype"]').val()=='buytemp'||$('.result #viewwindow input[name="sendtype"]').val()=='tempsale')){
				}
				else{
					$.ajax({//產生貼紙
						url:'./lib/js/create.tag.php',
						method:'post',
						async:false,
						data:array1,
						dataType:'html',
						success:function(d){
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'creditcard-send create.tag.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}

							//console.log('貼紙'+d);
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
				if($('.order#order .initsetting #secview').val()=='1'){
					$.ajax({
						url:'../secview/cleartemp.ajax.php',
						async: false,
						dataType:'html',
						success:function(d){
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'creditcard-send cleartemp.ajax.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							//console.log(d);
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
				else{
				}
				$.ajax({
					url:'./lib/js/create.cmdtxt.php',
					method:'post',
					async: false,
					data:{'cmd':$('.order#order #tabs4 #listform input[name="machinetype"]').val()+'-cashdrawer'},
					dataType:'html',
					success:function(d){
						//console.log(d);
					},
					error:function(e){
						//console.log(e);
					}
				});
				$.ajax({
					url:'./lib/js/create.cmdtxt.php',
					method:'post',
					async: false,
					data:{'cmd':nowbizdate.substr(0,6)+'-change'},
					dataType:'html',
					success:function(d){
						//console.log(d);
					},
					error:function(e){
						//console.log(e);
					}
				});
				//2017/12/29var mywin=window.open('cashdrawer://','','width=1px,height=1px');
				//2017/12/29mywin.document.title='cashdrawer';

				/*集點樹贈點流程*/
				if(typeof $('.result input[name="sendtype"]')!="undefined"&&$('.result input[name="sendtype"]').val()=='tempsale'){//暫結需開發票之情況
				}
				else{
					var ptpoint=0;//兌換點數
					var ptpmoney=0;//兌換點數折扣金額
					var ptmoney=parseFloat($('.result #viewwindow #cash').html())+parseFloat($('.result #viewwindow #cashmoney').html());//集點金額:現金+信用卡金額
					if(typeof $('.result .sendviewwindow input[name="otherstring"]').val()!=="undefined"&&$('.result .sendviewwindow input[name="otherstring"]').val().length>0){
						var tempotherstring=$('.result .sendviewwindow input[name="otherstring"]').val().split(",");
						$.each(tempotherstring,function(v,i){
							var t1=i.split(":");
							var t1name=t1[0].split("-");
							var t1point=t1[1].split("=");
							if(t1name[0]=='pointtree'){
								ptpoint=t1point[0];
								ptppoint=t1point[1];
								return false;
							}
							else{
							}
						});
						if($('.result #viewwindow input[name="treetel"]').val().length>0&&Number(ptpoint)>0){
							/*start tag*/
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'start point-tree-exchange redeem','file':'point-tree'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
							if(typeof api_exchange_pointtree!=="undefined"&&typeof api_exchange_pointtree==="function"){
								if(typeof $('.result input[name="sendtype"]')!="undefined"&&$('.result input[name="sendtype"]').val()=='buytemp'){
									var exchangeres=api_exchange_pointtree($('.viewtemp #date').html(),consecnumber,$('.result #viewwindow input[name="treetoken"]').val(),$('.result #viewwindow input[name="treetel"]').val(),ptpoint);
								}
								else{
									var exchangeres=api_exchange_pointtree($('.order#order #tabs4 #listform input[name="bizdate"]').val(),consecnumber,$('.result #viewwindow input[name="treetoken"]').val(),$('.result #viewwindow input[name="treetel"]').val(),ptpoint);
								}
								console.log(exchangeres);
								if(exchangeres==''){
									$.ajax({
										url:'./lib/api/print.ticket.php',
										method:'post',
										async:false,
										data:{'type':'pointtree','message':'point-tree-exchange getrandom 意外錯誤'},
										dataType:'html',
										success:function(d){
											console.log(d);
										},
										error:function(e){
											console.log(e);
										}
									});
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										async:false,
										data:{'html':'point-tree-exchange getrandom 意外錯誤','file':'point-tree'},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
								}
								else if(typeof exchangeres['data']!=="undefined"){//success
									/*$.ajax({
										url:'./lib/api/print.ticket.php',
										method:'post',
										async:false,
										data:{'type':'pointtree','tel':$('.result #viewwindow input[name="treetel"]').val(),'user_balance':exchangeres['data']['user_balance']},
										dataType:'html',
										success:function(d){
											console.log(d);
										},
										error:function(e){
											console.log(e);
										}
									});*/
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										async:false,
										data:{'html':'pass point-tree-exchange redeem -PHP_EOL-pos_token_tx_id:'+exchangeres['data']['pos_token_tx_id'],'file':'point-tree'},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
								}
								else{
									var message=JSON.parse(exchangeres['responseText']);
									if(exchangeres['status']==='timeout'){
										$.ajax({
											url:'./lib/api/print.ticket.php',
											method:'post',
											async:false,
											data:{'type':'pointtree','message':'point-tree-exchange redeem timeout'},
											dataType:'html',
											success:function(d){
												console.log(d);
											},
											error:function(e){
												console.log(e);
											}
										});
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											async:false,
											data:{'html':'point-tree-exchange redeem timeout','file':'point-tree'},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else if(exchangeres['status']=='400'||exchangeres['status']=='406'){
										$.ajax({
											url:'./lib/api/print.ticket.php',
											method:'post',
											async:false,
											data:{'type':'pointtree','status':exchangeres['status'],'code':message['errors'][0]['code'],'message':message['errors'][0]['message']},
											dataType:'html',
											success:function(d){
												console.log(d);
											},
											error:function(e){
												console.log(e);
											}
										});
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											async:false,
											data:{'html':'point-tree-exchange redeem error -PHP_EOL-status:'+exchangeres['status']+'-PHP_EOL-code:'+message['errors'][0]['code']+'-PHP_EOL-message:'+message['errors'][0]['message'],'file':'point-tree'},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
										$.ajax({
											url:'./lib/api/print.ticket.php',
											method:'post',
											async:false,
											data:{'type':'pointtree','message':'point-tree-exchange redeem 意外錯誤'},
											dataType:'html',
											success:function(d){
												console.log(d);
											},
											error:function(e){
												console.log(e);
											}
										});
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											async:false,
											data:{'html':'point-tree-exchange redeem 意外錯誤','file':'point-tree'},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
								}
							}
							else{
								$.ajax({
									url:'./lib/api/print.ticket.php',
									method:'post',
									async:false,
									data:{'type':'pointtree','message':'api exchange pointtree is not function'},
									dataType:'html',
									success:function(d){
										console.log(d);
									},
									error:function(e){
										console.log(e);
									}
								});
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'api exchange pointtree is not function','file':'point-tree'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							/*end tag*/
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'end point-tree-exchange redeem','file':'point-tree'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
					}
					else{
					}
					if($('.order#order .initsetting #pointtree').length>0&&$('.order#order .initsetting #pointtree').val()=='1'){
						if($('.result #viewwindow input[name="treetel"]').val().length>0&&Number(ptmoney)>0){
							/*start tag*/
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'start point-tree-gift transfer','file':'point-tree'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
							if(typeof api_gift_pointtree!=="undefined"&&typeof api_gift_pointtree==="function"){
								if(typeof $('.result input[name="sendtype"]')!="undefined"&&$('.result input[name="sendtype"]').val()=='buytemp'){
									var giftres=api_gift_pointtree($('.viewtemp #date').html(),consecnumber,$('.result #viewwindow input[name="treetoken"]').val(),$('.result #viewwindow input[name="treetel"]').val(),(parseFloat($('.result #viewwindow #cash').html())+parseFloat($('.result #viewwindow #cashmoney').html())));
								}
								else{
									var giftres=api_gift_pointtree($('.order#order #tabs4 #listform input[name="bizdate"]').val(),consecnumber,$('.result #viewwindow input[name="treetoken"]').val(),$('.result #viewwindow input[name="treetel"]').val(),(parseFloat($('.result #viewwindow #cash').html())+parseFloat($('.result #viewwindow #cashmoney').html())));
								}
								if(giftres==''){
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										async:false,
										data:{'html':'point-tree-gift getrandom 意外錯誤','file':'point-tree'},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
								}
								else if(typeof giftres['data']!=="undefined"){//success
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										async:false,
										data:{'html':'pass point-tree-gift transfer -PHP_EOL-pos_token_tx_id:'+giftres['data']['pos_token_tx_id']+'-PHP_EOL-store_balance:'+giftres['data']['store_balance']+'-PHP_EOL-user_balance:'+giftres['data']['user_balance'],'file':'point-tree'},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
								}
								else{
									var message=JSON.parse(giftres['responseText']);
									if(giftres['status']==='timeout'){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											async:false,
											data:{'html':'point-tree-gift transfer timeout','file':'point-tree'},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else if(giftres['status']=='400'||giftres['status']=='406'){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											async:false,
											data:{'html':'point-tree-gift transfer error -PHP_EOL-status:'+giftres['status']+'-PHP_EOL-code:'+message['errors'][0]['code']+'-PHP_EOL-message:'+message['errors'][0]['message'],'file':'point-tree'},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											async:false,
											data:{'html':'point-tree-gift transfer 意外錯誤','file':'point-tree'},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
								}
							}
							else{
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'api gift pointtree is not function','file':'point-tree'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							/*end tag*/
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'end point-tree-gift transfer','file':'point-tree'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
					}
					else{
					}
				}

				if($('.order#order .initsetting #changehint').val()=='1'){
					keybord.dialog('close');
					result.dialog('close');
					$('.changehint .inv').val(invnumber);
					$('.changehint .should').val($('.result #viewwindow #should').html());
					$('.changehint .already').val($('.result #viewwindow #already').html());
					$('.changehint .change').val($('.result #viewwindow #change').html());
					change.dialog('open');
				}
				else{
					if(viewtemp.dialog('isOpen')){
						alert('發票開立完成。');
						ClearWindow('','');
						keybord.dialog('close');
						result.dialog('close');
						viewtemp.dialog('close');
						$('.order#order #list #funbox #view').trigger('click');
						$.ajax({
							url:'./lib/js/check.booking.php',
							method:'post',
							async:false,
							dataType:'html',
							success:function(d){
								if(d=='success'){
									if($('.order#order #content #MemberBill #list #funbox #point').css('background-color')=='red'){
									}
									else{
										$('.order#order #content #MemberBill #list #funbox #point').css({'background-color':'red','z-index':'3'});
									}
								}
								else{
									$('.order#order #content #MemberBill #list #funbox #point').css({'background-color':'','z-index':''});
								}
								//console.log(d);
							},
							error:function(e){
								console.log(e);
							}
						});
					}
					else{
						window.setTimeout(function(){
							if($('.order#order .initsetting #controltable').val()=='1'){
								if($('.order#order .companydata #submachine').length>0){
									location.href='./control.php?submachine&usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
								}
								else{
									if($('.order#order #tabs4 #listform input[name="machinetype"]').val()=='m1'){
										location.href='./control.php?usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
									}
									else{
										location.href='./control.php?machine='+$('.order#order #tabs4 #listform input[name="machinetype"]').val()+'&usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
									}
								}
							}
							else{
								//if($('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val().length>0){
									//location.href='./order.php?usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
									ClearWindow('','');
									keybord.dialog('close');
									result.dialog('close');
								/*}
								else{
									location.href='./order.php';
								}*/
							}},500);
					}
				}
			}
			else{//192.168.0.128
				if($.isNumeric($('.keybord input[name="num"]').val())){
					$.ajax({
						url:'./lib/js/getborddata.ajax.php',
						method:'post',
						async:false,
						data:{'num':$('.keybord input[name="num"]').val()},
						dataType:'json',
						success:function(d){
							$.ajax({
								url:'http://'+d[3]+'/bord/callnumber.php',
								method:'get',
								data:{'company':d[0],'dep':d[1],'num':d[2]},
								dataType:'html',
								success:function(v){
								},
								error:function(e){
									console.log(e);
								}
							});
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'call number : '+d[2]},
								dataType:'html',
								success:function(d){},
								error:function(e){}
							});
						},
						error:function(e){
							console.log(e);
						}
					});
					$.ajax({
						url:'./lib/js/writecallnum.ajax.php',
						method:'post',
						data:{'num':$('.keybord input[name="num"]').val()},
						dataType:'html',
						success:function(d){
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'callnumber writecallnum.ajax.php '+d},
									dataType:'html',
									success:function(d){},
									error:function(e){}
								});
							}
							else{
							}
						},
						error:function(e){
							//console.log(e);
						}
					});
					//console.log('call');
				}
				else{
					if($('.sysmeg #name1.syshint3').length>0){
						$('.sysmeg #name1.syshint3').css({'display':''});
					}
					else{
					}
					if($('.sysmeg #name2.syshint3').length>0){
						$('.sysmeg #name2.syshint3').css({'display':''});
					}
					else{
					}
					sysmeg.dialog('open');
					//alert('號碼格式錯誤。');
				}
			}
		}
		else{
			if($('.sysmeg #name1.syshint3').length>0){
				$('.sysmeg #name1.syshint3').css({'display':''});
			}
			else{
			}
			if($('.sysmeg #name2.syshint3').length>0){
				$('.sysmeg #name2.syshint3').css({'display':''});
			}
			else{
			}
			sysmeg.dialog('open');
			//alert('號碼格式錯誤。');
		}
	});
	$('.keybord').on('click','#clear',function(){
		if($('.keybord input[name="type"]').val()=='creditcard'){
			$('.keybord input[name="num"]').val('');
		}
		else{
			$('.keybord input[name="num"]').val('0');
		}
	});
	$('.keybord').on('click','#back',function(){
		if($('.keybord input[name="num"]').val().length==1){
			if($('.keybord input[name="type"]').val()=='creditcard'){
				$('.keybord input[name="num"]').val('');
			}
			else{
				$('.keybord input[name="num"]').val('0');
			}
		}
		else{
			$('.keybord input[name="num"]').val($('.keybord input[name="num"]').val().substr(0,$('.keybord input[name="num"]').val().length-1));
		}
	});
	$('.keybord').on('click','#number',function(){
		if(($('.keybord input[name="num"]').val().toString()+$(this).val().toString()).length>$('.keybord input[name="num"]').prop('max').length||Number($('.keybord input[name="num"]').val().toString()+$(this).val().toString())>Number($('.keybord input[name="num"]').prop('max'))){
		}
		else{
			if($('.keybord input[name="type"]').val()=='creditcard'){
				$('.keybord input[name="num"]').val($('.keybord input[name="num"]').val()+$(this).val());
			}
			else{
				if($('.keybord input[name="num"]').val()=='0'){
					$('.keybord input[name="num"]').val($(this).val());
				}
				else{
					$('.keybord input[name="num"]').val($('.keybord input[name="num"]').val()+$(this).val());
				}
			}
		}
	});
	$('.keybord input[name="num"]').putCursorAtEnd().on("focus", function() {
		$('.keybord input[name="num"]').putCursorAtEnd()
    });
	$('.keybord input[name="num"]').on('input',function(){
		if($('.keybord input[name="num"]').val().toString().length>$('.keybord input[name="num"]').prop('max').length||Number($('.keybord input[name="num"]').val())>Number($('.keybord input[name="num"]').prop('max'))){
			$('.keybord input[name="num"]').val($('.keybord input[name="num"]').val().substr(1,$('.keybord input[name="num"]').prop('max').length));
		}
		else{
		}
	});
	$('.keybord').on('click','#add',function(){
		$.ajax({
			url:'./lib/js/addnumber.php',
			dataType:'html',
			success:function(d){
				$('.keybord input[name="num"]').val(d);
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.keybord').on('click','#diff',function(){
		$.ajax({
			url:'./lib/js/diffnumber.php',
			dataType:'html',
			success:function(d){
				$('.keybord input[name="num"]').val(d);
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.viewtemp #salelist #salecontent').on('click','.listitems',function(){
		var index=$('.viewtemp #salelist #salecontent .listitems').index(this);
		$('.viewtemp #salelist #salecontent .listitems').prop('id','');
		$('.viewtemp #salelist #salecontent .listitems:eq('+index+')').prop('id','focus');
		$('.viewtemp #listno').html($('.viewtemp #salelist #salecontent .listitems:eq('+index+') div:eq(1)').html());
		$('.viewtemp #date').html($('.viewtemp #salelist #salecontent .listitems:eq('+index+') div:eq(0)').html());
		$('.viewtemp #credate').val($('.viewtemp #salelist #salecontent .listitems:eq('+index+') div:eq(6)').html().substr(0,8));
		$('.viewtemp #credatetime').val($('.viewtemp #salelist #salecontent .listitems:eq('+index+') div:eq(6)').html());
		$.ajax({
			url:'./lib/js/getsaledetail.ajax.php',
			method:'post',
			data:{'company':$('.order#order .companydata #company').val(),'bizdate':$('.viewtemp #salelist #salecontent .listitems:eq('+index+') div:eq(0)').html(),'no':$('.viewtemp #salelist #salecontent .listitems:eq('+index+') div:eq(1) input[name="consecnumber"]').val(),'createdatetime':$('.viewtemp #salelist #salecontent .listitems:eq('+index+') div:eq(5)').html(),'temp':'temp'},
			dataType:'html',
			success:function(d){
				//console.log(d);
				$('.viewtemp #list #listcontent').html(d);
				if($('.viewtemp #salelist #salecontent .listitems:eq('+index+') div:eq(7)').html()=="Y"){
					$('.viewtemp #viewvoid').prop('disabled',true);
					$('.viewtemp #otherfun button#plus').prop('disabled',true);
					$('.viewtemp #otherfun button#openinv').prop('disabled',true);
					$('.viewtemp #fun button#tag').prop('disabled',true);
					$('.viewtemp #fun button#forall').prop('disabled',true);
					$('.viewtemp #fun button#kitchen').prop('disabled',true);
					$('.viewtemp #fun button#changecheck').prop('disabled',true);
				}
				else{
					if($('.order#order .companydata #ispad').val()=='submachine'){
						$('.viewtemp #viewvoid').prop('disabled',true);
					}
					else{
						$('.viewtemp #viewvoid').prop('disabled',false);
					}
					$('.viewtemp #otherfun button#plus').prop('disabled',false);
					if($.trim($('.viewtemp #salelist #salecontent .listitems#focus div:eq(3)').html())==""&&$('.order#order .initsetting #useinv').val()==1&&$('.order#order .initsetting #temptoinv').val()==1){
						$('.viewtemp #otherfun button#openinv').prop('disabled',false);
						$('.viewtemp #otherfun button#reinv').prop('disabled',true);
					}
					else{
						$('.viewtemp #otherfun button#openinv').prop('disabled',true);
						$('.viewtemp #otherfun button#reinv').prop('disabled',false);
					}
					$('.viewtemp #fun button#tag').prop('disabled',false);
					$('.viewtemp #fun button#forall').prop('disabled',false);
					$('.viewtemp #fun button#kitchen').prop('disabled',false);
					$('.viewtemp #fun button#changecheck').prop('disabled',false);
				}
				$('.viewtemp #fun button#list').prop('disabled',false);
				//$('.viewtemp #fun #kitchen').prop('disabled',false);
				
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.viewtemp #list #listcontent').on('click','.label',function(){
		var index=$('.viewtemp #list #listcontent .label').index(this);
		if($('.viewtemp #list #listcontent .label:eq('+index+')').prop('class')=='label focus'){
			$('.viewtemp #list #listcontent .label:eq('+index+')').addClass( "check" );
			$('.viewtemp #list #listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked',true);
		}
		else if($('.viewtemp #list #listcontent .label:eq('+index+')').prop('class')=='label check focus'||$('.viewtemp #list #listcontent .label:eq('+index+')').prop('class')=='label focus check'){
			$('.viewtemp #list #listcontent .label:eq('+index+')').removeClass( "check" );
			$('.viewtemp #list #listcontent .label:eq('+index+') input[type="checkbox"]').prop('checked',false);
		}
		else{
			$('.viewtemp #list #listcontent .label').removeClass( "focus" );
			$('.viewtemp #list #listcontent .label:eq('+index+')').addClass( "focus" );
		}
	});
	$('.viewtemp #fun').on('click','#changecheck',function(){
		if($('.viewtemp #list #listcontent .label').length==$('.viewtemp #list #listcontent .label input[id^="checkbox"]:checked').length||$('.viewtemp #list #listcontent .label input[id^="checkbox"]:checked').length==0){
			if($('.viewtemp #list #listcontent .label input[id^="checkbox"]:checked').length>0){
				$('.viewtemp #list #listcontent .label input[id^="checkbox"]').prop('checked',false);
				$('.viewtemp #list #listcontent .label').removeClass('check');
			}
			else{
				$('.viewtemp #list #listcontent .label input[id^="checkbox"]').prop('checked',true);
				$('.viewtemp #list #listcontent .label').addClass('check');
			}
		}
		else{
			for(var i=0;i<$('.viewtemp #list #listcontent .label').length;i++){
				if($('.viewtemp #list #listcontent .label:eq('+i+') input[id^="checkbox"]').prop('checked')){
					$('.viewtemp #list #listcontent .label:eq('+i+') input[id^="checkbox"]').prop('checked',false);
					$('.viewtemp #list #listcontent .label').removeClass('check');
				}
				else{
					$('.viewtemp #list #listcontent .label:eq('+i+') input[id^="checkbox"]').prop('checked',true);
					$('.viewtemp #list #listcontent .label').addClass('check');
				}
			}
		}
	});
	$('.viewtemp #fun').on('click','#forall',function(){
		var index='';
		var qty='';
		var inumber='';
		var linenumber='';
		for(var i=0;i<$('.viewtemp #list #listcontent .label').length;i++){
			if(index.length==0){
				index=index+$('.viewtemp #list #listcontent .label:eq('+i+') div:eq(1)').html();
				qty=qty+$('.viewtemp #list #listcontent .label:eq('+i+') div:eq(4)').html();
				inumber=inumber+$('.viewtemp #list #listcontent .label:eq('+i+') input[name="inumber"]').val();
				linenumber=linenumber+$('.viewtemp #list #listcontent .label:eq('+i+') input[name="linenumber"]').val();
			}
			else{
				index=index+','+$('.viewtemp #list #listcontent .label:eq('+i+') div:eq(1)').html();
				qty=qty+','+$('.viewtemp #list #listcontent .label:eq('+i+') div:eq(4)').html();
				inumber=inumber+','+$('.viewtemp #list #listcontent .label:eq('+i+') input[name="inumber"]').val();
				linenumber=linenumber+','+$('.viewtemp #list #listcontent .label:eq('+i+') input[name="linenumber"]').val();
			}
		}
		$.ajax({
			url:'./lib/js/reprint.ajax.php',
			method:'post',
			data:{'company':$('.order#order .companydata #company').val(),'type':'tempall','listtype':$('.viewtemp input[name="listtype"]').val(),'bizdate':$('.viewtemp #date').html(),'no':$('.viewtemp #listno input[name="consecnumber"]').val(),'date':$('.viewtemp #credate').val(),'index':index,'qty':qty,'inumber':inumber,'machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val(),'linenumber':linenumber,'username':$('.order#order #tabs4 #listform input[name="username"]').val()},
			dataType:'html',
			success:function(d){
				if(d.length>20){
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'viewtemp-forall reprint.ajax.php '+d},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				//console.log(d);
				//2017/12/4var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
				//2017/12/4mywin.document.title='cashdrawer';
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.viewtemp #fun').on('click','#list',function(){
		var index='';
		var qty='';
		$.ajax({
			url:'./lib/js/reprint.ajax.php',
			method:'post',
			data:{'type':'templist','no':$('.viewtemp #listno input[name="consecnumber"]').val(),'bizdate':$('.viewtemp #date').html(),'date':$('.viewtemp #credate').val(),'index':index,'qty':qty,'machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val(),'username':$('.order#order #tabs4 #listform input[name="username"]').val()},
			dataType:'html',
			success:function(d){
				if(d.length>20){
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'viewtemp-list reprint.ajax.php '+d},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				//console.log(d);
				//2017/12/4var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
				//2017/12/4mywin.document.title='cashdrawer';
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.viewtemp #fun').on('click','#tag',function(){
		var index='';
		var qty='';
		for(var i=0;i<$('.viewtemp #list #listcontent .label').length;i++){
			if($('.viewtemp #list #listcontent .label:eq('+i+') input[id^="checkbox"]').prop('checked')){
				if(index.length==0){
					index=index+$('.viewtemp #list #listcontent .label:eq('+i+') input[name="linenumber"]').val()+','+('00'+(Number($('.viewtemp #list #listcontent .label:eq('+i+') input[name="linenumber"]').val())+1)).substr(3-(Number($('.viewtemp #list #listcontent .label:eq('+i+') input[name="linenumber"]').val())+1).length);
					qty=qty+$('.viewtemp #list #listcontent .label:eq('+i+') div:eq(4)').html();
				}
				else{
					index=index+','+$('.viewtemp #list #listcontent .label:eq('+i+') input[name="linenumber"]').val()+','+('00'+(Number($('.viewtemp #list #listcontent .label:eq('+i+') input[name="linenumber"]').val())+1)).substr(3-(Number($('.viewtemp #list #listcontent .label:eq('+i+') input[name="linenumber"]').val())+1).length);
					qty=qty+','+$('.viewtemp #list #listcontent .label:eq('+i+') div:eq(4)').html();
				}
			}
			else{
			}
		}
		$.ajax({
			url:'./lib/js/reprint.ajax.php',
			method:'post',
			data:{'type':'temptag','no':$('.viewtemp #listno input[name="consecnumber"]').val(),'bizdate':$('.viewtemp #date').html(),'date':$('.viewtemp #credate').val(),'index':index,'qty':qty},
			dataType:'html',
			success:function(d){
				if(d.length>20){
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'viewtemp-tag reprint.ajax.php '+d},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				//console.log(d);
				//2017/12/4var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
				//2017/12/4mywin.document.title='cashdrawer';
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.viewtemp #fun').on('click','#kitchen',function(){
		var qty='';
		var linenumber='';
		for(var i=0;i<$('.viewtemp #list #listcontent .label').length;i++){
			if($('.viewtemp #list #listcontent .label:eq('+i+') input[id^="checkbox"]').prop('checked')){
				if(linenumber.length==0){
					//index=index+$('.viewtemp #list #listcontent .label:eq('+i+') div:eq(1)').html();
					linenumber=linenumber+$('.viewtemp #list #listcontent .label:eq('+i+') input[name="linenumber"]').val();
					//inumber=inumber+$('.viewtemp #list #listcontent .label:eq('+i+') input[name="inumber"]').val();
					qty=qty+$('.viewtemp #list #listcontent .label:eq('+i+') div:eq(1)').html();
				}
				else{
					//index=index+','+$('.viewtemp #list #listcontent .label:eq('+i+') div:eq(1)').html();
					linenumber=linenumber+','+$('.viewtemp #list #listcontent .label:eq('+i+') input[name="linenumber"]').val();
					//inumber=inumber+','+$('.viewtemp #list #listcontent .label:eq('+i+') input[name="inumber"]').val();
					qty=qty+','+$('.viewtemp #list #listcontent .label:eq('+i+') div:eq(1)').html();
				}
			}
			else{
			}
		}
		$.ajax({
			url:'./lib/js/reprint.ajax.php',
			method:'post',
			data:{'company':$('.order#order .companydata #company').val(),'type':'tempkitchen','listtype':$('.viewtemp input[name="listtype"]').val(),'no':$('.viewtemp #listno input[name="consecnumber"]').val(),'bizdate':$('.viewtemp #date').html(),'date':$('.viewtemp #credate').val(),'qty':qty,'linenumber':linenumber,'username':$('.order#order #tabs4 #listform input[name="username"]').val()},
			dataType:'html',
			success:function(d){
				if(d.length>20){
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'viewtemp-kitchen reprint.ajax.php '+d},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				//console.log(d);
				//2017/12/4var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
				//2017/12/4mywin.document.title='cashdrawer';
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.viewtemp #fun').on('click','#prebizdate',function(){
		$.ajax({
			url:'./lib/js/getsalelist.ajax.php',
			method:'post',
			data:{'bizdate':$('.viewtemp #salelist #salecontent #bizdate').val(),'type':'-','temp':'temp'},
			dataType:'html',
			success:function(d){
				$('.viewtemp #salelist #salecontent').html(d);
				$('.viewtemp #listno').html('');
				$('.viewtemp #list #listcontent').html('');
				$('.viewtemp #date').html('');
				$('.viewtemp #credate').html('');
				$('.viewtemp #viewvoid').prop('disabled',true);
				$('.viewtemp #fun #tag').prop('disabled',true);
				$('.viewtemp #fun button#list').prop('disabled',true);
				$('.viewtemp #fun #kitchen').prop('disabled',true);
				$('.viewtemp #fun #forall').prop('disabled',true);
				$('.viewtemp #fun #changecheck').prop('disabled',true);
				$('.viewtemp #rightnow #ttmoney').html($('.viewtemp #salelist input[name="ttmoney"]').val());
				$('.viewtemp #rightnow #ttcount').html($('.viewtemp #salelist input[name="ttcount"]').val());
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.viewtemp #fun').on('click','#nextbizdate',function(){
		$.ajax({
			url:'./lib/js/getsalelist.ajax.php',
			method:'post',
			data:{'bizdate':$('.viewtemp #salelist #salecontent #bizdate').val(),'type':'+','temp':'temp'},
			dataType:'html',
			success:function(d){
				$('.viewtemp #salelist #salecontent').html(d);
				$('.viewtemp #listno').html('');
				$('.viewtemp #list #listcontent').html('');
				$('.viewtemp #date').html('');
				$('.viewtemp #credate').html('');
				$('.viewtemp #viewvoid').prop('disabled',true);
				$('.viewtemp #fun #tag').prop('disabled',true);
				$('.viewtemp #fun button#list').prop('disabled',true);
				$('.viewtemp #fun #kitchen').prop('disabled',true);
				$('.viewtemp #fun #forall').prop('disabled',true);
				$('.viewtemp #fun #changecheck').prop('disabled',true);
				$('.viewtemp #rightnow #ttmoney').html($('.viewtemp #salelist input[name="ttmoney"]').val());
				$('.viewtemp #rightnow #ttcount').html($('.viewtemp #salelist input[name="ttcount"]').val());
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.viewtemp').on('click','#viewvoid',function(){
		if($('.order#order .initsetting #controltable').val()=='1'){
			$.ajax({
				url:'./lib/js/checktabstate.ajax.php',
				method:'post',
				async:false,
				data:{'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'machine':$('.order#order #tabs4 #listform input[name="machinetype"]').val()},
				dataType:'html',
				success:function(d){
					console.log(d);
					var tempd=d.split('-');
					if(tempd[0]=='unlock'){
						//$('.viewtemp #viewvoid').prop('disabled',true);
						if($('.order#order .initsetting #voidsale').val()=='0'){
							if($.trim($('.viewtemp #salelist #salecontent .listitems#focus div:eq(3)').html()).length!=0){//檢查是否已開立發票
								var hint=confirm('請確認發票正本已收回。');
								if(hint==true){
									var nowbizdate=$('.viewtemp #date').html();
									if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
										var posdvrfile='';
									}
									else{
									}
									$.ajax({
										url:'./lib/js/viewvoid.ajax.php',
										method:'post',
										async:false,
										data:{'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val()},
										dataType:'html',
										success:function(d){
											var tempres=d.split('-');
											if(d.length>20){
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													async:false,
													data:{'html':'viewtemp-viewvoid viewvoid.ajax.php '+d},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else{
											}
											if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
												var posdvrfile=tempres[1];
											}
											else{
											}
											//console.log(d);
											if(tempres[0]=='success'){
												$.ajax({//作廢發票
													url:'./lib/js/deleteinv.ajax.php',
													method:'post',
													async:false,
													data:{'bizdate':$('.viewtemp #date').html(),'number':$('.viewtemp #salelist #salecontent .listitems#focus div:eq(3)').html()},
													dataType:'html',
													success:function(d){
														if(d.length>20){
															$.ajax({
																url:'./lib/js/print.php',
																method:'post',
																data:{'html':'viewtemp-viewvoid deleteinv.ajax.php '+d},
																dataType:'html',
																success:function(d){/*console.log(d);*/},
																error:function(e){/*console.log(e);*/}
															});
														}
														else{
														}
														//console.log(d);
														$('.viewtemp #salelist #salecontent .listitems').prop('id','');
														$('.viewtemp #listno').html('');
														$('.viewtemp #list #listcontent').html('');
														$('.viewtemp #date').html('');
														$('.viewtemp #credate').html('');
														$('.viewtemp #otherfun button#plus').prop('disabled',true);
														$('.viewtemp #otherfun button#openinv').prop('disabled',true);
														$('.viewtemp #viewvoid').prop('disabled',true);
														$('.viewtemp #fun button#forall').prop('disabled',true);
														$('.viewtemp #fun button#list').prop('disabled',true);
														$('.viewtemp #fun button#tag').prop('disabled',true);
														$('.viewtemp #fun button#kitchen').prop('disabled',true);
														$('.viewtemp #fun button#changecheck').prop('disabled',true);
														$('.order#order #MemberBill #list #funbox #view').trigger('click');
														//2017/12/29var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
														//2017/12/29mywin.document.title='cashdrawer';
													},
													error:function(e){
														//console.log(e);
													}
												});
											}
											else{
												//console.log(d);
											}
										},
										error:function(e){
											//console.log(e);
										}
									});
									$.ajax({
										url:'./lib/js/create.cmdtxt.php',
										method:'post',
										async: false,
										data:{'cmd':nowbizdate.substr(0,6)+'-change'},
										dataType:'html',
										success:function(d){
											//console.log(d);
										},
										error:function(e){
											//console.log(e);
										}
									});
									/*錢都錄借接*/
									if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
										/*start tag*/
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											async:false,
											data:{'html':'start posdvr-sendmessage','file':'posdvr'},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){console.log(e);}
										});
										if(typeof api_sendmessage_posdvr!=="undefined"&&typeof api_sendmessage_posdvr==="function"){
											api_sendmessage_posdvr(posdvrfile);
											$.ajax({
												url:'./lib/js/print.php',
												method:'post',
												data:{'html':'success','file':'posdvr'},
												dataType:'html',
												success:function(d){/*console.log(d);*/},
												error:function(e){/*console.log(e);*/}
											});
										}
										else{
											$.ajax({
												url:'./lib/js/print.php',
												method:'post',
												async:false,
												data:{'html':'error sendmessage is not function','file':'posdvr'},
												dataType:'html',
												success:function(d){/*console.log(d);*/},
												error:function(e){/*console.log(e);*/}
											});
										}
										/*end tag*/
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											async:false,
											data:{'html':'end posdvr-sendmessage','file':'posdvr'},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
								}
								else{
								}
								
							}
							else{
								var nowbizdate=$('.viewtemp #date').html();
								if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
									var posdvrfile='';
								}
								else{
								}
								$.ajax({
									url:'./lib/js/viewvoid.ajax.php',
									method:'post',
									data:{'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val()},
									dataType:'html',
									success:function(d){
										var tempres=d.split('-');
										if(d.length>20){
											$.ajax({
												url:'./lib/js/print.php',
												method:'post',
												data:{'html':'viewtemp-viewvoid viewvoid.ajax.php '+d},
												dataType:'html',
												success:function(d){/*console.log(d);*/},
												error:function(e){/*console.log(e);*/}
											});
										}
										else{
										}
										if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
											var posdvrfile=tempres[1];
										}
										else{
										}
										//console.log(d);
										$('.viewtemp #salelist #salecontent .listitems').prop('id','');
										$('.viewtemp #listno').html('');
										$('.viewtemp #list #listcontent').html('');
										$('.viewtemp #date').html('');
										$('.viewtemp #credate').html('');
										$('.viewtemp #otherfun button#plus').prop('disabled',true);
										$('.viewtemp #otherfun button#openinv').prop('disabled',true);
										$('.viewtemp #viewvoid').prop('disabled',true);
										$('.viewtemp #fun button#forall').prop('disabled',true);
										$('.viewtemp #fun button#list').prop('disabled',true);
										$('.viewtemp #fun button#tag').prop('disabled',true);
										$('.viewtemp #fun button#kitchen').prop('disabled',true);
										$('.viewtemp #fun button#changecheck').prop('disabled',true);
										$('.order#order #MemberBill #list #funbox #view').trigger('click');
									},
									error:function(e){
										//console.log(e);
									}
								});
								/*錢都錄借接*/
								if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
									/*start tag*/
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										async:false,
										data:{'html':'start posdvr-sendmessage','file':'posdvr'},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){console.log(e);}
									});
									if(typeof api_sendmessage_posdvr!=="undefined"&&typeof api_sendmessage_posdvr==="function"){
										api_sendmessage_posdvr(posdvrfile);
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'success','file':'posdvr'},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											async:false,
											data:{'html':'error sendmessage is not function','file':'posdvr'},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									/*end tag*/
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										async:false,
										data:{'html':'end posdvr-sendmessage','file':'posdvr'},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
								}
								else{
								}
								$.ajax({
									url:'./lib/js/create.cmdtxt.php',
									method:'post',
									async: false,
									data:{'cmd':nowbizdate.substr(0,6)+'-change'},
									dataType:'html',
									success:function(d){
										//console.log(d);
									},
									error:function(e){
										//console.log(e);
									}
								});
							}
						}
						else{
							$('.verpsw input[name="type"]').val('viewvoid');
							verpsw.dialog('open');
						}
					}
					else{
						var res=confirm(tempd[1]+'點餐中。\n是否仍要點餐？');
						if(res==true){
							if($('.order#order .initsetting #voidsale').val()=='0'){
								if($.trim($('.viewtemp #salelist #salecontent .listitems#focus div:eq(3)').html()).length!=0){//檢查是否已開立發票
									var hint=confirm('請確認發票正本已收回。');
									if(hint==true){
										var nowbizdate=$('.viewtemp #date').html();
										if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
											var posdvrfile='';
										}
										else{
										}
										$.ajax({
											url:'./lib/js/viewvoid.ajax.php',
											method:'post',
											async:false,
											data:{'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val()},
											dataType:'html',
											success:function(d){
												var tempres=d.split('-');
												if(d.length>20){
													$.ajax({
														url:'./lib/js/print.php',
														method:'post',
														async:false,
														data:{'html':'viewtemp-viewvoid viewvoid.ajax.php '+d},
														dataType:'html',
														success:function(d){/*console.log(d);*/},
														error:function(e){/*console.log(e);*/}
													});
												}
												else{
												}
												if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
													var posdvrfile=tempres[1];
												}
												else{
												}
												//console.log(d);
												if(tempres[0]=='success'){
													$.ajax({//作廢發票
														url:'./lib/js/deleteinv.ajax.php',
														method:'post',
														async:false,
														data:{'bizdate':$('.viewtemp #date').html(),'number':$('.viewtemp #salelist #salecontent .listitems#focus div:eq(3)').html()},
														dataType:'html',
														success:function(d){
															if(d.length>20){
																$.ajax({
																	url:'./lib/js/print.php',
																	method:'post',
																	async:false,
																	data:{'html':'viewtemp-viewvoid deleteinv.ajax.php '+d},
																	dataType:'html',
																	success:function(d){/*console.log(d);*/},
																	error:function(e){/*console.log(e);*/}
																});
															}
															else{
															}
															//console.log(d);
															$('.viewtemp #salelist #salecontent .listitems').prop('id','');
															$('.viewtemp #listno').html('');
															$('.viewtemp #list #listcontent').html('');
															$('.viewtemp #date').html('');
															$('.viewtemp #credate').html('');
															$('.viewtemp #otherfun button#plus').prop('disabled',true);
															$('.viewtemp #otherfun button#openinv').prop('disabled',true);
															$('.viewtemp #viewvoid').prop('disabled',true);
															$('.viewtemp #fun button#forall').prop('disabled',true);
															$('.viewtemp #fun button#list').prop('disabled',true);
															$('.viewtemp #fun button#tag').prop('disabled',true);
															$('.viewtemp #fun button#kitchen').prop('disabled',true);
															$('.viewtemp #fun button#changecheck').prop('disabled',true);
															$('.order#order #MemberBill #list #funbox #view').trigger('click');
															//2017/12/29var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
															//2017/12/29mywin.document.title='cashdrawer';
														},
														error:function(e){
															//console.log(e);
														}
													});
												}
												else{
													//console.log(d);
												}
											},
											error:function(e){
												//console.log(e);
											}
										});
										/*錢都錄借接*/
										if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
											/*start tag*/
											$.ajax({
												url:'./lib/js/print.php',
												method:'post',
												async:false,
												data:{'html':'start posdvr-sendmessage','file':'posdvr'},
												dataType:'html',
												success:function(d){/*console.log(d);*/},
												error:function(e){console.log(e);}
											});
											if(typeof api_sendmessage_posdvr!=="undefined"&&typeof api_sendmessage_posdvr==="function"){
												api_sendmessage_posdvr(posdvrfile);
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													data:{'html':'success','file':'posdvr'},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else{
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													async:false,
													data:{'html':'error sendmessage is not function','file':'posdvr'},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											/*end tag*/
											$.ajax({
												url:'./lib/js/print.php',
												method:'post',
												async:false,
												data:{'html':'end posdvr-sendmessage','file':'posdvr'},
												dataType:'html',
												success:function(d){/*console.log(d);*/},
												error:function(e){/*console.log(e);*/}
											});
										}
										else{
										}
										$.ajax({
											url:'./lib/js/create.cmdtxt.php',
											method:'post',
											async: false,
											data:{'cmd':nowbizdate.substr(0,6)+'-change'},
											dataType:'html',
											success:function(d){
												//console.log(d);
											},
											error:function(e){
												//console.log(e);
											}
										});
									}
									else{
									}
									
								}
								else{
									var nowbizdate=$('.viewtemp #date').html();
									if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
										var posdvrfile='';
									}
									else{
									}
									$.ajax({
										url:'./lib/js/viewvoid.ajax.php',
										method:'post',
										async:false,
										data:{'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val()},
										dataType:'html',
										success:function(d){
											var tempres=d.split('-');
											if(d.length>20){
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													async:false,
													data:{'html':'viewtemp-viewvoid viewvoid.ajax.php '+d},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else{
											}
											if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
												var posdvrfile=tempres[1];
											}
											else{
											}
											//console.log(d);
											$('.viewtemp #salelist #salecontent .listitems').prop('id','');
											$('.viewtemp #listno').html('');
											$('.viewtemp #list #listcontent').html('');
											$('.viewtemp #date').html('');
											$('.viewtemp #credate').html('');
											$('.viewtemp #otherfun button#plus').prop('disabled',true);
											$('.viewtemp #otherfun button#openinv').prop('disabled',true);
											$('.viewtemp #viewvoid').prop('disabled',true);
											$('.viewtemp #fun button#forall').prop('disabled',true);
											$('.viewtemp #fun button#list').prop('disabled',true);
											$('.viewtemp #fun button#tag').prop('disabled',true);
											$('.viewtemp #fun button#kitchen').prop('disabled',true);
											$('.viewtemp #fun button#changecheck').prop('disabled',true);
											$('.order#order #MemberBill #list #funbox #view').trigger('click');
										},
										error:function(e){
											//console.log(e);
										}
									});
									/*錢都錄借接*/
									if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
										/*start tag*/
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											async:false,
											data:{'html':'start posdvr-sendmessage','file':'posdvr'},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){console.log(e);}
										});
										if(typeof api_sendmessage_posdvr!=="undefined"&&typeof api_sendmessage_posdvr==="function"){
											api_sendmessage_posdvr(posdvrfile);
											$.ajax({
												url:'./lib/js/print.php',
												method:'post',
												data:{'html':'success','file':'posdvr'},
												dataType:'html',
												success:function(d){/*console.log(d);*/},
												error:function(e){/*console.log(e);*/}
											});
										}
										else{
											$.ajax({
												url:'./lib/js/print.php',
												method:'post',
												async:false,
												data:{'html':'error sendmessage is not function','file':'posdvr'},
												dataType:'html',
												success:function(d){/*console.log(d);*/},
												error:function(e){/*console.log(e);*/}
											});
										}
										/*end tag*/
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											async:false,
											data:{'html':'end posdvr-sendmessage','file':'posdvr'},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									$.ajax({
										url:'./lib/js/create.cmdtxt.php',
										method:'post',
										async: false,
										data:{'cmd':nowbizdate.substr(0,6)+'-change'},
										dataType:'html',
										success:function(d){
											//console.log(d);
										},
										error:function(e){
											//console.log(e);
										}
									});
								}
							}
							else{
								$('.verpsw input[name="type"]').val('viewvoid');
								verpsw.dialog('open');
							}
						}
						else{
						}
					}
				},
				error:function(e){
					console.log(e);
				}
			});
		}
		else{
			//$('.viewtemp #viewvoid').prop('disabled',true);
			if($('.order#order .initsetting #voidsale').val()=='0'){
				if($.trim($('.viewtemp #salelist #salecontent .listitems#focus div:eq(3)').html()).length!=0){//檢查是否已開立發票
					var hint=confirm('請確認發票正本已收回。');
					if(hint==true){
						var nowbizdate=$('.viewtemp #date').html();
						if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
							var posdvrfile='';
						}
						else{
						}
						$.ajax({
							url:'./lib/js/viewvoid.ajax.php',
							method:'post',
							async:false,
							data:{'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val()},
							dataType:'html',
							success:function(d){
								var tempres=d.split('-');
								if(d.length>20){
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										data:{'html':'viewtemp-viewvoid viewvoid.ajax.php '+d},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
								}
								else{
								}
								if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
									var posdvrfile=tempres[1];
								}
								else{
								}
								//console.log(d);
								if(tempres[0]=='success'){
									$.ajax({//作廢發票
										url:'./lib/js/deleteinv.ajax.php',
										method:'post',
										async:false,
										data:{'bizdate':$('.viewtemp #date').html(),'number':$('.viewtemp #salelist #salecontent .listitems#focus div:eq(3)').html()},
										dataType:'html',
										success:function(d){
											if(d.length>20){
												$.ajax({
													url:'./lib/js/print.php',
													method:'post',
													async:false,
													data:{'html':'viewtemp-viewvoid deleteinv.ajax.php '+d},
													dataType:'html',
													success:function(d){/*console.log(d);*/},
													error:function(e){/*console.log(e);*/}
												});
											}
											else{
											}
											//console.log(d);
											$('.viewtemp #salelist #salecontent .listitems').prop('id','');
											$('.viewtemp #listno').html('');
											$('.viewtemp #list #listcontent').html('');
											$('.viewtemp #date').html('');
											$('.viewtemp #credate').html('');
											$('.viewtemp #otherfun button#plus').prop('disabled',true);
											$('.viewtemp #otherfun button#openinv').prop('disabled',true);
											$('.viewtemp #viewvoid').prop('disabled',true);
											$('.viewtemp #fun button#forall').prop('disabled',true);
											$('.viewtemp #fun button#list').prop('disabled',true);
											$('.viewtemp #fun button#tag').prop('disabled',true);
											$('.viewtemp #fun button#kitchen').prop('disabled',true);
											$('.viewtemp #fun button#changecheck').prop('disabled',true);
											$('.order#order #MemberBill #list #funbox #view').trigger('click');
											//2017/12/29var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
											//2017/12/29mywin.document.title='cashdrawer';
										},
										error:function(e){
											//console.log(e);
										}
									});
								}
								else{
									//console.log(d);
								}
							},
							error:function(e){
								//console.log(e);
							}
						});
						/*錢都錄借接*/
						if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
							/*start tag*/
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'start posdvr-sendmessage','file':'posdvr'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){console.log(e);}
							});
							if(typeof api_sendmessage_posdvr!=="undefined"&&typeof api_sendmessage_posdvr==="function"){
								api_sendmessage_posdvr(posdvrfile);
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'success','file':'posdvr'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									async:false,
									data:{'html':'error sendmessage is not function','file':'posdvr'},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							/*end tag*/
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'end posdvr-sendmessage','file':'posdvr'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						$.ajax({
							url:'./lib/js/create.cmdtxt.php',
							method:'post',
							async: false,
							data:{'cmd':nowbizdate.substr(0,6)+'-change'},
							dataType:'html',
							success:function(d){
								//console.log(d);
							},
							error:function(e){
								//console.log(e);
							}
						});
					}
					else{
					}
					
				}
				else{
					var nowbizdate=$('.viewtemp #date').html();
					if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
						var posdvrfile='';
					}
					else{
					}
					$.ajax({
						url:'./lib/js/viewvoid.ajax.php',
						method:'post',
						async:false,
						data:{'terminalnumber':$('.order#order .companydata #terminalnumber').val(),'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val()},
						dataType:'html',
						success:function(d){
							var tempres=d.split('-');
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'viewtemp-viewvoid viewvoid.ajax.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
								var posdvrfile=tempres[1];
							}
							else{
							}
							//console.log(d);
							$('.viewtemp #salelist #salecontent .listitems').prop('id','');
							$('.viewtemp #listno').html('');
							$('.viewtemp #list #listcontent').html('');
							$('.viewtemp #date').html('');
							$('.viewtemp #credate').html('');
							$('.viewtemp #otherfun button#plus').prop('disabled',true);
							$('.viewtemp #otherfun button#openinv').prop('disabled',true);
							$('.viewtemp #viewvoid').prop('disabled',true);
							$('.viewtemp #fun button#forall').prop('disabled',true);
							$('.viewtemp #fun button#list').prop('disabled',true);
							$('.viewtemp #fun button#tag').prop('disabled',true);
							$('.viewtemp #fun button#kitchen').prop('disabled',true);
							$('.viewtemp #fun button#changecheck').prop('disabled',true);
							$('.order#order #MemberBill #list #funbox #view').trigger('click');
						},
						error:function(e){
							//console.log(e);
						}
					});
					/*錢都錄借接*/
					if($('.order#order .initsetting #posdvr').length>0&&$('.order#order .initsetting #posdvr').val()=='1'){
						/*start tag*/
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							async:false,
							data:{'html':'start posdvr-sendmessage','file':'posdvr'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){console.log(e);}
						});
						if(typeof api_sendmessage_posdvr!=="undefined"&&typeof api_sendmessage_posdvr==="function"){
							api_sendmessage_posdvr(posdvrfile);
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'success','file':'posdvr'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								async:false,
								data:{'html':'error sendmessage is not function','file':'posdvr'},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						/*end tag*/
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							async:false,
							data:{'html':'end posdvr-sendmessage','file':'posdvr'},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					$.ajax({
						url:'./lib/js/create.cmdtxt.php',
						method:'post',
						async: false,
						data:{'cmd':nowbizdate.substr(0,6)+'-change'},
						dataType:'html',
						success:function(d){
							//console.log(d);
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
			}
			else{
				$('.verpsw input[name="type"]').val('viewvoid');
				verpsw.dialog('open');
			}
		}
	});
	$('.viewtemp #fun').on('click','#exit',function(){
		viewtemp.dialog('close');
	});
	$('.viewtemp #otherfun').on('click','#plus',function(){
		if($.trim($('.viewtemp #salelist #salecontent .listitems#focus div:eq(3)').html()).length!=0){//檢查是否開立發票
			$('.temptoinv').html('');
			$('.temptoinv').append("<button id='delplus' value='修改帳單'>修改帳單</button>");
			$('.temptoinv').append("<button id='buylist' value='結帳'>結帳</button>");
			$('.temptoinv').append("<button id='cancel' value='取消'>取消</button>");
			temptoinv.dialog('open');
		}
		else{
			//console.log($.trim($('.viewtemp #listno').html()));
			if($('.order#order .initsetting #controltable').val()=='1'){
				$.ajax({
					url:'./lib/js/checktabstate.ajax.php',
					method:'post',
					async:false,
					data:{'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'machine':$('.order#order #tabs4 #listform input[name="machinetype"]').val()},
					dataType:'html',
					success:function(d){
						console.log(d);
						var tempd=d.split('-');
						if(tempd[0]=='unlock'){
							temporder($('.viewtemp #date').html(),$('.viewtemp #listno input[name="consecnumber"]').val(),$('.order#order #tabs4 #listform input[name="machinetype"]').val(),$('.order#order .companydata #company').val(),$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val(),$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val());
							/*initlisttype();
							initsumbox();
							initparameters();
							inittempbox();
							initlists();
							initorder();
							$.ajax({
								url:'./lib/js/temporder.banner.php',
								method:'post',
								async: false,
								data:{'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val()},
								dataType:'json',
								success:function(d){
									//console.log(d);
									if(d[0]['REMARKS'].toString().match(/-/g)){
										var temp=d[0]['REMARKS'].toString().split("-");
										$('.order#order #banner #type input[name="reservedatetime"]').val(temp[1]);
										if(temp[0]=='1'){
											$('.order#order #banner #type').css({'margin-right':'1px'});
											$('.order#order #banner #type button.inside').prop('disabled',true);
											
											var temp=$.trim($('.viewtemp #listno').html()).split('<br>');
											if($('.order#order .initsetting #tabnum').val()==0){
												$('.order#order #banner #tablenumber').prop('style','float: left;height: 100%;margin: 0px 1px;');
												$('.order#order #banner #tablenumber').html('');
												$('.order#order #banner #detail').css({'margin-left':'calc(47% - 478px)'});
											}
											else{
												$('.order#order #banner #tablenumber').prop('style','float: left;width: calc(42% / 5 - 2px);height: 100%;margin: 0px 1px;');
												$('.order#order #banner #tablenumber').html('<div style="width:100%;height:50%;text-align:center;">內用桌號</div><div class="tabnumbox" style="width:100%;height:50%;border:1px solid #898989;text-align:center;border-radius: 5px;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;">'+temp[0]+'</div>');
												$('.order#order #banner #detail').css({'margin-left':'3px'});
											}
											
											$('.order#order #banner #detail #viewtotal').val(d[0]['SALESTTLAMT']);
											$('.order#order #banner #detail #viewnumber').val(d[0]['SALESTTLQTY']);
										}
										else{
											$('.order#order #banner #type').css({'margin-right':'calc(42% / 5)'});
											if(temp[0]=='2'){
												$('.order#order #banner #type button.come').prop('disabled',true);
											}
											else if(temp[0]=='3'){
												$('.order#order #banner #type button.outside').prop('disabled',true);
											}
											else{
												$('.order#order #banner #type button.bysale').prop('disabled',true);
											}
											$('.order#order #banner #tablenumber').prop('style','float: left;');
											$('.order#order #banner #tablenumber').html('');
											$('.order#order #banner #detail').css({'margin-left':'3px'});
											$('.order#order #banner #detail #viewtotal').val(d[0]['SALESTTLAMT']);
											$('.order#order #banner #detail #viewnumber').val(d[0]['SALESTTLQTY']);
										}
									}
									else{
										if(d[0]['REMARKS']=='1'){
											$('.order#order #banner #type').css({'margin-right':'1px'});
											$('.order#order #banner #type button.inside').prop('disabled',true);
											
											var temp=$.trim($('.viewtemp #listno').html()).split('<br>');
											if($('.order#order .initsetting #tabnum').val()==0){
												$('.order#order #banner #tablenumber').prop('style','float: left;height: 100%;margin: 0px 1px;');
												$('.order#order #banner #tablenumber').html('');
												$('.order#order #banner #detail').css({'margin-left':'calc(47% - 478px)'});
											}
											else{
												$('.order#order #banner #tablenumber').prop('style','float: left;width: calc(42% / 5 - 2px);height: 100%;margin: 0px 1px;');
												$('.order#order #banner #tablenumber').html('<div style="width:100%;height:50%;text-align:center;">內用桌號</div><div class="tabnumbox" style="width:100%;height:50%;border:1px solid #898989;text-align:center;border-radius: 5px;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;">'+temp[0]+'</div>');
												$('.order#order #banner #detail').css({'margin-left':'3px'});
											}
											
											$('.order#order #banner #detail #viewtotal').val(d[0]['SALESTTLAMT']);
											$('.order#order #banner #detail #viewnumber').val(d[0]['SALESTTLQTY']);
										}
										else{
											$('.order#order #banner #type').css({'margin-right':'calc(42% / 5)'});
											if(d[0]['REMARKS']=='2'){
												$('.order#order #banner #type button.come').prop('disabled',true);
											}
											else if(d[0]['REMARKS']=='3'){
												$('.order#order #banner #type button.outside').prop('disabled',true);
											}
											else{
												$('.order#order #banner #type button.bysale').prop('disabled',true);
											}
											$('.order#order #banner #tablenumber').prop('style','float: left;');
											$('.order#order #banner #tablenumber').html('');
											$('.order#order #banner #detail').css({'margin-left':'3px'});
											$('.order#order #banner #detail #viewtotal').val(d[0]['SALESTTLAMT']);
											$('.order#order #banner #detail #viewnumber').val(d[0]['SALESTTLQTY']);
										}
									}
									$.ajax({
										url:'./lib/js/temporder.list.php',
										method:'post',
										async: false,
										data:{'machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val(),'company':$('.order#order .companydata #company').val(),'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'usercode':$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val(),'username':$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val()},
										dataType:'html',
										success:function(d){
											$.ajax({
												url:'./lib/js/checktabini.ajax.php',
												method:'post',
												async:false,
												data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tabnum':$('.order#order #tabs4 #listform input[name="tablenumber"]').val()},
												dataType:'html',
												success:function(d){
													console.log(d);
												},
												error:function(e){
													console.log(e);
												}
											});
											$('.order#order #MemberBill #list #tabs4 #listform').html(d);
											$('.setperson #view input[name="persons1"]').val($('.order#order #tabs4 #listform input[name="person1"]').val());
											$('.setperson #view input[name="persons2"]').val($('.order#order #tabs4 #listform input[name="person2"]').val());
											$('.setperson #view input[name="persons3"]').val($('.order#order #tabs4 #listform input[name="person3"]').val());
											//console.log($('.setperson #view input[name="persons1"]').val());
											//console.log($('.order#order #tabs4 #listform input[name="person1"]').val());
											$('.setperson #buttons #submit').trigger('click');
										},
										error:function(e){
											//console.log(e);
										}
									});
								},
								error:function(e){
									//console.log(e);
								}
							});*/
							viewtemp.dialog('close');
						}
						else{
							var res=condirm(tempd[1]+'點餐中。\n是否仍要點餐？');
							if(res==true){
								temporder($('.viewtemp #date').html(),$('.viewtemp #listno input[name="consecnumber"]').val(),$('.order#order #tabs4 #listform input[name="machinetype"]').val(),$('.order#order .companydata #company').val(),$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val(),$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val());
								/*initlisttype();
								initsumbox();
								initparameters();
								inittempbox();
								initlists();
								initorder();
								$.ajax({
									url:'./lib/js/temporder.banner.php',
									method:'post',
									async: false,
									data:{'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val()},
									dataType:'json',
									success:function(d){
										//console.log(d);
										if(d[0]['REMARKS'].toString().match(/-/g)){
											var temp=d[0]['REMARKS'].toString().split("-");
											$('.order#order #banner #type input[name="reservedatetime"]').val(temp[1]);
											if(temp[0]=='1'){
												$('.order#order #banner #type').css({'margin-right':'1px'});
												$('.order#order #banner #type button.inside').prop('disabled',true);
												
												var temp=$.trim($('.viewtemp #listno').html()).split('<br>');
												if($('.order#order .initsetting #tabnum').val()==0){
													$('.order#order #banner #tablenumber').prop('style','float: left;height: 100%;margin: 0px 1px;');
													$('.order#order #banner #tablenumber').html('');
													$('.order#order #banner #detail').css({'margin-left':'calc(47% - 478px)'});
												}
												else{
													$('.order#order #banner #tablenumber').prop('style','float: left;width: calc(42% / 5 - 2px);height: 100%;margin: 0px 1px;');
													$('.order#order #banner #tablenumber').html('<div style="width:100%;height:50%;text-align:center;">內用桌號</div><div class="tabnumbox" style="width:100%;height:50%;border:1px solid #898989;text-align:center;border-radius: 5px;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;">'+temp[0]+'</div>');
													$('.order#order #banner #detail').css({'margin-left':'3px'});
												}
												
												$('.order#order #banner #detail #viewtotal').val(d[0]['SALESTTLAMT']);
												$('.order#order #banner #detail #viewnumber').val(d[0]['SALESTTLQTY']);
											}
											else{
												$('.order#order #banner #type').css({'margin-right':'calc(42% / 5)'});
												if(temp[0]=='2'){
													$('.order#order #banner #type button.come').prop('disabled',true);
												}
												else if(temp[0]=='3'){
													$('.order#order #banner #type button.outside').prop('disabled',true);
												}
												else{
													$('.order#order #banner #type button.bysale').prop('disabled',true);
												}
												$('.order#order #banner #tablenumber').prop('style','float: left;');
												$('.order#order #banner #tablenumber').html('');
												$('.order#order #banner #detail').css({'margin-left':'3px'});
												$('.order#order #banner #detail #viewtotal').val(d[0]['SALESTTLAMT']);
												$('.order#order #banner #detail #viewnumber').val(d[0]['SALESTTLQTY']);
											}
										}
										else{
											if(d[0]['REMARKS']=='1'){
												$('.order#order #banner #type').css({'margin-right':'1px'});
												$('.order#order #banner #type button.inside').prop('disabled',true);
												
												var temp=$.trim($('.viewtemp #listno').html()).split('<br>');
												if($('.order#order .initsetting #tabnum').val()==0){
													$('.order#order #banner #tablenumber').prop('style','float: left;height: 100%;margin: 0px 1px;');
													$('.order#order #banner #tablenumber').html('');
													$('.order#order #banner #detail').css({'margin-left':'calc(47% - 478px)'});
												}
												else{
													$('.order#order #banner #tablenumber').prop('style','float: left;width: calc(42% / 5 - 2px);height: 100%;margin: 0px 1px;');
													$('.order#order #banner #tablenumber').html('<div style="width:100%;height:50%;text-align:center;">內用桌號</div><div class="tabnumbox" style="width:100%;height:50%;border:1px solid #898989;text-align:center;border-radius: 5px;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;">'+temp[0]+'</div>');
													$('.order#order #banner #detail').css({'margin-left':'3px'});
												}
												
												$('.order#order #banner #detail #viewtotal').val(d[0]['SALESTTLAMT']);
												$('.order#order #banner #detail #viewnumber').val(d[0]['SALESTTLQTY']);
											}
											else{
												$('.order#order #banner #type').css({'margin-right':'calc(42% / 5)'});
												if(d[0]['REMARKS']=='2'){
													$('.order#order #banner #type button.come').prop('disabled',true);
												}
												else if(d[0]['REMARKS']=='3'){
													$('.order#order #banner #type button.outside').prop('disabled',true);
												}
												else{
													$('.order#order #banner #type button.bysale').prop('disabled',true);
												}
												$('.order#order #banner #tablenumber').prop('style','float: left;');
												$('.order#order #banner #tablenumber').html('');
												$('.order#order #banner #detail').css({'margin-left':'3px'});
												$('.order#order #banner #detail #viewtotal').val(d[0]['SALESTTLAMT']);
												$('.order#order #banner #detail #viewnumber').val(d[0]['SALESTTLQTY']);
											}
										}
										$.ajax({
											url:'./lib/js/temporder.list.php',
											method:'post',
											async: false,
											data:{'machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val(),'company':$('.order#order .companydata #company').val(),'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'usercode':$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val(),'username':$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val()},
											dataType:'html',
											success:function(d){
												$.ajax({
													url:'./lib/js/checktabini.ajax.php',
													method:'post',
													async:false,
													data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tabnum':$('.order#order #tabs4 #listform input[name="tablenumber"]').val()},
													dataType:'html',
													success:function(d){
														console.log(d);
													},
													error:function(e){
														console.log(e);
													}
												});
												$('.order#order #MemberBill #list #tabs4 #listform').html(d);
												$('.setperson #view input[name="persons1"]').val($('.order#order #tabs4 #listform input[name="person1"]').val());
												$('.setperson #view input[name="persons2"]').val($('.order#order #tabs4 #listform input[name="person2"]').val());
												$('.setperson #view input[name="persons3"]').val($('.order#order #tabs4 #listform input[name="person3"]').val());
												//console.log($('.setperson #view input[name="persons1"]').val());
												//console.log($('.order#order #tabs4 #listform input[name="person1"]').val());
												$('.setperson #buttons #submit').trigger('click');
											},
											error:function(e){
												//console.log(e);
											}
										});
									},
									error:function(e){
										//console.log(e);
									}
								});*/
								viewtemp.dialog('close');
							}
							else{
							}
						}
					},
					error:function(e){
						console.log(e);
					}
				});
			}
			else{
				temporder($('.viewtemp #date').html(),$('.viewtemp #listno input[name="consecnumber"]').val(),$('.order#order #tabs4 #listform input[name="machinetype"]').val(),$('.order#order .companydata #company').val(),$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val(),$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val());
				/*initlisttype();
				initsumbox();
				initparameters();
				inittempbox();
				initlists();
				initorder();
				$.ajax({
					url:'./lib/js/temporder.banner.php',
					method:'post',
					async: false,
					data:{'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val()},
					dataType:'json',
					success:function(d){
						//console.log(d);
						if(d[0]['REMARKS'].toString().match(/-/g)){
							var temp=d[0]['REMARKS'].toString().split("-");
							$('.order#order #banner #type input[name="reservedatetime"]').val(temp[1]);
							if(temp[0]=='1'){
								$('.order#order #banner #type').css({'margin-right':'1px'});
								$('.order#order #banner #type button.inside').prop('disabled',true);
								
								var temp=$.trim($('.viewtemp #listno').html()).split('<br>');
								if($('.order#order .initsetting #tabnum').val()==0){
									$('.order#order #banner #tablenumber').prop('style','float: left;height: 100%;margin: 0px 1px;');
									$('.order#order #banner #tablenumber').html('');
									$('.order#order #banner #detail').css({'margin-left':'calc(47% - 478px)'});
								}
								else{
									$('.order#order #banner #tablenumber').prop('style','float: left;width: calc(42% / 5 - 2px);height: 100%;margin: 0px 1px;');
									$('.order#order #banner #tablenumber').html('<div style="width:100%;height:50%;text-align:center;">內用桌號</div><div class="tabnumbox" style="width:100%;height:50%;border:1px solid #898989;text-align:center;border-radius: 5px;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;">'+temp[0]+'</div>');
									$('.order#order #banner #detail').css({'margin-left':'3px'});
								}
								
								$('.order#order #banner #detail #viewtotal').val(d[0]['SALESTTLAMT']);
								$('.order#order #banner #detail #viewnumber').val(d[0]['SALESTTLQTY']);
							}
							else{
								$('.order#order #banner #type').css({'margin-right':'calc(42% / 5)'});
								if(temp[0]=='2'){
									$('.order#order #banner #type button.come').prop('disabled',true);
								}
								else if(temp[0]=='3'){
									$('.order#order #banner #type button.outside').prop('disabled',true);
								}
								else{
									$('.order#order #banner #type button.bysale').prop('disabled',true);
								}
								$('.order#order #banner #tablenumber').prop('style','float: left;');
								$('.order#order #banner #tablenumber').html('');
								$('.order#order #banner #detail').css({'margin-left':'3px'});
								$('.order#order #banner #detail #viewtotal').val(d[0]['SALESTTLAMT']);
								$('.order#order #banner #detail #viewnumber').val(d[0]['SALESTTLQTY']);
							}
						}
						else{
							if(d[0]['REMARKS']=='1'){
								$('.order#order #banner #type').css({'margin-right':'1px'});
								$('.order#order #banner #type button.inside').prop('disabled',true);
								
								var temp=$.trim($('.viewtemp #listno').html()).split('<br>');
								if($('.order#order .initsetting #tabnum').val()==0){
									$('.order#order #banner #tablenumber').prop('style','float: left;height: 100%;margin: 0px 1px;');
									$('.order#order #banner #tablenumber').html('');
									$('.order#order #banner #detail').css({'margin-left':'calc(47% - 478px)'});
								}
								else{
									$('.order#order #banner #tablenumber').prop('style','float: left;width: calc(42% / 5 - 2px);height: 100%;margin: 0px 1px;');
									$('.order#order #banner #tablenumber').html('<div style="width:100%;height:50%;text-align:center;">內用桌號</div><div class="tabnumbox" style="width:100%;height:50%;border:1px solid #898989;text-align:center;border-radius: 5px;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;">'+temp[0]+'</div>');
									$('.order#order #banner #detail').css({'margin-left':'3px'});
								}
								
								$('.order#order #banner #detail #viewtotal').val(d[0]['SALESTTLAMT']);
								$('.order#order #banner #detail #viewnumber').val(d[0]['SALESTTLQTY']);
							}
							else{
								$('.order#order #banner #type').css({'margin-right':'calc(42% / 5)'});
								if(d[0]['REMARKS']=='2'){
									$('.order#order #banner #type button.come').prop('disabled',true);
								}
								else if(d[0]['REMARKS']=='3'){
									$('.order#order #banner #type button.outside').prop('disabled',true);
								}
								else{
									$('.order#order #banner #type button.bysale').prop('disabled',true);
								}
								$('.order#order #banner #tablenumber').prop('style','float: left;');
								$('.order#order #banner #tablenumber').html('');
								$('.order#order #banner #detail').css({'margin-left':'3px'});
								$('.order#order #banner #detail #viewtotal').val(d[0]['SALESTTLAMT']);
								$('.order#order #banner #detail #viewnumber').val(d[0]['SALESTTLQTY']);
							}
						}
						$.ajax({
							url:'./lib/js/temporder.list.php',
							method:'post',
							async: false,
							data:{'machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val(),'company':$('.order#order .companydata #company').val(),'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'usercode':$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val(),'username':$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val()},
							dataType:'html',
							success:function(d){
								$.ajax({
									url:'./lib/js/checktabini.ajax.php',
									method:'post',
									async:false,
									data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'tabnum':$('.order#order #tabs4 #listform input[name="tablenumber"]').val(),'machine':$('.order#order .companydata #terminalnumber').val()},
									dataType:'html',
									success:function(d){
										console.log(d);
									},
									error:function(e){
										console.log(e);
									}
								});
								$('.order#order #MemberBill #list #tabs4 #listform').html(d);
								$('.setperson #view input[name="persons1"]').val($('.order#order #tabs4 #listform input[name="person1"]').val());
								$('.setperson #view input[name="persons2"]').val($('.order#order #tabs4 #listform input[name="person2"]').val());
								$('.setperson #view input[name="persons3"]').val($('.order#order #tabs4 #listform input[name="person3"]').val());
								//console.log($('.setperson #view input[name="persons1"]').val());
								//console.log($('.order#order #tabs4 #listform input[name="person1"]').val());
								$('.setperson #buttons #submit').trigger('click');
							},
							error:function(e){
								//console.log(e);
							}
						});
					},
					error:function(e){
						//console.log(e);
					}
				});*/
				viewtemp.dialog('close');
			}
		}
	});
	$('.order#order #MemberBill #member').on('click','#membutton',function(){
		if($('.order#order #tabs4 .listcontentbox #listform input[name="memno"]').length==0){
			//console.log('遺失memno變數');
		}
		else if($('.order#order #tabs4 .listcontentbox #listform input[name="memno"]').val().length==0){
			meminput.dialog('open');
		}
		else{
			memdata.dialog('open');
		}
	});
	$('.meminput').on('click','#cremem',function(){
		if($('.order#order .initsetting #quickcremember').val()=='0'){
			cremem.dialog('open');//開啟新增會員介面
		}
		else{//新增會員
			if($('.meminput #memtel').val()==''){
			}
			else{
				$.ajax({
					url:'./lib/js/create.member.php',
					method:'post',
					async: false,
					data:{'type':'offline','company':$('.order#order .companydata #company').val(),'story':$('.order#order .companydata #story').val(),'name':$('.meminput #memtel').val(),'tel':$('.meminput #memtel').val(),'initpower':$('.order#order .companydata #initpower').val()},
					dataType:'html',
					success:function(d){
						//console.log(d);
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'cremem-create-offline create.member.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						if(d=='exists'){
							//alert('該電話已存在。');
						}
						else if(d=='success'){
							//alert('新增成功。');
						}
						else{
							/*if(d.statusText=="error"){
								alert('新增失敗，請確認網路狀態。(local)');
							}
							else{
								alert('新增失敗。(local)');
								console.log(d);
							}*/
						}
					},
					error:function(e){
						/*if(e.statusText=="error"){
							alert('新增失敗，請聯絡工程師。(local)');
						}
						else{
						}*/
					}
				});
				if($('.order#order .initsetting #onlinemember').length>0&&$('.order#order .initsetting #onlinemember').val()=='1'){
					$.ajax({
						url:'https://www.quickcode.com.tw/outposandorder/demopos/lib/js/create.member.php',
						method:'post',
						async: false,
						data:{'type':'online','company':$('.order#order .companydata #company').val(),'story':$('.order#order .companydata #story').val(),'name':$('.meminput #memtel').val(),'tel':$('.meminput #memtel').val(),'initpower':$('.order#order .companydata #initpower').val()},
						dataType:'html',
						success:function(d){
							//console.log(d);
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'cremem-create-online create.member.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							if(d=='exists'){
								//alert('該電話已存在。');
							}
							else if(d=='success'){
								//alert('新增成功。');
								/*$.ajax({
									url:'./lib/js/create.cmdtxt.php',
									method:'post',
									async: false,
									data:{'cmd':'downloadmember'},
									dataType:'html',
									success:function(d){
										//console.log(d);
									},
									error:function(e){
										//console.log(e);
									}
								});*/
								/*$('.cremem input[name="name"]').val('');
								$('.cremem input[name="tel"]').val('');
								$('.cremem input[name="address"]').val('');
								if($('.cremem input[name="setting"]').length>0){
									$('.cremem input[name="setting"]').val('');
								}
								else{
								}
								$('.cremem textarea[name="remark"]').val('');*/
							}
							else{
								/*if(d.statusText=="error"){
									alert('新增失敗，請確認網路狀態。(net)');
								}
								else{
									//console.log(e);
									alert('新增失敗。(net)');
								}*/
							}
						},
						error:function(e){
							/*if(e.statusText=="error"){
								alert('新增失敗，請確認網路狀態。(net)');
							}
							else{
							}*/
						}
					});
				}
				else{
				}
				$('.meminput #searchmem').trigger('click');
			}
		}
	});
	$('.meminput').on('click','#searchmem',function(){//查詢會員
		if($('.meminput #memtel').val().length<2){
			alert('請填入至少兩碼。');
		}
		else{
			//console.log('1');
			$.ajax({
				url:'./lib/js/getmemdata.ajax.php',
				method:'post',
				async:false,
				data:{'tel':$('.meminput #memtel').val()},
				dataType:'json',
				success:function(d){
					//console.log(d);
					if($(window).width()==1920){
						var preitem=7;//???尚未確認
					}
					else if($(window).width()==1366){
						var preitem=8;
					}
					else if($(window).width()==1280){
						var preitem=9;
					}
					else{// if($(window).width()==1024)
						var preitem=10;
					}
					if(d=="查無資料庫。"){
						$('.meminput #memslist #listbox #lists').html('查無資料庫。');
						$('.meminput #memslist #listbox input[name="allitems"]').val('');
						$('.meminput #memslist #listbox input[name="page"]').val('');
						$('.meminput #memslist #listbox #allresult').html('');
					}
					else if(d.length==0){
						$('.meminput #memslist #listbox #lists').html('查無資料');
						$('.meminput #memslist #listbox input[name="allitems"]').val('');
						$('.meminput #memslist #listbox input[name="page"]').val('');
						$('.meminput #memslist #listbox #allresult').html('');
					}
					else{
						$('.meminput #memslist #listbox input[name="allitems"]').val(d.length);
						$('.meminput #memslist #listbox input[name="page"]').val('0');
						for(var i=0;i<d.length;i++){
							$('.meminput #memslist #listbox #allresult').append("<input type='hidden' id='"+i+"' value='"+d[i]['memno']+","+d[i]['tel']+","+d[i]['tel2']+","+d[i]['name']+","+d[i]['address']+","+d[i]['setting']+"'>");
						}
						$('.meminput #memslist #listbox #lists').html('');
						if(parseInt(d.length%preitem)>0){
							if((parseInt(d.length/preitem)+1)==1){
								$('.meminput #memslist #fun #change').prop('disabled',true);
							}
							else{
								$('.meminput #memslist #fun #change').prop('disabled',false);
							}
						}
						else{
							if(parseInt(d.length/preitem)==1){
								$('.meminput #memslist #fun #change').prop('disabled',true);
							}
							else{
								$('.meminput #memslist #fun #change').prop('disabled',false);
							}
						}
						var maxitem=0;
						if(d.length>preitem*(parseInt($('.meminput #memslist #listbox input[name="page"]').val())+1)){
							maxitem=preitem*(parseInt($('.meminput #memslist #listbox input[name="page"]').val())+1);
						}
						else{
							maxitem=d.length;
						}
						for(var i=0;i<maxitem;i++){
							if(d[i]['address']==null){
								d[i]['address']='';
							}
							else{
							}
							if(d[i]['tel2']==null){
								d[i]['tel2']='';
							}
							else{
							}
							$('.meminput #memslist #listbox #lists').append('<div class="memitem" style="width:calc(100% - 10px);margin:10px 5px 0 5px;padding-bottom:5px;border-bottom:1px solid #898989;float:left;"><input type="hidden" name="memno" value="'+d[i]['memno']+'"><input type="hidden" name="address" value="'+d[i]['address']+'"><input type="hidden" name="tel2" value="'+d[i]['tel2']+'"><div style="width:calc(100% / 3);float:left;">'+d[i]['tel']+'</div><div style="width:calc(100% / 3);float:left;">'+d[i]['name']+'</div><div style="width:calc(100% / 3);float:left;">'+d[i]['setting']+'</div></div>');
						}
					}
					$('.meminput #memtel').val('');
				},
				error:function(e){
					console.log(e);
				}
			});
		}
	});
	$('.cremem').on('click','#create',function(){//新增會員－送出
		if($('.cremem input[name="tel"]').val()!=""){
			var tel=$('.cremem input[name="tel"]').val();
			if($('.cremem input[name="name"]').val()==''){
				var name=tel;
			}
			else{
				var name=$('.cremem input[name="name"]').val();
			}
			if($('.order#order .initsetting #onlinemember').length>0&&$('.order#order .initsetting #onlinemember').val()=='1'){
				$.ajax({
					url:'https://www.quickcode.com.tw/outposandorder/demopos/lib/js/create.member.php',
					method:'post',
					async: false,
					data:{'type':'online','company':$('.order#order .companydata #company').val(),'story':$('.order#order .companydata #story').val(),'name':name,'tel':tel,'address':$('.cremem input[name="address"]').val(),'remark':$('.cremem textarea[name="remark"]').val(),'initpower':$('.order#order .companydata #initpower').val(),'setting':$('.cremem input[name="setting"]').val()},
					dataType:'html',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'cremem-create-online create.member.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						if(d=='exists'){
							alert('該電話已存在。');
						}
						else if(d=='success'){
							//alert('新增成功。');
							$.ajax({
								url:'./lib/js/create.cmdtxt.php',
								method:'post',
								async: false,
								data:{'cmd':'downloadmember'},
								dataType:'html',
								success:function(d){
									//console.log(d);
								},
								error:function(e){
									//console.log(e);
								}
							});
						}
						else{
							if(d.statusText=="error"){
								alert('新增失敗，請確認網路狀態。(net)');
							}
							else{
								//console.log(e);
								alert('新增失敗。(net)');
							}
						}
					},
					error:function(e){
						if(e.statusText=="error"){
							alert('新增失敗，請確認網路狀態。(net)');
						}
						else{
						}
					}
				});
			}
			else{
			}
			$.ajax({
				url:'./lib/js/create.member.php',
				method:'post',
				async: false,
				data:{'type':'offline','company':$('.order#order .companydata #company').val(),'story':$('.order#order .companydata #story').val(),'name':name,'tel':tel,'address':$('.cremem input[name="address"]').val(),'remark':$('.cremem textarea[name="remark"]').val(),'initpower':$('.order#order .companydata #initpower').val(),'setting':$('.cremem input[name="setting"]').val()},
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'cremem-create-offline create.member.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					if(d=='exists'){
						alert('該電話已存在。');
					}
					else if(d=='success'){
						alert('新增成功。');
					}
					else{
						if(d.statusText=="error"){
							alert('新增失敗。(local)');
						}
						else{
							alert('新增失敗。(local)');
							console.log(d);
						}
					}
				},
				error:function(e){
					if(e.statusText=="error"){
						alert('新增失敗，請聯絡工程師。(local)');
					}
					else{
					}
				}
			});
			$('.cremem input[name="name"]').val('');
			$('.cremem input[name="tel"]').val('');
			$('.cremem input[name="address"]').val('');
			if($('.cremem input[name="setting"]').length>0){
				$('.cremem input[name="setting"]').val('');
			}
			else{
			}
			$('.cremem textarea[name="remark"]').val('');
		}
		else{
			alert('至少填寫電話。');
		}
	});
	$('.meminput').on('click','#reloadmem',function(){//更新會員
		//$('.cremem').on('click','#reflash',function(){
		$.ajax({
			url:'./lib/js/create.cmdtxt.php',
			method:'post',
			async: false,
			data:{'cmd':'downloadmember'},
			dataType:'html',
			success:function(d){
				//console.log(d);
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.cremem').on('click','#close',function(){//關閉新增會員介面
		$('.cremem input[name="name"]').val('');
		$('.cremem input[name="tel"]').val('');
		$('.cremem input[name="address"]').val('');
		$('.cremem textarea[name="remark"]').val('');
		cremem.dialog('close');
	});
	$('.meminput #inputbox').on('click','#button',function(){
		var index=$('.meminput #inputbox input').index(this);
		if(index==14){
			$('.meminput #memtel').val('');
		}
		else if(index==13){
			$('.meminput #memtel').val($('.meminput #memtel').val().substr(0,$('.meminput #memtel').val().length-1));
		}
		/*else if(index==11){
			if($('.meminput #memtel').val().length<2){
				alert('請填入至少兩碼。');
			}
			else{
				console.log('1');
				$.ajax({
					url:'./lib/js/getmemdata.ajax.php',
					method:'post',
					data:{'tel':$('.meminput #memtel').val()},
					dataType:'json',
					success:function(d){
						//console.log(d);
						if($(window).width()==1920){
							var preitem=7;//???尚未確認
						}
						else if($(window).width()==1366){
							var preitem=8;
						}
						else if($(window).width()==1280){
							var preitem=9;
						}
						else{// if($(window).width()==1024)
							var preitem=10;
						}
						if(d=="查無資料庫。"){
							$('.meminput #memslist #listbox #lists').html('查無資料庫。');
							$('.meminput #memslist #listbox input[name="allitems"]').val('');
							$('.meminput #memslist #listbox input[name="page"]').val('');
							$('.meminput #memslist #listbox #allresult').html('');
						}
						else if(d.length==0){
							$('.meminput #memslist #listbox #lists').html('查無資料');
							$('.meminput #memslist #listbox input[name="allitems"]').val('');
							$('.meminput #memslist #listbox input[name="page"]').val('');
							$('.meminput #memslist #listbox #allresult').html('');
						}
						else{
							$('.meminput #memslist #listbox input[name="allitems"]').val(d.length);
							$('.meminput #memslist #listbox input[name="page"]').val('0');
							for(var i=0;i<d.length;i++){
								$('.meminput #memslist #listbox #allresult').append("<input type='hidden' id='"+i+"' value='"+d[i]['memno']+","+d[i]['tel']+","+d[i]['tel2']+","+d[i]['name']+","+d[i]['address']+","+d[i]['setting']+"'>");
							}
							$('.meminput #memslist #listbox #lists').html('');
							if(parseInt(d.length%preitem)>0){
								if((parseInt(d.length/preitem)+1)==1){
									$('.meminput #memslist #fun #change').prop('disabled',true);
								}
								else{
									$('.meminput #memslist #fun #change').prop('disabled',false);
								}
							}
							else{
								if(parseInt(d.length/preitem)==1){
									$('.meminput #memslist #fun #change').prop('disabled',true);
								}
								else{
									$('.meminput #memslist #fun #change').prop('disabled',false);
								}
							}
							var maxitem=0;
							if(d.length>preitem*(parseInt($('.meminput #memslist #listbox input[name="page"]').val())+1)){
								maxitem=preitem*(parseInt($('.meminput #memslist #listbox input[name="page"]').val())+1);
							}
							else{
								maxitem=d.length;
							}
							for(var i=0;i<maxitem;i++){
								if(d[i]['address']==null){
									d[i]['address']='';
								}
								else{
								}
								if(d[i]['tel2']==null){
									d[i]['tel2']='';
								}
								else{
								}
								$('.meminput #memslist #listbox #lists').append('<div class="memitem" style="width:calc(100% - 10px);margin:10px 5px 0 5px;padding-bottom:5px;border-bottom:1px solid #898989;float:left;"><input type="hidden" name="memno" value="'+d[i]['memno']+'"><input type="hidden" name="address" value="'+d[i]['address']+'"><input type="hidden" name="tel2" value="'+d[i]['tel2']+'"><div style="width:calc(100% / 3);float:left;">'+d[i]['tel']+'</div><div style="width:calc(100% / 3);float:left;">'+d[i]['name']+'</div><div style="width:calc(100% / 3);float:left;">'+d[i]['setting']+'</div></div>');
							}
						}
						$('.meminput #memtel').val('');
					},
					error:function(e){
						console.log(e);
					}
				});
			}
		}*/
		else{
			$('.meminput #memtel').val($('.meminput #memtel').val()+$(this).val());
		}
	});
	$('.meminput #memslist #listbox #lists').on('click','.memitem',function(){
		if($(this).prop('id')=='focus'){
			$('.meminput #memslist #listbox #lists .memitem').css({'background-color':'#ffffff'});
			$('.meminput #memslist #listbox #lists .memitem').prop('id','');
			$('.meminput #memslist #fun #check').prop('disabled',true);
		}
		else{
			$('.meminput #memslist #listbox #lists .memitem').css({'background-color':'#ffffff'});
			$('.meminput #memslist #listbox #lists .memitem').prop('id','');
			$(this).css({'background-color':'#5A748B'});
			$(this).prop('id','focus');
			$('.meminput #memslist #fun #check').prop('disabled',false);
		}
	});
	$('.meminput #memslist #fun').on('click','#change',function(){
		if($(window).width()==1920){
			var preitem=7;//???尚未確認
		}
		else if($(window).width()==1366){
			var preitem=8;
		}
		else if($(window).width()==1280){
			var preitem=9;
		}
		else{// if($(window).width()==1024)
			var preitem=10;
		}
		if(parseInt($('.meminput #memslist #listbox input[name="allitems"]').val())%preitem>0){
			var maxpage=parseInt((parseInt($('.meminput #memslist #listbox input[name="allitems"]').val())/preitem)+1);
		}
		else{
			var maxpage=parseInt((parseInt($('.meminput #memslist #listbox input[name="allitems"]').val())/preitem));
		}
		if((parseInt($('.meminput #memslist #listbox input[name="page"]').val())+1)>=maxpage){
			$('.meminput #memslist #listbox input[name="page"]').val('0');
		}
		else{
			$('.meminput #memslist #listbox input[name="page"]').val(parseInt($('.meminput #memslist #listbox input[name="page"]').val())+1);
		}
		$('.meminput #memslist #listbox #lists').html('');
		if(parseInt($('.meminput #memslist #listbox input[name="allitems"]').val())>preitem*(parseInt($('.meminput #memslist #listbox input[name="page"]').val())+1)){
			var maxitem=preitem*(parseInt($('.meminput #memslist #listbox input[name="page"]').val())+1);
		}
		else{
			var maxitem=parseInt($('.meminput #memslist #listbox input[name="allitems"]').val());
		}
		for(var i=(parseInt($('.meminput #memslist #listbox input[name="page"]').val())*preitem);i<maxitem;i++){
			var d=$('.meminput #memslist #listbox #allresult input:eq('+i+')').val().split(',');
			if(d[0]=='null'){
				d[0]='';
			}
			else{
			}
			if(d[1]=='null'){
				d[1]='';
			}
			else{
			}
			if(d[2]=='null'){
				d[2]='';
			}
			else{
			}
			if(d[3]=='null'){
				d[3]='';
			}
			else{
			}
			if(d[4]=='null'){
				d[4]='';
			}
			else{
			}
			$('.meminput #memslist #listbox #lists').append('<div class="memitem" style="width:calc(100% - 10px);margin:10px 5px 0 5px;padding-bottom:5px;border-bottom:1px solid #898989;float:left;"><input type="hidden" name="memno" value="'+d[0]+'"><input type="hidden" name="address" value="'+d[4]+'"><input type="hidden" name="tel2" value="'+d[2]+'"><div style="width:50%;float:left;">'+d[1]+'</div><div style="width:50%;float:left;">'+d[3]+'</div></div>');
		}
	});
	$('.meminput #memslist #fun').on('click','#check',function(){
		$('.order#order #tabs4 .listcontentbox #listform input[name="memno"]').val($('.meminput #memslist #listbox #lists .memitem#focus input[name="memno"]').val());
		$('.order#order #tabs1 #membutton div:eq(0)').html($('.meminput #memslist #listbox #lists .memitem#focus div:eq(1)').html());
		$('.order#order #tabs1 #membutton div:eq(1)').html($('.meminput #memslist #listbox #lists .memitem#focus div:eq(0)').html());
		$('.memdata #name').html($('.meminput #memslist #listbox #lists .memitem#focus div:eq(1)').html());
		$('.memdata #tel').html($('.meminput #memslist #listbox #lists .memitem#focus div:eq(0)').html());
		if($('.meminput #memslist #listbox #lists .memitem#focus input[name="address"]').val()==null){
			$('.memdata #address').html('');
		}
		else{
			$('.memdata #address').html($('.meminput #memslist #listbox #lists .memitem#focus input[name="address"]').val());
		}
		if($('.meminput #memslist #listbox #lists .memitem#focus input[name="tel2"]').val()==null){
			$('.memdata #tel2').html('');
		}
		else{
			$('.memdata #tel2').html($('.meminput #memslist #listbox #lists .memitem#focus input[name="tel2"]').val());
		}
		meminput.dialog('close');
		$('.meminput #memtel').html('');
		$('.meminput #memslist #listbox #lists').html('');
		$('.meminput #memslist #listbox input[name="allitems"]').val('');
		$('.meminput #memslist #listbox input[name="page"]').val('');
		$('.meminput #memslist #listbox #allresult').html('');
		$('.meminput #memslist #fun #change').prop('disabled',true);
		$('.meminput #memslist #fun #check').prop('disabled',true);
	});
	$('.meminput #memslist #fun').on('click','#return',function(){
		meminput.dialog('close');
		$('.meminput #memtel').html('');
		$('.meminput #memslist #listbox #lists').html('');
		$('.meminput #memslist #listbox input[name="allitems"]').val('');
		$('.meminput #memslist #listbox input[name="page"]').val('');
		$('.meminput #memslist #listbox #allresult').html('');
		$('.meminput #memslist #fun #change').prop('disabled',true);
		$('.meminput #memslist #fun #check').prop('disabled',true);
	});
	$('.memdata').on('click','#close',function(){
		memdata.dialog('close');
	});
	$('.memdata').on('click','#clear',function(){//清除會員
		memdata.dialog('close');
		$('.order#order #tabs4 .listcontentbox #listform input[name="memno"]').val('');
		$.ajax({
			url:'./lib/js/getbuttonname.ajax.php',
			method:'post',
			async:false,
			data:{'name':'member'},
			dataType:'json',
			success:function(d){
				console.log(d);
				$('.order#order #tabs1 #membutton div:eq(1)').html('');
				$('.order#order #tabs1 #membutton div:eq(0)').html('<div id="name1">'+d[0]+'</div>');
			},
			error:function(e){
				console.log(e);
			}
		});
	});
	$('.memdata').on('click','#change',function(){
		memdata.dialog('close');
		$('.order#order #tabs4 .listcontentbox #listform input[name="memno"]').val('');
		$('.order#order #tabs1 #membutton div:eq(0)').html('會員');
		$('.order#order #tabs1 #membutton div:eq(1)').html('');
		meminput.dialog('open');
	});
	$('#reason').on('click','button',function(){//刪除已出單產品之原因選項按鈕
		var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
		$('#reason button').prop('disabled',true);
		if($(this).val()=='other'){
			reasoninput.dialog('open');
		}
		else{
			var tabs=changetagtarget();
			var reasonval=$(this).val();
			if($('.order#order #'+tabs+' #listform .label.check').length>0){
				var deltarget='check';
			}
			else{
				var deltarget='focus';
			}
			if(deltarget=='check'){
				var minticket=$('.order#order #'+tabs+' #listform .label').index($('.order#order #'+tabs+' #listform .label.check'));
				var ticketlength=parseInt($('.order#order #'+tabs+' #listform .label').length)-1;
				while($('.order#order #'+tabs+' #listform .label.check').length>0){
					var i=$('.order#order #'+tabs+' #listform .label').index($('.order#order #'+tabs+' #listform .label.check'));
					if(tabs=='tabs5'&&i==0){
						/*不會發生*/
						/*var r=confirm("您確認要取消套餐嗎？");
						if(r==true){
							$('.order#order #'+tabs+' #listform .listcontent').html('');
						}
						else{
							$('.order#order #'+tabs+' #listform .label:eq('+i+') input[id="checkbox[]"]').prop('checked',false);
						}*/
					}
					else{
						//$('.order#order #banner #detail #viewtotal').val(Number($('.order#order #banner #detail #viewtotal').val())-Number($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="subtotal[]"]').val()));
						//$('.order#order #banner #detail #viewnumber').val(Number($('.order#order #banner #detail #viewnumber').val())-Number($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="number[]"]').val()));
						//$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="total"]').val($('.order#order #banner #detail #viewtotal').val());
						//$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="totalnumber"]').val($('.order#order #banner #detail #viewnumber').val());

						$('.setperson #view input[name="persons'+$('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val(parseInt($('.setperson #view input[name="persons'+$('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val())-parseInt($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="number[]"]').val()));
						$('.setperson #buttons #submit').trigger('click');
						if($('.order#order .initsetting #secview').val()=='1'){
							$.ajax({
								url:'../secview/voiditem.ajax.php',
								method:'post',
								async: false,
								data:{'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'linenumber':$('.order#order #tabs4 #listform .label:eq('+i+') input[name="linenumber[]"]').val()},
								dataType:'html',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'reason voiditem.ajax.php '+d},
											dataType:'html',
											success:function(d){
												//console.log(d);
											},
											error:function(e){
												//console.log(e);
											}
										});
									}
									else{
									}
									//console.log(d);
									//$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
								},
								error:function(e){
									//console.log(e);
								}
							});
						}
						else{
						}
						if($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="templistitem[]"]').length>0){
							$.ajax({
								url:'./lib/js/voiditem.ajax.php',
								method:'post',
								async: false,
								data:{'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'linenumber':$('.order#order #tabs4 #listform .label:eq('+i+') input[name="linenumber[]"]').val(),'machine':$('.order#order .companydata #terminalnumber').val(),'reason':reasonval},
								dataType:'html',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'reason voiditem.ajax.php '+d},
											dataType:'html',
											success:function(d){
												//console.log(d);
											},
											error:function(e){
												//console.log(e);
											}
										});
									}
									else{
									}
									//console.log(d);
									$('.order#order #tabs1 #tempbox input[name="target"]').val('');
									$('.order#order #tabs1 #tempbox input[name="typeno"]').val('');
									$('.order#order #tabs1 #tempbox input[name="type"]').val('');
									$('.order#order #tabs1 #tempbox input[name="no"]').val('');
									$('.order#order #tabs1 #tempbox input[name="name"]').val('');
									$('.order#order #tabs1 #tempbox input[name="name2"]').val('');
									$('.order#order #tabs1 #tempbox input[name="isgroup"]').val('0');
									$('.order#order #tabs1 #tempbox input[name="childtype"]').val('');
									$('.order#order #tabs1 #tempbox input[name="mname1"]').val('');
									$('.order#order #tabs1 #tempbox input[name="mname2"]').val('');
									$('.order#order #tabs1 #tempbox input[name="insaleinv"]').val('');
									$('.order#order #tabs1 #tempbox input[name="unitprice"]').val('');
									$('.order#order #tabs1 #tempbox input[name="money"]').val('');
									$('.order#order #tabs1 #tempbox input[name="discount"]').val('0');
									$('.order#order #tabs1 #tempbox input[name="discontent"]').val('');
									$('.order#order #tabs1 #tempbox input[name="number"]').val('');
									$('.order#order #tabs1 #tempbox input[name="subtotal"]').val('');
									$('.order#order #tabs1 #tempbox input[name="taste1"]').val('');
									$('.order#order #tabs1 #tempbox input[name="taste1name"]').val('');
									$('.order#order #tabs1 #tempbox input[name="taste2name"]').val('');
									$('.order#order #tabs1 #tempbox input[name="taste1price"]').val('');
									$('.order#order #tabs1 #tempbox input[name="taste1number"]').val('');
									$('.order#order #tabs1 #tempbox input[name="taste1money"]').val('0');
									$('.order#order #tabs1 #tempbox input[name="taste2"]').val('');
									$('.order#order #tabs1 #editview').val('');
									$('.order#order .parameters #typeno').val('');
									$('.order#order .parameters #type').val('');
									$('.order#order .parameters #no').val('');
									$('.order#order .parameters #name').val('');
									$('.order#order .parameters #msize').val('');
									$('.order#order .parameters input[id^="mname"]').val('');
									$('.order#order .parameters input[id^="money"]').val('');
									$('.order#order .parameters #taste1').val('');
									$('.order#order .parameters #taste1name').val('');
									$('.order#order .parameters #taste1money').val('');
									$('.order#order #menubox #itemfun .startchangetaste').val('0');
									$('.order#order #menubox #itemfun .itemfun').trigger( "click" );
									$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
								},
								error:function(e){
									//console.log(e);
								}
							});
						}
						else{
							$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
						}
					}
				}
				if($('.order#order #'+tabs+' #listform .label').length>0){
					if(minticket==0){
						$('.order#order #'+tabs+' #listform .label:eq(0)').trigger('click');
					}
					else{
						$('.order#order #'+tabs+' #listform .label:eq('+(parseInt(minticket)-1)+')').trigger('click');
					}
				}
				else{
				}
			}
			else{
				var minticket=$('.order#order #'+tabs+' #listform .label').index($('.order#order #'+tabs+' #listform .label.focus'));
				console.log(minticket);
				var ticketlength=parseInt($('.order#order #'+tabs+' #listform .label').length)-1;
				console.log(ticketlength);
				while($('.order#order #'+tabs+' #listform .label.focus').length>0){
					var i=$('.order#order #'+tabs+' #listform .label').index($('.order#order #'+tabs+' #listform .label.focus'));
					if(tabs=='tabs5'&&i==0){
						/*不會發生*/
						/*var r=confirm("您確認要取消套餐嗎？");
						if(r==true){
							$('.order#order #'+tabs+' #listform .listcontent').html('');
						}
						else{
							$('.order#order #'+tabs+' #listform .label:eq('+i+') input[id="checkbox[]"]').prop('checked',false);
						}*/
					}
					else{
						//$('.order#order #banner #detail #viewtotal').val(Number($('.order#order #banner #detail #viewtotal').val())-Number($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="subtotal[]"]').val()));
						//$('.order#order #banner #detail #viewnumber').val(Number($('.order#order #banner #detail #viewnumber').val())-Number($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="number[]"]').val()));
						//$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="total"]').val($('.order#order #banner #detail #viewtotal').val());
						//$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="totalnumber"]').val($('.order#order #banner #detail #viewnumber').val());

						$('.setperson #view input[name="persons'+$('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val(parseInt($('.setperson #view input[name="persons'+$('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val())-parseInt($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="number[]"]').val()));
						$('.setperson #buttons #submit').trigger('click');
						if($('.order#order .initsetting #secview').val()=='1'){
							$.ajax({
								url:'../secview/voiditem.ajax.php',
								method:'post',
								async: false,
								data:{'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'linenumber':$('.order#order #tabs4 #listform .label:eq('+i+') input[name="linenumber[]"]').val()},
								dataType:'html',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'reason voiditem.ajax.php '+d},
											dataType:'html',
											success:function(d){
												//console.log(d);
											},
											error:function(e){
												//console.log(e);
											}
										});
									}
									else{
									}
									//console.log(d);
									//$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
								},
								error:function(e){
									//console.log(e);
								}
							});
						}
						else{
						}
						if($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="templistitem[]"]').length>0){
							$.ajax({
								url:'./lib/js/voiditem.ajax.php',
								method:'post',
								async: false,
								data:{'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'linenumber':$('.order#order #tabs4 #listform .label:eq('+i+') input[name="linenumber[]"]').val(),'machine':$('.order#order .companydata #terminalnumber').val(),'reason':reasonval},
								dataType:'html',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'reason voiditem.ajax.php '+d},
											dataType:'html',
											success:function(d){
												//console.log(d);
											},
											error:function(e){
												//console.log(e);
											}
										});
									}
									else{
									}
									//console.log(d);
									$('.order#order #tabs1 #tempbox input[name="target"]').val('');
									$('.order#order #tabs1 #tempbox input[name="typeno"]').val('');
									$('.order#order #tabs1 #tempbox input[name="type"]').val('');
									$('.order#order #tabs1 #tempbox input[name="no"]').val('');
									$('.order#order #tabs1 #tempbox input[name="name"]').val('');
									$('.order#order #tabs1 #tempbox input[name="name2"]').val('');
									$('.order#order #tabs1 #tempbox input[name="isgroup"]').val('0');
									$('.order#order #tabs1 #tempbox input[name="childtype"]').val('');
									$('.order#order #tabs1 #tempbox input[name="mname1"]').val('');
									$('.order#order #tabs1 #tempbox input[name="mname2"]').val('');
									$('.order#order #tabs1 #tempbox input[name="insaleinv"]').val('');
									$('.order#order #tabs1 #tempbox input[name="unitprice"]').val('');
									$('.order#order #tabs1 #tempbox input[name="money"]').val('');
									$('.order#order #tabs1 #tempbox input[name="discount"]').val('0');
									$('.order#order #tabs1 #tempbox input[name="discontent"]').val('');
									$('.order#order #tabs1 #tempbox input[name="number"]').val('');
									$('.order#order #tabs1 #tempbox input[name="subtotal"]').val('');
									$('.order#order #tabs1 #tempbox input[name="taste1"]').val('');
									$('.order#order #tabs1 #tempbox input[name="taste1name"]').val('');
									$('.order#order #tabs1 #tempbox input[name="taste2name"]').val('');
									$('.order#order #tabs1 #tempbox input[name="taste1price"]').val('');
									$('.order#order #tabs1 #tempbox input[name="taste1number"]').val('');
									$('.order#order #tabs1 #tempbox input[name="taste1money"]').val('0');
									$('.order#order #tabs1 #tempbox input[name="taste2"]').val('');
									$('.order#order #tabs1 #editview').val('');
									$('.order#order .parameters #typeno').val('');
									$('.order#order .parameters #type').val('');
									$('.order#order .parameters #no').val('');
									$('.order#order .parameters #name').val('');
									$('.order#order .parameters #msize').val('');
									$('.order#order .parameters input[id^="mname"]').val('');
									$('.order#order .parameters input[id^="money"]').val('');
									$('.order#order .parameters #taste1').val('');
									$('.order#order .parameters #taste1name').val('');
									$('.order#order .parameters #taste1money').val('');
									$('.order#order #menubox #itemfun .startchangetaste').val('0');
									$('.order#order #menubox #itemfun .itemfun').trigger( "click" );
									$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
								},
								error:function(e){
									//console.log(e);
								}
							});
						}
						else{
							$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
						}
					}
				}
				if($('.order#order #'+tabs+' #listform .label').length>0){
					if(minticket==0){
						$('.order#order #'+tabs+' #listform .label:eq(0)').trigger('click');
					}
					else{
						$('.order#order #'+tabs+' #listform .label:eq('+(parseInt(minticket)-1)+')').trigger('click');
					}
				}
				else{
				}
			}
			/*for(var i=($('.order#order #'+tabs+' #listform .label').length-1);i>=0;i--){
				if(tabs=='tabs5'&&i==0&&$('.order#order #'+tabs+' #listform .label:eq('+i+') input[id="checkbox[]"]').prop('checked')){
					var r=confirm("您確認要取消套餐嗎？");
					if(r==true){
						$('.order#order #'+tabs+' #listform .listcontent').html('');
					}
					else{
						$('.order#order #'+tabs+' #listform .label:eq('+i+') input[id="checkbox[]"]').prop('checked',false);
					}
				}
				else if($('.order#order #'+tabs+' #listform .label:eq('+i+') input[id="checkbox[]"]').prop('checked')){
					//$('.order#order #banner #detail #viewtotal').val(Number($('.order#order #banner #detail #viewtotal').val())-Number($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="subtotal[]"]').val()));
					//$('.order#order #banner #detail #viewnumber').val(Number($('.order#order #banner #detail #viewnumber').val())-Number($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="number[]"]').val()));
					/$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="total"]').val($('.order#order #banner #detail #viewtotal').val());
					//$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="totalnumber"]').val($('.order#order #banner #detail #viewnumber').val());

					$('.setperson #view input[name="persons'+$('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val(parseInt($('.setperson #view input[name="persons'+$('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val())-parseInt($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="number[]"]').val()));
					$('.setperson #buttons #submit').trigger('click');
					if($('.order#order .initsetting #secview').val()=='1'){
						$.ajax({
							url:'../secview/voiditem.ajax.php',
							method:'post',
							async: false,
							data:{'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'linenumber':$('.order#order #tabs4 #listform .label:eq('+i+') input[name="linenumber[]"]').val()},
							dataType:'html',
							success:function(d){
								if(d.length>20){
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										data:{'html':'reason voiditem.ajax.php '+d},
										dataType:'html',
										success:function(d){
											//console.log(d);
										},
										error:function(e){
											//console.log(e);
										}
									});
								}
								else{
								}
								//console.log(d);
								//$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
							},
							error:function(e){
								//console.log(e);
							}
						});
					}
					else{
					}
					if($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="templistitem[]"]').length>0){
						$.ajax({
							url:'./lib/js/voiditem.ajax.php',
							method:'post',
							async: false,
							data:{'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'linenumber':$('.order#order #tabs4 #listform .label:eq('+i+') input[name="linenumber[]"]').val(),'reason':reasonval},
							dataType:'html',
							success:function(d){
								if(d.length>20){
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										data:{'html':'reason voiditem.ajax.php '+d},
										dataType:'html',
										success:function(d){
											//console.log(d);
										},
										error:function(e){
											//console.log(e);
										}
									});
								}
								else{
								}
								//console.log(d);
								$('.order#order #tabs1 #tempbox input[name="target"]').val('');
								$('.order#order #tabs1 #tempbox input[name="typeno"]').val('');
								$('.order#order #tabs1 #tempbox input[name="type"]').val('');
								$('.order#order #tabs1 #tempbox input[name="no"]').val('');
								$('.order#order #tabs1 #tempbox input[name="name"]').val('');
								$('.order#order #tabs1 #tempbox input[name="name2"]').val('');
								$('.order#order #tabs1 #tempbox input[name="isgroup"]').val('0');
								$('.order#order #tabs1 #tempbox input[name="childtype"]').val('');
								$('.order#order #tabs1 #tempbox input[name="mname1"]').val('');
								$('.order#order #tabs1 #tempbox input[name="mname2"]').val('');
								$('.order#order #tabs1 #tempbox input[name="insaleinv"]').val('');
								$('.order#order #tabs1 #tempbox input[name="unitprice"]').val('');
								$('.order#order #tabs1 #tempbox input[name="money"]').val('');
								$('.order#order #tabs1 #tempbox input[name="discount"]').val('0');
								$('.order#order #tabs1 #tempbox input[name="discontent"]').val('');
								$('.order#order #tabs1 #tempbox input[name="number"]').val('');
								$('.order#order #tabs1 #tempbox input[name="subtotal"]').val('');
								$('.order#order #tabs1 #tempbox input[name="taste1"]').val('');
								$('.order#order #tabs1 #tempbox input[name="taste1name"]').val('');
								$('.order#order #tabs1 #tempbox input[name="taste2name"]').val('');
								$('.order#order #tabs1 #tempbox input[name="taste1price"]').val('');
								$('.order#order #tabs1 #tempbox input[name="taste1number"]').val('');
								$('.order#order #tabs1 #tempbox input[name="taste1money"]').val('0');
								$('.order#order #tabs1 #tempbox input[name="taste2"]').val('');
								$('.order#order #tabs1 #editview').val('');
								$('.order#order .parameters #typeno').val('');
								$('.order#order .parameters #type').val('');
								$('.order#order .parameters #no').val('');
								$('.order#order .parameters #name').val('');
								$('.order#order .parameters #msize').val('');
								$('.order#order .parameters input[id^="mname"]').val('');
								$('.order#order .parameters input[id^="money"]').val('');
								$('.order#order .parameters #taste1').val('');
								$('.order#order .parameters #taste1name').val('');
								$('.order#order .parameters #taste1money').val('');
								$('.order#order #menubox #itemfun .startchangetaste').val('0');
								$('.order#order #menubox #itemfun .itemfun').trigger( "click" );
								$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
							},
							error:function(e){
								//console.log(e);
							}
						});
					}
					else{
						$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
					}
				}
				else{
				}
			}*/
			$('.order#order #banner #detail #viewtotal').val('0');
			$('.order#order #banner #detail #viewnumber').val('0');
			for(var i=($('.order#order #'+tabs+' #listform .label').length-1);i>=0;i--){
				$('.order#order #banner #detail #viewtotal').val(Number($('.order#order #banner #detail #viewtotal').val())+Number($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="subtotal[]"]').val()));
				$('.order#order #banner #detail #viewnumber').val(Number($('.order#order #banner #detail #viewnumber').val())+Number($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="number[]"]').val()));	
			}
			if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
				$('.order#order #banner #detail #viewtotal').val( roundfun($('.order#order #banner #detail #viewtotal').val(),precision));
				$('.order#order #banner #detail #viewnumber').val( roundfun($('.order#order #banner #detail #viewnumber').val(),precision));
			}
			else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
				$('.order#order #banner #detail #viewtotal').val( ceilfun($('.order#order #banner #detail #viewtotal').val(),precision));
				$('.order#order #banner #detail #viewnumber').val( ceilfun($('.order#order #banner #detail #viewnumber').val(),precision));
			}
			else{//無條件捨去
				$('.order#order #banner #detail #viewtotal').val( floorfun($('.order#order #banner #detail #viewtotal').val(),precision));
				$('.order#order #banner #detail #viewnumber').val( floorfun($('.order#order #banner #detail #viewnumber').val(),precision));
			}
			$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="total"]').val($('.order#order #banner #detail #viewtotal').val());
			$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="totalnumber"]').val($('.order#order #banner #detail #viewnumber').val());

			$('.order#order #numbox input[type="button"]:eq(14)').prop('disabled',true);
			$('.order#order #numbox input[type="button"]:eq(14)').css({'color':'#a8a8a8'});
			if($('.order#order #MemberBill #tabs4 #listform input[name="templistitem[]"]').length!=$('.order#order #MemberBill #tabs4 #listform .label').length){
			}
			else{
				if($('.order#order .initsetting #opentemp').val()==1&&$('.order#order .initsetting #controltable').val()==1){
					$.ajax({
						url:'./lib/js/change.button4.php',
						method:'post',
						data:{'type':'b'},
						dataType:'json',
						success:function(d){
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'reason change.button4.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							if($('.order#order #billfun #billfun1 button:eq(4) #name1').length>0){
								$('.order#order #billfun #billfun1 button:eq(4) #name1').html(d[0]);
							}
							else{
							}
							if($('.order#order #billfun #billfun1 button:eq(4) #name2').length>0){
								$('.order#order #billfun #billfun1 button:eq(4) #name2').html(d[0]);
							}
							else{
							}
							if($('.order#order .initsetting #controltable').val()=='1'&&$('.order#order .initsetting #opentemp').val()=='0'){
								$('.order#order #billfun #billfun1 button:eq(4)').prop('disabled',false);
							}
							else{
							}
							$('.order#order #billfun #billfun1 button:eq(4)').val(d[2]);
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
				else{
				}
			}
			$('#reason button').prop('disabled',false);
			reason.dialog('close');
		}
	});
	$('#reasoninput').on('click','#cancel',function(){
		$('#reasoninput #cancel').prop('disabled',true);
		$('#reasoninput #send').prop('disabled',true);
		$('#reasoninput input[name="reason"]').prop('disabled',true);
		reasoninput.dialog('close');
		$('#reason button').prop('disabled',false);
		$('#reasoninput #cancel').prop('disabled',false);
		$('#reasoninput #send').prop('disabled',false);
		$('#reasoninput input[name="reason"]').prop('disabled',false);
		$('#reasoninput input[name="reason"]').val('');
	});
	$('#reasoninput').on('click','#send',function(){
		$('#reasoninput #cancel').prop('disabled',true);
		$('#reasoninput #send').prop('disabled',true);
		$('#reasoninput input[name="reason"]').prop('disabled',true);
		var tabs=changetagtarget();
		var reasonval=$(this).val();
		if($('.order#order #'+tabs+' #listform .label.check').length>0){
			var deltarget='check';
		}
		else{
			var deltarget='focus';
		}
		if(deltarget=='check'){
			var minticket=$('.order#order #'+tabs+' #listform .label').index($('.order#order #'+tabs+' #listform .label.check'));
			var ticketlength=parseInt($('.order#order #'+tabs+' #listform .label').length)-1;
			while($('.order#order #'+tabs+' #listform .label.check').length>0){
				var i=$('.order#order #'+tabs+' #listform .label').index($('.order#order #'+tabs+' #listform .label.check'));
				if(tabs=='tabs5'&&i==0){
					/*不會發生*/
					/*var r=confirm("您確認要取消套餐嗎？");
					if(r==true){
						$('.order#order #'+tabs+' #listform .listcontent').html('');
					}
					else{
						$('.order#order #'+tabs+' #listform .label:eq('+i+') input[id="checkbox[]"]').prop('checked',false);
					}*/
				}
				else{
					$('.order#order #banner #detail #viewtotal').val(Number($('.order#order #banner #detail #viewtotal').val())-Number($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="subtotal[]"]').val()));
					$('.order#order #banner #detail #viewnumber').val(Number($('.order#order #banner #detail #viewnumber').val())-Number($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="number[]"]').val()));
					if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
						$('.order#order #banner #detail #viewtotal').val( roundfun($('.order#order #banner #detail #viewtotal').val(),precision));
						$('.order#order #banner #detail #viewnumber').val( roundfun($('.order#order #banner #detail #viewnumber').val(),precision));
					}
					else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
						$('.order#order #banner #detail #viewtotal').val( ceilfun($('.order#order #banner #detail #viewtotal').val(),precision));
						$('.order#order #banner #detail #viewnumber').val( ceilfun($('.order#order #banner #detail #viewnumber').val(),precision));
					}
					else{//無條件捨去
						$('.order#order #banner #detail #viewtotal').val( floorfun($('.order#order #banner #detail #viewtotal').val(),precision));
						$('.order#order #banner #detail #viewnumber').val( floorfun($('.order#order #banner #detail #viewnumber').val(),precision));
					}
					$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="total"]').val($('.order#order #banner #detail #viewtotal').val());
					$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="totalnumber"]').val($('.order#order #banner #detail #viewnumber').val());

					$('.setperson #view input[name="persons'+$('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val(parseInt($('.setperson #view input[name="persons'+$('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val())-parseInt($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="number[]"]').val()));
					$('.setperson #buttons #submit').trigger('click');
					if($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="templistitem[]"]').length>0){
						$.ajax({
							url:'./lib/js/voiditem.ajax.php',
							method:'post',
							async: false,
							data:{'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'linenumber':$('.order#order #tabs4 #listform .label:eq('+i+') input[name="linenumber[]"]').val(),'machine':$('.order#order .companydata #terminalnumber').val(),'reason':$('#reasoninput input[name="reason"]').val()},
							dataType:'html',
							success:function(d){
								if(d.length>20){
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										data:{'html':'reasoninput voiditem.ajax.php '+d},
										dataType:'html',
										success:function(d){
											//console.log(d);
										},
										error:function(e){
											//console.log(e);
										}
									});
								}
								else{
								}
								//console.log(d);
								$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
							},
							error:function(e){
								//console.log(e);
							}
						});
					}
					else{
						$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
					}
				}
			}
			if($('.order#order #'+tabs+' #listform .label').length>0){
				if(minticket==0){
					$('.order#order #'+tabs+' #listform .label:eq(0)').trigger('click');
				}
				else{
					$('.order#order #'+tabs+' #listform .label:eq('+(parseInt(minticket)-1)+')').trigger('click');
				}
			}
			else{
			}
		}
		else{
			var minticket=$('.order#order #'+tabs+' #listform .label').index($('.order#order #'+tabs+' #listform .label.focus'));
			console.log(minticket);
			var ticketlength=parseInt($('.order#order #'+tabs+' #listform .label').length)-1;
			console.log(ticketlength);
			var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
			while($('.order#order #'+tabs+' #listform .label.focus').length>0){
				var i=$('.order#order #'+tabs+' #listform .label').index($('.order#order #'+tabs+' #listform .label.focus'));
				if(tabs=='tabs5'&&i==0){
					/*不會發失*/
					/*var r=confirm("您確認要取消套餐嗎？");
					if(r==true){
						$('.order#order #'+tabs+' #listform .listcontent').html('');
					}
					else{
						$('.order#order #'+tabs+' #listform .label:eq('+i+') input[id="checkbox[]"]').prop('checked',false);
					}*/
				}
				else{
					$('.order#order #banner #detail #viewtotal').val(Number($('.order#order #banner #detail #viewtotal').val())-Number($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="subtotal[]"]').val()));
					$('.order#order #banner #detail #viewnumber').val(Number($('.order#order #banner #detail #viewnumber').val())-Number($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="number[]"]').val()));
					if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
						$('.order#order #banner #detail #viewtotal').val( roundfun($('.order#order #banner #detail #viewtotal').val(),precision));
						$('.order#order #banner #detail #viewnumber').val( roundfun($('.order#order #banner #detail #viewnumber').val(),precision));
					}
					else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
						$('.order#order #banner #detail #viewtotal').val( ceilfun($('.order#order #banner #detail #viewtotal').val(),precision));
						$('.order#order #banner #detail #viewnumber').val( ceilfun($('.order#order #banner #detail #viewnumber').val(),precision));
					}
					else{//無條件捨去
						$('.order#order #banner #detail #viewtotal').val( floorfun($('.order#order #banner #detail #viewtotal').val(),precision));
						$('.order#order #banner #detail #viewnumber').val( floorfun($('.order#order #banner #detail #viewnumber').val(),precision));
					}
					$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="total"]').val($('.order#order #banner #detail #viewtotal').val());
					$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="totalnumber"]').val($('.order#order #banner #detail #viewnumber').val());

					$('.setperson #view input[name="persons'+$('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val(parseInt($('.setperson #view input[name="persons'+$('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val())-parseInt($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="number[]"]').val()));
					$('.setperson #buttons #submit').trigger('click');
					if($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="templistitem[]"]').length>0){
						$.ajax({
							url:'./lib/js/voiditem.ajax.php',
							method:'post',
							async: false,
							data:{'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'linenumber':$('.order#order #tabs4 #listform .label:eq('+i+') input[name="linenumber[]"]').val(),'machine':$('.order#order .companydata #terminalnumber').val(),'reason':$('#reasoninput input[name="reason"]').val()},
							dataType:'html',
							success:function(d){
								if(d.length>20){
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										data:{'html':'reasoninput voiditem.ajax.php '+d},
										dataType:'html',
										success:function(d){
											//console.log(d);
										},
										error:function(e){
											//console.log(e);
										}
									});
								}
								else{
								}
								//console.log(d);
								$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
							},
							error:function(e){
								//console.log(e);
							}
						});
					}
					else{
						$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
					}
				}
			}
			if($('.order#order #'+tabs+' #listform .label').length>0){
				if(minticket==0){
					$('.order#order #'+tabs+' #listform .label:eq(0)').trigger('click');
				}
				else{
					$('.order#order #'+tabs+' #listform .label:eq('+(parseInt(minticket)-1)+')').trigger('click');
				}
			}
			else{
			}
		}
		/*for(var i=($('.order#order #'+tabs+' #listform .label').length-1);i>=0;i--){
			if(tabs=='tabs5'&&i==0&&$('.order#order #'+tabs+' #listform .label:eq('+i+') input[id="checkbox[]"]').prop('checked')){
				var r=confirm("您確認要取消套餐嗎？");
				if(r==true){
					$('.order#order #'+tabs+' #listform .listcontent').html('');
				}
				else{
					$('.order#order #'+tabs+' #listform .label:eq('+i+') input[id="checkbox[]"]').prop('checked',false);
				}
			}
			else if($('.order#order #'+tabs+' #listform .label:eq('+i+') input[id="checkbox[]"]').prop('checked')){
				$('.order#order #banner #detail #viewtotal').val(Number($('.order#order #banner #detail #viewtotal').val())-Number($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="subtotal[]"]').val()));
				$('.order#order #banner #detail #viewnumber').val(Number($('.order#order #banner #detail #viewnumber').val())-Number($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="number[]"]').val()));
				$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="total"]').val($('.order#order #banner #detail #viewtotal').val());
				$('.order#order #MemberBill #list #tabs4 .listcontentbox input[name="totalnumber"]').val($('.order#order #banner #detail #viewnumber').val());

				$('.setperson #view input[name="persons'+$('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val(parseInt($('.setperson #view input[name="persons'+$('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="personcount[]"]').val()+'"]').val())-parseInt($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="number[]"]').val()));
				$('.setperson #buttons #submit').trigger('click');
				if($('.order#order #'+tabs+' #listform .label:eq('+i+') input[name="templistitem[]"]').length>0){
					$.ajax({
						url:'./lib/js/voiditem.ajax.php',
						method:'post',
						async: false,
						data:{'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'linenumber':$('.order#order #tabs4 #listform .label:eq('+i+') input[name="linenumber[]"]').val(),'reason':$('#reasoninput input[name="reason"]').val()},
						dataType:'html',
						success:function(d){
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'reasoninput voiditem.ajax.php '+d},
									dataType:'html',
									success:function(d){
										//console.log(d);
									},
									error:function(e){
										//console.log(e);
									}
								});
							}
							else{
							}
							//console.log(d);
							$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
						},
						error:function(e){
							//console.log(e);
						}
					});
				}
				else{
					$('.order#order #'+tabs+' #listform .label:eq('+i+')').remove();
				}
			}
			else{
			}
		}*/
		$('.order#order #numbox input[type="button"]:eq(14)').prop('disabled',true);
		$('.order#order #numbox input[type="button"]:eq(14)').css({'color':'#a8a8a8'});
		if($('.order#order #MemberBill #tabs4 #listform input[name="templistitem[]"]').length!=$('.order#order #MemberBill #tabs4 #listform .label').length){
		}
		else{
			if($('.order#order .initsetting #opentemp').val()==1&&$('.order#order .initsetting #controltable').val()==1){
				$.ajax({
					url:'./lib/js/change.button4.php',
					method:'post',
					data:{'type':'b'},
					dataType:'json',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'reasoninput change.button4.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						if($('.order#order #billfun #billfun1 button:eq(4) #name1').length>0){
							$('.order#order #billfun #billfun1 button:eq(4) #name1').html(d[0]);
						}
						else{
						}
						if($('.order#order #billfun #billfun1 button:eq(4) #name2').length>0){
							$('.order#order #billfun #billfun1 button:eq(4) #name2').html(d[0]);
						}
						else{
						}
						if($('.order#order .initsetting #controltable').val()=='1'&&$('.order#order .initsetting #opentemp').val()=='0'){
							$('.order#order #billfun #billfun1 button:eq(4)').prop('disabled',false);
						}
						else{
						}
						$('.order#order #billfun #billfun1 button:eq(4)').val(d[2]);
					},
					error:function(e){
						//console.log(e);
					}
				});
			}
			else{
			}
		}
		reasoninput.dialog('close');
		$('#reasoninput #cancel').prop('disabled',false);
		$('#reasoninput #send').prop('disabled',false);
		$('#reasoninput input[name="reason"]').prop('disabled',false);
		$('#reasoninput input[name="reason"]').val('');
		reason.dialog('close');
		$('#reason button').prop('disabled',false);
	});
	$('.result').on('click','.otherpay',function(){
		$('.paywindow input[name="target"]').val('result');
		paywindow.dialog('open');
	});
	$('.paywindow').on('click','button',function(){
		var content='';
		var target='';
		var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
		if(typeof $('.paywindow input[name="target"]')=="undefined"||$('.paywindow input[name="target"]').val()==''||$('.paywindow input[name="target"]').val()=='result'){
			target='result';
		}
		else{
			target='editpay';
		}
		if($('.'+target+' input[name="view"]').val().length>0){
			if((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))<=0){
			}
			else{
				content="<div class='paywaybox' style='width:calc(100% - 20px);overflow:hidden;'><div style='width:20px;height:19px;float:left;'><input type='checkbox' name='checkbox'></div><div class='payway' style='overflow:hidden;'><div style='width:calc(50% - 10px);float:left;text-align:left;'><span id='name1'>"+$(this).html()+"</span></div><div style='width:calc(50% - 10px);float:left;text-align:right;'>";
				if($(this).find('input[name="type"]').val()=='1'){//找零
					if((Number($('.'+target+' input[name="view"]').val())*Number($(this).find('input[name="price"]').val()))>=(Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))){
						content=content+"<span class='otherpay' id='"+$(this).attr('class')+"-"+$(this).attr('id')+"'>";

						if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
							var temp=roundfun(((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val())),precision);
						}
						else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
							var temp=ceilfun(((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val())),precision);
						}
						else{//無條件捨去
							var temp=floorfun(((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val())),precision);
						}
						
						content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

						if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
							var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}
						else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
							var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}
						else{//無條件捨去
							var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}

						content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
					}
					else{
						content=content+"<span class='otherpay' id='"+$(this).attr('class')+"-"+$(this).attr('id')+"'>";

						if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
							var temp=roundfun($('.'+target+' input[name="view"]').val(),precision);
						}
						else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
							var temp=ceilfun($('.'+target+' input[name="view"]').val(),precision);
						}
						else{//無條件捨去
							var temp=floorfun($('.'+target+' input[name="view"]').val(),precision);
						}

						content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

						if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
							var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}
						else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
							var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}
						else{//無條件捨去
							var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}

						content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
					}
				}
				else{//不找零
					if((Number($('.'+target+' input[name="view"]').val())*Number($(this).find('input[name="price"]').val()))>=(Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))){
						if((parseInt((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val()))*Number($(this).find('input[name="price"]').val()))<(Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))){
							content=content+"<span class='otherpay' id='"+$(this).attr('class')+"-"+$(this).attr('id')+"'>";

							var temp=(parseInt((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val()))+1);

							content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

							if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
								var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
							}
							else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
								var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
							}
							else{//無條件捨去
								var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
							}

							content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
						}
						else{
							content=content+"<span class='otherpay' id='"+$(this).attr('class')+"-"+$(this).attr('id')+"'>";

							var temp=parseInt((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val()));

							content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

							if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
								var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
							}
							else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
								var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
							}
							else{//無條件捨去
								var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
							}

							content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
						}
					}
					else{
						content=content+"<span class='otherpay' id='"+$(this).attr('class')+"-"+$(this).attr('id')+"'>";

						var temp=parseInt($('.'+target+' input[name="view"]').val());

						content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

						if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
							var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}
						else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
							var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}
						else{//無條件捨去
							var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}

						content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
					}
				}
				content=content+"</div></div></div>";
				
				if(target=='result'){
					$('.result #paywindow #paycontent').append(content);
				}
				else{
					$('.editpay #viewwindow #editpaywindow #paycontent').append(content);
				}
			}
			$('.'+target+' input[name="view"]').val('');
			
		}
		else if((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))>0){
			content="<div class='paywaybox' style='width:calc(100% - 20px);overflow:hidden;'><div style='width:20px;height:19px;float:left;'><input type='checkbox' name='checkbox'></div><div class='payway' style='overflow:hidden;'><div style='width:calc(50% - 10px);float:left;text-align:left;'><span id='name1'>"+$(this).html()+"</span></div><div style='width:calc(50% - 10px);float:left;text-align:right;'>";

			if($(this).find('input[name="type"]').val()=='1'){//找零
				content=content+"<span class='otherpay' id='"+$(this).attr('class')+"-"+$(this).attr('id')+"'>";

				if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
					var temp=roundfun(((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val())),precision);
				}
				else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
					var temp=ceilfun(((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val())),precision);
				}
				else{//無條件捨去
					var temp=floorfun(((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val())),precision);
				}

				content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

				if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
					var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
				}
				else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
					var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
				}
				else{//無條件捨去
					var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
				}

				content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
			}
			else{//不找零
				if((parseInt((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val()))*Number($(this).find('input[name="price"]').val()))<(Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))){
					content=content+"<span class='otherpay' id='"+$(this).attr('class')+"-"+$(this).attr('id')+"'>";

					var temp=(parseInt((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val()))+1);

					content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

					if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
						var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
					}
					else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
						var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
					}
					else{//無條件捨去
						var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
					}

					content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
				}
				else{
					content=content+"<span class='otherpay' id='"+$(this).attr('class')+"-"+$(this).attr('id')+"'>";

					var temp=parseInt((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val()));

					content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

					if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
						var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
					}
					else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
						var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
					}
					else{//無條件捨去
						var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
					}

					content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
				}
			}
			
			content=content+"</div></div></div>";
			if(target=='result'){
				$('.result #paywindow #paycontent').append(content);
			}
			else{
				$('.editpay #viewwindow #editpaywindow #paycontent').append(content);
			}
		}
		else{
		}
		if(target=='result'){
			computerchange();
		}
		else{
			editpaycomchange();
		}
		paywindow.dialog('close');
	});
	$('.result .otherfunction').click(function(){
		$('.paywindow input[name="target"]').val('result');
		var content='';
		var target='';
		var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
		if(typeof $('.paywindow input[name="target"]')=="undefined"||$('.paywindow input[name="target"]').val()==''||$('.paywindow input[name="target"]').val()=='result'){
			target='result';
		}
		else{
			target='editpay';
		}
		if($('.'+target+' input[name="view"]').val().length>0){			
			if((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))<=0){
			}
			else{
				content="<div class='paywaybox' style='width:calc(100% - 20px);overflow:hidden;'><div style='width:20px;height:19px;float:left;'><input type='checkbox' name='checkbox'></div><div class='payway' style='overflow:hidden;'><div style='width:calc(50% - 10px);float:left;text-align:left;'><span id='name1'>"+$(this).html()+"</span></div><div style='width:calc(50% - 10px);float:left;text-align:right;'>";
				if($(this).find('input[name="type"]').val()=='1'){//找零
					content=content+"<span class='otherpay' id='"+$(this).find('input[name="location"]').val()+"-"+$(this).attr('id')+"'>";

					if((Number($('.result input[name="view"]').val())*Number($(this).find('input[name="price"]').val()))>=(Number($('.result #viewwindow #should').html())+Number($('.result #viewwindow #cashcomm').html())-Number($('.result #viewwindow #already').html()))){
						if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
							var temp=roundfun(((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val())),precision);
						}
						else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
							var temp=ceilfun(((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val())),precision);
						}
						else{//無條件捨去
							var temp=floorfun(((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val())),precision);
						}
						
						content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

						if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
							var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}
						else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
							var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}
						else{//無條件捨去
							var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}

						content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
					}
					else{
						if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
							var temp=roundfun($('.'+target+' input[name="view"]').val(),precision);
						}
						else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
							var temp=ceilfun($('.'+target+' input[name="view"]').val(),precision);
						}
						else{//無條件捨去
							var temp=floorfun($('.'+target+' input[name="view"]').val(),precision);
						}
						
						content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

						if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
							var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}
						else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
							var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}
						else{//無條件捨去
							var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}

						content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
					}
					
					content=content+"</div></div></div>";
					if(target=='result'){
						$('.result #paywindow #paycontent').append(content);
					}
					else{
						$('.editpay #viewwindow #editpaywindow #paycontent').append(content);
					}
				}
				else{//不找零
					if((Number($('.'+target+' input[name="view"]').val())*Number($(this).find('input[name="price"]').val()))>=(Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))){
						if((parseInt((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val()))*Number($(this).find('input[name="price"]').val()))<(Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))){
							content=content+"<span class='otherpay' id='"+$(this).find('input[name="location"]').val()+"-"+$(this).attr('id')+"'>";

							var temp=(parseInt((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val()))+1);

							content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

							if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
								var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
							}
							else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
								var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
							}
							else{//無條件捨去
								var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
							}

							content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
						}
						else{
							content=content+"<span class='otherpay' id='"+$(this).find('input[name="location"]').val()+"-"+$(this).attr('id')+"'>";

							var temp=parseInt((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val()));

							content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

							if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
								var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
							}
							else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
								var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
							}
							else{//無條件捨去
								var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
							}

							content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
						}
					}
					else{
						content=content+"<span class='otherpay' id='"+$(this).find('input[name="location"]').val()+"-"+$(this).attr('id')+"'>";

						var temp=parseInt($('.'+target+' input[name="view"]').val());

						content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

						if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
							var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}
						else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
							var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}
						else{//無條件捨去
							var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}

						content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
					}
				}
				content=content+"</div></div></div>";
				
				if(target=='result'){
					$('.result #paywindow #paycontent').append(content);
				}
				else{
					$('.editpay #viewwindow #editpaywindow #paycontent').append(content);
				}
			}
			$('.'+target+' input[name="view"]').val('');
			
		}
		else if((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))>0){
			content="<div class='paywaybox' style='width:calc(100% - 20px);overflow:hidden;'><div style='width:20px;height:19px;float:left;'><input type='checkbox' name='checkbox'></div><div class='payway' style='overflow:hidden;'><div style='width:calc(50% - 10px);float:left;text-align:left;'><span id='name1'>"+$(this).html()+"</span></div><div style='width:calc(50% - 10px);float:left;text-align:right;'>";
			
			if($(this).find('input[name="type"]').val()=='1'){//找零
				content=content+""+$('.result .frontunit').val()+"<span class='otherpay' id='"+$(this).find('input[name="location"]').val()+"-"+$(this).attr('id')+"'>";

				if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
					var temp=roundfun(((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val())),precision);
				}
				else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
					var temp=ceilfun(((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val())),precision);
				}
				else{//無條件捨去
					var temp=floorfun(((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val())),precision);
				}

				content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

				if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
					var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
				}
				else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
					var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
				}
				else{//無條件捨去
					var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
				}
				
				content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
			}
			else{//不找零
				if((parseInt((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val()))*Number($(this).find('input[name="price"]').val()))<(Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))){
					content=content+""+$('.result .frontunit').val()+"<span class='otherpay' id='"+$(this).find('input[name="location"]').val()+"-"+$(this).attr('id')+"'>";

					var temp=parseInt((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val()))+1;

					content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

					if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
						var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
					}
					else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
						var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
					}
					else{//無條件捨去
						var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
					}
					
					content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
				}
				else{
					content=content+""+$('.result .frontunit').val()+"<span class='otherpay' id='"+$(this).find('input[name="location"]').val()+"-"+$(this).attr('id')+"'>";

					var temp=parseInt((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val()));

					content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

					if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
						var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
					}
					else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
						var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
					}
					else{//無條件捨去
						var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
					}
					
					content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
				}
			}

			content=content+"</div></div></div>";
			if(target=='result'){
				$('.result #paywindow #paycontent').append(content);
			}
			else{
				$('.editpay #viewwindow #editpaywindow #paycontent').append(content);
			}
		}
		else{
		}
		if(target=='result'){
			computerchange();
		}
		else{
			editpaycomchange();
		}
		paywindow.dialog('close');
	});
	$('.editpay .otherfunction').click(function(){
		$('.paywindow input[name="target"]').val('editpay');
		var content='';
		var target='';
		var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
		if(typeof $('.paywindow input[name="target"]')=="undefined"||$('.paywindow input[name="target"]').val()==''||$('.paywindow input[name="target"]').val()=='result'){
			target='result';
		}
		else{
			target='editpay';
		}
		if($('.'+target+' input[name="view"]').val().length>0){
			if((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))<=0){
			}
			else{
				content="<div class='paywaybox' style='width:calc(100% - 20px);overflow:hidden;'><div style='width:20px;height:19px;float:left;'><input type='checkbox' name='checkbox'></div><div class='payway' style='overflow:hidden;'><div style='width:calc(50% - 10px);float:left;text-align:left;'><span id='name1'>"+$(this).html()+"</span></div><div style='width:calc(50% - 10px);float:left;text-align:right;'>";
				if($(this).find('input[name="type"]').val()=='1'){//找零
					content=content+"<span class='otherpay' id='"+$(this).find('input[name="location"]').val()+"-"+$(this).attr('id')+"'>";

					if((Number($('.'+target+' input[name="view"]').val())*Number($(this).find('input[name="price"]').val()))>=(Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))){
						if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
							var temp=roundfun(((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val())),precision);
						}
						else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
							var temp=ceilfun(((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val())),precision);
						}
						else{//無條件捨去
							var temp=floorfun(((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val())),precision);
						}

						content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

						if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
							var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}
						else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
							var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}
						else{//無條件捨去
							var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}

						content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
					}
					else{
						if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
							var temp=roundfun($('.'+target+' input[name="view"]').val(),precision);
						}
						else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
							var temp=ceilfun($('.'+target+' input[name="view"]').val(),precision);
						}
						else{//無條件捨去
							var temp=floorfun($('.'+target+' input[name="view"]').val(),precision);
						}

						content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

						if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
							var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}
						else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
							var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}
						else{//無條件捨去
							var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}

						content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
					}
				}
				else{//不找零
					if((Number($('.'+target+' input[name="view"]').val())*Number($(this).find('input[name="price"]').val()))>=(Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))){
						if((parseInt((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val()))*Number($(this).find('input[name="price"]').val()))<(Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))){
							content=content+"<span class='otherpay' id='"+$(this).find('input[name="location"]').val()+"-"+$(this).attr('id')+"'>";

							var temp=(parseInt((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val()))+1);

							content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

							if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
								var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
							}
							else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
								var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
							}
							else{//無條件捨去
								var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
							}

							content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
						}
						else{
							content=content+"<span class='otherpay' id='"+$(this).find('input[name="location"]').val()+"-"+$(this).attr('id')+"'>";

							var temp=parseInt((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val()));

							content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

							if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
								var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
							}
							else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
								var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
							}
							else{//無條件捨去
								var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
							}

							content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
						}
					}
					else{
						content=content+"<span class='otherpay' id='"+$(this).find('input[name="location"]').val()+"-"+$(this).attr('id')+"'>";

						var temp=parseInt($('.'+target+' input[name="view"]').val());

						content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

						if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
							var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}
						else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
							var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}
						else{//無條件捨去
							var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
						}

						content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
					}
				}

				content=content+"</div></div></div>";

				if(target=='result'){
					$('.result #paywindow #paycontent').append(content);
				}
				else{
					$('.editpay #viewwindow #editpaywindow #paycontent').append(content);
				}
			}
			$('.'+target+' input[name="view"]').val('');
			
		}
		else if((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))>0){
			content="<div class='paywaybox' style='width:calc(100% - 20px);overflow:hidden;'><div style='width:20px;height:19px;float:left;'><input type='checkbox' name='checkbox'></div><div class='payway' style='overflow:hidden;'><div style='width:calc(50% - 10px);float:left;text-align:left;'><span id='name1'>"+$(this).html()+"</span></div><div style='width:calc(50% - 10px);float:left;text-align:right;'>";
			
			if($(this).find('input[name="type"]').val()=='1'){//找零
				content=content+"<span class='otherpay' id='"+$(this).find('input[name="location"]').val()+"-"+$(this).attr('id')+"'>";

				if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
					var temp=roundfun(((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val())),precision);
				}
				else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
					var temp=ceilfun(((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val())),precision);
				}
				else{//無條件捨去
					var temp=floorfun(((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val())),precision);
				}

				content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

				if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
					var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
				}
				else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
					var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
				}
				else{//無條件捨去
					var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
				}
				
				content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
			}
			else{//不找零
				if((parseInt((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val()))*Number($(this).find('input[name="price"]').val()))<(Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))){
					content=content+""+$('.result .frontunit').val()+"<span class='otherpay' id='"+$(this).find('input[name="location"]').val()+"-"+$(this).attr('id')+"'>";

					var temp=parseInt((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val()))+1;

					content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

					if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
						var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
					}
					else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
						var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
					}
					else{//無條件捨去
						var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
					}
					
					content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
				}
				else{
					content=content+"<span class='otherpay' id='"+$(this).find('input[name="location"]').val()+"-"+$(this).attr('id')+"'>";

					var temp=parseInt((Number($('.'+target+' #viewwindow #should').html())+Number($('.'+target+' #viewwindow #cashcomm').html())-Number($('.'+target+' #viewwindow #already').html()))/Number($(this).find('input[name="price"]').val()));

					content=content+temp+"<input type='hidden' name='initview' value='"+temp+"'>";

					if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
						var temp=roundfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
					}
					else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
						var temp=ceilfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
					}
					else{//無條件捨去
						var temp=floorfun((Number(temp)*Number($(this).find('input[name="price"]').val())),precision);
					}
					
					content=content+"<input type='hidden' name='viewmoney' value='"+temp+"'><input type='hidden' name='inv' value='"+$(this).find('input[name="inv"]').val()+"'><input type='hidden' name='type' value='"+$(this).find('input[name="type"]').val()+"'></span>";
				}
			}

			content=content+"</div></div></div>";
			if(target=='result'){
				$('.result #paywindow #paycontent').append(content);
			}
			else{
				$('.editpay #viewwindow #editpaywindow #paycontent').append(content);
			}
		}
		else{
		}
		if(target=='result'){
			computerchange();
		}
		else{
			editpaycomchange();
		}
		paywindow.dialog('close');
	});
	$('.order#order #MemberBill #billfun #citybox #billfun3').on('click','#punch',function(){
		punch.dialog('open');
	});
	$('.punch').on('click','#return',function(){
		punch.dialog('close');
	});
	$('.punch').on('click','#number',function(){
		$('.punch input[name="num"]').val($('.punch input[name="num"]').val()+$(this).val());
	});
	$('.punch').on('click','#clear',function(){
		$('.punch input[name="num"]').val('');
	});
	$('.punch').on('click','#back',function(){
		if($('.punch input[name="num"]').val().length>0){
			$('.punch input[name="num"]').val($('.punch input[name="num"]').val().substr(0,$('.punch input[name="num"]').val().length-1));
		}
		else{
			$('.punch input[name="num"]').val('');
		}
	});
	$('.punch').on('click','#on',function(){
		if($('.punch input[name="num"]').val().length>0){
			$.ajax({
				url:'./lib/js/checkpunch.ajax.php',
				method:'post',
				async:false,
				data:{'type':'off','punchno':$('.punch input[name="num"]').val(),'machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val()},
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'punch-on checkpunch.ajax.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					console.log(d);
					var temp=d.split(';');
					//console.log(temp);
					if(temp[0]=='success'){
						//console.log(d);
						$.ajax({
							url:'./lib/js/pushpunch.ajax.php',
							method:'post',
							async:false,
							data:{'type':'on','time':temp[1],'punchno':$('.punch input[name="num"]').val(),'machine':$('.order#order #tabs4 #listform input[name="machinetype"]').val()},
							dataType:'html',
							success:function(d){
								if(d.length>20){
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										data:{'html':'punch-on pushpunch.ajax.php '+d},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
								}
								else{
								}
								console.log(d);
								if(d=='success'){
									alert('成功打卡。');
								}
								else{
									alert('員工編號輸入錯誤。');
								}
							},
							error:function(e){
								//console.log(e);
							}
						});
					}
					else{
						alert('您尚未下班，因此無法打上班卡。');
					}
				},
				error:function(e){
					//console.log(e);
				}
			});
		}
		else{
		}
	});
	$('.punch').on('click','#off',function(){
		if($('.punch input[name="num"]').val().length>0){
			$.ajax({
				url:'./lib/js/checkpunch.ajax.php',
				method:'post',
				async:false,
				data:{'type':'on','punchno':$('.punch input[name="num"]').val(),'machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val()},
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'punch-off checkpunch.ajax.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					var temp=d.split(';');
					if(temp[0]=='success'){
						//console.log(d);
						$.ajax({
							url:'./lib/js/pushpunch.ajax.php',
							method:'post',
							async:false,
							data:{'type':'off','time':temp[1],'punchno':$('.punch input[name="num"]').val(),'machine':$('.order#order #tabs4 #listform input[name="machinetype"]').val()},
							dataType:'html',
							success:function(d){
								if(d.length>20){
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										data:{'html':'punch-off pushpunch.ajax.php '+d},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
								}
								else{
								}
								//console.log(d);
								if(d=='success'){
									alert('成功打卡。');
								}
								else{
									alert('員工編號輸入錯誤。');
								}
							},
							error:function(e){
								//console.log(e);
							}
						});
					}
					else{
						alert('您尚未上班，因此無法打下班卡。');
					}
				},
				error:function(e){
					//console.log(e);
				}
			});
		}
		else{
		}
	});
	$('.viewtemp #otherfun').on('click','#openinv',function(){
		if($('.order#order .initsetting #controltable').val()=='1'){
			$.ajax({
				url:'./lib/js/checktabstate.ajax.php',
				method:'post',
				async:false,
				data:{'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'machine':$('.order#order #tabs4 #listform input[name="machinetype"]').val()},
				dataType:'html',
				success:function(d){
					console.log(d);
					if(d.substr(0,6)=='unlock'){
						var tabs=changetagtarget();
						if($('.order#order #banner #detail #invnum').length>0&&$('.order#order #banner #detail #invnum').val()=='0'){
							alert('目前發票數量不足，無法開立發票。');
						}
						else{
							$('.result input[name="sendtype"]').val('tempsale');
							$.ajax({
								url:'./lib/js/templistitems.ajax.php',
								method:'post',
								async: false,
								data:{'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val()},
								dataType:'json',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'viewtemp-openinv templistitems.ajax.php '+d},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									var temp='';
									//console.log(d);
									$.each(d,function(index,value){
										if($.isArray(value)){
											$.each(value,function(k,v){
												temp=temp+index+'[]='+v+'&';
											});
										}
										else{
											temp=temp+index+'='+value+'&';
										}
									});
									//console.log(temp);
									if($('.order#order .initsetting #autodis').val()=='1'){//開啟自動優惠
										$.ajax({
											url:'./lib/js/compdis.ajax.php',
											method:'post',
											async: false,
											data:temp,
											dataType:'html',
											success:function(d){
												//console.log(d);
												if(d.length>20){
													$.ajax({
														url:'./lib/js/print.php',
														method:'post',
														data:{'html':'viewtemp-openinv compdis.ajax.php '+d},
														dataType:'html',
														success:function(d){/*console.log(d);*/},
														error:function(e){/*console.log(e);*/}
													});
												}
												else{
												}
												var temp=d.split(';');
												if($.isNumeric(temp[0])){
													$('.result #viewwindow #autodis').html(temp[0]);
													$('.result #viewwindow input[name="autodiscontent"]').val(temp[1]);
													$('.result #viewwindow input[name="autodispremoney"]').val(temp[2]);
												}
												else{
													$('.result #viewwindow #autodis').html('0');
													$('.result #viewwindow input[name="autodiscontent"]').val('');
													$('.result #viewwindow input[name="autodispremoney"]').val('0');
												}
												//console.log(d);
											},
											error:function(e){
												//console.log(e)
											}
										});
									}
									else{
										$('.result #viewwindow #autodis').html('0');
										$('.result #viewwindow input[name="autodiscontent"]').val('');
										$('.result #viewwindow input[name="autodispremoney"]').val('0');
									}
									var flooramt=0;
									flooramt=Number(flooramt)+(parseInt(d['TAX6'])*Number($('.setperson #view input[name="personfloor1"]').val()));
									flooramt=Number(flooramt)+(parseInt(d['TAX7'])*Number($('.setperson #view input[name="personfloor2"]').val()));
									flooramt=Number(flooramt)+(parseInt(d['TAX8'])*Number($('.setperson #view input[name="personfloor3"]').val()));
									$('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val(flooramt);
									var total=0;
									var itemdis=0;
									var temptotal=0;
									var tempdis=0;
									//console.log(d['no'].length);
									for(var i=0;i<d['no'].length;i++){
										total=Number(total)+(Number(d['number'][i])*Number(d['unitprice'][i]));
										itemdis=Number(itemdis)+Number(d['itemdis'][i]);
										if(d['needcharge'][i]=='1'){
											temptotal=Number(temptotal)+(Number(d['number'][i])*Number(d['unitprice'][i]));
											tempdis=Number(tempdis)+Number(d['itemdis'][i]);
										}
										else{
										}
									}
									if($('.order#order .initsetting #comfloor').val()=='1'){
										if(Number(total)<Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())){
											$('.result #viewwindow input[name="floorspan"]').val((Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())-Number(total)));
										}
										else{
											$('.result #viewwindow input[name="floorspan"]').val('0');
										}
									}
									else{
										if(Number(d['AMT'])<Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())){
											$('.result #viewwindow input[name="floorspan"]').val((Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())-Number(d['AMT'])));
										}
										else{
											$('.result #viewwindow input[name="floorspan"]').val('0');
										}
									}
									if(Number($('.result #viewwindow input[name="floorspan"]').val())>0){
										var t=confirm('不足低銷，將以低消計算('+$('.result .frontunit').val()+$('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val()+$('.result .unit').val()+')');
										if(t==true){
											$('.result #viewwindow #total').html($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val());
											$('.result #viewwindow #temptotal').val($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val());
											$('.result #viewwindow #itemdis').html('0');
											$('.result #viewwindow #tempdis').val('0');
										}
										else{
											$('.result #viewwindow #total').html(total);
											$('.result #viewwindow #temptotal').val(temptotal);
											$('.result #viewwindow #itemdis').html(itemdis);
											$('.result #viewwindow #tempdis').val(tempdis);
										}
										if($('.order#order .initsetting #openchar').val()=='1'){//開啟服務費
											$('.result #viewwindow #charge').html(temparray['charge']);
										}
										else{//關閉服務費
										}
									}
									else{
										$('.result #viewwindow #total').html(total);
										$('.result #viewwindow #temptotal').val(temptotal);
										$('.result #viewwindow #itemdis').html(itemdis);
										$('.result #viewwindow #tempdis').val(tempdis);
									}
									$('.result #viewwindow #listtotal').html(Number($('.result #viewwindow #total').html())-Number($('.result #viewwindow #itemdis').html())-Number($('.result #viewwindow #autodis').html()));
									$('.result #viewwindow #charge').html(d['charge']);
									$('.result #viewwindow #listdis1').html('0');
									$('.result #viewwindow #listdis2').html(0-d['listdis2']);
									$('.result #viewwindow #notyet').html($('.result #viewwindow #should').html());
									$('.result #paywindow #paycontent').html('');
									$('.result #viewwindow #already').html('0');
									$('.result #viewwindow #cashmoney').html('0');
									$('.result #viewwindow #cash').html('0');
									$('.result #viewwindow #other').html('0');
									$('.result #viewwindow input[name="already"]').val('0');
									$('.result #viewwindow #should').html(d['amt']);
									$('.result #viewwindow #notyet').html($('.result #viewwindow #should').html());
								},
								error:function(e){
									//console.log(e);
								}
							});
							$('.result .numbox .otherpay').prop('disabled',true);
							$('.result .numbox .cashbut').prop('disabled',true);
							$('.result .numbox .moneybut').prop('disabled',true);
							$('.result #funbox #loopbut #name1').html($('.order#order .initsetting #listprintname1').val());
							$('.result #funbox #loopbut #name2').html($('.order#order .initsetting #listprintname2').val());
							$('.result #viewwindow .sendviewwindow input[name="looptype"]').val($('.order#order .initsetting #looptype').val());
							if($('.order#order .initsetting #openchar').val()=='0'){
								$('.result #funbox .chargebut').prop('disabled',true);
								$('.result #funbox .chargebut #name1').html('不收服務費');
								$('.result #funbox #charno').html($('.order#order .initsetting #charge').val());
							}
							else{
								$('.result #funbox .chargebut').prop('disabled',false);
								if($('.order#order .initsetting #charge').val()=='1'){
									$('.result #funbox .chargebut #name1').html('收服務費');
									$('.result #funbox #charno').val($('.order#order .initsetting #charge').val());
								}
								else{
									$('.result #funbox .chargebut #name1').html('不收服務費');
									$('.result #funbox #charno').val($('.order#order .initsetting #charge').val());
								}
							}
							$('.result .numbox .ban #name1').html('輸入統編');
							$('.result input[name="view"]').val('');
							$('.result input[name="view"]').css({'background-color':'#FFFFFF'});
							$('.result #viewwindow input[name="tempban"]').css({'background-color':'#EFEBDE'});
							$('.result #viewwindow input[name="tempban"]').prop('readonly',true);
							$('.result #viewwindow input[name="tempban"]').val('');
							$('.result #viewwindow input[name="tempcontainer"]').css({'background-color':'#EFEBDE'});
							$('.result #viewwindow input[name="tempcontainer"]').prop('readonly',true);
							$('.result #viewwindow input[name="tempcontainer"]').val('');
							$('.result .target').val('view');
							result.dialog('open');
						}
					}
					else{
					}
				},
				error:function(e){
					console.log(e);
				}
			});
		}
		else{
			var tabs=changetagtarget();
			if($('.order#order #banner #detail #invnum').length>0&&$('.order#order #banner #detail #invnum').val()=='0'){
				alert('目前發票數量不足，無法開立發票。');
			}
			else{
				$('.result input[name="sendtype"]').val('tempsale');
				$.ajax({
					url:'./lib/js/templistitems.ajax.php',
					method:'post',
					async: false,
					data:{'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val()},
					dataType:'json',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'viewtemp-openinv templistitems.ajax.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						var temp='';
						//console.log(d);
						$.each(d,function(index,value){
							if($.isArray(value)){
								$.each(value,function(k,v){
									temp=temp+index+'[]='+v+'&';
								});
							}
							else{
								temp=temp+index+'='+value+'&';
							}
						});
						//console.log(temp);
						if($('.order#order .initsetting #autodis').val()=='1'){//開啟自動優惠
							$.ajax({
								url:'./lib/js/compdis.ajax.php',
								method:'post',
								async: false,
								data:temp,
								dataType:'html',
								success:function(d){
									//console.log(d);
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'viewtemp-openinv compdis.ajax.php '+d},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									var temp=d.split(';');
									if($.isNumeric(temp[0])){
										$('.result #viewwindow #autodis').html(temp[0]);
										$('.result #viewwindow input[name="autodiscontent"]').val(temp[1]);
										$('.result #viewwindow input[name="autodispremoney"]').val(temp[2]);
									}
									else{
										$('.result #viewwindow #autodis').html('0');
										$('.result #viewwindow input[name="autodiscontent"]').val('');
										$('.result #viewwindow input[name="autodispremoney"]').val('0');
									}
									//console.log(d);
								},
								error:function(e){
									//console.log(e)
								}
							});
						}
						else{
							$('.result #viewwindow #autodis').html('0');
							$('.result #viewwindow input[name="autodiscontent"]').val('');
							$('.result #viewwindow input[name="autodispremoney"]').val('0');
						}
						var flooramt=0;
						flooramt=Number(flooramt)+(parseInt(d['TAX6'])*Number($('.setperson #view input[name="personfloor1"]').val()));
						flooramt=Number(flooramt)+(parseInt(d['TAX7'])*Number($('.setperson #view input[name="personfloor2"]').val()));
						flooramt=Number(flooramt)+(parseInt(d['TAX8'])*Number($('.setperson #view input[name="personfloor3"]').val()));
						$('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val(flooramt);
						var total=0;
						var itemdis=0;
						var temptotal=0;
						var tempdis=0;
						//console.log(d['no'].length);
						for(var i=0;i<d['no'].length;i++){
							total=Number(total)+(Number(d['number'][i])*Number(d['unitprice'][i]));
							itemdis=Number(itemdis)+Number(d['itemdis'][i]);
							if(d['needcharge'][i]){
								temptotal=Number(temptotal)+(Number(d['number'][i])*Number(d['unitprice'][i]));
								tempdis=Number(tempdis)+Number(d['itemdis'][i]);
							}
							else{
							}
						}
						if($('.order#order .initsetting #comfloor').val()=='1'){
							if(Number(total)<Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())){
								$('.result #viewwindow input[name="floorspan"]').val((Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())-Number(total)));
							}
							else{
								$('.result #viewwindow input[name="floorspan"]').val('0');
							}
						}
						else{
							if(Number(d['AMT'])<Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())){
								$('.result #viewwindow input[name="floorspan"]').val((Number($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val())-Number(d['AMT'])));
							}
							else{
								$('.result #viewwindow input[name="floorspan"]').val('0');
							}
						}
						if(Number($('.result #viewwindow input[name="floorspan"]').val())>0){
							var t=confirm('不足低銷，將以低消計算('+$('.result .frontunit').val()+$('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val()+$('.result .unit').val()+')');
							if(t==true){
								$('.result #viewwindow #total').html($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val());
								$('.result #viewwindow #temptotal').val($('.result #viewwindow .sendviewwindow input[name="ttlfloor"]').val());
								$('.result #viewwindow #itemdis').html('0');
								$('.result #viewwindow #tempdis').val('0');
							}
							else{
								$('.result #viewwindow #total').html(total);
								$('.result #viewwindow #temptotal').val(temptotal);
								$('.result #viewwindow #itemdis').html(itemdis);
								$('.result #viewwindow #tempdis').val(tempdis);
							}
							if($('.order#order .initsetting #openchar').val()=='1'){//開啟服務費
								$('.result #viewwindow #charge').html(temparray['charge']);
							}
							else{//關閉服務費
							}
						}
						else{
							$('.result #viewwindow #total').html(total);
							$('.result #viewwindow #temptotal').val(temptotal);
							$('.result #viewwindow #itemdis').html(itemdis);
							$('.result #viewwindow #tempdis').val(tempdis);
						}
						$('.result #viewwindow #listtotal').html(Number($('.result #viewwindow #total').html())-Number($('.result #viewwindow #itemdis').html())-Number($('.result #viewwindow #autodis').html()));
						$('.result #viewwindow #charge').html(d['charge']);
						$('.result #viewwindow #listdis1').html('0');
						$('.result #viewwindow #listdis2').html(0-d['listdis2']);
						$('.result #viewwindow #notyet').html($('.result #viewwindow #should').html());
						$('.result #paywindow #paycontent').html('');
						$('.result #viewwindow #already').html('0');
						$('.result #viewwindow #cashmoney').html('0');
						$('.result #viewwindow #cash').html('0');
						$('.result #viewwindow #other').html('0');
						$('.result #viewwindow input[name="already"]').val('0');
						$('.result #viewwindow #should').html(d['amt']);
						$('.result #viewwindow #notyet').html($('.result #viewwindow #should').html());
					},
					error:function(e){
						//console.log(e);
					}
				});
				$('.result .numbox .otherpay').prop('disabled',true);
				$('.result .numbox .cashbut').prop('disabled',true);
				$('.result .numbox .moneybut').prop('disabled',true);
				$('.result #funbox #loopbut #name1').html($('.order#order .initsetting #listprintname1').val());
				$('.result #funbox #loopbut #name2').html($('.order#order .initsetting #listprintname2').val());
				$('.result #viewwindow .sendviewwindow input[name="looptype"]').val($('.order#order .initsetting #looptype').val());
				if($('.order#order .initsetting #openchar').val()=='0'){
					$('.result #funbox .chargebut').prop('disabled',true);
					$('.result #funbox .chargebut #name1').html('不收服務費');
					$('.result #funbox #charno').html($('.order#order .initsetting #charge').val());
				}
				else{
					$('.result #funbox .chargebut').prop('disabled',false);
					if($('.order#order .initsetting #charge').val()=='1'){
						$('.result #funbox .chargebut #name1').html('收服務費');
						$('.result #funbox #charno').val($('.order#order .initsetting #charge').val());
					}
					else{
						$('.result #funbox .chargebut #name1').html('不收服務費');
						$('.result #funbox #charno').val($('.order#order .initsetting #charge').val());
					}
				}
				$('.result .numbox .ban #name1').html('輸入統編');
				$('.result input[name="view"]').val('');
				$('.result input[name="view"]').css({'background-color':'#FFFFFF'});
				$('.result #viewwindow input[name="tempban"]').css({'background-color':'#EFEBDE'});
				$('.result #viewwindow input[name="tempban"]').prop('readonly',true);
				$('.result #viewwindow input[name="tempban"]').val('');
				$('.result #viewwindow input[name="tempcontainer"]').css({'background-color':'#EFEBDE'});
				$('.result #viewwindow input[name="tempcontainer"]').prop('readonly',true);
				$('.result #viewwindow input[name="tempcontainer"]').val('');
				$('.result .target').val('view');
				result.dialog('open');
			}
		}
	});
	$('.temptoinv').on('click','#cancel',function(){
		temptoinv.dialog('close');
		temptoinv.dialog('option','height',220);
	});
	$('.temptoinv').on('click','#delplus',function(){
		if($('.order#order .initsetting #controltable').val()=='1'){
			$.ajax({
				url:'./lib/js/checktabstate.ajax.php',
				method:'post',
				async:false,
				data:{'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'machine':$('.order#order #tabs4 #listform input[name="machinetype"]').val()},
				dataType:'html',
				success:function(d){
					console.log(d);
					var tempd=d.split('-');
					if(tempd[0]=='unlock'){
						var hint=confirm('該帳單已開發票，如要修改請確認發票正本已收回。');
						if(hint==true){
							$.ajax({//作廢帳單
								url:'./lib/js/salevoid.ajax.php',
								method:'post',
								data:{'bizdate':$('.viewtemp #date').html(),'createdatetime':$('.viewtemp #credate').val(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'remarks':'tempeditsale'},
								dataType:'html',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'viewtemp-delplus salevoid.ajax.php '+d},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									if(d.substr(0,7)=='success'){
										$.ajax({//作廢發票
											url:'./lib/js/deleteinv.ajax.php',
											method:'post',
											data:{'bizdate':$('.viewtemp #date').html(),'number':$('.viewtemp #salelist #salecontent .listitems#focus div:eq(3)').html()},
											dataType:'html',
											success:function(d){
												if(d.length>20){
													$.ajax({
														url:'./lib/js/print.php',
														method:'post',
														data:{'html':'viewtemp-delplus deleteinv.ajax.php '+d},
														dataType:'html',
														success:function(d){/*console.log(d);*/},
														error:function(e){/*console.log(e);*/}
													});
												}
												else{
												}
												//console.log(d);
												//2017/12/29var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
												//2017/12/29mywin.document.title='cashdrawer';
											},
											error:function(e){
												//console.log(e);
											}
										});
									}
									else{
										//console.log(d);
									}
									$.ajax({//利用暫結加點功能將產品撈出(資料從正式表格複製一份至暫存表格)
										url:'./lib/js/copysale.ajax.php',
										method:'post',
										data:{'bizdate':$('.viewtemp #date').html(),'createdatetime':$('.viewtemp #credate').val(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'code':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'name':$('.order#order #tabs4 #listform input[name="username"]').val()},
										dataType:'html',
										success:function(d){
											var t=d.split('-');
											//console.log(t);
											listtype=t[t.length-3];
											bizdate=t[t.length-2];
											consecnumber=t[t.length-1];
											//console.log(d);
											temporder(bizdate,consecnumber,$('.order#order #tabs4 #listform input[name="machinetype"]').val(),$('.order#order .companydata #company').val(),$('.order#order #tabs4 #listform input[name="usercode"]').val(),$('.order#order #tabs4 #listform input[name="username"]').val());
											temptoinv.dialog('close');
											viewtemp.dialog('close');
											//location.href='./order.php?usercode='+$('.order#order #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #tabs4 #listform input[name="username"]').val()+'&listtype='+listtype+'&tabnum&bizdate='+bizdate+'&consecnumber='+consecnumber;
										},
										error:function(e){
											//console.log(e);
										}
									});
								},
								error:function(e){
									//console.log(e);
								}
							});
						}
						else{
						}
					}
					else{
						var res=confirm(tempd[1]+'點餐中。\n是否仍要點餐？');
						if(res==true){
							var hint=confirm('該帳單已開發票，如要修改請確認發票正本已收回。');
							if(hint==true){
								$.ajax({//作廢帳單
									url:'./lib/js/salevoid.ajax.php',
									method:'post',
									data:{'bizdate':$('.viewtemp #date').html(),'createdatetime':$('.viewtemp #credate').val(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'remarks':'tempeditsale'},
									dataType:'html',
									success:function(d){
										if(d.length>20){
											$.ajax({
												url:'./lib/js/print.php',
												method:'post',
												data:{'html':'viewtemp-delplus salevoid.ajax.php '+d},
												dataType:'html',
												success:function(d){/*console.log(d);*/},
												error:function(e){/*console.log(e);*/}
											});
										}
										else{
										}
										if(d.substr(0,7)=='success'){
											$.ajax({//作廢發票
												url:'./lib/js/deleteinv.ajax.php',
												method:'post',
												data:{'bizdate':$('.viewtemp #date').html(),'number':$('.viewtemp #salelist #salecontent .listitems#focus div:eq(3)').html()},
												dataType:'html',
												success:function(d){
													if(d.length>20){
														$.ajax({
															url:'./lib/js/print.php',
															method:'post',
															data:{'html':'viewtemp-delplus deleteinv.ajax.php '+d},
															dataType:'html',
															success:function(d){/*console.log(d);*/},
															error:function(e){/*console.log(e);*/}
														});
													}
													else{
													}
													//console.log(d);
													//2017/12/29var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
													//2017/12/29mywin.document.title='cashdrawer';
												},
												error:function(e){
													//console.log(e);
												}
											});
										}
										else{
											//console.log(d);
										}
										$.ajax({//利用暫結加點功能將產品撈出(資料從正式表格複製一份至暫存表格)
											url:'./lib/js/copysale.ajax.php',
											method:'post',
											data:{'bizdate':$('.viewtemp #date').html(),'createdatetime':$('.viewtemp #credate').val(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'code':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'name':$('.order#order #tabs4 #listform input[name="username"]').val()},
											dataType:'html',
											success:function(d){
												var t=d.split('-');
												//console.log(t);
												listtype=t[t.length-3];
												bizdate=t[t.length-2];
												consecnumber=t[t.length-1];
												//console.log(d);
												temporder(bizdate,consecnumber,$('.order#order #tabs4 #listform input[name="machinetype"]').val(),$('.order#order .companydata #company').val(),$('.order#order #tabs4 #listform input[name="usercode"]').val(),$('.order#order #tabs4 #listform input[name="username"]').val());
												temptoinv.dialog('close');
												viewtemp.dialog('close');
												//location.href='./order.php?usercode='+$('.order#order #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #tabs4 #listform input[name="username"]').val()+'&listtype='+listtype+'&tabnum&bizdate='+bizdate+'&consecnumber='+consecnumber;
											},
											error:function(e){
												//console.log(e);
											}
										});
									},
									error:function(e){
										//console.log(e);
									}
								});
							}
							else{
							}
						}
						else{
						}
					}
				},
				error:function(e){
					console.log(e);
				}
			});
		}
		else{
			var hint=confirm('該帳單已開發票，如要修改請確認發票正本已收回。');
			if(hint==true){
				$.ajax({//作廢帳單
					url:'./lib/js/salevoid.ajax.php',
					method:'post',
					data:{'bizdate':$('.viewtemp #date').html(),'createdatetime':$('.viewtemp #credate').val(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'name':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'remarks':'tempeditsale'},
					dataType:'html',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'viewtemp-delplus salevoid.ajax.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						if(d.substr(0,7)=='success'){
							$.ajax({//作廢發票
								url:'./lib/js/deleteinv.ajax.php',
								method:'post',
								data:{'bizdate':$('.viewtemp #date').html(),'number':$('.viewtemp #salelist #salecontent .listitems#focus div:eq(3)').html()},
								dataType:'html',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'viewtemp-delplus deleteinv.ajax.php '+d},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									//console.log(d);
									//2017/12/29var mywin=window.open('cashdrawer://reprint','','width=1px,height=1px');
									//2017/12/29mywin.document.title='cashdrawer';
								},
								error:function(e){
									//console.log(e);
								}
							});
						}
						else{
							//console.log(d);
						}
						$.ajax({//利用暫結加點功能將產品撈出(資料從正式表格複製一份至暫存表格)
							url:'./lib/js/copysale.ajax.php',
							method:'post',
							data:{'bizdate':$('.viewtemp #date').html(),'createdatetime':$('.viewtemp #credate').val(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'code':$('.order#order #tabs4 #listform input[name="usercode"]').val(),'name':$('.order#order #tabs4 #listform input[name="username"]').val()},
							dataType:'html',
							success:function(d){
								var t=d.split('-');
								//console.log(t);
								listtype=t[t.length-3];
								bizdate=t[t.length-2];
								consecnumber=t[t.length-1];
								//console.log(d);
								temporder(bizdate,consecnumber,$('.order#order #tabs4 #listform input[name="machinetype"]').val(),$('.order#order .companydata #company').val(),$('.order#order #tabs4 #listform input[name="usercode"]').val(),$('.order#order #tabs4 #listform input[name="username"]').val());
								temptoinv.dialog('close');
								viewtemp.dialog('close');
								//location.href='./order.php?usercode='+$('.order#order #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #tabs4 #listform input[name="username"]').val()+'&listtype='+listtype+'&tabnum&bizdate='+bizdate+'&consecnumber='+consecnumber;
							},
							error:function(e){
								//console.log(e);
							}
						});
					},
					error:function(e){
						//console.log(e);
					}
				});
			}
			else{
			}
		}
	});
	$('.temptoinv').on('click','#buylist',function(){
		if($('.order#order .initsetting #controltable').val()=='1'){
			$.ajax({
				url:'./lib/js/checktabstate.ajax.php',
				method:'post',
				async:false,
				data:{'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val(),'machine':$('.order#order #tabs4 #listform input[name="machinetype"]').val()},
				dataType:'html',
				success:function(d){
					console.log(d);
					var tempd=d.split('-');
					if(tempd[0]=='unlock'){
						temptoinv.dialog('close');
						$('.result input[name="sendtype"]').val('buytemp');
						$.ajax({
							url:'./lib/js/templistdata.ajax.php',
							method:'post',
							async: false,
							data:{'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val()},
							dataType:'json',
							success:function(d){
								if(d.length>20){
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										data:{'html':'temptoinv-buylist templistdata.ajax.php '+d},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
								}
								else{
								}
								$('.result #funbox .invbut').prop('disabled',true);
								$('.result #funbox .invbut #name1').html('開立發票');
								$('.result #funbox .invno').val('1');
								if($('.order#order .initsetting #openpay').val()=='1'){
									$('.result .numbox .otherpay').prop('disabled',false);
								}
								else{
									$('.result .numbox .otherpay').prop('disabled',true);
								}
								if($('.order#order .initsetting #cashbut').val()=='1'){
									$('.result .numbox .cashbut').prop('disabled',false);
								}
								else{
									$('.result .numbox .cashbut').prop('disabled',true);
								}
								$('.result .numbox .moneybut').prop('disabled',false);
								$('.result .numbox .ban').prop('disabled',true);
								$('.result .numbox .carrier').prop('disabled',true);
								$('.result .numbox .carrier2').prop('disabled',true);
								$('.result .numbox .donate').prop('disabled',true);
								if(typeof d['buyerid']=="undefined"){
									$('.result #viewwindow input[name="tempban"]').val('');
								}
								else{
									if(d['buyerid']!='0000000000'){
										$('.result #viewwindow input[name="tempban"]').val(d['buyerid']);
									}
									else{
										$('.result #viewwindow input[name="tempban"]').val('');
									}
								}
								if(typeof d['carrierid1']=="undefined"){
									$('.result #viewwindow input[name="tempcontainer"]').val('');
								}
								else{
									if(d['carrierid1']!=null||d['carrierid1']!=''){
										$('.result #viewwindow input[name="tempcontainer"]').val(d['carrierid1']);
									}
									else{
										$('.result #viewwindow input[name="tempcontainer"]').val('');
									}
								}
								if(typeof d['item']=="undefined"){
									$('.result #viewwindow #total').html('0');
								}
								else{
									$('.result #viewwindow #total').html(Number(d['item']));
								}
								if(typeof d['temptotal']=="undefined"){
									$('.result #viewwindow #temptotal').val('0');
								}
								else{
									$('.result #viewwindow #temptotal').val(Number(d['temptotal']));
								}
								if(typeof d['disitem']=="undefined"){
									$('.result #viewwindow #itemdis').html('0');
								}
								else{
									$('.result #viewwindow #itemdis').html(0-Number(d['disitem']));
								}
								if(typeof d['tempdis']=="undefined"){
									$('.result #viewwindow #tempdis').val('0');
								}
								else{
									$('.result #viewwindow #tempdis').val(0-Number(d['tempdis']));
								}
								if(typeof d['autodis']=="undefined"){
									$('.result #viewwindow #autodis').html('0');
									$('.result #viewwindow input[name="autodiscontent"]').val('');
									$('.result #viewwindow input[name="autodispremoney"]').val('0');
								}
								else{
									$('.result #viewwindow #autodis').html(0-Number(d['autodis']));
									$('.result #viewwindow input[name="autodiscontent"]').val(d['autodiscontent']);
									$('.result #viewwindow input[name="autodispremoney"]').val(d['autodispremoney']);
								}
								$('.result #viewwindow #listtotal').html(Number($('.result #viewwindow #total').html())-Number($('.result #viewwindow #itemdis').html())-Number($('.result #viewwindow #autodis').html()));
								if(typeof d['charge']=="undefined"){
									$('.result #viewwindow #charge').html('0');
								}
								else{
									$('.result #viewwindow #charge').html(d['charge']);
								}
								$('.result #viewwindow #listdis1').html('0');
								if(typeof d['dislist']=="undefined"){//存的是金額，因此放在折讓
									$('.result #viewwindow #listdis2').html('0');
								}
								else{
									$('.result #viewwindow #listdis2').html(0-Number(d['dislist']));
								}
								$('.result #viewwindow #should').html(d['should']);
								$('.result #viewwindow #cashcomm').html('0');
								$('.result #viewwindow #already').html('0');
								$('.result #viewwindow #cashmoney').html('0');
								$('.result #viewwindow #cash').html('0');
								$('.result #viewwindow #other').html('0');
								$('.result #viewwindow input[name="otherstring"]').html('');
								$('.result #viewwindow #notyet').html(d['should']);
								$('.result #viewwindow #change').html('0');
								$('.result #paycontent').html('');
							},
							error:function(e){
								//console.log(e);
							}
						});
						result.dialog('open');
					}
					else{
						var res=confirm(tempd[1]+'點餐中。\n是否仍要點餐？');
						if(res==true){
							temptoinv.dialog('close');
							$('.result input[name="sendtype"]').val('buytemp');
							$.ajax({
								url:'./lib/js/templistdata.ajax.php',
								method:'post',
								async: false,
								data:{'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val()},
								dataType:'json',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'temptoinv-buylist templistdata.ajax.php '+d},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									$('.result #funbox .invbut').prop('disabled',true);
									$('.result #funbox .invbut #name1').html('開立發票');
									$('.result #funbox .invno').val('1');
									if($('.order#order .initsetting #openpay').val()=='1'){
										$('.result .numbox .otherpay').prop('disabled',false);
									}
									else{
										$('.result .numbox .otherpay').prop('disabled',true);
									}
									if($('.order#order .initsetting #cashbut').val()=='1'){
										$('.result .numbox .cashbut').prop('disabled',false);
									}
									else{
										$('.result .numbox .cashbut').prop('disabled',true);
									}
									$('.result .numbox .moneybut').prop('disabled',false);
									$('.result .numbox .ban').prop('disabled',true);
									$('.result .numbox .carrier').prop('disabled',true);
									$('.result .numbox .carrier2').prop('disabled',true);
									$('.result .numbox .donate').prop('disabled',true);
									if(typeof d['buyerid']=="undefined"){
										$('.result #viewwindow input[name="tempban"]').val('');
									}
									else{
										if(d['buyerid']!='0000000000'){
											$('.result #viewwindow input[name="tempban"]').val(d['buyerid']);
										}
										else{
											$('.result #viewwindow input[name="tempban"]').val('');
										}
									}
									if(typeof d['carrierid1']=="undefined"){
										$('.result #viewwindow input[name="tempcontainer"]').val('');
									}
									else{
										if(d['carrierid1']!=null||d['carrierid1']!=''){
											$('.result #viewwindow input[name="tempcontainer"]').val(d['carrierid1']);
										}
										else{
											$('.result #viewwindow input[name="tempcontainer"]').val('');
										}
									}
									if(typeof d['item']=="undefined"){
										$('.result #viewwindow #total').html('0');
									}
									else{
										$('.result #viewwindow #total').html(Number(d['item']));
									}
									if(typeof d['temptotal']=="undefined"){
										$('.result #viewwindow #temptotal').val('0');
									}
									else{
										$('.result #viewwindow #temptotal').val(Number(d['temptotal']));
									}
									if(typeof d['disitem']=="undefined"){
										$('.result #viewwindow #itemdis').html('0');
									}
									else{
										$('.result #viewwindow #itemdis').html(0-Number(d['disitem']));
									}
									if(typeof d['tempdis']=="undefined"){
										$('.result #viewwindow #tempdis').val('0');
									}
									else{
										$('.result #viewwindow #tempdis').val(0-Number(d['tempdis']));
									}
									if(typeof d['autodis']=="undefined"){
										$('.result #viewwindow #autodis').html('0');
										$('.result #viewwindow input[name="autodiscontent"]').val('');
										$('.result #viewwindow input[name="autodispremoney"]').val('0');
									}
									else{
										$('.result #viewwindow #autodis').html(0-Number(d['autodis']));
										$('.result #viewwindow input[name="autodiscontent"]').val(d['autodiscontent']);
										$('.result #viewwindow input[name="autodispremoney"]').val(d['autodispremoney']);
									}
									$('.result #viewwindow #listtotal').html(Number($('.result #viewwindow #total').html())-Number($('.result #viewwindow #itemdis').html())-Number($('.result #viewwindow #autodis').html()));
									if(typeof d['charge']=="undefined"){
										$('.result #viewwindow #charge').html('0');
									}
									else{
										$('.result #viewwindow #charge').html(d['charge']);
									}
									$('.result #viewwindow #listdis1').html('0');
									if(typeof d['dislist']=="undefined"){//存的是金額，因此放在折讓
										$('.result #viewwindow #listdis2').html('0');
									}
									else{
										$('.result #viewwindow #listdis2').html(0-Number(d['dislist']));
									}
									$('.result #viewwindow #should').html(d['should']);
									$('.result #viewwindow #cashcomm').html('0');
									$('.result #viewwindow #already').html('0');
									$('.result #viewwindow #cashmoney').html('0');
									$('.result #viewwindow #cash').html('0');
									$('.result #viewwindow #other').html('0');
									$('.result #viewwindow input[name="otherstring"]').html('');
									$('.result #viewwindow #notyet').html(d['should']);
									$('.result #viewwindow #change').html('0');
									$('.result #paycontent').html('');
								},
								error:function(e){
									//console.log(e);
								}
							});
							result.dialog('open');
						}
						else{
						}
					}
				},
				error:function(e){
					console.log(e);
				}
			});
		}
		else{
			temptoinv.dialog('close');
			$('.result input[name="sendtype"]').val('buytemp');
			$.ajax({
				url:'./lib/js/templistdata.ajax.php',
				method:'post',
				async: false,
				data:{'bizdate':$('.viewtemp #date').html(),'consecnumber':$('.viewtemp #listno input[name="consecnumber"]').val()},
				dataType:'json',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'temptoinv-buylist templistdata.ajax.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					$('.result #funbox .invbut').prop('disabled',true);
					$('.result #funbox .invbut #name1').html('開立發票');
					$('.result #funbox .invno').val('1');
					if($('.order#order .initsetting #openpay').val()=='1'){
						$('.result .numbox .otherpay').prop('disabled',false);
					}
					else{
						$('.result .numbox .otherpay').prop('disabled',true);
					}
					if($('.order#order .initsetting #cashbut').val()=='1'){
						$('.result .numbox .cashbut').prop('disabled',false);
					}
					else{
						$('.result .numbox .cashbut').prop('disabled',true);
					}
					$('.result .numbox .moneybut').prop('disabled',false);
					$('.result .numbox .ban').prop('disabled',true);
					$('.result .numbox .carrier').prop('disabled',true);
					$('.result .numbox .carrier2').prop('disabled',true);
					$('.result .numbox .donate').prop('disabled',true);
					if(typeof d['buyerid']=="undefined"){
						$('.result #viewwindow input[name="tempban"]').val('');
					}
					else{
						if(d['buyerid']!='0000000000'){
							$('.result #viewwindow input[name="tempban"]').val(d['buyerid']);
						}
						else{
							$('.result #viewwindow input[name="tempban"]').val('');
						}
					}
					if(typeof d['carrierid1']=="undefined"){
						$('.result #viewwindow input[name="tempcontainer"]').val('');
					}
					else{
						if(d['carrierid1']!=null||d['carrierid1']!=''){
							$('.result #viewwindow input[name="tempcontainer"]').val(d['carrierid1']);
						}
						else{
							$('.result #viewwindow input[name="tempcontainer"]').val('');
						}
					}
					if(typeof d['item']=="undefined"){
						$('.result #viewwindow #total').html('0');
					}
					else{
						$('.result #viewwindow #total').html(Number(d['item']));
					}
					if(typeof d['temptotal']=="undefined"){
						$('.result #viewwindow #temptotal').val('0');
					}
					else{
						$('.result #viewwindow #temptotal').val(Number(d['temptotal']));
					}
					if(typeof d['disitem']=="undefined"){
						$('.result #viewwindow #itemdis').html('0');
					}
					else{
						$('.result #viewwindow #itemdis').html(0-Number(d['disitem']));
					}
					if(typeof d['tempdis']=="undefined"){
						$('.result #viewwindow #tempdis').val('0');
					}
					else{
						$('.result #viewwindow #tempdis').val(0-Number(d['tempdis']));
					}
					if(typeof d['autodis']=="undefined"){
						$('.result #viewwindow #autodis').html('0');
						$('.result #viewwindow input[name="autodiscontent"]').val('');
						$('.result #viewwindow input[name="autodispremoney"]').val('0');
					}
					else{
						$('.result #viewwindow #autodis').html(0-Number(d['autodis']));
						$('.result #viewwindow input[name="autodiscontent"]').val(d['autodiscontent']);
						$('.result #viewwindow input[name="autodispremoney"]').val(d['autodispremoney']);
					}
					$('.result #viewwindow #listtotal').html(Number($('.result #viewwindow #total').html())-Number($('.result #viewwindow #itemdis').html())-Number($('.result #viewwindow #autodis').html()));
					if(typeof d['charge']=="undefined"){
						$('.result #viewwindow #charge').html('0');
					}
					else{
						$('.result #viewwindow #charge').html(d['charge']);
					}
					$('.result #viewwindow #listdis1').html('0');
					if(typeof d['dislist']=="undefined"){//存的是金額，因此放在折讓
						$('.result #viewwindow #listdis2').html('0');
					}
					else{
						$('.result #viewwindow #listdis2').html(0-Number(d['dislist']));
					}
					$('.result #viewwindow #should').html(d['should']);
					$('.result #viewwindow #cashcomm').html('0');
					$('.result #viewwindow #already').html('0');
					$('.result #viewwindow #cashmoney').html('0');
					$('.result #viewwindow #cash').html('0');
					$('.result #viewwindow #other').html('0');
					$('.result #viewwindow input[name="otherstring"]').html('');
					$('.result #viewwindow #notyet').html(d['should']);
					$('.result #viewwindow #change').html('0');
					$('.result #paycontent').html('');
				},
				error:function(e){
					console.log(e);
				}
			});
			result.dialog('open');
		}
	});
	$('.temptoinv').on('click','#reserve',function(){//開立預約單
		if($('.temptoinv select[name="date"] option:selected').val()=='0'){
			$('.temptoinv #continue').trigger('click');
		}
		else{
			if($('.order#order .initsetting #secview').val()=='1'){
				$.ajax({
					url:'../secview/cleartemp.ajax.php',
					async: false,
					dataType:'html',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'temptoinv-reserve cleartemp.ajax.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						//console.log(d);
					},
					error:function(e){
						//console.log(e);
					}
				});
			}
			else{
			}
			var total=0;
			var subtotal=0;
			var qty=0;
			var temptotal=0;
			var tempdis=0;
			$.each($('.order#order #tabs4 #listform .label'),function(index,value){
				total=Number(total)+(Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="money[]"]').val())*Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="number[]"]').val()));
				subtotal=Number(subtotal)+(Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="subtotal[]"]').val()));
				qty=Number(qty)+(Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="qty[]"]').val()));
				if($('.order#order #tabs4 #listform .label:eq('+index+') input[name="needcharge[]"]').val()=='1'){
					temptotal=Number(temptotal)+(Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="money[]"]').val())*Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="number[]"]').val()));
					tempdis=Number(tempdis)+Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="discount[]"]').val());
				}
				else{
				}
			});
			if($('.order#order #tabs4 #listform input[name="charge"]').length>0&&Number($('.order#order #tabs4 #listform input[name="charge"]').val())==''){
				if($('.order#order .initsetting #openchar').val()=='1'&&$('.order#order .initsetting #charge').val()=='1'){
					if($('.order#order .initsetting #chargeeq').val()=='2'){//服務費以折扣後之價格計算
						$('.order#order #tabs4 #listform input[name="charge"]').val((Number(temptotal)-Number(tempdis))*Number($('.order#order .initsetting #chargenumber').val())/100);
					}
					else{//服務費以原價格計算
						$('.order#order #tabs4 #listform input[name="charge"]').val(Number(temptotal)*Number($('.order#order .initsetting #chargenumber').val())/100);
					}
					var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
					/*設定檔內可設定使用何種進位*/
					if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
						$('.order#order #tabs4 #listform input[name="charge"]').val( roundfun(Number($('.order#order #tabs4 #listform input[name="charge"]').val()),precision));
					}
					else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
						$('.order#order #tabs4 #listform input[name="charge"]').val( ceilfun(Number($('.order#order #tabs4 #listform input[name="charge"]').val()),precision));
					}
					else{//無條件捨去
						$('.order#order #tabs4 #listform input[name="charge"]').val( floorfun(Number($('.order#order #tabs4 #listform input[name="charge"]').val()),precision));
					}
				}
				else{
				}
			}
			else{
			}
			var consecnumber='';
			$('.order#order #billfun1 button:eq(4)').prop('disabled',true);
			$.ajax({
				url:'./lib/js/create.tempdb.php',
				method:'post',
				async: false,
				data:$("#tabs4 #listform").serialize(),
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'temptoinv-reserve create.tempdb.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					var tempd=d.split('-');
					consecnumber=tempd[1];
					if($('.order#order #tabs4 #listform input[name="consecnumber"]').val()==''){
						$('.order#order #tabs4 #listform input[name="saleno"]').val(tempd[0]);
						$('.order#order #tabs4 #listform input[name="consecnumber"]').val(tempd[1]);
					}
					else{
					}
					//console.log(d);
				},
				error:function(e){
					//console.log(e);
				}
			});
			if($('.temptoinv input[name="printtag"]:checked').length>0){
				var printtag=1;
			}
			else{
				var printtag=0;
			}
			$.ajax({
				url:'./lib/js/reserve.ajax.php',
				method:'post',
				async: false,
				data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':consecnumber,'datetime':$('.temptoinv select[name="date"] option:selected').val()+$('.temptoinv select[name="hour"] option:selected').val()+$('.temptoinv select[name="min"] option:selected').val()+';'+printtag},
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'temptoinv-reserve reserve.ajax.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
				},
				error:function(e){
					//console.log(e);
				}
			});
			if($('.order#order .initsetting #autodis').val()=='1'){//開啟自動優惠
				$.ajax({
					url:'./lib/js/compdis.ajax.php',
					method:'post',
					async: false,
					data:$('.order#order #tabs4 #listform').serialize(),
					dataType:'html',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'temptoinv-reserve compdis.ajax.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						//console.log(d);
						var temp=d.split(';');
						if($.isNumeric(temp[0])){
							$.ajax({
								url:'./lib/js/wttempdis.ajax.php',
								method:'post',
								async: false,
								data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':consecnumber,'autodis':temp[0],'autodiscontent':temp[1],'autodispermoney':temp[2]},
								dataType:'html',
								success:function(d){
									if(d.length>20){
										$.ajax({
											url:'./lib/js/print.php',
											method:'post',
											data:{'html':'temptoinv-reserve wttempdis.ajax.php '+d},
											dataType:'html',
											success:function(d){/*console.log(d);*/},
											error:function(e){/*console.log(e);*/}
										});
									}
									else{
									}
									//console.log(d);
								},
								error:function(e){
									//console.log(e);
								}
							});
							//$('.result #viewwindow #autodis').html(temp[0]);
							//$('.result #viewwindow input[name="autodiscontent"]').val(temp[1]);
							//$('.result #viewwindow input[name="autodispremoney"]').val(temp[2]);
						}
						else{
						}
						//console.log(d);
					},
					error:function(e){
						//console.log(e)
					}
				});
			}
			else{
			}
			if($('.order#order #tabs4 #listform input[name="consecnumber"]').val()==''){
			}
			else{
				$.ajax({
					url:'./lib/js/create.voidlist.php',
					method:'post',
					async: false,
					data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tablenumber':$('.order#order #tabs4 #listform input[name="tablenumber"]').val(),'machine':$('.order#order .companydata #terminalnumber').val()},
					dataType:'html',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'temptoinv-reserve create.voidlist.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						//console.log(d);
					},
					error:function(e){
						//console.log(e);
					}
				});
			}
			$.ajax({
				url:'./lib/js/create.list.php',
				method:'post',
				async: false,
				data:$("#tabs4 #listform").serialize(),
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'temptoinv-reserve create.list.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
				},
				error:function(e){
					//console.log(e);
				}
			});
			if($('.order#order #tabs4 #listform input[name="consecnumber"]').val()==''){
			}
			else{
				$.ajax({
					url:'./lib/js/create.voidkitchen.php',
					method:'post',
					async: false,
					data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tablenumber':$('.order#order #tabs4 #listform input[name="tablenumber"]').val(),'machine':$('.order#order .companydata #terminalnumber').val()},
					dataType:'html',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'temptoinv-reserve create.voidkitchen.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						//console.log(d);
					},
					error:function(e){
						//console.log(e);
					}
				});
			}
			$.ajax({
				url:'./lib/js/create.kitchen.php',
				method:'post',
				async: false,
				data:$("#tabs4 #listform").serialize(),
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'temptoinv-reserve create.kitchen.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
				},
				error:function(e){
					//console.log(e);
				}
			});
			if($('.temptoinv input[name="printtag"]:checked').length>0){
				$.ajax({
					url:'./lib/js/create.tag.php',
					method:'post',
					async: false,
					data:$("#tabs4 #listform").serialize(),
					dataType:'html',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'temptoinv-reserve create.tag.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						//console.log(d);
					},
					error:function(e){
						//console.log(e);
					}
				});
			}
			else{
			}
			if($('.order#order #tabs4 #listform input[name="consecnumber"]').val()==''){
			}
			else{
				$.ajax({
					url:'./lib/js/create.voidtempdb.php',
					method:'post',
					async: false,
					data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tablenumber':$('.order#order #tabs4 #listform input[name="tablenumber"]').val(),'machine':$('.order#order .companydata #terminalnumber').val()},
					dataType:'html',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'temptoinv-reserve create.tag.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						//console.log(d);
					},
					error:function(e){
						//console.log(e);
					}
				});
			}
			if($('.order#order .initsetting #controltable').val()=='1'){
				if($('.order#order .companydata #submachine').length>0){
					location.href='./control.php?submachine&usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
				}
				else{
					if($('.order#order #tabs4 #listform input[name="machinetype"]').val()=='m1'){
						location.href='./control.php?usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
					}
					else{
						location.href='./control.php?machine='+$('.order#order #tabs4 #listform input[name="machinetype"]').val()+'&usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
					}
				}
			}
			else{
				if($('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val().length>0){
					//location.href='./order.php?usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
					ClearWindow('','');
				}
				else{
					//location.href='./order.php';
					ClearWindow('','');
				}
				$('.order#order #billfun1 button:eq(4)').prop('disabled',false);
			}
			temptoinv.dialog('close');
			temptoinv.dialog('option','height',220);
		}
	});
	$('.temptoinv').on('click','#continue',function(){//原始暫結流程
		if($('.order#order .initsetting #secview').val()=='1'){
			$.ajax({
				url:'../secview/cleartemp.ajax.php',
				async: false,
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'temptoinv-continue cleartemp.ajax.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
				},
				error:function(e){
					//console.log(e);
				}
			});
		}
		else{
		}
		var total=0;
		var subtotal=0;
		var qty=0;
		var temptotal=0;
		var tempdis=0;
		var nowbizdate=$('.order#order #tabs4 #listform input[name="bizdate"]').val();
		$.each($('.order#order #tabs4 #listform .label'),function(index,value){
			total=Number(total)+(Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="money[]"]').val())*Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="number[]"]').val()));
			subtotal=Number(subtotal)+(Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="subtotal[]"]').val()));
			qty=Number(qty)+(Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="qty[]"]').val()));
			if($('.order#order #tabs4 #listform .label:eq('+index+') input[name="needcharge[]"]').val()=='1'){
				temptotal=Number(temptotal)+(Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="money[]"]').val())*Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="number[]"]').val()));
				tempdis=Number(tempdis)+Number($('.order#order #tabs4 #listform .label:eq('+index+') input[name="discount[]"]').val());
			}
			else{
			}
		});
		if($('.order#order #tabs4 #listform input[name="charge"]').length>0&&Number($('.order#order #tabs4 #listform input[name="charge"]').val())==''){
			if($('.order#order .initsetting #openchar').val()=='1'&&$('.order#order .initsetting #charge').val()=='1'){
				if($('.order#order .initsetting #chargeeq').val()=='2'){//服務費以折扣後之價格計算
					$('.order#order #tabs4 #listform input[name="charge"]').val((Number(temptotal)-Number(tempdis))*Number($('.order#order .initsetting #chargenumber').val())/100);
				}
				else{//服務費以原價格計算
					$('.order#order #tabs4 #listform input[name="charge"]').val(Number(temptotal)*Number($('.order#order .initsetting #chargenumber').val())/100);
				}
				var precision=parseInt($('.order#order .initsetting #accuracy').val());//可由設定檔設定精準度(e.g.精準度小數點第二位 填2)
				/*設定檔內可設定使用何種進位*/
				if($('.order#order .initsetting #accuracytype').val()=='1'){//四捨五入
					$('.order#order #tabs4 #listform input[name="charge"]').val( roundfun(Number($('.order#order #tabs4 #listform input[name="charge"]').val()),precision));
				}
				else if($('.order#order .initsetting #accuracytype').val()=='2'){//無條件進位
					$('.order#order #tabs4 #listform input[name="charge"]').val( ceilfun(Number($('.order#order #tabs4 #listform input[name="charge"]').val()),precision));
				}
				else{//無條件捨去
					$('.order#order #tabs4 #listform input[name="charge"]').val( floorfun(Number($('.order#order #tabs4 #listform input[name="charge"]').val()),precision));
				}
			}
			else{
			}
		}
		else{
		}
		var consecnumber='';
		$('.order#order #billfun1 button:eq(4)').prop('disabled',true);
		$.ajax({
			url:'./lib/js/create.tempdb.php',
			method:'post',
			async: false,
			data:$("#tabs4 #listform").serialize(),
			dataType:'html',
			success:function(d){
				if(d.length>20){
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'temptoinv-continue create.tempdb.php '+d},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				var tempd=d.split('-');
				consecnumber=tempd[1];
				if($('.order#order #tabs4 #listform input[name="consecnumber"]').val()==''){
					$('.order#order #tabs4 #listform input[name="saleno"]').val(tempd[0]);
					$('.order#order #tabs4 #listform input[name="consecnumber"]').val(tempd[1]);
				}
				else{
				}
				//console.log(d);
			},
			error:function(e){
				//console.log(e);
			}
		});
		if($('.order#order .initsetting #autodis').val()=='1'){//開啟自動優惠
			$.ajax({
				url:'./lib/js/compdis.ajax.php',
				method:'post',
				async: false,
				data:$('.order#order #tabs4 #listform').serialize(),
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'temptoinv-continue compdis.ajax.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
					var temp=d.split(';');
					if($.isNumeric(temp[0])){
						$.ajax({
							url:'./lib/js/wttempdis.ajax.php',
							method:'post',
							async: false,
							data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':consecnumber,'autodis':temp[0],'autodiscontent':temp[1],'autodispermoney':temp[2]},
							dataType:'html',
							success:function(d){
								if(d.length>20){
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										data:{'html':'temptoinv-continue wttempdis.ajax.php '+d},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
								}
								else{
								}
								//console.log(d);
							},
							error:function(e){
								//console.log(e);
							}
						});
						//$('.result #viewwindow #autodis').html(temp[0]);
						//$('.result #viewwindow input[name="autodiscontent"]').val(temp[1]);
						//$('.result #viewwindow input[name="autodispremoney"]').val(temp[2]);
					}
					else{
					}
					//console.log(d);
				},
				error:function(e){
					//console.log(e)
				}
			});
		}
		else{
		}
		if($('.order#order #tabs4 #listform input[name="consecnumber"]').val()==''){
		}
		else{
			$.ajax({
				url:'./lib/js/create.voidlist.php',
				method:'post',
				async: false,
				data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tablenumber':$('.order#order #tabs4 #listform input[name="tablenumber"]').val(),'machine':$('.order#order .companydata #terminalnumber').val()},
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'temptoinv-continue create.voidlist.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
				},
				error:function(e){
					//console.log(e);
				}
			});
		}
		$.ajax({
			url:'./lib/js/create.cmdtxt.php',
			method:'post',
			async: false,
			data:{'cmd':nowbizdate.substr(0,6)+'-change'},
			dataType:'html',
			success:function(d){
				//console.log(d);
			},
			error:function(e){
				//console.log(e);
			}
		});
		$.ajax({
			url:'./lib/js/create.list.php',
			method:'post',
			async: false,
			data:$("#tabs4 #listform").serialize(),
			dataType:'html',
			success:function(d){
				if(d.length>20){
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'temptoinv-continue create.list.php '+d},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				//console.log(d);
			},
			error:function(e){
				//console.log(e);
			}
		});
		if($('.order#order #tabs4 #listform input[name="consecnumber"]').val()==''){
		}
		else{
			$.ajax({
				url:'./lib/js/create.voidkitchen.php',
				method:'post',
				async: false,
				data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tablenumber':$('.order#order #tabs4 #listform input[name="tablenumber"]').val(),'machine':$('.order#order .companydata #terminalnumber').val()},
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'temptoinv-continue create.voidkitchen.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
				},
				error:function(e){
					//console.log(e);
				}
			});
		}
		$.ajax({
			url:'./lib/js/create.kitchen.php',
			method:'post',
			async: false,
			data:$("#tabs4 #listform").serialize(),
			dataType:'html',
			success:function(d){
				if(d.length>20){
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'temptoinv-continue create.kitchen.php '+d},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				//console.log(d);
			},
			error:function(e){
				//console.log(e);
			}
		});
		$.ajax({
			url:'./lib/js/create.tag.php',
			method:'post',
			async: false,
			data:$("#tabs4 #listform").serialize(),
			dataType:'html',
			success:function(d){
				if(d.length>20){
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'temptoinv-continue create.tag.php '+d},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				//console.log(d);
			},
			error:function(e){
				//console.log(e);
			}
		});
		if($('.order#order #tabs4 #listform input[name="consecnumber"]').val()==''){
		}
		else{
			$.ajax({
				url:'./lib/js/create.voidtempdb.php',
				method:'post',
				async: false,
				data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tablenumber':$('.order#order #tabs4 #listform input[name="tablenumber"]').val(),'machine':$('.order#order .companydata #terminalnumber').val()},
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'temptoinv-continue create.voidtempdb.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
				},
				error:function(e){
					//console.log(e);
				}
			});
		}
		if($('.order#order .initsetting #controltable').val()=='1'){
			if($('.order#order .companydata #submachine').length>0){
				location.href='./control.php?submachine&usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
			}
			else{
				if($('.order#order #tabs4 #listform input[name="machinetype"]').val()=='m1'){
					location.href='./control.php?usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
				}
				else{
					location.href='./control.php?machine='+$('.order#order #tabs4 #listform input[name="machinetype"]').val()+'&usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
				}
			}
		}
		else{
			if($('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val().length>0){
				//location.href='./order.php?usercode='+$('.order#order #MemberBill #tabs4 #listform input[name="usercode"]').val()+'&username='+$('.order#order #MemberBill #tabs4 #listform input[name="username"]').val();
				ClearWindow('','');
			}
			else{
				//location.href='./order.php';
				ClearWindow('','');
			}
			$('.order#order #billfun1 button:eq(4)').prop('disabled',false);
		}
		temptoinv.dialog('close');
		temptoinv.dialog('option','height',220);
	});
	$('.result .numbox').on('click','.carrier',function(){
		container.dialog('open');
	});
	$('.container #check').click(function(){
		$('.container input[name="containercode"]').val($('.container input[name="containercode"]').val().replace("/",""));
		if($('.container input[name="containercode"]').val().length==(Number($('.order#order .initsetting #container1').val())-1)){
			$('.result #viewwindow input[name="tempcontainer"]').val('/'+$('.container input[name="containercode"]').val());
			$('.container input[name="containercode"]').val('');
			container.dialog('close');
		}
		else if($('.container input[name="containercode"]').val().length==0){
			$('.result #viewwindow input[name="tempcontainer"]').val('');
			$('.container input[name="containercode"]').val('');
			container.dialog('close');
		}
		else{
		}
	});
	$('.container #cancel').click(function(){
		$('.container input[name="containercode"]').val('');
		container.dialog('close');
	});
	$('.result .numbox').on('click','.carrier2',function(){
		container2.dialog('open');
	});
	$('.container2 #check').click(function(){
		if($('.container2 input[name="containercode"]').val().length==$('.order#order .initsetting #container2').val()&&$('.container2 input[name="containercode"]').val().match(/[A-Za-z]{2}[0-9]{14}/g)){
			$('.result #viewwindow input[name="tempcontainer"]').val($('.container2 input[name="containercode"]').val().toUpperCase());
			$('.container2 input[name="containercode"]').val('');
			container2.dialog('close');
		}
		else if($('.container2 input[name="containercode"]').val().length==0){
			$('.result #viewwindow input[name="tempcontainer"]').val('');
			$('.container2 input[name="containercode"]').val('');
			container2.dialog('close');
		}
		else{
		}
	});
	$('.container2 #cancel').click(function(){
		$('.container2 input[name="containercode"]').val('');
		container2.dialog('close');
	});
	$('.result .numbox').on('click','.donate',function(){
		donatewin.dialog('open');
	});
	$(document).on('keydown','.donatewin input[name="containercode"]',function(event){
		if(event.which==13){
			$.ajax({
				url:'./lib/js/searchdonate.ajax.php',
				method:'post',
				async:false,
				data:{'code':$('.donatewin input[name="containercode"]').val()},
				dataType:'html',
				success:function(d){
					//console.log(d);
					if(d.match(/,/)){
						var temp=d.split(',');
						if(temp[3]==''){
							$('.donatewin input[name="label"]').val(temp[1]);
						}
						else{
							$('.donatewin input[name="label"]').val(temp[3]);
						}
					}
					else{
					}
				},
				error:function(e){
					console.log(e);
				}
			});
		}
		else{
			console.log('1');
			$('.donatewin input[name="label"]').val('');
		}
	});
	$('.donatewin #check').click(function(){
		if($('.donatewin input[name="label"]').val()!=''){
			$('.result #viewwindow input[name="tempban"]').val('');
			$('.result #viewwindow input[name="tempcontainer"]').val($('.donatewin input[name="containercode"]').val().toUpperCase());
			$('.donatewin input[name="containercode"]').val('');
			$('.donatewin input[name="label"]').val('');
			donatewin.dialog('close');
		}
		else if($('.donatewin input[name="containercode"]').val().length==0){
			$('.result #viewwindow input[name="tempcontainer"]').val('');
			$('.donatewin input[name="containercode"]').val('');
			$('.donatewin input[name="label"]').val('');
			donatewin.dialog('close');
		}
		else{
		}
	});
	$('.donatewin #cancel').click(function(){
		$('.donatewin input[name="containercode"]').val('');
		$('.donatewin input[name="label"]').val('');
		donatewin.dialog('close');
	});
	$('.order#order #MemberBill #billfun #citybox #billfun1').on('click','#weborder',function(){
		$.ajax({
			url:'./lib/js/lockdb.ajax.php',
			async:false,
			success:function(d){
				//console.log(d);
			},
			error:function(e){
				//console.log(e);
			}
		});
		$.ajax({
			url:'https://www.quickcode.com.tw/outposandorder/demopos/lib/js/downweb.ajax.php',
			method:'post',
			async:false,
			data:{'company':$('.order#order .companydata #company').val(),'dep':$('.order#order .companydata #story').val()},
			dataType:'json',
			success:function(d){
				if(d=='empty'){
				}
				else{
					d[-1]=$('.order#order .companydata #company').val();
					d[-2]=$('.order#order .companydata #story').val();
					//console.log(d);
					$.ajax({
						url:'./lib/js/pushlistdata.ajax.php',
						method:'post',
						async:false,
						data:{'data':d},
						dataType:'html',
						success:function(d){
							$.ajax({
								url:'https://www.quickcode.com.tw/outposandorder/demopos/lib/js/receveweb.ajax.php',
								method:'post',
								async:false,
								data:{'company':$('.order#order .companydata #company').val(),'dep':$('.order#order .companydata #story').val()},
								dataType:'html',
								success:function(d){
									console.log(d);
								},
								error:function(e){
									console.log(e);
								}
							});
							console.log(d);
						},
						error:function(e){
							console.log(e);
						}
					});
				}
			},
			error:function(e){
				console.log(e);
			}
		});
		$.ajax({
			url:'https://www.quickcode.com.tw/outposandorder/demopos/lib/js/changeweb.ajax.php',
			method:'post',
			data:{'company':$('.order#order .companydata #company').val(),'dep':$('.order#order .companydata #story').val()},
			dataType:'html',
			success:function(d){
				console.log(d);
			},
			error:function(e){
				console.log(e);
			}
		});
		$.ajax({
			url:'./lib/js/unlockdb.ajax.php',
			async:false,
			success:function(d){
				//console.log(d);
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.order#order #MemberBill #billfun #citybox #billfun3 #historypaper').click(function(){
		historypaper.dialog('open');
	});
	$('.historypaper #cancel').click(function(){
		historypaper.dialog('close');
	});
	$('.historypaper #send').click(function(){
		if(parseInt($('.historypaper #papbizdateS').val().substr(0,4))-parseInt($('.historypaper #papbizdateE').val().substr(0,4))==0&&parseInt($('.historypaper #papbizdateS').val().substr(5,2))-parseInt($('.historypaper #papbizdateE').val().substr(5,2))==0){
			if(parseInt($('.historypaper #papbizdateS').val().replace(/-/g,''))<=parseInt($('.historypaper #papbizdateE').val().replace(/-/g,''))){
				if($('.order#order .initsetting #voidsale').val()=='0'){
					if($('.historypaper select[name="paperlist"] option:selected').val()=='paper1'){
						$.ajax({
							url:'./lib/js/shift.paper.php',
							method:'post',
							async:false,
							data:{'papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
							dataType:'html',
							success:function(d){
								console.log(d);
							},
							error:function(e){
								console.log(e);
							}
						});
					}
					else if($('.historypaper select[name="paperlist"] option:selected').val()=='paper2'){
						$.ajax({
							url:'./lib/js/hispaper2.php',
							method:'post',
							async:false,
							data:{'papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
							dataType:'html',
							success:function(d){
								console.log(d);
							},
							error:function(e){
								console.log(e);
							}
						});
					}
					else if($('.historypaper select[name="paperlist"] option:selected').val()=='paper3'){
						$.ajax({
							url:'./lib/js/hispaper3.php',
							method:'post',
							async:false,
							data:{'papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
							dataType:'html',
							success:function(d){
								console.log(d);
							},
							error:function(e){
								console.log(e);
							}
						});
					}
					else if($('.historypaper select[name="paperlist"] option:selected').val()=='paper4'){
						$.ajax({
							url:'./lib/js/hispaper4.php',
							method:'post',
							async:false,
							data:{'papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
							dataType:'html',
							success:function(d){
								console.log(d);
							},
							error:function(e){
								console.log(e);
							}
						});
					}
					else{
					}
				}
				else{
					$('.verpsw input[name="type"]').val('paper');
					verpsw.dialog('open');
				}
			}
			else{
				if($('.sysmeg #name1.syshint5').length>0){
					$('.sysmeg #name1.syshint5').css({'display':''});
				}
				else{
				}
				if($('.sysmeg #name2.syshint5').length>0){
					$('.sysmeg #name2.syshint5').css({'display':''});
				}
				else{
				}
				sysmeg.dialog('open');
			}
		}
		else{
			if($('.sysmeg #name1.syshint6').length>0){
				$('.sysmeg #name1.syshint6').css({'display':''});
			}
			else{
			}
			if($('.sysmeg #name2.syshint6').length>0){
				$('.sysmeg #name2.syshint6').css({'display':''});
			}
			else{
			}
			sysmeg.dialog('open');
		}
	});
	$('.historypaper #view').click(function(){
		//viewpaper.dialog('open');
		if(parseInt($('.historypaper #papbizdateS').val().substr(0,4))-parseInt($('.historypaper #papbizdateE').val().substr(0,4))==0&&parseInt($('.historypaper #papbizdateS').val().substr(5,2))-parseInt($('.historypaper #papbizdateE').val().substr(5,2))==0){
			if(parseInt($('.historypaper #papbizdateS').val().replace(/-/g,''))<=parseInt($('.historypaper #papbizdateE').val().replace(/-/g,''))){
				if($('.order#order .initsetting #voidsale').val()=='0'){
					if($('.historypaper select[name="paperlist"] option:selected').val()=='paper1'){
						$.ajax({
							url:'./lib/js/shift.paper.php',
							method:'post',
							async:false,
							data:{'type':'view','papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
							dataType:'html',
							success:function(d){
								$('.viewpaper').html(d);
								viewpaper.dialog('open');
								console.log(d);
							},
							error:function(e){
								console.log(e);
							}
						});
					}
					else if($('.historypaper select[name="paperlist"] option:selected').val()=='paper2'){
						$.ajax({
							url:'./lib/js/hispaper2.php',
							method:'post',
							async:false,
							data:{'type':'view','papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
							dataType:'html',
							success:function(d){
								$('.viewpaper').html(d);
								viewpaper.dialog('open');
								console.log(d);
							},
							error:function(e){
								console.log(e);
							}
						});
					}
					else if($('.historypaper select[name="paperlist"] option:selected').val()=='paper3'){
						$.ajax({
							url:'./lib/js/hispaper3.php',
							method:'post',
							async:false,
							data:{'type':'view','papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
							dataType:'html',
							success:function(d){
								$('.viewpaper').html(d);
								viewpaper.dialog('open');
								console.log(d);
							},
							error:function(e){
								console.log(e);
							}
						});
					}
					else if($('.historypaper select[name="paperlist"] option:selected').val()=='paper4'){
						$.ajax({
							url:'./lib/js/hispaper4.php',
							method:'post',
							async:false,
							data:{'type':'view','papbizdateS':$('.historypaper #papbizdateS').val().replace(/-/g,''),'papbizdateE':$('.historypaper #papbizdateE').val().replace(/-/g,''),'zcounter':$('.historypaper select[name="zcounter"] option:selected').val()},
							dataType:'html',
							success:function(d){
								$('.viewpaper').html(d);
								viewpaper.dialog('open');
								console.log(d);
							},
							error:function(e){
								console.log(e);
							}
						});
					}
					else{
					}
				}
				else{
					$('.verpsw input[name="type"]').val('viewpaper');
					verpsw.dialog('open');
				}
			}
			else{
				if($('.sysmeg #name1.syshint5').length>0){
					$('.sysmeg #name1.syshint5').css({'display':''});
				}
				else{
				}
				if($('.sysmeg #name2.syshint5').length>0){
					$('.sysmeg #name2.syshint5').css({'display':''});
				}
				else{
				}
				sysmeg.dialog('open');
			}
		}
		else{
			if($('.sysmeg #name1.syshint6').length>0){
				$('.sysmeg #name1.syshint6').css({'display':''});
			}
			else{
			}
			if($('.sysmeg #name2.syshint6').length>0){
				$('.sysmeg #name2.syshint6').css({'display':''});
			}
			else{
			}
			sysmeg.dialog('open');
		}
	});
	$('.order#order #menubox #itemfun #changetaste').click(function(){
		if($('.order#order .parameters #taste1').val()!=''){
			var temp=$('.order#order .parameters #taste1').val().split(';');
			temp=temp[1].split(',');
			if(temp.length>((Number($('.order#order #menubox #itemfun .startchangetaste').val())+1)*10)){
				$('.order#order #menubox #itemfun .startchangetaste').val((Number($('.order#order #menubox #itemfun .startchangetaste').val())+1));
			}
			else{
				$('.order#order #menubox #itemfun .startchangetaste').val('0');
			}
		}
		else{
		}
		$('.order#order #menubox #itemfun .itemfun').trigger( "click" );
	});
	$('.order#order #MemberBill #billfun #citybox #billfun2').on('click','#kvm',function(){
		$.ajax({
			url:'./lib/js/getkvmlist.ajax.php',
			async:false,
			dataType:'html',
			success:function(d){
				//console.log(d);
				$('.kvm #salelist #salecontent').html(d);
			},
			error:function(e){
				console.log(e);
			}
		});
		if(kvm.dialog('isOpen')){
		}
		else{
			kvm.dialog('open');
		}
	});
	$('.kvm #salelist #salecontent').on('click','.listitems',function(){
		var index=$('.kvm #salelist #salecontent .listitems').index(this);
		$('.kvm #salelist #salecontent .listitems').prop('id','');
		$('.kvm #salelist #salecontent .listitems:eq('+index+')').prop('id','focus');
		$('.kvm #listno').html($('.kvm #salelist #salecontent .listitems:eq('+index+') div:eq(1)').html()+"("+$('.kvm #salelist #salecontent .listitems:eq('+index+') div:eq(1) input[name="consecnumber"]').val()+")");
		$('.kvm #date').html($('.kvm #salelist #salecontent .listitems:eq('+index+') div:eq(0)').html());
		$('.kvm #credate').val($('.kvm #salelist #salecontent .listitems:eq('+index+') div:eq(3)').html().substr(0,8));
		$.ajax({
			url:'./lib/js/getsaledetail.ajax.php',
			method:'post',
			data:{'company':$('.order#order .companydata #company').val(),'bizdate':$('.kvm #salelist #salecontent .listitems:eq('+index+') div:eq(0)').html(),'no':$('.kvm #salelist #salecontent .listitems:eq('+index+') div:eq(1) input[name="consecnumber"]').val(),'createdatetime':$('.kvm #salelist #salecontent .listitems:eq('+index+') div:eq(3)').html(),'temp':'kvm'},
			dataType:'html',
			success:function(d){
				//console.log(d);
				$('.kvm #list #listcontent').html(d);
				$('.kvm #delete').prop('disabled',false);
				
			},
			error:function(e){
				//console.log(e);
			}
		});
	});
	$('.kvm #fun').on('click','#delete',function(){
		//console.log('1');
		$.ajax({
			url:'./lib/js/deletekvm.ajax.php',
			method:'post',
			async:false,
			data:{'bizdate':$('.kvm #date').html(),'consecnumber':$('.kvm #listno input[name="consecnumber"]').val()},
			dataType:'html',
			success:function(d){
				//console.log(d);
				$('.kvm #listno').html('');
				$('.kvm #date').html('');
				$('.kvm #credate').html('');
				$('.kvm #list #listcontent').html('');
				$('.kvm #delete').prop('disabled',true);
				$('.order#order #MemberBill #billfun #citybox #billfun2 #kvm').trigger('click');
			},
			error:function(e){
				console.log(e);
			}
		});
	});
	$('.kvm #fun').on('click','#exit',function(){
		kvm.dialog('close');
	});
	$('.order#order #MemberBill #billfun #citybox #billfun3').on('click','#editpunch',function(){
		if($('.order#order .initsetting #voidsale').val()=='1'){
			$('.verpsw input[name="type"]').val('editpunch');
			verpsw.dialog('open');
		}
		else{
			editpunch.dialog('open');
		}
	});
	$('.editpunch').on('click','#search',function(){
		$.ajax({
			url:'./lib/js/getpunchlist.ajax.php',
			method:'post',
			async:false,
			data:{'start':$('.editpunch #startpunch').val(),'end':$('.editpunch #endpunch').val(),'perno':$('.editpunch select[name="punchname"] option:selected').val()},
			dataType:'html',
			success:function(d){
				//console.log(d);
				$('.editpunch #searchresult').html(d);
				$('.editpunch #printpunch').prop('disabled',false);
			},
			error:function(e){
				console.log(e);
			}
		});
	});
	$('.editpunch').on('click','#printpunch',function(){
		$.ajax({
			url:'./lib/js/create.punchlist.php',
			method:'post',
			async:false,
			data:{'start':$('.editpunch #startpunch').val(),'end':$('.editpunch #endpunch').val(),'perno':$('.editpunch select[name="punchname"] option:selected').val()},
			dataType:'html',
			success:function(d){
				console.log(d);
			},
			error:function(e){
				console.log(e);
			}
		});
	});
	$('.editpunch #searchresult').on('click','.punchlabel',function(){
		if($(this).find('#date').val()!=''&&$(this).find('#time').val()!=''){
			$.ajax({
				url:'./lib/js/getpunchlistdata.ajax.php',
				method:'post',
				async:false,
				data:{'perno':$(this).find('#perno').val(),'date':$(this).find('#date').val(),'time':$(this).find('#time').val()},
				dataType:'json',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'editpunch search getpunchlistdata.ajax.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
					$('.editpunch #editperson').val(d[0]['name']);
					$('.editpunch #editperno').val(d[0]['perno']);
					$('.editpunch #initeditDATE').val(d[0]['date']);
					$('.editpunch #initeditTIME').val(d[0]['time']);
					$('.editpunch #initeditH').val(d[0]['time'].substr(0,2));
					$('.editpunch #initeditI').val(d[0]['time'].substr(3,2));

					$(".editpunch #editDATE").datepicker('setDate',d[0]['date']);
					$('.editpunch #editDATE').prop('disabled',false);
					$('.editpunch #editH option').prop('selected',false);
					$('.editpunch #editH option:eq('+(Number(d[0]['time'].substr(0,2))+1)+')').prop('selected',true);
					$('.editpunch #editH').prop('disabled',false);
					$('.editpunch #editI option').prop('selected',false);
					$('.editpunch #editI option:eq('+(Number(d[0]['time'].substr(3,2))+1)+')').prop('selected',true);
					$('.editpunch #editI').prop('disabled',false);

					$('.editpunch #cancel').prop('disabled',false);
					$('.editpunch #save').prop('disabled',false);
					$('.editpunch #printpunch').prop('disabled',true);
				},
				error:function(e){
					console.log(e);
				}
			});
		}
		else{
		}
	});
	$('.editpunch #cancel').click(function(){
		$('.editpunch #editperson').val('');
		$('.editpunch #editperno').val('');
		$('.editpunch #initeditDATE').val('');
		$('.editpunch #initeditTIME').val('');
		$('.editpunch #initeditH').val('');
		$('.editpunch #initeditI').val('');

		$(".editpunch #editDATE").datepicker('setDate','');
		$('.editpunch #editDATE').prop('disabled',true);
		$('.editpunch #editH option').prop('selected',false);
		$('.editpunch #editH option:eq(0)').prop('selected',true);
		$('.editpunch #editH').prop('disabled',true);
		$('.editpunch #editI option').prop('selected',false);
		$('.editpunch #editI option:eq(0)').prop('selected',true);
		$('.editpunch #editI').prop('disabled',true);
		
		$('.editpunch #cancel').prop('disabled',true);
		$('.editpunch #save').prop('disabled',true);
	});
	$('.editpunch #save').click(function(){
		$.ajax({
			url:'./lib/js/savepunchlist.ajax.php',
			method:'post',
			async:false,
			data:{'perno':$('.editpunch #editperno').val(),'initdate':$('.editpunch #initeditDATE').val(),'inittime':$('.editpunch #initeditTIME').val(),'date':$('.editpunch #editDATE').val(),'time':$('.editpunch #editH').val()+':'+$('.editpunch #editI').val()},
			dataType:'html',
			success:function(d){
				console.log(d);
			},
			error:function(e){
				console.log(e);
			}
		});
		$('.editpunch #editperson').val('');
		$('.editpunch #editperno').val('');
		$('.editpunch #initeditDATE').val('');
		$('.editpunch #initeditTIME').val('');
		$('.editpunch #initeditH').val('');
		$('.editpunch #initeditI').val('');

		$(".editpunch #editDATE").datepicker('setDate','');
		$('.editpunch #editDATE').prop('disabled',true);
		$('.editpunch #editH option').prop('selected',false);
		$('.editpunch #editH option:eq(0)').prop('selected',true);
		$('.editpunch #editH').prop('disabled',true);
		$('.editpunch #editI option').prop('selected',false);
		$('.editpunch #editI option:eq(0)').prop('selected',true);
		$('.editpunch #editI').prop('disabled',true);
		
		$('.editpunch #cancel').prop('disabled',true);
		$('.editpunch #save').prop('disabled',true);
		$('.editpunch #search').trigger('click');
	});
	$('.editpunch').on('click','#exit',function(){
		editpunch.dialog('close');
	});
	$('.order#order #content #member #memdeposit').click(function(){
		memdeposit.dialog('open');
	});
	$('.memdeposit #exit').click(function(){
		$('.memdeposit input[name="type"]').prop('checked',false);
		$('.memdeposit input[name="type"]:eq(0)').prop('checked',true);
		$('.memdeposit #memcard').val('');
		$('.memdeposit #memname').val('');
		$('.memdeposit #remaining').val('');
		$('.memdeposit #money').val('');
		memdeposit.dialog('close');
	});
	$('.emptyitemsvoidlist .void').click(function(){
		$('.verpsw input[name="type"]').val('viewvoidbyemptylist');
		verpsw.dialog('open');
	});
	$('.emptyitemsvoidlist .return').click(function(){
		var nowbizdate=$('.order#order #tabs4 #listform input[name="bizdate"]').val();
		$.ajax({
			url:'./lib/js/create.voidtempdb.php',
			method:'post',
			async: false,
			data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'tablenumber':$('.order#order #tabs4 #listform input[name="tablenumber"]').val(),'machine':$('.order#order .companydata #terminalnumber').val()},
			dataType:'html',
			success:function(d){
				if(d.length>20){
					$.ajax({
						url:'./lib/js/print.php',
						method:'post',
						data:{'html':'return emptyitemsvoidlist create.voidtempdb.php '+d},
						dataType:'html',
						success:function(d){/*console.log(d);*/},
						error:function(e){/*console.log(e);*/}
					});
				}
				else{
				}
				//console.log(d);
			},
			error:function(e){
				//console.log(e);
			}
		});
		if($('.order#order .initsetting #secview').val()=='1'){
			$.ajax({
				url:'../secview/cleartemp.ajax.php',
				async: false,
				dataType:'html',
				success:function(d){
					if(d.length>20){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'temp cleartemp.ajax.php '+d},
							dataType:'html',
							success:function(d){/*console.log(d);*/},
							error:function(e){/*console.log(e);*/}
						});
					}
					else{
					}
					//console.log(d);
				},
				error:function(e){
					//console.log(e);
				}
			});
		}
		else{
		}
		$.ajax({
			url:'./lib/js/create.cmdtxt.php',
			method:'post',
			async: false,
			data:{'cmd':nowbizdate.substr(0,6)+'-change'},
			dataType:'html',
			success:function(d){
				//console.log(d);
			},
			error:function(e){
				//console.log(e);
			}
		});
		if($('.order#order .initsetting #controltable').val()=='1'){
			$.ajax({
				url:'./lib/js/changetabini.ajax.php',
				method:'post',
				async:false,
				data:{'bizdate':$('.order#order #tabs4 #listform input[name="bizdate"]').val(),'tabnum':$('.order#order #tabs4 #listform input[name="tablenumber"]').val(),'consecnumber':$('.order#order #tabs4 #listform input[name="consecnumber"]').val(),'listtype':$('.order#order #tabs4 #listform input[name="listtype"]').val()},
				dataType:'html',
				success:function(d){
					//console.log(d);
				},
				error:function(e){
					//console.log(e);
				}
			});

			inittable.dialog('open');
			ClearWindow('','');
		}
		else{
			ClearWindow('','');
		}
		emptyitemsvoidlist.dialog('close');
		$('.order#order #billfun1 button:eq(4)').prop('disabled',false);
		if($('.order#order .initsetting #controltable').val()=='1'){
			var buttype='b';
		}
		else{
			var buttype='a';
		}
		$.ajax({
			url:'./lib/js/change.button4.php',
			method:'post',
			data:{'type':buttype},
			dataType:'json',
			success:function(d){
				if($('.order#order #billfun #billfun1 button:eq(4) #name1').length>0){
					$('.order#order #billfun #billfun1 button:eq(4) #name1').html(d[0]);
				}
				else{
				}
				if($('.order#order #billfun #billfun1 button:eq(4) #name2').length>0){
					$('.order#order #billfun #billfun1 button:eq(4) #name2').html(d[1]);
				}
				else{
				}
				if($('.order#order .initsetting #controltable').val()=='1'&&$('.order#order .initsetting #opentemp').val()=='0'){
					if(buttype=='a'){
						$('.order#order #billfun #billfun1 button:eq(4)').prop('disabled',true);
					}
					else{
						$('.order#order #billfun #billfun1 button:eq(4)').prop('disabled',false);
					}
				}
				else{
				}
				$('.order#order #billfun #billfun1 button:eq(4)').val(d[2]);
			},
			error:function(e){
				console.log(e);
			}
		});
	});
	/*$('.salelist #rekvm').click(function(){
		$.ajax({
			url:'./lib/js/create.rekvm.php',
			method:'post',
			async:false,
			data:{'type':'salelist','bizdate':$('.salelist #date').html(),'consecnumber':$('.salelist #listno input[name="consecnumber"]').val()},
			dataType:'html',
			success:function(d){
				console.log(d);
			},
			error:function(e){
				console.log(e);
			}
		});
	});*/
	/*鑫寶錸查詢會員資訊*/
	$('.memdeposit #memcard').keypress(function(event){
		if(event.which==13){
			/*start tag*/
			$.ajax({
				url:'./lib/js/print.php',
				method:'post',
				async:false,
				data:{'html':'start bolai-search','file':'bolai'},
				dataType:'html',
				success:function(d){/*console.log(d);*/},
				error:function(e){/*console.log(e);*/}
			});
			if(typeof api_search_bolai!=="undefined"&&typeof api_search_bolai==="function"){
				var searchres=api_search_bolai();
			}
			else{
				$.ajax({
					url:'./lib/js/print.php',
					method:'post',
					async:false,
					data:{'html':'api search bolai is not function','file':'bolai'},
					dataType:'html',
					success:function(d){/*console.log(d);*/},
					error:function(e){/*console.log(e);*/}
				});
				//console.log('not function');
			}
			/*end tag*/
			$.ajax({
				url:'./lib/js/print.php',
				method:'post',
				async:false,
				data:{'html':'end bolai-search','file':'bolai'},
				dataType:'html',
				success:function(d){/*console.log(d);*/},
				error:function(e){/*console.log(e);*/}
			});
		}
		else{
		}
	});
	/*鑫寶錸儲值*/
	$('.memdeposit #send').click(function(){
		/*start tag*/
		$.ajax({
			url:'./lib/js/print.php',
			method:'post',
			async:false,
			data:{'html':'start bolai-deposit','file':'bolai'},
			dataType:'html',
			success:function(d){/*console.log(d);*/},
			error:function(e){/*console.log(e);*/}
		});
		if(typeof api_deposit_bolai!=="undefined"&&typeof api_deposit_bolai==="function"){
			var depositres=api_deposit_bolai($('.memdeposit input[name="type"]:checked').val(),$('.memdeposit #memcard').val(),$('.memdeposit #money').val());
			console.log(depositres);
		}
		else{
			$.ajax({
				url:'./lib/js/print.php',
				method:'post',
				async:false,
				data:{'html':'api deposit bolai is not function','file':'bolai'},
				dataType:'html',
				success:function(d){/*console.log(d);*/},
				error:function(e){/*console.log(e);*/}
			});
			//console.log('not function');
		}
		/*end tag*/
		$.ajax({
			url:'./lib/js/print.php',
			method:'post',
			async:false,
			data:{'html':'end bolai-deposit','file':'bolai'},
			dataType:'html',
			success:function(d){/*console.log(d);*/},
			error:function(e){/*console.log(e);*/}
		});
	});
	/*集點樹查詢剩餘點數*/
	$('.result #funbox .pointtree').click(function(){
		$('.result #viewwindow input[name="treetel"]').val($('.result input[name="view"]').val());
		if($('.result input[name="view"]').val()==''){
			$('.result #funbox .pointtree #name3').html('');
			$('.result #funbox .pointtree #name2').html('');
			$('.pointtreememdata #tel').html('');
			$('.pointtreememdata #name').html('');
			$('.pointtreememdata #ismem').html('');
			$('.pointtreememdata #sex').html('');
			$('.pointtreememdata #balance').html('');
			if($('.order#order .initsetting #secview').val()=='1'){
				$.ajax({
					url:'../secview/writepoint.ajax.php',
					method:'post',
					data:{'tel':$('.result #viewwindow input[name="treetel"]').val(),'point':'0','machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val()},
					dataType:'html',
					success:function(d){
						if(d.length>20){
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'searchpoint writepoint.ajax.php '+d},
								dataType:'html',
								success:function(d){/*console.log(d);*/},
								error:function(e){/*console.log(e);*/}
							});
						}
						else{
						}
						//console.log(d);
					},
					error:function(e){
						//console.log(e);
					}
				});
			}
			else{
			}
		}
		else{
			/*start tag*/
			$.ajax({
				url:'./lib/js/print.php',
				method:'post',
				async:false,
				data:{'html':'start point-tree-search transfer','file':'point-tree'},
				dataType:'html',
				success:function(d){/*console.log(d);*/},
				error:function(e){/*console.log(e);*/}
			});

			if(typeof api_search_pointtree!=="undefined"&&typeof api_search_pointtree==="function"){
				var searchres=api_search_pointtree($('.result #viewwindow input[name="treetoken"]').val(),$('.result #viewwindow input[name="treetel"]').val());
				//console.log(searchres);
				if(typeof searchres['data']!=="undefined"){//success
					if($('.order#order .initsetting #secview').val()=='1'){
						$.ajax({
							url:'../secview/writepoint.ajax.php',
							method:'post',
							data:{'tel':$('.result #viewwindow input[name="treetel"]').val(),'point':searchres["data"]["balance"],'machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val()},
							dataType:'html',
							success:function(d){
								if(d.length>20){
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										data:{'html':'searchpoint writepoint.ajax.php '+d,'file':'point-tree'},
										dataType:'html',
										success:function(d){
											//console.log(d);
										},
										error:function(e){
											//console.log(e);
										}
									});
								}
								else{
								}
								//console.log(d);
							},
							error:function(e){
								//console.log(e);
							}
						});
					}
					else{
					}
					//console.log(searchres);
					$('.result #funbox .pointtree #name3').html($('.result #viewwindow input[name="treetel"]').val());
					$('.result #funbox .pointtree #name2').html(searchres["data"]["balance"]);
					$('.pointtreememdata #tel').html($('.result #viewwindow input[name="treetel"]').val());
					$('.pointtreememdata #name').html(searchres['data']['name']);
					if(searchres['data']['is_active']){
						$('.pointtreememdata #ismem').html("YES");
					}
					else{
						$('.pointtreememdata #ismem').html("NO");
					}
					$('.pointtreememdata #sex').html(searchres['data']['sex']);
					$('.pointtreememdata #balance').html(searchres['data']['balance']);
					pointtreememdata.dialog('open');

					$.ajax({
						url:'./lib/js/create.member.php',
						method:'post',
						async: false,
						data:{'type':'offline','company':$('.order#order .companydata #company').val(),'story':$('.order#order .companydata #story').val(),'name':searchres['data']['name']+' ','tel':$('.result #viewwindow input[name="treetel"]').val(),'initpower':$('.order#order .companydata #initpower').val()},
						dataType:'html',
						success:function(d){
							//console.log(d);
							if(d.length>20){
								$.ajax({
									url:'./lib/js/print.php',
									method:'post',
									data:{'html':'cremem-create-offline create.member.php '+d},
									dataType:'html',
									success:function(d){/*console.log(d);*/},
									error:function(e){/*console.log(e);*/}
								});
							}
							else{
							}
							if(d=='exists'){
							}
							else if(d=='success'){
							}
							else{
							}
						},
						error:function(e){
						}
					});
					if($('.order#order .initsetting #onlinemember').length>0&&$('.order#order .initsetting #onlinemember').val()=='1'){
						$.ajax({
							url:'https://www.quickcode.com.tw/outposandorder/demopos/lib/js/create.member.php',
							method:'post',
							async: false,
							data:{'type':'online','company':$('.order#order .companydata #company').val(),'story':$('.order#order .companydata #story').val(),'name':searchres['data']['name']+' ','tel':$('.result #viewwindow input[name="treetel"]').val(),'initpower':$('.order#order .companydata #initpower').val()},
							dataType:'html',
							success:function(d){
								//console.log(d);
								if(d.length>20){
									$.ajax({
										url:'./lib/js/print.php',
										method:'post',
										data:{'html':'cremem-create-online create.member.php '+d},
										dataType:'html',
										success:function(d){/*console.log(d);*/},
										error:function(e){/*console.log(e);*/}
									});
								}
								else{
								}
								if(d=='exists'){
								}
								else if(d=='success'){
								}
								else{
								}
							},
							error:function(e){
							}
						});
					}
					else{
					}
				}
				else{
					//console.log(searchres);
					var message=JSON.parse(searchres['responseText']);
					if(searchres['status']==='timeout'){
						alert('與查詢伺服器連線逾時。');
						$('.result #viewwindow input[name="treetel"]').val('');
					}
					else if(searchres['status']=='400'){
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'API https://pointtree.com.tw/api/v1/pos/members/information -PHP_EOL-status:'+searchres['status']+'-PHP_EOL-code:'+message['errors'][0]['code']+'-PHP_EOL-message:'+message['errors'][0]['message'],'file':'point-tree'},
							dataType:'html',
							success:function(d){
								//console.log(d);
							},
							error:function(e){
								//console.log(e);
							}
						});
						console.log(searchres);
						$('.result #funbox .pointtree #name3').html('查詢錯誤');
						$('.result #funbox .pointtree #name2').html('');
						//alert('status:'+e['status']+'\ncode:'+message['errors'][0]['code']+'\nmessage:'+message['errors'][0]['message']);
						$('.result #viewwindow input[name="treetel"]').val('');
					}
					else if(searchres['status']=='406'){
						if(message['errors'][0]['code']=='not_found'){
							if($('.order#order .initsetting #secview').val()=='1'){
								$.ajax({
									url:'../secview/writepoint.ajax.php',
									method:'post',
									data:{'tel':$('.result #viewwindow input[name="treetel"]').val(),'point':'0','machinetype':$('.order#order #tabs4 #listform input[name="machinetype"]').val()},
									dataType:'html',
									success:function(d){
										if(d.length>20){
											$.ajax({
												url:'./lib/js/print.php',
												method:'post',
												data:{'html':'searchpoint writepoint.ajax.php '+d,'file':'point-tree'},
												dataType:'html',
												success:function(d){
													//console.log(d);
												},
												error:function(e){
													//console.log(e);
												}
											});
										}
										else{
										}
										//console.log(d);
									},
									error:function(e){
										//console.log(e);
									}
								});
							}
							else{
							}
							$('.result #funbox .pointtree #name3').html($('.result #viewwindow input[name="treetel"]').val());
							$('.result #funbox .pointtree #name2').html('0');
							//alert('客戶手機:'+$('.result #viewwindow input[name="treetel"]').val()+'\n剩餘點數:0');
						}
						else{
							$.ajax({
								url:'./lib/js/print.php',
								method:'post',
								data:{'html':'API https://pointtree.com.tw/api/v1/pos/members/information -PHP_EOL-status:'+searchres['status']+'-PHP_EOL-code:'+message['errors'][0]['code']+'-PHP_EOL-message:'+message['errors'][0]['message'],'file':'point-tree'},
								dataType:'html',
								success:function(d){
									//console.log(d);
								},
								error:function(e){
									//console.log(e);
								}
							});
							$('.result #funbox .pointtree #name3').html('查詢錯誤');
							$('.result #funbox .pointtree #name2').html('');
							//alert('status:'+e['status']+'\ncode:'+message['errors'][0]['code']+'\nmessage:'+message['errors'][0]['message']);
							$('.result #viewwindow input[name="treetel"]').val('');
						}
					}
					else{
						$.ajax({
							url:'./lib/js/print.php',
							method:'post',
							data:{'html':'API https://pointtree.com.tw/api/v1/pos/members/information 意外錯誤。','file':'point-tree'},
							dataType:'html',
							success:function(d){
								//console.log(d);
							},
							error:function(e){
								//console.log(e);
							}
						});
						$('.result #funbox .pointtree #name3').html('查詢錯誤');
						$('.result #funbox .pointtree #name2').html('');
						//alert('意外錯誤。');
						$('.result #viewwindow input[name="treetel"]').val('');
					}
				}
			}
			else{
				$.ajax({
					url:'./lib/js/print.php',
					method:'post',
					async:false,
					data:{'html':'api search pointtree is not function','file':'point-tree'},
					dataType:'html',
					success:function(d){/*console.log(d);*/},
					error:function(e){/*console.log(e);*/}
				});
				//console.log('not function');
			}
			/*end tag*/
			$.ajax({
				url:'./lib/js/print.php',
				method:'post',
				async:false,
				data:{'html':'end point-tree-search transfer','file':'point-tree'},
				dataType:'html',
				success:function(d){/*console.log(d);*/},
				error:function(e){/*console.log(e);*/}
			});
		}
		$('.result input[name="view"]').val('');
	});
	$('.pointtreememdata #exit').click(function(){
		pointtreememdata.dialog('close');
	});
});